<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>The Kawa Scheme language</title>

<meta name="description" content="The Kawa Scheme language">
<meta name="keywords" content="The Kawa Scheme language">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="#Top" rel="start" title="Top">
<link href="#Overall-Index" rel="index" title="Overall Index">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="dir.html#Top" rel="up" title="(dir)">
<link href="#Installation" rel="next" title="Installation">
<link href="dir.html#Top" rel="prev" title="(dir)">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>

<script type='text/javascript'>
MathJax = {
  options: {
    skipHtmlTags: {'[-]': ['pre']},
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
};
</script><script type="text/javascript" id="MathJax-script" async
  src="mathjax/tex-svg.js">
</script>
<script defer src="qref.js"></script></head>

<body lang="en">
<h1 class="settitle" align="center">The Kawa Scheme language</h1>

















<div class="top" id="Top">
<div class="header">
<p>
Next: <a href="#Installation" accesskey="n" rel="next">Getting and installing Kawa</a>, Previous: <a href="dir.html#Top" accesskey="p" rel="prev">(dir)</a>, Up: <a href="dir.html#Top" accesskey="u" rel="up">(dir)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="The-Kawa-Scheme-language"></span><h1 class="top">The Kawa Scheme language</h1>


<p>Kawa is a general-purpose programming language that runs on the Java platform.
It aims to combine:
</p><ul>
<li> the benefits of dynamic scripting languages
(non-verbose code with less boiler-plate, fast and easy start-up,
a <a href="http://en.wikipedia.org/wiki/Read-eval-print_loop">REPL</a>,
no required compilation step); with
</li><li> the benefits of traditional compiled languages (fast execution, static error detection,
modularity, zero-overhead Java platform integration).
</li></ul>
<p>It is an extension of the long-established <a href="http://www.schemers.org/">Scheme</a>
language, which is in the Lisp family of programming languages.
Kawa has many <a href="#Features">useful features</a>.
</p>
<p>Kawa is also a useful <a href="#Framework">framework</a> for implementing
other programming languages on the Java platform.
It has many useful utility classes.
</p>
<p>This manual describes version 2.93, updated 5 July 2017.
See the summary of <a href="#News">recent changes</a>.
</p>
<p>The Kawa home page (which is currently just an on-line
version of this document) is <a href="http://www.gnu.org/software/kawa/">http://www.gnu.org/software/kawa/</a>.
</p>

<p>The <a href="#Tutorial">Kawa tutorial</a> is useful to get stated.
While it is woefully incomplete, it does link to some other more in-depth
(but not Kawa-specific) Scheme tutorials.
</p>
<p>For copyright information on the software and documentation,
see <a href="#License">License</a>.
</p>
<p>Various people and orgnizations <a href="#Acknowledgements">have contributed to Kawa</a>.
</p>
<p>This package has nothing to do with the defunct Kawa commercial Java IDE.
</p>

<div class="Contents_element" id="SEC_Contents">
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">
<ul class="no-bullet">
<li>
<ul class="no-bullet">
  <li><a id="toc-News-_002d-Recent-Changes" href="#News">1 News - Recent Changes</a></li>
  <li><a id="toc-Features-1" href="#Features">2 Features</a>
  <ul class="no-bullet">
    <li><a id="toc-Implemented-SRFIs-1" href="#Implemented-SRFIs">2.1 Implemented SRFIs</a></li>
    <li><a id="toc-Compatibility-with-standards" href="#Compatibility">2.2 Compatibility with standards</a></li>
  </ul></li>
  <li><a id="toc-The-Kawa-Community" href="#Community">3 The Kawa Community</a>
  <ul class="no-bullet">
    <li><a id="toc-Reporting-bugs-1" href="#Reporting-bugs">3.1 Reporting bugs</a></li>
    <li><a id="toc-General-Kawa-email-and-discussion" href="#Mailing-lists">3.2 General Kawa email and discussion</a></li>
    <li><a id="toc-Acknowledgements-and-thanks" href="#Acknowledgements">3.3 Acknowledgements and thanks</a></li>
    <li><a id="toc-Technical-Support-for-Kawa" href="#Support">3.4 Technical Support for Kawa</a></li>
    <li><a id="toc-Projects-using-Kawa" href="#Projects">3.5 Projects using Kawa</a></li>
    <li><a id="toc-Ideas-and-tasks-for-contributing-to-Kawa" href="#Ideas-and-tasks">3.6 Ideas and tasks for contributing to Kawa</a>
    <ul class="no-bullet">
      <li><a id="toc-Run-interactive-process-in-separate-Java-Virtual-Machine_003a" href="#Run-interactive-process-in-separate-Java-Virtual-Machine_003a">3.6.1 Run interactive process in separate Java Virtual Machine:</a></li>
      <li><a id="toc-Better-dynamic-reload" href="#Better-dynamic-reload">3.6.2 Better dynamic reload</a></li>
      <li><a id="toc-Easier-Access-to-Native-Libraries-using-JNA_002fJNR" href="#Easier-Access-to-Native-Libraries-using-JNA_002fJNR">3.6.3 Easier Access to Native Libraries using JNA/JNR</a></li>
      <li><a id="toc-Types-for-units" href="#Types-for-units">3.6.4 Types for units</a></li>
      <li><a id="toc-Compiler-should-use-class_002dfile-reading-instead-of-reflection" href="#Compiler-should-use-class_002dfile-reading-instead-of-reflection">3.6.5 Compiler should use class-file reading instead of reflection</a></li>
      <li><a id="toc-Mutually-dependent-Java-and-Scheme-modules" href="#Mutually-dependent-Java-and-Scheme-modules">3.6.6 Mutually dependent Java and Scheme modules</a></li>
      <li><a id="toc-Use-Java_002d7-MethodHandles-and-invokedynamic" href="#Use-Java_002d7-MethodHandles-and-invokedynamic">3.6.7 Use Java-7 MethodHandles and invokedynamic</a></li>
      <li><a id="toc-Parameterized-types" href="#Parameterized-types">3.6.8 Parameterized types</a></li>
      <li><a id="toc-Optimized-function-types-and-values-using-MethodHandles" href="#Optimized-function-types-and-values-using-MethodHandles">3.6.9 Optimized function types and values using MethodHandles</a></li>
      <li><a id="toc-Full-continuations" href="#Full-continuations">3.6.10 Full continuations</a></li>
      <li><a id="toc-Faster-tailcalls" href="#Faster-tailcalls">3.6.11 Faster tailcalls</a></li>
      <li><a id="toc-TreeList_002doptimization" href="#TreeList_002doptimization">3.6.12 TreeList-optimization</a></li>
      <li><a id="toc-Asynchronous-evaluation" href="#Asynchronous-evaluation">3.6.13 Asynchronous evaluation</a></li>
      <li><a id="toc-REPL-console-and-other-REPL-improvement" href="#REPL-console-and-other-REPL-improvement">3.6.14 REPL console and other REPL improvement</a></li>
      <li><a id="toc-XQuery_002d3_002e0-functionality" href="#XQuery_002d3_002e0-functionality">3.6.15 XQuery-3.0 functionality</a></li>
      <li><a id="toc-XQuery_002dupdates" href="#XQuery_002dupdates">3.6.16 XQuery-updates</a></li>
      <li><a id="toc-Common-Lisp-support" href="#Common-Lisp-support">3.6.17 Common Lisp support</a></li>
      <li><a id="toc-JEmacs-improvements" href="#JEmacs-improvements">3.6.18 JEmacs improvements</a></li>
      <li><a id="toc-Improved-IDE-integration" href="#Improved-IDE-integration">3.6.19 Improved IDE integration</a>
      <ul class="no-bullet">
        <li><a id="toc-Plugin-for-NetBeans-IDE" href="#Plugin-for-NetBeans-IDE">3.6.19.1 Plugin for NetBeans IDE</a></li>
        <li><a id="toc-Plugin-for-Eclipse-IDE" href="#Plugin-for-Eclipse-IDE">3.6.19.2 Plugin for Eclipse IDE</a></li>
        <li><a id="toc-Improve-Emacs-integration" href="#Improve-Emacs-integration">3.6.19.3 Improve Emacs integration</a></li>
      </ul></li>
      <li><a id="toc-Hop_002dstyle-web-programming" href="#Hop_002dstyle-web-programming">3.6.20 Hop-style web programming</a></li>
      <li><a id="toc-String-localization" href="#String-localization">3.6.21 String localization</a></li>
      <li><a id="toc-Data-binding" href="#Data-binding">3.6.22 Data binding</a></li>
      <li><a id="toc-Decimal-arithmetic-and-repeated-decimals" href="#Decimal-arithmetic-and-repeated-decimals">3.6.23 Decimal arithmetic and repeated decimals</a></li>
      <li><a id="toc-Optional-strict-typing-along-with-an-explicit-dynamic-type" href="#Optional-strict-typing-along-with-an-explicit-dynamic-type">3.6.24 Optional strict typing along with an explicit <code>dynamic</code> type</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Getting-and-installing-Kawa" href="#Installation">4 Getting and installing Kawa</a>
  <ul class="no-bullet">
    <li><a id="toc-Getting-Kawa-1" href="#Getting-Kawa">4.1 Getting Kawa</a>
    <ul class="no-bullet">
      <li><a id="toc-Getting-the-development-sources-using-Git" href="#Getting-the-development-sources-using-Git">4.1.1 Getting the development sources using Git</a></li>
    </ul></li>
    <li><a id="toc-Getting-and-running-Java" href="#Running-Java">4.2 Getting and running Java</a></li>
    <li><a id="toc-Installing-and-using-the-binary-distribution" href="#Binary-distribution">4.3 Installing and using the binary distribution</a></li>
    <li><a id="toc-Installing-and-using-the-source-distribution" href="#Source-distribution">4.4 Installing and using the source distribution</a>
    <ul class="no-bullet">
      <li><a id="toc-Build-Kawa-using-configure-and-make" href="#Build-Kawa-using-configure-and-make">4.4.1 Build Kawa using <code>configure</code> and <code>make</code></a>
      <ul class="no-bullet">
        <li><a id="toc-Configure-options" href="#Configure-options">4.4.1.1 Configure options</a></li>
        <li><a id="toc-Building-on-Windows-using-MinGW" href="#Building-on-Windows-using-MinGW">4.4.1.2 Building on Windows using MinGW</a></li>
        <li><a id="toc-Building-on-Windows-using-Cygwin" href="#Building-on-Windows-using-Cygwin">4.4.1.3 Building on Windows using Cygwin</a></li>
      </ul></li>
      <li><a id="toc-Building-the-documentation" href="#Building-the-documentation">4.4.2 Building the documentation</a>
      <ul class="no-bullet">
        <li><a id="toc-Plain-HTML-documentation" href="#Plain-HTML-documentation">4.4.2.1 Plain HTML documentation</a></li>
        <li><a id="toc-Fancier-HTML-documentation" href="#Fancier-HTML-documentation">4.4.2.2 Fancier HTML documentation</a></li>
        <li><a id="toc-Using-ebook-readers-or-the-_002d_002dbrowse_002dmanual-option" href="#Using-ebook-readers-or-the-_002d_002dbrowse_002dmanual-option">4.4.2.3 Using ebook readers or the &ndash;browse-manual option</a></li>
        <li><a id="toc-Building-a-printable-PDF-file" href="#Building-a-printable-PDF-file">4.4.2.4 Building a printable PDF file</a></li>
      </ul></li>
      <li><a id="toc-Build-Kawa-using-ant" href="#Build-Kawa-using-ant">4.4.3 Build Kawa using <code>ant</code></a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Kawa-Scheme-Tutorial" href="#Tutorial">5 Kawa Scheme Tutorial</a>
  <ul class="no-bullet">
    <li><a id="toc-Introduction" href="#Tutorial-_002d-Introduction">5.1 Introduction</a></li>
    <li><a id="toc-Booleans" href="#Tutorial-_002d-Booleans">5.2 Booleans</a></li>
    <li><a id="toc-Numbers-1" href="#Tutorial-_002d-Numbers">5.3 Numbers</a></li>
    <li><a id="toc-Functions" href="#Tutorial-_002d-Functions">5.4 Functions</a></li>
    <li><a id="toc-Variables" href="#Tutorial-_002d-Variables">5.5 Variables</a></li>
    <li><a id="toc-Composable-pictures-1" href="#Tutorial-_002d-Pictures">5.6 Composable pictures</a></li>
    <li><a id="toc-Lists-and-sequences" href="#Tutorial-_002d-Sequences">5.7 Lists and sequences</a></li>
    <li><a id="toc-Creating-and-using-objects" href="#Tutorial-_002d-Objects">5.8 Creating and using objects</a></li>
    <li><a id="toc-Types-and-declarations" href="#Tutorial-_002d-Types">5.9 Types and declarations</a></li>
    <li><a id="toc-Exceptions-and-errors" href="#Tutorial-_002d-Exceptions-and-errors">5.10 Exceptions and errors</a></li>
    <li><a id="toc-Classes" href="#Tutorial-_002d-Classes">5.11 Classes</a></li>
    <li><a id="toc-Other-Java-features" href="#Tutorial-_002d-Other-Java-features">5.12 Other Java features</a></li>
  </ul></li>
</ul></li>
<li><a id="toc-Reference-Documentation" href="#Reference-Documentation">Reference Documentation</a>
<ul class="no-bullet">
  <li><a id="toc-How-to-start-up-and-run-Kawa" href="#Running">6 How to start up and run Kawa</a>
  <ul class="no-bullet">
    <li><a id="toc-Command_002dline-arguments" href="#Options">6.1 Command-line arguments</a>
    <ul class="no-bullet">
      <li><a id="toc-Argument-processing" href="#Argument-processing">6.1.1 Argument processing</a></li>
      <li><a id="toc-General-options" href="#General-options">6.1.2 General options</a></li>
      <li><a id="toc-Options-for-language-selection" href="#Options-for-language-selection">6.1.3 Options for language selection</a></li>
      <li><a id="toc-Options-for-warnings-and-errors" href="#Options-for-warnings-and-errors">6.1.4 Options for warnings and errors</a></li>
      <li><a id="toc-Options-for-setting-variables" href="#Options-for-setting-variables">6.1.5 Options for setting variables</a></li>
      <li><a id="toc-Options-for-the-REPL-console" href="#Options-for-the-REPL-console">6.1.6 Options for the REPL console</a></li>
      <li><a id="toc-Options-for-controlling-output-formatting" href="#Options-for-controlling-output-formatting">6.1.7 Options for controlling output formatting</a></li>
      <li><a id="toc-Options-for-compiling-and-optimizing" href="#Options-for-compiling-and-optimizing">6.1.8 Options for compiling and optimizing</a></li>
      <li><a id="toc-Options-for-debugging" href="#Options-for-debugging">6.1.9 Options for debugging</a></li>
      <li><a id="toc-Options-for-web-servers" href="#Options-for-web-servers">6.1.10 Options for web servers</a></li>
      <li><a id="toc-Options-for-the-JVM" href="#Options-for-the-JVM">6.1.11 Options for the JVM</a></li>
    </ul></li>
    <li><a id="toc-Running-Command-Scripts" href="#Scripts">6.2 Running Command Scripts</a>
    <ul class="no-bullet">
      <li><a id="toc-Setting-kawa-options-in-the-script" href="#Setting-kawa-options-in-the-script">6.2.1 Setting kawa options in the script</a></li>
      <li><a id="toc-Other-ways-to-pass-options-using-meta_002darg-or-_002d_002dscript" href="#Other-ways-to-pass-options-using-meta_002darg-or-_002d_002dscript">6.2.2 Other ways to pass options using meta-arg or &ndash;script</a></li>
      <li><a id="toc-Scripts-for-compiled-code" href="#Scripts-for-compiled-code">6.2.3 Scripts for compiled code</a></li>
    </ul></li>
    <li><a id="toc-The-REPL-_0028read_002deval_002dprint_002dloop_0029-console" href="#REPL-Console">6.3 The REPL (read-eval-print-loop) console</a>
    <ul class="no-bullet">
      <li><a id="toc-Input-line-editing-and-history" href="#Input-line-editing-and-history">6.3.1 Input line editing and history</a></li>
      <li><a id="toc-Running-a-Command-Interpreter-in-a-new-Window" href="#Running-a-Command-Interpreter-in-a-new-Window">6.3.2 Running a Command Interpreter in a new Window</a></li>
      <li><a id="toc-Using-DomTerm-1" href="#Using-DomTerm-1">6.3.3 Using DomTerm</a></li>
    </ul></li>
    <li><a id="toc-Exiting-Kawa" href="#Exiting">6.4 Exiting Kawa</a></li>
    <li><a id="toc-Compiling-to-byte_002dcode" href="#Compiling">6.5 Compiling to byte-code</a>
    <ul class="no-bullet">
      <li><a id="toc-Compiling-to-a-set-of-_002eclass-files" href="#Files-compilation">6.5.1 Compiling to a set of .class files</a></li>
      <li><a id="toc-Compiling-to-an-archive-file" href="#Archive-compilation">6.5.2 Compiling to an archive file</a></li>
      <li><a id="toc-Compiling-using-Ant-1" href="#Compiling-using-Ant">6.5.3 Compiling using Ant</a></li>
      <li><a id="toc-Compiling-to-a-standalone-application" href="#Application-compilation">6.5.4 Compiling to a standalone application</a></li>
      <li><a id="toc-Compiling-to-an-applet" href="#Applet-compilation">6.5.5 Compiling to an applet</a></li>
      <li><a id="toc-Compiling-to-a-native-executable" href="#Compiling-to-executable">6.5.6 Compiling to a native executable</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Syntax-1" href="#Syntax">7 Syntax</a>
  <ul class="no-bullet">
    <li><a id="toc-Notation" href="#Syntax-notation">7.1 Notation</a></li>
    <li><a id="toc-Lexical-and-datum-syntax-1" href="#Lexical-and-datum-syntax">7.2 Lexical and datum syntax</a></li>
    <li><a id="toc-Lexical-syntax-1" href="#Lexical-syntax">7.3 Lexical syntax</a>
    <ul class="no-bullet">
      <li><a id="toc-Formal-account" href="#Formal-account">7.3.1 Formal account</a></li>
      <li><a id="toc-Line-endings" href="#Line-endings">7.3.2 Line endings</a></li>
      <li><a id="toc-Whitespace-and-comments" href="#Whitespace-and-comments">7.3.3 Whitespace and comments</a></li>
      <li><a id="toc-Identifiers" href="#Identifiers">7.3.4 Identifiers</a></li>
      <li><a id="toc-Numbers-2" href="#Numbers-2">7.3.5 Numbers</a></li>
    </ul></li>
    <li><a id="toc-Datum-syntax-1" href="#Datum-syntax">7.4 Datum syntax</a>
    <ul class="no-bullet">
      <li><a id="toc-Datum-labels" href="#Datum-labels">7.4.1 Datum labels</a></li>
      <li><a id="toc-Abbreviations" href="#Abbreviations">7.4.2 Abbreviations</a></li>
    </ul></li>
    <li><a id="toc-Hash_002dprefixed-forms-1" href="#Hash_002dprefixed-forms">7.5 Hash-prefixed forms</a></li>
    <li><a id="toc-Primitive-expression-syntax-1" href="#Primitive-expression-syntax">7.6 Primitive expression syntax</a>
    <ul class="no-bullet">
      <li><a id="toc-Literal-expressions" href="#Literal-expressions">7.6.1 Literal expressions</a></li>
      <li><a id="toc-Variable-references" href="#Variable-references">7.6.2 Variable references</a></li>
      <li><a id="toc-Procedure-calls" href="#Procedure-calls">7.6.3 Procedure calls</a></li>
    </ul></li>
    <li><a id="toc-Property-access-using-colon-notation" href="#Colon-notation">7.7 Property access using colon notation</a>
    <ul class="no-bullet">
      <li><a id="toc-Part-lookup-rules" href="#Part-lookup-rules">7.7.1 Part lookup rules</a></li>
      <li><a id="toc-Specific-cases" href="#Specific-cases">7.7.2 Specific cases</a>
      <ul class="no-bullet">
        <li><a id="toc-Invoking-methods" href="#Invoking-methods">7.7.2.1 Invoking methods</a></li>
        <li><a id="toc-Accessing-fields" href="#Accessing-fields">7.7.2.2 Accessing fields</a></li>
        <li><a id="toc-Type-literal" href="#Type-literal">7.7.2.3 Type literal</a></li>
        <li><a id="toc-Type-cast" href="#Type-cast">7.7.2.4 Type cast</a></li>
        <li><a id="toc-Type-test" href="#Type-test">7.7.2.5 Type test</a></li>
        <li><a id="toc-New-object-construction" href="#New-object-construction">7.7.2.6 New object construction</a></li>
        <li><a id="toc-Getting-array-length" href="#Getting-array-length">7.7.2.7 Getting array length</a></li>
      </ul></li>
    </ul></li>
    <li><a id="toc-Programs-and-Bodies" href="#Bodies">7.8 Programs and Bodies</a></li>
    <li><a id="toc-Syntax-and-conditional-compilation-1" href="#Syntax-and-conditional-compilation">7.9 Syntax and conditional compilation</a></li>
    <li><a id="toc-Macros-1" href="#Macros">7.10 Macros</a>
    <ul class="no-bullet">
      <li><a id="toc-Pattern-language" href="#Pattern-language">7.10.1 Pattern language</a></li>
      <li><a id="toc-Identifier-predicates" href="#Identifier-predicates">7.10.2 Identifier predicates</a></li>
      <li><a id="toc-Syntax_002dobject-and-datum-conversions" href="#Syntax_002dobject-and-datum-conversions">7.10.3 Syntax-object and datum conversions</a></li>
      <li><a id="toc-Signaling-errors-in-macro-transformers" href="#Signaling-errors-in-macro-transformers">7.10.4 Signaling errors in macro transformers</a></li>
      <li><a id="toc-Convenience-forms" href="#Convenience-forms">7.10.5 Convenience forms</a></li>
    </ul></li>
    <li><a id="toc-Named-quasi_002dliterals-1" href="#Named-quasi_002dliterals">7.11 Named quasi-literals</a></li>
  </ul></li>
  <li><a id="toc-Program-structure-1" href="#Program-structure">8 Program structure</a>
  <ul class="no-bullet">
    <li><a id="toc-Boolean-values-1" href="#Boolean-values">8.1 Boolean values</a></li>
    <li><a id="toc-Conditionals-1" href="#Conditionals">8.2 Conditionals</a></li>
    <li><a id="toc-Variables-and-Patterns-1" href="#Variables-and-Patterns">8.3 Variables and Patterns</a>
    <ul class="no-bullet">
      <li><a id="toc-Patterns" href="#Patterns">8.3.1 Patterns</a></li>
    </ul></li>
    <li><a id="toc-Definitions-1" href="#Definitions">8.4 Definitions</a></li>
    <li><a id="toc-Local-binding-constructs-1" href="#Local-binding-constructs">8.5 Local binding constructs</a></li>
    <li><a id="toc-Lazy-evaluation-1" href="#Lazy-evaluation">8.6 Lazy evaluation</a>
    <ul class="no-bullet">
      <li><a id="toc-Delayed-evaluation" href="#Delayed-evaluation">8.6.1 Delayed evaluation</a></li>
      <li><a id="toc-Implicit-forcing" href="#Implicit-forcing">8.6.2 Implicit forcing</a></li>
      <li><a id="toc-Blank-promises" href="#Blank-promises">8.6.3 Blank promises</a></li>
      <li><a id="toc-Lazy-and-eager-types" href="#Lazy-and-eager-types">8.6.4 Lazy and eager types</a></li>
    </ul></li>
    <li><a id="toc-Threads-1" href="#Threads">8.7 Threads</a></li>
    <li><a id="toc-Exception-handling" href="#Exceptions">8.8 Exception handling</a>
    <ul class="no-bullet">
      <li><a id="toc-Simple-error-objects" href="#Simple-error-objects">8.8.1 Simple error objects</a></li>
      <li><a id="toc-Named-exceptions" href="#Named-exceptions">8.8.2 Named exceptions</a></li>
      <li><a id="toc-Native-exception-handling" href="#Native-exception-handling">8.8.3 Native exception handling</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Control-features-1" href="#Control-features">9 Control features</a>
  <ul class="no-bullet">
    <li><a id="toc-Mapping-functions-1" href="#Mapping-functions">9.1 Mapping functions</a></li>
    <li><a id="toc-Multiple-values-1" href="#Multiple-values">9.2 Multiple values</a></li>
  </ul></li>
  <li><a id="toc-Symbols-and-namespaces-1" href="#Symbols-and-namespaces">10 Symbols and namespaces</a>
  <ul class="no-bullet">
    <li><a id="toc-Simple-symbols-1" href="#Simple-symbols">10.1 Simple symbols</a></li>
    <li><a id="toc-Namespaces-and-compound-symbols" href="#Namespaces">10.2 Namespaces and compound symbols</a>
    <ul class="no-bullet">
      <li><a id="toc-Namespace-objects" href="#Namespace-objects">10.2.1 Namespace objects</a></li>
      <li><a id="toc-Compound-symbols" href="#Compound-symbols">10.2.2 Compound symbols</a></li>
      <li><a id="toc-Namespace-aliases" href="#Namespace-aliases">10.2.3 Namespace aliases</a></li>
    </ul></li>
    <li><a id="toc-Keywords-1" href="#Keywords">10.3 Keywords</a></li>
    <li><a id="toc-Special-named-constants-1" href="#Special-named-constants">10.4 Special named constants</a></li>
  </ul></li>
  <li><a id="toc-Procedures-1" href="#Procedures">11 Procedures</a>
  <ul class="no-bullet">
    <li><a id="toc-Application-and-Arguments-Lists-1" href="#Application-and-Arguments-Lists">11.1 Application and Arguments Lists</a>
    <ul class="no-bullet">
      <li><a id="toc-Arguments-lists" href="#Arguments-lists">11.1.1 Arguments lists</a></li>
      <li><a id="toc-Explicit-argument-list-objects" href="#Explicit-argument-list-objects">11.1.2 Explicit argument list objects</a></li>
      <li><a id="toc-Argument-list-library" href="#Argument-list-library">11.1.3 Argument list library</a></li>
      <li><a id="toc-Apply-procedures" href="#Apply-procedures">11.1.4 Apply procedures</a></li>
    </ul></li>
    <li><a id="toc-Procedure-properties-1" href="#Procedure-properties">11.2 Procedure properties</a>
    <ul class="no-bullet">
      <li><a id="toc-Standard-properties" href="#Standard-properties">11.2.1 Standard properties</a></li>
    </ul></li>
    <li><a id="toc-Generic-_0028dynamically-overloaded_0029-procedures" href="#Generic-procedures">11.3 Generic (dynamically overloaded) procedures</a></li>
    <li><a id="toc-Extended-Formal-Arguments-List" href="#Extended-formals">11.4 Extended Formal Arguments List</a></li>
    <li><a id="toc-Partial-application-1" href="#Partial-application">11.5 Partial application</a></li>
  </ul></li>
  <li><a id="toc-Quantities-and-Numbers" href="#Numbers">12 Quantities and Numbers</a>
  <ul class="no-bullet">
    <li><a id="toc-Numerical-types-1" href="#Numerical-types">12.1 Numerical types</a>
    <ul class="no-bullet">
      <li><a id="toc-Exactness" href="#Exactness">12.1.1 Exactness</a></li>
      <li><a id="toc-Numerical-promotion-and-conversion" href="#Numerical-promotion-and-conversion">12.1.2 Numerical promotion and conversion</a></li>
    </ul></li>
    <li><a id="toc-Arithmetic-operations-1" href="#Arithmetic-operations">12.2 Arithmetic operations</a></li>
    <li><a id="toc-Numerical-input-and-output-1" href="#Numerical-input-and-output">12.3 Numerical input and output</a></li>
    <li><a id="toc-Quaternions-1" href="#Quaternions">12.4 Quaternions</a>
    <ul class="no-bullet">
      <li><a id="toc-The-_0028kawa-quaternions_0029-module" href="#The-_0028kawa-quaternions_0029-module">12.4.1 The <code>(kawa quaternions)</code> module</a></li>
      <li><a id="toc-The-_0028kawa-rotations_0029-module" href="#The-_0028kawa-rotations_0029-module">12.4.2 The <code>(kawa rotations)</code> module</a>
      <ul class="no-bullet">
        <li><a id="toc-Rotation-Representation-Conversions" href="#Rotation-Representation-Conversions">12.4.2.1 Rotation Representation Conversions</a></li>
        <li><a id="toc-Rotation-Operations" href="#Rotation-Operations">12.4.2.2 Rotation Operations</a></li>
      </ul></li>
    </ul></li>
    <li><a id="toc-Quantities-and-Units" href="#Quantities">12.5 Quantities and Units</a></li>
    <li><a id="toc-Logical-Number-Operations-1" href="#Logical-Number-Operations">12.6 Logical Number Operations</a>
    <ul class="no-bullet">
      <li><a id="toc-SRFI_002d60-Logical-Number-Operations" href="#SRFI_002d60-Logical-Number-Operations">12.6.1 SRFI-60 Logical Number Operations</a></li>
      <li><a id="toc-Deprecated-Logical-Number-Operations" href="#Deprecated-Logical-Number-Operations">12.6.2 Deprecated Logical Number Operations</a></li>
    </ul></li>
    <li><a id="toc-Performance-of-numeric-operations-1" href="#Performance-of-numeric-operations">12.7 Performance of numeric operations</a></li>
  </ul></li>
  <li><a id="toc-Characters-and-text-1" href="#Characters-and-text">13 Characters and text</a>
  <ul class="no-bullet">
    <li><a id="toc-Characters-1" href="#Characters">13.1 Characters</a></li>
    <li><a id="toc-Character-sets-1" href="#Character-sets">13.2 Character sets</a></li>
    <li><a id="toc-Strings-1" href="#Strings">13.3 Strings</a>
    <ul class="no-bullet">
      <li><a id="toc-Basic-string-procedures" href="#Basic-string-procedures">13.3.1 Basic string procedures</a></li>
      <li><a id="toc-Immutable-String-Constructors" href="#Immutable-String-Constructors">13.3.2 Immutable String Constructors</a></li>
      <li><a id="toc-Selection" href="#Selection">13.3.3 Selection</a></li>
      <li><a id="toc-String-Comparisons" href="#String-Comparisons">13.3.4 String Comparisons</a></li>
      <li><a id="toc-Conversions" href="#Conversions">13.3.5 Conversions</a></li>
      <li><a id="toc-Searching-and-matching" href="#Searching-and-matching">13.3.6 Searching and matching</a></li>
      <li><a id="toc-Concatenation-and-replacing" href="#Concatenation-and-replacing">13.3.7 Concatenation and replacing</a></li>
      <li><a id="toc-Mapping-and-folding" href="#Mapping-and-folding">13.3.8 Mapping and folding</a></li>
      <li><a id="toc-Replication-_0026-splitting" href="#Replication-_0026-splitting">13.3.9 Replication &amp; splitting</a></li>
      <li><a id="toc-String-mutation" href="#String-mutation">13.3.10 String mutation</a></li>
      <li><a id="toc-Strings-as-sequences" href="#Strings-as-sequences">13.3.11 Strings as sequences</a>
      <ul class="no-bullet">
        <li><a id="toc-Indexing-a-string" href="#Indexing-a-string">13.3.11.1 Indexing a string</a></li>
        <li><a id="toc-Indexing-with-a-sequence" href="#Indexing-with-a-sequence">13.3.11.2 Indexing with a sequence</a></li>
      </ul></li>
      <li><a id="toc-String-Cursor-API-1" href="#String-Cursor-API-1">13.3.12 String Cursor API</a></li>
    </ul></li>
    <li><a id="toc-String-literals-1" href="#String-literals">13.4 String literals</a>
    <ul class="no-bullet">
      <li><a id="toc-Simple-string-literals" href="#Simple-string-literals">13.4.1 Simple string literals</a></li>
      <li><a id="toc-String-templates" href="#String-templates">13.4.2 String templates</a>
      <ul class="no-bullet">
        <li><a id="toc-Special-characters" href="#Special-characters">13.4.2.1 Special characters</a></li>
        <li><a id="toc-Multiline-string-literals" href="#Multiline-string-literals">13.4.2.2 Multiline string literals</a></li>
        <li><a id="toc-Embedded-expressions" href="#Embedded-expressions">13.4.2.3 Embedded expressions</a></li>
        <li><a id="toc-Formatting" href="#Formatting">13.4.2.4 Formatting</a></li>
      </ul></li>
    </ul></li>
    <li><a id="toc-Unicode-character-classes-and-conversions" href="#Unicode">13.5 Unicode character classes and conversions</a>
    <ul class="no-bullet">
      <li><a id="toc-Characters-2" href="#Characters-2">13.5.1 Characters</a></li>
      <li><a id="toc-Deprecated-in_002dplace-case-modification" href="#Deprecated-in_002dplace-case-modification">13.5.2 Deprecated in-place case modification</a></li>
    </ul></li>
    <li><a id="toc-Regular-expressions-1" href="#Regular-expressions">13.6 Regular expressions</a>
    <ul class="no-bullet">
      <li><a id="toc-Java-regular-expressions" href="#Java-regular-expressions">13.6.1 Java regular expressions</a></li>
      <li><a id="toc-Portable-Scheme-regular-expressions" href="#Portable-Scheme-regular-expressions">13.6.2 Portable Scheme regular expressions</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Data-structures-1" href="#Data-structures">14 Data structures</a>
  <ul class="no-bullet">
    <li><a id="toc-Sequences-1" href="#Sequences">14.1 Sequences</a></li>
    <li><a id="toc-Lists-1" href="#Lists">14.2 Lists</a>
    <ul class="no-bullet">
      <li><a id="toc-SRFI_002d1-list-library" href="#SRFI_002d1-list-library">14.2.1 SRFI-1 list library</a></li>
      <li><a id="toc-SRFI_002d101-Purely-Functional-Random_002dAccess-Pairs-and-Lists" href="#SRFI_002d101-Purely-Functional-Random_002dAccess-Pairs-and-Lists">14.2.2 SRFI-101 Purely Functional Random-Access Pairs and Lists</a></li>
    </ul></li>
    <li><a id="toc-Vectors-1" href="#Vectors">14.3 Vectors</a></li>
    <li><a id="toc-Uniform-vectors-1" href="#Uniform-vectors">14.4 Uniform vectors</a>
    <ul class="no-bullet">
      <li><a id="toc-Relationship-with-Java-arrays" href="#Relationship-with-Java-arrays">14.4.1 Relationship with Java arrays</a></li>
    </ul></li>
    <li><a id="toc-Bytevectors-1" href="#Bytevectors">14.5 Bytevectors</a>
    <ul class="no-bullet">
      <li><a id="toc-Converting-to-or-from-strings" href="#Converting-to-or-from-strings">14.5.1 Converting to or from strings</a></li>
    </ul></li>
    <li><a id="toc-Ranges-1" href="#Ranges">14.6 Ranges</a></li>
    <li><a id="toc-Streams-_002d-lazy-lists" href="#Streams">14.7 Streams - lazy lists</a></li>
    <li><a id="toc-Multi_002ddimensional-Arrays" href="#Arrays">14.8 Multi-dimensional Arrays</a>
    <ul class="no-bullet">
      <li><a id="toc-Array-shape" href="#Array-shape">14.8.1 Array shape</a></li>
      <li><a id="toc-Array-types" href="#Array-types">14.8.2 Array types</a></li>
      <li><a id="toc-Array-literals-and-printing" href="#Array-literals-and-printing">14.8.3 Array literals and printing</a></li>
      <li><a id="toc-Array-construction" href="#Array-construction">14.8.4 Array construction</a></li>
      <li><a id="toc-Array-indexing" href="#Array-indexing">14.8.5 Array indexing</a></li>
      <li><a id="toc-Modifying-arrays" href="#Modifying-arrays">14.8.6 Modifying arrays</a></li>
      <li><a id="toc-Transformations-and-views" href="#Transformations-and-views">14.8.7 Transformations and views</a></li>
      <li><a id="toc-Miscellaneous-1" href="#Miscellaneous-1">14.8.8 Miscellaneous</a></li>
    </ul></li>
    <li><a id="toc-Hash-tables-1" href="#Hash-tables">14.9 Hash tables</a>
    <ul class="no-bullet">
      <li><a id="toc-R6RS-hash-tables" href="#R6RS-hash-tables">14.9.1 R6RS hash tables</a>
      <ul class="no-bullet">
        <li><a id="toc-Procedures-2" href="#Procedures-2">14.9.1.1 Procedures</a></li>
        <li><a id="toc-Inspection" href="#Inspection">14.9.1.2 Inspection</a></li>
        <li><a id="toc-Hash-functions" href="#Hash-functions">14.9.1.3 Hash functions</a></li>
      </ul></li>
      <li><a id="toc-SRFI_002d69-hash-tables" href="#SRFI_002d69-hash-tables">14.9.2 SRFI-69 hash tables</a>
      <ul class="no-bullet">
        <li><a id="toc-Type-constructors-and-predicate" href="#Type-constructors-and-predicate">14.9.2.1 Type constructors and predicate</a></li>
        <li><a id="toc-Reflective-queries" href="#Reflective-queries">14.9.2.2 Reflective queries</a></li>
        <li><a id="toc-Dealing-with-single-elements" href="#Dealing-with-single-elements">14.9.2.3 Dealing with single elements</a></li>
        <li><a id="toc-Dealing-with-the-whole-contents" href="#Dealing-with-the-whole-contents">14.9.2.4 Dealing with the whole contents</a></li>
        <li><a id="toc-Hash-functions-1" href="#Hash-functions-1">14.9.2.5 Hash functions</a></li>
      </ul></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Eval-and-Environments-1" href="#Eval-and-Environments">15 Eval and Environments</a>
  <ul class="no-bullet">
    <li><a id="toc-Locations-1" href="#Locations">15.1 Locations</a></li>
    <li><a id="toc-Parameter-objects-1" href="#Parameter-objects">15.2 Parameter objects</a></li>
  </ul></li>
  <li><a id="toc-Debugging-1" href="#Debugging">16 Debugging</a></li>
  <li><a id="toc-Input_002c-output_002c-and-file-handling" href="#Input_002dOutput">17 Input, output, and file handling</a>
  <ul class="no-bullet">
    <li><a id="toc-Named-output-formats-1" href="#Named-output-formats">17.1 Named output formats</a></li>
    <li><a id="toc-Paths-_002d-file-name_002c-URLs_002c-and-URIs" href="#Paths">17.2 Paths - file name, URLs, and URIs</a>
    <ul class="no-bullet">
      <li><a id="toc-Extracting-Path-components" href="#Extracting-Path-components">17.2.1 Extracting Path components</a></li>
    </ul></li>
    <li><a id="toc-File-System-Interface" href="#Files">17.3 File System Interface</a></li>
    <li><a id="toc-Reading-and-writing-whole-files-1" href="#Reading-and-writing-whole-files">17.4 Reading and writing whole files</a>
    <ul class="no-bullet">
      <li><a id="toc-Reading-a-file" href="#Reading-a-file">17.4.1 Reading a file</a></li>
      <li><a id="toc-Blobs-1" href="#Blobs-1">17.4.2 Blobs</a></li>
      <li><a id="toc-Writing-to-a-file" href="#Writing-to-a-file">17.4.3 Writing to a file</a></li>
      <li><a id="toc-Functions-1" href="#Functions-1">17.4.4 Functions</a></li>
    </ul></li>
    <li><a id="toc-Ports-1" href="#Ports">17.5 Ports</a>
    <ul class="no-bullet">
      <li><a id="toc-String-and-bytevector-ports" href="#String-and-bytevector-ports">17.5.1 String and bytevector ports</a></li>
      <li><a id="toc-Input" href="#Input">17.5.2 Input</a></li>
      <li><a id="toc-Output" href="#Output">17.5.3 Output</a></li>
      <li><a id="toc-Prompts-for-interactive-consoles-_0028REPLs_0029" href="#Prompts-for-interactive-consoles-_0028REPLs_0029">17.5.4 Prompts for interactive consoles (REPLs)</a></li>
      <li><a id="toc-Line-numbers-and-other-input-port-properties" href="#Line-numbers-and-other-input-port-properties">17.5.5 Line numbers and other input port properties</a></li>
      <li><a id="toc-Miscellaneous-2" href="#Miscellaneous-2">17.5.6 Miscellaneous</a></li>
    </ul></li>
    <li><a id="toc-Formatted-Output-_0028Common_002dLisp_002dstyle_0029" href="#Format">17.6 Formatted Output (Common-Lisp-style)</a>
    <ul class="no-bullet">
      <li><a id="toc-Implemented-CL-Format-Control-Directives" href="#Implemented-CL-Format-Control-Directives">17.6.1 Implemented CL Format Control Directives</a></li>
      <li><a id="toc-Formatting-Integers" href="#Formatting-Integers">17.6.2 Formatting Integers</a></li>
      <li><a id="toc-Formatting-real-numbers" href="#Formatting-real-numbers">17.6.3 Formatting real numbers</a></li>
      <li><a id="toc-Miscellaneous-formatting-operators" href="#Miscellaneous-formatting-operators">17.6.4 Miscellaneous formatting operators</a></li>
      <li><a id="toc-Unimplemented-CL-Format-Control-Directives" href="#Unimplemented-CL-Format-Control-Directives">17.6.5 Unimplemented CL Format Control Directives</a></li>
      <li><a id="toc-Extended_002c-Replaced-and-Additional-Control-Directives" href="#Extended_002c-Replaced-and-Additional-Control-Directives">17.6.6 Extended, Replaced and Additional Control Directives</a></li>
    </ul></li>
    <li><a id="toc-Pretty_002dprinting-1" href="#Pretty_002dprinting">17.7 Pretty-printing</a>
    <ul class="no-bullet">
      <li><a id="toc-Pretty_002dprinting-Scheme-forms" href="#Pretty_002dprinting-Scheme-forms">17.7.1 Pretty-printing Scheme forms</a></li>
      <li><a id="toc-Generic-pretty_002dprinting-functions" href="#Generic-pretty_002dprinting-functions">17.7.2 Generic pretty-printing functions</a></li>
    </ul></li>
    <li><a id="toc-Resources-1" href="#Resources">17.8 Resources</a></li>
  </ul></li>
  <li><a id="toc-Types-1" href="#Types">18 Types</a>
  <ul class="no-bullet">
    <li><a id="toc-Standard-Types-1" href="#Standard-Types">18.1 Standard Types</a></li>
    <li><a id="toc-Parameterized-Types-1" href="#Parameterized-Types">18.2 Parameterized Types</a></li>
    <li><a id="toc-Type-tests-and-conversions-1" href="#Type-tests-and-conversions">18.3 Type tests and conversions</a></li>
  </ul></li>
  <li><a id="toc-Object_002c-Classes-and-Modules" href="#Objects-Classes-and-Modules">19 Object, Classes and Modules</a>
  <ul class="no-bullet">
    <li><a id="toc-Defining-new-classes-1" href="#Defining-new-classes">19.1 Defining new classes</a>
    <ul class="no-bullet">
      <li><a id="toc-General-class-properties" href="#General-class-properties">19.1.1 General class properties</a></li>
      <li><a id="toc-Declaring-fields" href="#Declaring-fields">19.1.2 Declaring fields</a></li>
      <li><a id="toc-Declaring-methods" href="#Declaring-methods">19.1.3 Declaring methods</a></li>
      <li><a id="toc-Example" href="#Example">19.1.4 Example</a></li>
    </ul></li>
    <li><a id="toc-Anonymous-classes-1" href="#Anonymous-classes">19.2 Anonymous classes</a>
    <ul class="no-bullet">
      <li><a id="toc-Lambda-as-shorthand-for-anonymous-class" href="#Lambda-as-shorthand-for-anonymous-class">19.2.1 Lambda as shorthand for anonymous class</a></li>
    </ul></li>
    <li><a id="toc-Enumeration-types" href="#Enumerations">19.3 Enumeration types</a></li>
    <li><a id="toc-Annotations-of-declarations" href="#Annotations">19.4 Annotations of declarations</a></li>
    <li><a id="toc-Modules-and-how-they-are-compiled-to-classes" href="#Module-classes">19.5 Modules and how they are compiled to classes</a>
    <ul class="no-bullet">
      <li><a id="toc-Name-visibility" href="#Name-visibility">19.5.1 Name visibility</a></li>
      <li><a id="toc-R7RS-explicit-library-modules" href="#R7RS-explicit-library-modules">19.5.2 R7RS explicit library modules</a></li>
      <li><a id="toc-How-a-module-becomes-a-class" href="#How-a-module-becomes-a-class">19.5.3 How a module becomes a class</a></li>
      <li><a id="toc-Same-class-for-module-and-defined-class" href="#Same-class-for-module-and-defined-class">19.5.4 Same class for module and defined class</a></li>
      <li><a id="toc-Static-vs-non_002dstatic-modules" href="#Static-vs-non_002dstatic-modules">19.5.5 Static vs non-static modules</a></li>
      <li><a id="toc-Module-options" href="#Module-options">19.5.6 Module options</a></li>
    </ul></li>
    <li><a id="toc-Importing-from-a-library" href="#Importing">19.6 Importing from a library</a>
    <ul class="no-bullet">
      <li><a id="toc-Searching-for-modules" href="#Searching-for-modules">19.6.1 Searching for modules</a></li>
      <li><a id="toc-Searching-for-source-files" href="#Searching-for-source-files">19.6.2 Searching for source files</a></li>
      <li><a id="toc-Builtin-libraries" href="#Builtin-libraries">19.6.3 Builtin libraries</a></li>
      <li><a id="toc-Importing-a-SRFI-library" href="#Importing-a-SRFI-library">19.6.4 Importing a SRFI library</a></li>
      <li><a id="toc-Importing-from-a-plain-class" href="#Importing-from-a-plain-class">19.6.5 Importing from a plain class</a></li>
    </ul></li>
    <li><a id="toc-Record-types-1" href="#Record-types">19.7 Record types</a></li>
    <li><a id="toc-Creating-New-Record-Types-On_002dthe_002dfly" href="#Dynamic-records">19.8 Creating New Record Types On-the-fly</a></li>
    <li><a id="toc-Calling-Java-methods-from-Scheme" href="#Method-operations">19.9 Calling Java methods from Scheme</a>
    <ul class="no-bullet">
      <li><a id="toc-Calling-static-methods-using-colon-notation" href="#Calling-static-methods-using-colon-notation">19.9.1 Calling static methods using colon notation</a></li>
      <li><a id="toc-Calling-instance-methods-using-colon-notation" href="#Calling-instance-methods-using-colon-notation">19.9.2 Calling instance methods using colon notation</a></li>
      <li><a id="toc-Method-names" href="#Method-names">19.9.3 Method names</a></li>
      <li><a id="toc-Invoking-a-method-with-the-invoke-function" href="#Invoking-a-method-with-the-invoke-function">19.9.4 Invoking a method with the <code>invoke</code> function</a></li>
      <li><a id="toc-Using-a-namespace-prefix" href="#Using-a-namespace-prefix">19.9.5 Using a namespace prefix</a></li>
    </ul></li>
    <li><a id="toc-Allocating-objects-1" href="#Allocating-objects">19.10 Allocating objects</a></li>
    <li><a id="toc-Accessing-object-fields" href="#Field-operations">19.11 Accessing object fields</a>
    <ul class="no-bullet">
      <li><a id="toc-Accessing-static-fields-and-properties" href="#Accessing-static-fields-and-properties">19.11.1 Accessing static fields and properties</a></li>
      <li><a id="toc-Accessing-instance-fields-and-properties" href="#Accessing-instance-fields-and-properties">19.11.2 Accessing instance fields and properties</a></li>
      <li><a id="toc-Using-field-and-static_002dfield-methods" href="#Using-field-and-static_002dfield-methods">19.11.3 Using field and static-field methods</a></li>
      <li><a id="toc-Older-colon_002ddot-notation" href="#Older-colon_002ddot-notation">19.11.4 Older colon-dot notation</a></li>
    </ul></li>
    <li><a id="toc-Mapping-Scheme-names-to-Java-names" href="#Mangling">19.12 Mapping Scheme names to Java names</a></li>
    <li><a id="toc-Scheme-types-in-Java-1" href="#Scheme-types-in-Java">19.13 Scheme types in Java</a></li>
    <li><a id="toc-Using-Java-Arrays" href="#Array-operations">19.14 Using Java Arrays</a>
    <ul class="no-bullet">
      <li><a id="toc-Creating-new-Java-arrays" href="#Creating-new-Java-arrays">19.14.1 Creating new Java arrays</a></li>
      <li><a id="toc-Accessing-Java-array-elements" href="#Accessing-Java-array-elements">19.14.2 Accessing Java array elements</a></li>
      <li><a id="toc-Old-low_002dlevel-array-macros" href="#Old-low_002dlevel-array-macros">19.14.3 Old low-level array macros</a></li>
    </ul></li>
    <li><a id="toc-Loading-Java-functions-into-Scheme-1" href="#Loading-Java-functions-into-Scheme">19.15 Loading Java functions into Scheme</a></li>
    <li><a id="toc-Evaluating-Scheme-expressions-from-Java-1" href="#Evaluating-Scheme-expressions-from-Java">19.16 Evaluating Scheme expressions from Java</a>
    <ul class="no-bullet">
      <li><a id="toc-Using-javax_002escript-portable-Java-scripting" href="#Using-javax_002escript-portable-Java-scripting">19.16.1 Using <code>javax.script</code> portable Java scripting</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Working-with-XML-and-HTML" href="#XML-tools">20 Working with XML and HTML</a>
  <ul class="no-bullet">
    <li><a id="toc-Formatting-XML-1" href="#Formatting-XML">20.1 Formatting XML</a></li>
    <li><a id="toc-Creating-HTML-nodes-1" href="#Creating-HTML-nodes">20.2 Creating HTML nodes</a></li>
    <li><a id="toc-Creating-XML-nodes-1" href="#Creating-XML-nodes">20.3 Creating XML nodes</a></li>
    <li><a id="toc-XML-literals-1" href="#XML-literals">20.4 XML literals</a>
    <ul class="no-bullet">
      <li><a id="toc-Element-constructors" href="#Element-constructors">20.4.1 Element constructors</a></li>
      <li><a id="toc-Elements-contents-_0028children_0029" href="#Elements-contents-_0028children_0029">20.4.2 Elements contents (children)</a></li>
      <li><a id="toc-Attributes" href="#Attributes">20.4.3 Attributes</a></li>
      <li><a id="toc-QNames-and-namespaces" href="#QNames-and-namespaces">20.4.4 QNames and namespaces</a></li>
      <li><a id="toc-Other-XML-types" href="#Other-XML-types">20.4.5 Other XML types</a>
      <ul class="no-bullet">
        <li><a id="toc-Processing-instructions" href="#Processing-instructions">20.4.5.1 Processing instructions</a></li>
        <li><a id="toc-XML-comments" href="#XML-comments">20.4.5.2 XML comments</a></li>
        <li><a id="toc-CDATA-sections" href="#CDATA-sections">20.4.5.3 CDATA sections</a></li>
      </ul></li>
    </ul></li>
    <li><a id="toc-Web-page-scripts" href="#Server_002dside-scripts">20.5 Web page scripts</a></li>
    <li><a id="toc-Self_002dconfiguring-web-page-scripts" href="#Self_002dconfiguring-page-scripts">20.6 Self-configuring web page scripts</a>
    <ul class="no-bullet">
      <li><a id="toc-Using-the-OpenJDK-built_002din-web-server" href="#Using-the-OpenJDK-built_002din-web-server">20.6.1 Using the OpenJDK built-in web server</a></li>
      <li><a id="toc-Using-a-servlet-container" href="#Using-a-servlet-container">20.6.2 Using a servlet container</a></li>
      <li><a id="toc-Finding-a-matching-script" href="#Finding-a-matching-script">20.6.3 Finding a matching script</a></li>
      <li><a id="toc-Determining-script-language" href="#Determining-script-language">20.6.4 Determining script language</a></li>
      <li><a id="toc-Compilation-and-caching" href="#Compilation-and-caching">20.6.5 Compilation and caching</a></li>
    </ul></li>
    <li><a id="toc-Installing-web-page-scripts-as-Servlets" href="#Servlets">20.7 Installing web page scripts as Servlets</a>
    <ul class="no-bullet">
      <li><a id="toc-Creating-a-web-application" href="#Creating-a-web-application">20.7.1 Creating a web application</a></li>
      <li><a id="toc-Compiling-a-web-page-script-to-a-servlet" href="#Compiling-a-web-page-script-to-a-servlet">20.7.2 Compiling a web page script to a servlet</a></li>
      <li><a id="toc-Installing-a-servlet-under-Tomcat" href="#Installing-a-servlet-under-Tomcat">20.7.3 Installing a servlet under Tomcat</a></li>
      <li><a id="toc-Installing-a-servlet-under-Glassfish" href="#Installing-a-servlet-under-Glassfish">20.7.4 Installing a servlet under Glassfish</a></li>
      <li><a id="toc-Servlet_002dspecific-script-functions" href="#Servlet_002dspecific-script-functions">20.7.5 Servlet-specific script functions</a></li>
    </ul></li>
    <li><a id="toc-Installing-Kawa-programs-as-CGI-scripts" href="#CGI-scripts">20.8 Installing Kawa programs as CGI scripts</a></li>
    <li><a id="toc-Functions-for-accessing-HTTP-requests" href="#HTTP-requests">20.9 Functions for accessing HTTP requests</a>
    <ul class="no-bullet">
      <li><a id="toc-Request-URL-components" href="#Request-URL-components">20.9.1 Request URL components</a></li>
      <li><a id="toc-Request-parameters" href="#Request-parameters">20.9.2 Request parameters</a></li>
      <li><a id="toc-Request-headers" href="#Request-headers">20.9.3 Request headers</a></li>
      <li><a id="toc-Request-body" href="#Request-body">20.9.4 Request body</a></li>
      <li><a id="toc-Request-IP-addresses-and-ports" href="#Request-IP-addresses-and-ports">20.9.5 Request IP addresses and ports</a></li>
      <li><a id="toc-Miscellaneous-request-properties" href="#Miscellaneous-request-properties">20.9.6 Miscellaneous request properties</a></li>
    </ul></li>
    <li><a id="toc-Generating-HTTP-responses" href="#HTTP-response">20.10 Generating HTTP responses</a></li>
    <li><a id="toc-Using-non_002dScheme-languages-for-XML_002fHTML" href="#XML-beyond-Scheme">20.11 Using non-Scheme languages for XML/HTML</a>
    <ul class="no-bullet">
      <li><a id="toc-XQuery-language" href="#XQuery-language">20.11.1 XQuery language</a></li>
      <li><a id="toc-XSL-transformations" href="#XSL-transformations">20.11.2 XSL transformations</a></li>
      <li><a id="toc-KRL-_002d-The-Kawa-Report-Language-for-generating-XML_002fHTML" href="#KRL">20.11.3 KRL - The Kawa Report Language for generating XML/HTML</a></li>
      <li><a id="toc-Differences-between-KRL-and-BRL" href="#Differences-between-KRL-and-BRL">20.11.4 Differences between KRL and BRL</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Miscellaneous-topics" href="#Miscellaneous">21 Miscellaneous topics</a>
  <ul class="no-bullet">
    <li><a id="toc-Composable-pictures-2" href="#Composable-pictures">21.1 Composable pictures</a>
    <ul class="no-bullet">
      <li><a id="toc-Coordinates-_002d-points-and-dimensions" href="#Coordinates-_002d-points-and-dimensions">21.1.1 Coordinates - points and dimensions</a></li>
      <li><a id="toc-Shapes" href="#Shapes">21.1.2 Shapes</a></li>
      <li><a id="toc-Colors-and-paints" href="#Colors-and-paints">21.1.3 Colors and paints</a></li>
      <li><a id="toc-Filling-a-shape-with-a-color" href="#Filling-a-shape-with-a-color">21.1.4 Filling a shape with a color</a></li>
      <li><a id="toc-Stroking-_0028outlining_0029-a-shape" href="#Stroking-_0028outlining_0029-a-shape">21.1.5 Stroking (outlining) a shape</a></li>
      <li><a id="toc-Affine-transforms" href="#Affine-transforms">21.1.6 Affine transforms</a></li>
      <li><a id="toc-Combining-pictures" href="#Combining-pictures">21.1.7 Combining pictures</a></li>
      <li><a id="toc-Images" href="#Images">21.1.8 Images</a></li>
      <li><a id="toc-Compositing-_002d-Controlling-how-pictures-are-combined" href="#Compositing-_002d-Controlling-how-pictures-are-combined">21.1.9 Compositing - Controlling how pictures are combined</a></li>
      <li><a id="toc-Displaying-and-exporting-pictures" href="#Displaying-and-exporting-pictures">21.1.10 Displaying and exporting pictures</a>
      <ul class="no-bullet">
        <li><a id="toc-Export-to-SVG" href="#Export-to-SVG">21.1.10.1 Export to SVG</a></li>
        <li><a id="toc-Display-in-Swing" href="#Display-in-Swing">21.1.10.2 Display in Swing</a></li>
        <li><a id="toc-Convert-to-image" href="#Convert-to-image">21.1.10.3 Convert to image</a></li>
      </ul></li>
    </ul></li>
    <li><a id="toc-Building-JavaFX-applications-1" href="#Building-JavaFX-applications">21.2 Building JavaFX applications</a>
    <ul class="no-bullet">
      <li><a id="toc-Using-JavaFX-with-JDK-7" href="#Using-JavaFX-with-JDK-7">21.2.1 Using JavaFX with JDK 7</a></li>
    </ul></li>
    <li><a id="toc-Building-for-Android-1" href="#Building-for-Android">21.3 Building for Android</a>
    <ul class="no-bullet">
      <li><a id="toc-Downloading-and-setting-up-the-Android-SDK" href="#Downloading-and-setting-up-the-Android-SDK">21.3.1 Downloading and setting up the Android SDK</a></li>
      <li><a id="toc-Building-Kawa-for-Android" href="#Building-Kawa-for-Android">21.3.2 Building Kawa for Android</a></li>
      <li><a id="toc-Creating-the-application" href="#Creating-the-application">21.3.3 Creating the application</a></li>
      <li><a id="toc-Running-the-application-on-the-Android-emulator" href="#Running-the-application-on-the-Android-emulator">21.3.4 Running the application on the Android emulator</a></li>
      <li><a id="toc-Running-the-application-on-your-device" href="#Running-the-application-on-your-device">21.3.5 Running the application on your device</a></li>
      <li><a id="toc-Some-debugging-notes" href="#Some-debugging-notes">21.3.6 Some debugging notes</a></li>
      <li><a id="toc-Other-resources" href="#Other-resources">21.3.7 Other resources</a></li>
    </ul></li>
    <li><a id="toc-Android-view-construction-1" href="#Android-view-construction">21.4 Android view construction</a>
    <ul class="no-bullet">
      <li><a id="toc-View-object-allocation" href="#View-object-allocation">21.4.1 View object allocation</a></li>
      <li><a id="toc-Event-handlers" href="#Event-handlers">21.4.2 Event handlers</a></li>
    </ul></li>
    <li><a id="toc-System-inquiry-1" href="#System-inquiry">21.5 System inquiry</a></li>
    <li><a id="toc-Processes-1" href="#Processes">21.6 Processes</a>
    <ul class="no-bullet">
      <li><a id="toc-Creating-a-process" href="#Creating-a-process">21.6.1 Creating a process</a></li>
      <li><a id="toc-Process-literals" href="#Process-literals">21.6.2 Process literals</a></li>
      <li><a id="toc-Process-values-and-process-output" href="#Process-values-and-process-output">21.6.3 Process values and process output</a></li>
      <li><a id="toc-Substitution-and-tokenization" href="#Substitution-and-tokenization">21.6.4 Substitution and tokenization</a></li>
      <li><a id="toc-Input_002foutput-redirection" href="#Input_002foutput-redirection">21.6.5 Input/output redirection</a></li>
      <li><a id="toc-Pipe_002dlines" href="#Pipe_002dlines">21.6.6 Pipe-lines</a></li>
      <li><a id="toc-Setting-the-process-environment" href="#Setting-the-process-environment">21.6.7 Setting the process environment</a></li>
      <li><a id="toc-Waiting-for-process-exit" href="#Waiting-for-process-exit">21.6.8 Waiting for process exit</a></li>
      <li><a id="toc-Exiting-the-current-process-1" href="#Exiting-the-current-process-1">21.6.9 Exiting the current process</a></li>
      <li><a id="toc-Deprecated-functions" href="#Deprecated-functions">21.6.10 Deprecated functions</a></li>
    </ul></li>
    <li><a id="toc-Time_002drelated-functions-1" href="#Time_002drelated-functions">21.7 Time-related functions</a></li>
    <li><a id="toc-Deprecated-low_002dlevel-functions" href="#Low_002dlevel-functions">21.8 Deprecated low-level functions</a>
    <ul class="no-bullet">
      <li><a id="toc-Low_002dlevel-Method-invocation-1" href="#Low_002dlevel-Method-invocation-1">21.8.1 Low-level Method invocation</a></li>
      <li><a id="toc-Low_002dlevel-field-operations" href="#Low_002dlevel-field-operations">21.8.2 Low-level field operations</a></li>
      <li><a id="toc-Old-low_002dlevel-array-macros-1" href="#Old-low_002dlevel-array-macros-1">21.8.3 Old low-level array macros</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Frequently-Asked-Questions" href="#FAQs">22 Frequently Asked Questions</a></li>
  <li><a id="toc-The-Kawa-language-framework" href="#Framework">23 The Kawa language framework</a></li>
  <li><a id="toc-License-1" href="#License">24 License</a>
  <ul class="no-bullet">
    <li><a id="toc-License-for-the-Kawa-software" href="#Software_002dLicense">24.1 License for the Kawa software</a></li>
    <li><a id="toc-License-for-the-Kawa-manual" href="#Manual_002dLicense">24.2 License for the Kawa manual</a></li>
  </ul></li>
</ul></li>
  <li><a id="toc-Index" href="#Overall-Index" rel="index">Appendix A Index</a></li>

</ul>
</div>
</div>
<hr>
<div class="chapter" id="News">
<div class="header">
<p>
Next: <a href="#Features" accesskey="n" rel="next">Features</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="News-_002d-Recent-Changes"></span><h2 class="chapter">1 News - Recent Changes</h2>
<p>These changes are in more-or-less reverse chronological order, with the
most recent changes first.
</p>
<p>See also the list of <a href="../qexo/news.html">Qexo (XQuery)-specific
changes</a>.
</p>
<span id="In-Git-repository-_0028invoke-branch_0029-since-last-release"></span><h4 class="subheading">In Git repository (invoke branch) since last release</h4>
<ul>
<li> Binary release are now built for Java 8.
The repository source code is now set up for Java 8.
(Biulding fro Java 6 or 7 is still supported.
Java 5 might also work, but not not been tested recently.)
</li><li> Most places where you could declare a new identifier
binding have been generalized to accept <a href="#Variables-and-Patterns">patterns</a>,
including literals and boolean <a href="#meta_002dguard"><var>guard</var></a>s.
</li><li> The new form <a href="#def_002dmatch"><code>match</code></a> form is a generalization
of <code>case</code> using patterns.
</li><li> The internal calling convention used for &ldquo;apply&rdquo; (ie. calling
an unknown-at-compile-time procedure) has been completely changed.
</li><li> Major changes to strings:
<ul>
<li> <em>Incompatible change:</em> String literals are now
<code>gnu.lists.IString</code> rather than <code>java.lang.String</code>.
The advantage of using <code>gnu.lists.IString</code> is that <code>string-ref</code>
and <code>string-length</code> are (roughly) constant-time, rather than
having to linearly scan the string.
</li><li> <em>Incompatible change:</em>
The procedures <code>string-append</code>, <code>string-map</code>,
<code>substring</code>, <code>list-&gt;string</code>, <code>vector-&gt;string</code>,
<code>string-downcase</code>, <code>string-upcase</code>, <code>string-foldcase</code>, 
<code>string-titlecase</code>, and the constructor <code>string</code>
return an immutable string (an <code>IString</code>).
(The function <code>string-copy</code> is similar to <code>substring</code>,
but returns a mutable string.)
This is a work-in-progress with the goal of implementing
<a href="http://srfi.schemers.org/srfi-140/srfi-140.html">SRFI-140</a>:
Other procedures will be changed to return immutable strings.

<p>If you <code>(import (scheme base))</code> standard procedures
such as <code>string-append</code> will return mutable strings;
if you <code>(import (kawa base))</code> the procedures will return immutable strings.
The command-line options <code>--r5rs</code> or <code>--r6rs</code> or <code>--r7rs</code>
override the default so these procedures return mutable strings.
</p></li><li> <em>Incompatible change:</em>
Treating a string as a sequence is now simpler but possibly slower:
The <var>I</var>&rsquo;th element is now the <var>I</var>&rsquo;th Unicode code point.
Indexing with function-call syntax
<code>(<var>string</var> <var>i</var>)</code> is the same as <code>(string-ref <var>string</var> <var>i</var>)</code> and
<code>(length <var>string</var>)</code> is the same as <code>(string-length <var>string</var>)</code>.
This applies to all classes that implement <code>java.lang.CharSequence</code>.
Indexing may be a linear-time operation (thus much slower),
unless the string is an <code>IString</code> (in which case it is constant-time),
</li><li> <em>Incompatible change:</em> Before, if a Java parameter type
was <code>java.lang.String</code> Kawa would accept any value, converting it
using Object&rsquo;s <code>toString</code> method.
Now Kawa will reject an argument if it is not a <code>java.lang.CharSequence</code>.
</li><li> New procedures: <code>istring?</code>, <code>reverse-list-&gt;string</code>,
<code>string-any</code>, <code>string-concatenate</code>, <code>string-concatenate-reverse</code>,
<code>string-contains</code>, <code>string-contains-right</code>,
<code>string-count</code>, <code>string-drop</code>,  <code>string-drop-right</code>,
<code>string-every</code>, <code>string-filter</code>, <code>string-fold</code>,
<code>string-fold-right</code>, <code>string-for-each-index</code>,
<code>string-index</code>, <code>string-index-right</code>, <code>string-join</code>,
<code>string-map-index</code>, <code>string-null?</code>,
<code>string-prefix?</code>, <code>string-prefix-length</code>,
<code>string-repeat</code>, <code>string-remove</code>, <code>string-replace</code>,
<code>string-skip</code>, <code>string-skip-right</code>, <code>string-split</code>,
<code>string-suffix?</code>, <code>string-suffix-length</code>,
<code>string-tabulate</code>, <code>string-take</code>, <code>string-take-right</code>,
<code>string-trim</code>, <code>string-trim-right</code>, <code>string-trim-both</code>,
<code>string-unfold</code>, <code>string-unfold-right</code>,
<code>string-&gt;utf16</code>, <code>string-&gt;utf16be</code>, <code>string-&gt;utf16le</code>,
<code>utf16-&gt;string</code>, <code>utf16be-&gt;string</code>, <code>utf16le-&gt;string</code>,
<code>xsubstring</code>.
These follow SRFI-140 and return immutable strings.
(Some of these had previously been available in SRFI-13,
but the older versions return mutable strings.)
</li></ul>
</li><li> <em>Incompatible change:</em> Kawa traditionally followed Java in allowing you
to pass an array with the &ldquo;rest&rdquo; arguments to a varargs method.
For example, you could write:

<pre class="verbatim">(define args (Object[] 3 &quot;cm&quot;))
(java.lang.String:format &quot;length:%s%s&quot; args)
</pre>
<p>This is no longer allowed. Instead,
use the splice operator:
</p>
<pre class="verbatim">(java.lang.String:format &quot;length:%s%s&quot; @args)
</pre></li><li> <em>Incompatible change:</em> You used to be able to write a
type-specifier in a formal parameter or return type without
using &lsquo;<samp>::</samp>&rsquo;, as in:
<div class="example">
<pre class="example">(define (incr (x int)) int (+ x 1))
</pre></div>
<p>This is no longer allowed, because it conflicts with the
syntax for patterns.  Instead you have to write:
</p><div class="example">
<pre class="example">(define (incr (x ::int)) ::int (+ x 1))
</pre></div>
</li><li> New type aliases <code>bitvector</code> and <code>c16vector</code>.
The latter is a <a href="#Uniform-vectors">uniform vector</a> type for wrapping <code>char[]</code> arrays.
</li><li> You can convert a Java array (for example a <code>int[]</code> to the corresponing uniform vector type
(for example <code>u32vector</code>) using the <code>as</code> pseudo-function or the corresponding
conversion procedure (for example <code>-&gt;u32vector</code>).  The result shares storage with the
array, so changes in one will update the other.
</li><li> The expression <code>(module-class)</code> evaluates to the
containing module class.
</li><li> Change the <a href="#Mangling">mangling</a> for field and local variables names
to match the <a href="https://blogs.oracle.com/jrose/entry/symbolic_freedom_in_the_vm">Symbolic Freedom</a> style.
</li><li> Internally, expressions now record their ending position (line/column),
in addition to the starting position.
</li></ul>


<span id="Kawa-2_002e4-_0028April-30_002c-2017_0029"></span><h4 class="subheading">Kawa 2.4 (April 30, 2017)</h4>

<ul>
<li> Final 2.x release.
Minor updates and fixes.
</li></ul>

<span id="Kawa-2_002e3-_0028January-13_002c-2017_0029"></span><h4 class="subheading">Kawa 2.3 (January 13, 2017)</h4>

<ul>
<li> Moved Kawa&rsquo;s source code repository (version control system)
to use git, hosted at <a href="https://gitlab.com/kashell/Kawa">GitLab</a>.
</li><li> Issues (bugs, feature requests, etc) should now be reported using the
<a href="https://gitlab.com/kashell/Kawa/issues">GitLab Issue Tracker</a>.
</li><li> New <code>with-docbook-stylesheets</code> to make it easier to build
the documentation with better functionality and look.
</li><li> The command-line option <code>console:jline-mouse=yes</code>
enables moving the input cursor using a mouse click,
when using JLine in the REPL on common xterm-like terminals.
This is disabled by default because it conflicts with
other mouse actions, such as making a selection for copying text.
You can press shift to get the terminal&rsquo;s standard mouse handling.
</li></ul>

<span id="Kawa-2_002e2-_0028November-12_002c-2016_0029"></span><h4 class="subheading">Kawa 2.2 (November 12, 2016)</h4>

<ul>
<li> A binary release is no longer just a Kawa <code>.jar</code> file,
but is now a <code>zip</code> archive that also includes
shell/batch scripts for running Kawa, useful
third-party libraries, and the complete documentation in EPUB format.
The archives are named <code>kawa-version.zip</code>.
</li><li> The <code>kawa --browse-manual</code> switch makes it easy to
<a href="#browse_002dmanual_002doption">browse the local documentation</a>.
</li><li> The <a href="#Composable-pictures"><code>(kawa pictures</code>) library</a> lets
you create &ldquo;picture&rdquo; objects,
display them, transform them, combine them, and more.
</li><li> There is a new <a href="#Pretty_002dprinting">API for pretty-printing</a>.
</li><li> Basic support for Java 9 (though still some issues).
</li><li> Generated files like <code>Makefile.in</code> and <code>configure</code> are no
longer in the Subversion source code repository, though they are still
included in the distributed <code>kawa-version.tar.gz</code> releases. The new
top-level script <code>autogen.sh</code> should be run before
<code>configure</code>.
</li><li> Kawa traditionally followed Java in allowing you to pass an array with
the &quot;rest&quot; arguments to a varargs method. (A &quot;varargs&quot; method includes
Java varargs methods, as well as Kawa methods with a <code>#!rest</code>
parameter that is explicitly typed to be an array type.) For example,
you could write:

<pre class="verbatim">(define args (Object[] 3 &quot;cm&quot;))
(java.lang.String:format &quot;length:%s%s&quot; args)
</pre>
<p>This is deprecated, and may stop working in a future release. Instead,
use the splice operator:
</p>
<pre class="verbatim">(java.lang.String:format &quot;length:%s%s&quot; @args)
</pre>
</li><li> More options for <a href="#Ranges">range objects</a>.  For example,
you can write <code>[1 by: 2 &lt;=: 9]</code>.

</li><li> Many enhancements to <a href="#Arrays">arrays</a> and vectors:

<ul>
<li> Shape specifiers (used when creating an array) can now be one of a
rank-2 array of low/high-bounds, as in SRFI-25; a vector of upper
bounds; or a vector of ranges.
</li><li> New type specifiers for array: <code>array</code> is any array (i.e. any
<code>gnu.lists.Array</code>); <code>array<var>N</var></code> is the same restricted to rank
<code><var>N</var></code>; <code>array[etype]</code> or <code>arrayN[etype]</code> restrict the types
of elements to <code>etype</code>.

<p>If the <code>etype</code> is a primitive type (for example
<code>array2[double]</code>) then indexing is optimized to method calls that
avoid object allocation.
</p>
</li><li> Generalized array indexing: If A is an array (or a vector), then the
expression:<br>
<code>(A I J K ...)</code><br>
in general evaluates to an array B such that:<br>
<code>(B i1 i2 ... j1 j2 ... k1 k2 ... ...)</code> is<br>
<code>(A (I i1 i2 ..) (J j1 j2 ...) (K k1 k2 ...) ...)</code>

<p>If an index I is an integer, it is treated as a zero-index array - a
scalar.
</p>
<p>For example: if <code>(define B (A 2 [4 &lt;: 10]))</code> then <code>(B i)</code> is
<code>(A 2 (+ i 4))</code>.
</p>
</li><li> The procedure <code>array-index-ref</code> is does the above indexing
explicitly: <code>(array-index-ref A I J K ...)</code> is
<code>(A I J K ...)</code>. The result is a read-only snapshot.
</li><li> The procedure <code>array-index-share</code> is like <code>array-index-ref</code>
but creates a modifiable view into argument array.
</li><li> <code>(build-array shape procedure)</code> is a general constructor for lazy
arrays: If <code>A</code> is the result, then <code>(A i j k ...)</code> is
<code>(procedure [I J K ...])</code>.
</li><li> <code>array-transform</code> creates a view, with a mapping of the indexes.
</li><li> Other new procedures (like those in the Racket math package):
<code>array-size</code>, <code>array-fill!</code>, <code>array-copy!</code>,
<code>array-transform</code>, <code>array-reshape</code>, <code>array-flatten</code>,
<code>array-&gt;vector</code>, <code>index-array</code>, <code>build-array</code>.
</li><li> Add Common Lisp array reader syntax (<code>#rankA</code>) with
<a href="https://www.gnu.org/software/guile/manual/html_node/Array-Syntax.html">Guile
extensions</a>, including reader sypport for multi-dimensional uniform
(primitive) arrays. This is also used when printing arrays.
</li><li> New <code>format-array</code> procedure print an array a tabular 2-dimensional
(APL-like) format. This format is used by default in the top-level of
the REPL.
</li></ul>

</li><li> Print bit-vectors using the Common Lisp (and Guile) reader syntax.
For example <code>#*1100110</code>. Enhanced the reader to read this format.

</li><li> Various REPL enhancements and new features:

<ul>
<li> The <code>-w</code> switch to create a new REPL window
can be followed by various sub-options to control <em>how</em> and
where the window is created.
For example <code>-wbrowser</code> creates a new window
using your default web browser.
</li><li> Prompts are now normally specified using <code>printf</code>-style templates.
The normal prompt template is specified by the <code>input-prompt1</code>
variable, while continuation lines use <code>input-prompt2</code>. These can
be initialized by command-line options <code>console:prompt1</code> and
<code>console:prompt2</code>, or otherwise use language-specific defaults. You
can still use <code>set-input-port-prompter!</code> to set a more general
prompt-procedure, but it is now only called for the initial line of a
command, not continuation lines.
</li><li> The new <code>--with-jline3</code> configure option builds support for the
<a href="https://github.com/jline/jline3">JLine (version 3)</a> library for
handling console input, similar to GNU readline.
</li><li> Context-dependent command-completion (tab-completion) works when using
JLine.
</li></ul>

</li><li> Various REPL enhancements when using <a href="http://domterm.org/">DomTerm</a>.
<ul>
<li> If you &ldquo;print&rdquo; an XML/HTML node, it gets inserted into the DomTerm
objects.  You print images, tables, fancy text, and more.
</li><li> If you &ldquo;print&rdquo; a picture object or a <code>BuferredImage</code>
the picture is shown in the DomTerm console.
</li><li> You can load or modify styles with the <code>domterm-load-stylesheet</code>
procedure.
</li><li> When pretty-printing, calculation of line-breaks and indentation
is handled by DomTerm.
If you change the window width, DomTerm will dynamically
re-calculate the line-breaks of previous pretten output.
This works even in the case of a session saved to an HTML
file, as long as JavaScript is enabled.
</li><li> Hide/show buttons are emitted as part of the default prompt.
</li></ul>
</li><li> Multiple literals that have the same value (as in <code>equal?</code>) get
compiled to the same object.
</li><li> The syntax <code>&amp;&lt;[expr]</code> is now equivalent to <code>&amp;&lt;{&amp;[expr]}</code>,
assuming <code>expr</code> is an expression that evaluates to a string that
named an existing file. That file is read is the result is the contents
of the file (as if by <code>(path-data expr)</code>).

</li></ul>

<span id="Kawa-2_002e1-_0028October-26_002c-2015_0029"></span><h4 class="subheading">Kawa 2.1 (October 26, 2015)</h4>
<span id="g_t_0023kawa_002d2_002e1_002doctober_002d26_002d2015"></span><p>Lots of little changes, and some big changes to sequences and strings.
</p>
<ul>
<li> Enhancements to the Kawa tutorial.
</li><li> Added <code>parameter</code> as a new typename, for Scheme parameter objects.
It can be parameterized (for example <code>parameter[string]</code>) for
better type inference when &quot;calling&quot; (reading) the parameter.
</li><li> We now define &ldquo;interactive mode&rdquo; as a REPL or a source module that
uses the default global top-level environment <em>or</em> a source module
imported/required by a interactive module. Interactive mode attempts to
support dynamic re-definition and re-loading of function and other
definitions. This is a work-in-progres; interactive mode currently uses
extra indirection to support re-definitions (at a slight performance
cost).
</li><li> Various changes and fixes in Path/URI handling. Most significantly, the
resolve argorithm used by <code>resolve-uri</code> was re-written to use the
algorithm from RFC-3986, rather than the obsolete RFC-2396 algorithm
used by <code>java.net.URI.resolve</code>.
</li><li> Change to mangle class and package name in
<a href="https://blogs.oracle.com/jrose/entry/symbolic_freedom_in_the_vm">Symbolic
Freedom</a> style. This means that class names and class filenames usually
match the source file, even if special charaters are used, except for a
small number of disallowed characters. Note this is currently
<em>only</em> used for class and package names.
</li><li> Allow <code>'synchronized</code> and <code>'strictfp</code> as access flags for
methods.
</li><li> You can now have a type-specifier for <code>define-variable</code>.

</li><li> Better support for forward references between macros.

</li><li> Added unsigned primitive integer types <code>ubyte</code>, <code>ushort</code>,
<code>uint</code>, and <code>ulong</code>. These are represented at run-time by the
corresponding signed types, but Kawa generates code to do unsigned
arithmethic and comparisons. Corresponding boxed classes are
<code>gnu.math.UByte</code>, <code>gnu.math.UShort</code>, <code>gnu.math.UInt</code>, and
<code>gnu.math.ULong</code>.

</li><li> Improvements and unification of sequences and strings:

<ul>
<li> The new <code>sequence</code> type generalizes lists, vectors, arrays,
strings, and more. It is implemented as the <code>java.util.List</code>
interface, but strings (<code>java.lang.CharSequence</code>) and Java arrays
are compatible with <code>sequence</code> and converted as needed.
</li><li> The <code>length</code> function is generalized to arbitrary sequences. (For
strings it uses the <code>CharSequence.length</code> method, which returns the
number of (16-bit) code units. This is different from the
<code>string-length</code> function, which returns the number of Unicode code
points.)
</li><li> A new pseudo-character value <code>#\ignorable-char</code> is introduced. It
is ignored in string-construction contexts.
</li><li> The function-call syntax for indexing works for all sequences. If the
sequence is a string, the result is the Unicode (20-bit) scalar value at
the specified index. If index references the trailing surrogate of a
surrogate pair the result is <code>#\ignorable-char</code>. This allows
efficient indexing of strings: Handing of surrogate pairs are handled
automatically as long as <code>#\ignorable-char</code> is skipped.
</li><li> Indexing of uniform vector types (such as <code>s64vector</code> or
<code>f64vector</code> or <code>u16vector</code>) now return the &ldquo;standard&rdquo;
primitive type (such as <code>long</code> or <code>double</code>) or the new
unsigned primitive (such as <code>ushort</code>). This improves performance
(since we can generally use primitive types), and improves compatibility
with Java arrays. Specifically, <code>s64vector</code> now implements
<code>Sequence&lt;Long&gt;</code>, and thus <code>java.util.List&lt;Long&gt;</code> Note that
indexing a <code>f64vector</code> returns a <code>double</code> which as an object
is a <code>java.lang.Double</code>, not the Kawa floating-point type
<code>gnu.math.DFloNum</code>. The result is usually the same, but <code>eqv?</code>
might return a different result than previously.
</li><li> The arguments to <code>map</code>, <code>for-each</code>, and <code>vector-for-each</code>
can now be any sequence (including strings and native arrays). The
arguments to <code>vector-for-each</code> can now be arbitrary
<code>java.util.List</code> values. All of these are inlined. If the sequence
type is known, more efficient custom code is generated.

</li><li> A range represents an enumerable sequence, normally integers, but it is
represented compactly using the start value, the step (usually 1), and
size. There is a new convenient syntax for writing a range: if <code>i</code>
and <code>j</code> are integers then <code>[i &lt;=: j]</code> is the sequence of
integers starting at <code>i</code> and ending at <code>j</code> (inclusive). You
can also write <code>[i &lt;=: j]</code> (excludes the upper bound),
<code>[i &gt;: j]</code> (counts down to <code>j</code>, exclusive), and
<code>[i &gt;=: j]</code> (counts down to <code>j</code>, inclusive).
</li><li> You can use a sequences of integers to index a sequence. The result is
the sequence of the selected elements. In general
<code>(seq [i0 ... in])</code> is <code>[(seq i0) ... (seq in)]</code>. This work
well with ranges: <code>(seq [i &lt;: j])</code> is the subsequence of <code>seq</code>
from <code>i</code> to <code>j</code> (exclusive).

<p>If the <code>seq</code> is a string (a <code>CharSequence</code>) then the result is
also a string. In this case the indexing behavior is slightly different
in that indexing selects (16-bit) code units, which are combined to a
string.
</p>
</li></ul>

</li><li> A new <code>dynamic</code> type is like <code>Object</code>. However, it forces
runtime lookup and type-checking, and supresses compile-time type check
and errors. (This is similar to C#. It is useful as an escape hatch if
we ever implement traditional strict static type-checking.)
</li><li> Specifying the parameter type or return type of a function or method
without a &rsquo;<code>::</code>&rsquo; is deprecated and results in a warning.

</li><li> In <code>--r7rs</code> mode: The &rsquo;<code>l</code>&rsquo; exponent suffix of a number
literal creates a floating-point double, rather than a
<code>BigInteger</code>.
</li><li> Added the hyperbolic functions: sinh, cosh, tanh, asinh, acosh, atanh.
</li><li> The <code>equal?</code> function can now handle cyclic lists and vectors. So
can <code>equal-hash</code>.
</li><li> The command-line option <code>--with-arg-count=N</code> allows finer control
of command-line-processing. It is used before an &ldquo;action&rdquo;, and
specifies the <code>N</code> arguments following the action are set as the
command-line-arguments. After the action, command-line-processing
continues following those <code>N</code> arguments.
</li><li> Added the R6RS module <code>(rnrs arithmetic bitwise)</code>.
</li><li> The <code>kawa.repl</code> argument processor now handles <code>-D</code> options.
</li><li> The new <code>class</code> sub-form of <code>import</code> allows you to import
classes, and give them abbreviated names, like the Java <code>import</code>
statement. The new form is more compact and convenient than
<code>define-alias</code>.

<p>You can also use a classname directly, as a symbol, instead of writing
it in the form of a list:
</p>
<pre class="verbatim">(import (only java.lang.Math PI))
</pre>
</li><li> In the <code>only</code> clause of the <code>import</code> syntax you can now
directly rename, without having to write a <code>rename</code> clause.
</li><li> Changes in the calling-convention for <code>--full-tailcalls</code> yields a
substantial speed-up in some situations.
</li><li> The type of boolean literals <code>#f</code> and <code>#t</code> is now primitive
<code>boolean</code> rather than <code>java.lang.Boolean</code>.
</li><li> General multi-dimensional arrays can be indexed with function call
notation. E.g. <code>(arr i j k)</code> is equivalent to
<code>(array-ref a i j k)</code>. You can also use <code>set!</code> with either
<code>array-ref</code> or function call notation.
</li><li> The <code>#!null</code> value (Java <code>null</code>) is now considered false, not
true. Likewise for non-canonical false Boolean objects (i.e. all
instances of <code>java.lang.Boolean</code> for which <code>booleanValue</code>
returns false, not just <code>Boolean.FALSE</code>).

</li><li> New standard libraries <code>(kawa base)</code> and <code>(kawa reflect)</code>.
</li><li> You can now use patterns in the <code>let</code> form and related forms.

</li><li> Implemented the <a href="http://en.wikipedia.org/wiki/Lambda_lifting">lambda
lifting</a> optimzation.
</li><li> An expression that has type T is now considered compatible with a
context requiring an interface type I only if T implements I (or T is
Object). (Before they were considered possibly-compatible if T was
non-final because the run-time class might be a subclass of T that
implements I.)
</li><li> New <code>--console</code> flag forces input to be treated as an interactive
console, with prompting. This is needed on Windows under Emacs, where
<code>System.console()</code> gives the wrong result.
</li><li> You can now in a sub-class reference fields from not-yet-compiled
super-classes. (This doesn&rsquo;t work for methods yet.)
</li><li> The <code>(? name::type value)</code> operator supports conditional binding.
The <code>(! name::type value)</code> operator supports unconditional binding;
it is similar to <code>define-constant</code>, but supports patterns.

</li><li> More efficient implementation of <code>call-with-values</code>: If either
argument is a fixed-arity lambda expression it is inlined. Better
type-checking of both <code>call-with-values</code> and <code>values</code>.

</li><li> Jamison Hope enhanced the support for quaternions, primarily the new
<code>(kawa rotations)</code> library.
</li></ul>

<span id="Kawa-2_002e0-_0028December-2-2014_0029"></span><h4 class="subheading">Kawa 2.0 (December 2 2014)</h4>
<span id="g_t_0023kawa_002d2_002e0_002ddecember_002d2_002d2014"></span><p>There are many new features, but the big one is R7RS compatibility.
</p>
<ul>
<li> New <code>define-alias</code> can define aliases for static class members.
</li><li> The treatment of keywords is changing to not be self-evaluating (in
Scheme). If you want a literal keyword, you should quote it. Unquoted
keywords should only be used for keyword arguments. (This will be
enforced in a future release.) The compiler now warns about badly formed
keyword arguments, for example if a value is missing following a
keyword.
</li><li> The default is now Java 7, rather than Java 6. This means the checked-in
source code is pre-processed for Java 7, and future binary releases will
require Java 7.
</li><li> The behavior of parameters and fluid variables has changed. Setting a
parameter no longer changes its value in already-running sub-threads.
The implementation is simpler and should be more efficient.

</li><li> The form <code>define-early-constant</code> is similar to
<code>define-constant</code>, but it is evaluated in a module&rsquo;s class
initializer (or constructor in the case of a non-static definition).
</li><li> Almost all of R7RS is now working:

<ul>
<li> Importing a SRFI library can now use the syntax
<code>(import (srfi N [name]))</code>
</li><li> The various standard libraries such as <code>(scheme base)</code> are
implemented.
</li><li> The functions <code>eval</code> and <code>load</code> can now take an
environment-specifier. Implemented the <code>environment</code> function.
</li><li> Extended <code>numerator</code>, <code>denominator</code>, <code>gcd</code>, and
<code>lcm</code> to inexacts.
</li><li> The full R7RS library functionality is working, including
<code>define-library</code> The keyword <code>export</code> is now a synonym for
<code>module-export</code>, and both support the <code>rename</code> keyword. The
<code>prefix</code> option of <code>import</code> now works.

</li><li> The <code>cond-expand</code> form now supports the <code>library</code> clause.
</li><li> Implemented <code>make-promise</code> and <code>delay-force</code> (equivalent to
the older name <code>lazy</code>).
</li><li> Changed <code>include</code> so that by default it first seaches the directory
containing the included file, so by default it has the same effect as
<code>include-relative</code>. However, you can override the search path with
the <code>-Dkawa.include.path</code> property. Also implemented
<code>include-ci</code>.
</li><li> Implemented <code>define-values</code>.
</li><li> Fixed <code>string-&gt;number</code> to correctly handle a radix specifier in the
string.
</li><li> The <code>read</code> procedure now returns mutable pairs.
</li><li> If you need to use <code>...</code> in a <code>syntax-rules</code> template you can
use <code>(... template)</code>, which disables the special meaning of
<code>...</code> in <code>template</code>. (This is an extension of the older
<code>(... ...)</code>.)
</li><li> Alternatively, you can can write
<code>(syntax-rules dots (literals) rules)</code>. The symbol <code>dots</code>
replaces the functionality of <code>...</code> in the <code>rules</code>.
</li><li> An underscore <code>_</code> in a <code>syntax-rules</code> pattern matches
anything, and is ignored.
</li><li> The <code>syntax-error</code> syntax (renamed from <code>%syntax-error</code>)
allows error reporting in <code>syntax-rules</code> macros. (The older
Kawa-specific <code>syntax-error</code> procedure was renamed to
<code>report-syntax-error</code>.)
</li><li> Implemented and documented R7RS exception handling: The syntax
<code>guard</code> and the procedures <code>with-exception-handler</code>,
<code>raise</code>, and <code>raise-continuable</code> all work. The <code>error</code>
procedure is R7RS-compatible, and the procedures <code>error-object?</code>,
<code>error-object-message</code>, <code>error-object-irritants</code>,
<code>file-error?</code>, and <code>read-error?</code> were implemented.

</li><li> Implemented <code>emergency-exit</code>, and modified <code>exit</code> so
finally-blocks are executed.

</li><li> Implemented <code>exact-integer?</code>, <code>floor/</code>, <code>floor-quotient</code>,
<code>floor-remainder</code>, <code>truncate/</code>, <code>truncate-quotient</code>, and
<code>truncate-remainder</code>.
</li><li> The <code>letrec*</code> syntax is now supported. (It works the same as
<code>letrec</code>, which is an allowed extension of <code>letrec</code>.)

</li><li> The functions <code>utf8-&gt;string</code> and <code>string-&gt;utf8</code> are now
documented in the manual.

</li></ul>

</li><li> The changes to characters and strings are worth covering separately:

<ul>
<li> The <code>character</code> type is now a new primitive type (implemented as
<code>int</code>). This can avoid boxing (object allocation)
</li><li> There is also a new <code>character-or-eof</code>. (A union of
<code>character</code> and the EOF value, except the latter is encoded as -1,
thus avoiding object allocation.) The functions read-char and
<code>peek-char</code> now return a <code>character-or-eof</code> value.
</li><li> Functions like <code>string-ref</code> that take a character index would not
take into account non-BMP characters (those whose value is greater than
<code>#xffff</code>, thus requiring two surrogate characters). This was
contrary to R6RS/R7RS. This has been fixed, though at some performance
cost . (For example <code>string-ref</code> and <code>string-length</code> are no
longer constant-time.)
</li><li> Implemented a <a href="Strings.html#String-Cursor-API"><code>string-cursor</code>
API</a> (based on Chibi Scheme). Thes allow efficient indexing, based on
opaque cursors (actually counts of 16-bits <code>char</code>s).
</li><li> Optimized <code>string-for-each</code>, which is now the preferred way to
iterate through a string.
</li><li> Implemented <code>string-map</code>.
</li><li> New function <code>string-append!</code> for in-place appending to a mutable
string.
</li><li> New function <code>string-replace!</code> for replacing a substring of a
string with some other string.
</li><li> The SRFI-13 function <code>string-append/shared</code> is no longer
automatically visible; you have to <code>(import (srfi :13 strings))</code> or
similar.
</li></ul>

</li><li> The <code>module-name</code> form allows the name to be a list, as in a
R6RS/R7RS-style library name.
</li><li> The syntax <code>@expression</code> is a <em>splicing form</em>. The
<code>expression</code> must evaluate to a sequence (vector, list, array,
etc). The function application or constructor form is equivalent to all
the elements of the sequence.
</li><li> The parameter object <code>current-path</code> returns (or sets) the default
directory of the current thread.
</li><li> Add convenience procedures and syntax for <a href="Processes.html">working
with processes</a>: <code>run-process</code>, <code>process-exit-wait</code>,
<code>process-exit-ok?</code>, <code>&amp;cmd</code>, <code>&amp;`</code>, <code>&amp;sh</code>.
</li><li> The functions <code>path-bytes</code>, and <code>path-data</code> can
<a href="http://www.gnu.org/software/kawa/Reading-and-writing-whole-files.html">read
or write the entire contents of a file</a>. Alternatively, you can use the
short-hand syntax: <code>&amp;&lt;{pname}</code> <code>&amp;&gt;{pname}</code>
<code>&amp;&gt;&gt;{pname}</code>. These work with &quot;blobs&quot; which may be text or binary
depending on context.
</li><li> The initial values of <code>(current-output-port)</code> and
<code>(current-error-port)</code> are now hybrid textual/binary ports. This
means you can call <code>write-bytevector</code> and <code>write-u8</code> on them,
making it possible for an application to write binary data to standard
output. Similarly, initial value of <code>(current-input-port)</code> is a
hybrid textual/binary port, but only if there is no console (standard
input is not a tty).

</li><li> Jamison Hope contributed support for
<a href="http://en.wikipedia.org/wiki/Quaternion">quaternions</a>, a
generalization of complex numbers containing 4 real components.

</li><li> Andrea Bernardini contributed an optimized implementation of <code>case</code>
expressions. He was sponsored by Google Summer of Code.
</li><li> The <code>kawa.sh</code> shell script (which is installed as <code>kawa</code> when
<em>not</em> configuring with <code>--enable-kawa-frontend</code>) now handles
<code>-D</code> and <code>-J</code> options. The <code>kawa.sh</code> script is now also
built when usint Ant.
</li><li> The <code>cond-expand</code> features <code>java-6</code> though <code>java-9</code> are
now set based on the <code>System</code> property <code>&quot;java.version&quot;</code>
(rather than how Kawa was configured).
</li><li> An Emacs-style <code>coding</code> declaration allows you to specify the
encoding of a Scheme source file.
</li><li> The command-line option <code>--debug-syntax-pattern-match</code> prints
logging importation to standard error when a <code>syntax-rules</code> or
<code>syntax-case</code> pattern matches.
</li><li> <a href="http://srfi.schemers.org/srfi-60/srfi-60.html">SRFI-60 (Integers as
Bits)</a> is now fully implemented.

</li><li> Ported <a href="http://srfi.schemers.org/srfi-101/srfi-101.html">SRFI-101</a>.
These are immutable (read-only) lists with fast (logarithmic) indexing
and functional update (i.e. return a modified list). These are
implemented by a <code>RAPair</code> class which extends the generic
<code>pair</code> type, which means that most code that expects a standard
list will work on these lists as well.

</li><li> The class <code>kawa.lib.kawa.expressions</code> contains an experimental
Scheme API for manipulating and validating expressions.
</li><li> Internal: Changed representation used for multiple values to an abstract
class with multiple implementations.

</li><li> Internal: Started converting to more standard Java code formatting and
indentation conventions, rather than GNU conventions. Some files
converted; this is ongoing work.
</li><li> Internal: Various I/O-related classes moved to new package
<code>gnu.kawa.io</code>.

</li><li> Various changes to the <code>configure+make</code> build framework: A C
compiler is now only needed if you configure with
<code>--enable-kawa-frontend</code>. Improved support for building under
Windows (using MinGW/MSYS).

</li><li> Support for building with <a href="http://gcc.gnu.org/java/">GCJ</a> was
removed.

</li></ul>

<span id="Kawa-1_002e14-_0028October-4_002c-2013_0029"></span><h4 class="subheading">Kawa 1.14 (October 4, 2013)</h4>
<span id="g_t_0023kawa_002d1_002e14_002doctober_002d4_002d2013"></span><ul>
<li> You can pass flags from the <code>kawa</code> front-end to the <code>java</code>
launcher using <code>-J</code> and <code>-D</code> flags. The <code>kawa</code> front-end
now passes the <code>kawa.command.line</code> property to Java; this is used
by the <code>(command-line)</code> procedure.
</li><li> Various improvements to the shell-script handling, including
<a href="Scripts.html">re-written documentation</a>.
</li><li> Some initial support for Java 8.

</li><li> More of R7RS is now working:

<ul>
<li> After adding list procedures <code>make-list</code>, <code>list-copy</code>,
<code>list-set!</code> all the R7RS list procedures are implemented.
</li><li> Other added procedures: <code>square</code>, <code>boolean=?</code>,
<code>string-copy!</code>, <code>digit-value</code>,
<code>get-environment-variable</code>, <code>get-environment-variables</code>,
<code>current-second</code>, <code>current-jiffy</code>, <code>jiffies-per-second</code>,
and <code>features</code>.
</li><li> The predicates <code>finite?</code>, <code>infinite?</code>, and <code>nan?</code> are
generalized to complex numbers.
</li><li> The procedures <code>write</code>, <code>write-simple</code>, and
<code>write-shared</code> are now consistent with R7RS.
</li><li> String and character comparison functions are generalized to more than
two arguments (but restricted to strings or characters, respectively).
</li><li> The procedures <code>string-copy</code>, <code>string-&gt;list</code>, and
<code>string-fill!</code> now take optional (start,end)-bounds. All of the
R7RS string functions are now implemented.
</li><li> Support <code>=&gt;</code> syntax in <code>case</code> form.
</li><li> Support backslash-escaped special characters in symbols when inside
vertical bars, such as <code>'|Hello\nworld|</code>.
</li><li> The new functions and syntax are documented in the <a href="index.html">Kawa
manual</a>; look for the functions in the <a href="Overall-Index.html">index</a>.
</li></ul>

</li><li> Added <code>define-private-alias</code> keyword.
</li><li> Extended <a href="Strings.html#String-templates">string quasi-literals
(templates)</a> as specified by
<a href="http://srfi.schemers.org/srfi-109/srfi-109.html">SRFI-109</a>. For
example, if <code>name</code> has the value <code>&quot;John&quot;</code>, then:

<pre class="verbatim">&amp;{Hello &amp;[name]!}
</pre>
<p>evaluates to: <code>&quot;Hello John!&quot;</code>.
</p>
</li><li> Named quasi-literal constructors as specified by
<a href="http://srfi.schemers.org/srfi-108/srfi-108.html">SRFI-108</a>.
</li><li> A symbol having the form <code>-&gt;type</code> is a type conversion function
that converts a value to <code>type</code>.
</li><li> New and improved check for void-valued expressions in a context
requiring a value. This is controlled by the new option
<code>--warn-void-used</code>, which defaults to true.

</li><li> The <code>datum-&gt;syntax</code> procedure takes an optional third parameter to
specify the source location. See <code>testsuite/srfi-108-test.scm</code> for
an example.
</li><li> Instead of specifying <code>--main</code> the command line, you can now
specify <code>(module-compile-options: main: #t)</code> in the Scheme file.
This makes it easier to compile one or more application (main) modules
along with other modules.
</li><li> A change to the data structure used to detect never-returning procedure
uses a lot less memory. (Kawa 1.13 implemented a conservative detection
of when a procedure cannot return. This analysis would sometimes cause
the Kawa compiler to run out of memory. The improved analysis uses the
same basic algorithm, but with a more space-efficient &ldquo;inverted&rdquo; data
structure.)
</li><li> Multiple fixes to get Emacs Lisp (JEmacs) working (somewhat) again.
</li></ul>

<span id="Kawa-1_002e13-_0028December-10_002c-2012_0029"></span><h4 class="subheading">Kawa 1.13 (December 10, 2012)</h4>
<span id="g_t_0023kawa_002d1_002e13_002ddecember_002d10_002d2012"></span><ul>
<li> We now do a simple (conservative) analysis of when a procedure cannot
return. This is combined with earlier and more precise analysis of
reachable code. Not only does this catch programmer errors better, but
it also avoids some internal compiler errors, because Kawa could get
confused by unreachable code.
</li><li> Implement 2-argument version of <code>log</code> function, as specified by
R6RS and R7RS (and, prematurely, the Kawa documentation).
</li><li> Implement the R7RS <code>bytevector</code> functions. The <code>bytevector</code>
type is a synonym for older <code>u8vector</code> type.

</li><li> Implement R7RS <code>vector</code> procedures. Various procedures now take
(start,end)-bounds.

</li><li> Implement most of the R7RS input/output proecdures. Most significant
enhancement is support for R7RS-conforming binary ports.
</li><li> Various enhancements to the manual, including merging in lots of text
from R7RS.
</li><li> Improved Android support, including a more convenient Ant script
contributed by Julien Rousseau. Also, documentation merged into manual.
</li></ul>

<span id="Kawa-1_002e12-_0028May-30_002c-2012_0029"></span><h4 class="subheading">Kawa 1.12 (May 30, 2012)</h4>
<span id="g_t_0023kawa_002d1_002e12_002dmay_002d30_002d2012"></span><ul>
<li> Implement a compile-time data-flow framework, similar to Single Static
Assignment. This enables better type inference, improves some
warnings/errors, and enables some optimizations.

</li><li> Jamison Hope added support for co-variant return types and bridge
methods for generics.
</li><li> Macros were improved and more standards-conforming:
<ul>
<li> <code>datum-&gt;syntax</code> and <code>syntax-&gt;datum</code> are preferred names for
<code>datum-&gt;syntax-object</code> and <code>syntax-object-&gt;datum</code>.
</li><li> Implemented <code>bound-identifier=?</code> and re-wrote implementation of
<code>free-identifier=?</code>.

</li><li> Implement <code>unsyntax</code> and <code>unsyntax-splicing</code>, along with the
reader prefixes <code>#,</code> and <code>#,@</code>.
</li></ul>

</li><li> New and improved lazy evaluation functionality:

<ul>
<li> Lazy values (resulting from <code>delay</code> or <code>future</code>) are
implicitly forced as needed. This makes &ldquo;lazy programming&rdquo; more
convenient.
</li><li> New type <code>promise</code>.
</li><li> The semantics of promises (<code>delay</code> etc) is now compatible with
<a href="http://srfi.schemers.org/srfi-45/srfi-45.html">SRFI 45</a>.
</li><li> &ldquo;Blank promises&rdquo; are useful for passing data between processes, logic
programmming, and more. New functions <code>promise-set-value!</code>,
<code>promise-set-alias!</code>, <code>promise-set-exception!</code>, and
<code>promise-set-thunk!</code>.
</li><li> The stream functions of
<a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI-41</a> were
re-implemented to use the new promise functionality.
</li></ul>

</li><li> Different functions in the same module can be compiled with or without
full tailcall support. You can control this by using
<code>full-tailcalls</code> in <code>with-compile-options</code>. You can also
control <code>full-tailcalls</code> using <code>module-compile-options</code>.

</li><li> Charles Turner (sponsored by <a href="http://code.google.com/soc/">Google&rsquo;s
Summer of Code</a>) enhanced the printer with support for
<a href="http://srfi.schemers.org/srfi-38/">SRFI-38: External Representation
for Data With Shared Structure</a>.

</li><li> Optimize tail-recursion in module-level procedures. (We used to only do
this for internal functions, for reasons that are no longer relevant.)

</li><li> Add support for building Kawa on Windows using configure+make
(autotools) and Cygwin.

</li><li> Some support for parameterized (generic) types:

<pre class="verbatim">  Type[Arg1 Arg2 ... ArgN]
</pre>
<p>is more-or-less equivalent to Java&rsquo;s:
</p>
<pre class="verbatim">  Type&lt;Arg1, Arg2, ..., ArgN&gt;
</pre>
</li><li> New language options <code>--r5rs</code>, <code>--r6rs</code>, and <code>--r7rs</code>
provide better compatibility with those Scheme standards. (This is a
work-in-progress.) For example <code>--r6rs</code> aims to disable Kawa
extensions that conflict with R6RS. It does not aim to disable all
extensions, only incompatible extensions. So far these extensions
disable the colon operator and keyword literals. Selecting <code>--r5rs</code>
makes symbols by default case-insensitive.

</li><li> The special tokens <code>#!fold-case</code> and <code>#!no-fold-case</code> act like
comments except they enable or disable case-folding of symbols. The old
<code>symbol-read-case</code> global is now only checked when a LispReader is
created, not each time a symbol is read.
</li><li> You can now use square brackets to construct immutable sequences
(vectors).
</li><li> A record type defined using <code>define-record-type</code> is now compiled to
a class that is a member of the module class.

</li><li> Annotations are now supported.
<a href="http://per.bothner.com/blog/2011/Using-JAXB-annotations/">This
example</a> shows how to use
<a href="http://java.sun.com/xml/downloads/jaxb.html">JAXB</a> annotations to
automatically convert between between Java objects and XML files.
</li><li> Prevent mutation of vector literals.

</li><li> More R6RS procedures: <code>vector-map</code>, <code>vector-for-each</code>,
<code>string-for-each</code>, <code>real-valued?</code>, <code>rational-valued?</code>,
<code>integer-valued?</code>, <code>finite?</code>, <code>infinite?</code>, <code>nan?</code>,
<code>exact-integer-sqrt</code>.

</li><li> <a href="http://srfi.schemers.org/srfi-14/srfi-14.html">SRFI-14</a> (&quot;character
sets&quot;) and <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI-41</a>
(&quot;streams&quot;) are now supported, thanks to porting done by Jamison Hope.

</li><li> Kawa now runs under JDK 1.7. This mostly involved fixing some errors in
<code>StackMapTable</code> generation.

</li><li> You can now have a class created by <code>define-simple-class</code> with the
same name as the module class. For example
<code>(define-simple-class foo ...)</code> in a file <code>foo.scm</code>. The
defined class will serve dual-purpose as the module class.
</li><li> Improvements in separating compile-time from run-time code, reducing the
size of the runtime jar used for compiled code.
</li><li> In the <code>cond-expand</code> conditional form you can now use
<code>class-exists:ClassName</code> as a feature &ldquo;name&rdquo; to tests that
<code>ClassName</code> exists.
</li></ul>

<span id="Kawa-1_002e11-_0028November-11_002c-2010_0029"></span><h4 class="subheading">Kawa 1.11 (November 11, 2010)</h4>
<span id="g_t_0023kawa_002d1_002e11_002dnovember_002d11_002d2010"></span><ul>
<li> A new Kawa logo, contributed by <a href="http://jcubic.pl">Jakub
Jankiewicz</a>.
</li><li> A new <code>--warn-unknown-member</code> option, which generalizes
<code>--warn-invoke-unknown-method</code> to fields as well as methods.
</li><li> A new <a href="ant-kawac.html"><code>kawac</code> task</a>, useful for Ant
<code>build.xml</code> files, contributed by Jamison Hope.
</li><li> <a href="http://per.bothner.com/blog/2010/AndroidHelloScheme">Updated
Android support</a>.
</li><li> New <a href="Enumerations.html"><code>define-enum</code> macro</a> contributed by
Jamison Hope.
</li><li> Access specifiers <code>'final</code> and <code>'enum</code> are now allowed in
<code>define-class</code> and related forms.
</li><li> Optimized <code>odd?</code> and <code>even?</code>.
</li><li> If you specify the type of a <code>#!rest</code> parameter as an array type,
that will now be used for the &quot;varargs&quot; method parameter. (Before only
object arrays did this.)
</li><li> When constructing an object and there is no matching constructor method,
look for &quot;<code>add</code>&quot; methods in addition to &quot;<code>set</code>&quot; methods. Also,
allow passing constructor args as well as keyword setters.
<a href="Allocating-objects.html">See here</a> for the gory details.
</li><li> New <code>expand</code> function (contributed by Helmut Eller, and enabled by
<code>(require 'syntax-utils)</code>) for converting Scheme expressions to
macro-expanded forms.
</li><li> <a href="Anonymous-classes.html#SAM-conversion">SAM-conversion</a>: In a
context that expects a Single Abstract Method (SAM) type (for example
<code>java.lang.Runnable</code>), if you pass a lambda you will get an
<code>object</code> where the lambda implements the abstract method.

</li><li> In interactive mode allow dynamic rebinding of procedures. I.e. if you
re-define a procedure, the old procedure objects gets modified in-place
and re-used, rather than creating a new procedure object. Thus calls in
existing procedures will call the new version.

</li><li> Fix various threading issues related to compilation and eval.

</li><li> When <code>format</code> returns a string, return a <code>java.lang.String</code>
rather than a <code>gnu.lists.FString</code>. Also, add some minor
optimization.
</li><li> Inheritance of environments and fluid variables now work properly for
all child threads, not just ones created using <code>future</code>.

</li></ul>

<span id="Kawa-1_002e10-_0028July-24_002c-2010_0029"></span><h4 class="subheading">Kawa 1.10 (July 24, 2010)</h4>
<span id="g_t_0023kawa_002d1_002e10_002djuly_002d24_002d2010"></span><ul>
<li> Now defaults to using Java 6, when compiling from source. The pre-built
<code>jar</code> works with Java 5, but makes use of some Java 6 features
(<code>javax.script</code>, built-in HTTP server) if available.
</li><li> You can write <a href="XML-literals.html">XML literals</a> in Scheme code
prefixed by a <code>#</code>, for example:

<pre class="verbatim">#&lt;p&gt;The result is &amp;{result}.&lt;/p&gt;
</pre>
</li><li> New functions <code>element-name</code> and <code>attribute-name</code>.
</li><li> Various <a href="Server-side-scripts.html">Web server improvements</a>. You
have the option of using JDK 6&rsquo;s builtin
<a href="Options.html#Options-for-web-servers">web-server</a> for
<a href="Self-configuring-page-scripts.html">auto-configued web pages</a>.
Automatic import of web server functions, so you should not need to
<code>(import 'http)</code> any more.
</li><li> Kawa <a href="Hash-tables.html">hashtables</a> now extend <code>java.util.Map</code>.

</li><li> If a source file is specified on the <code>kawa</code> command line without
any options, it is read and compiled as a whole module before it is run.
In contrast, if you want to read and evaluate a source file line-by-line
you must use the <code>-f</code> flag.

</li><li> You can specify a class name on the <code>kawa</code> command line:

<pre class="verbatim">$ kawa fully.qualified.name
</pre>
<p>This is like the <code>java</code> command. but you don&rsquo;t need to specify the
path to the Kawa runtime library, and you don&rsquo;t need a <code>main</code>
method (as long as the class is <code>Runnable</code>).
</p>
</li><li> The usual bug-fixes, including better handling of the <code>~F</code>
<code>format</code> directive; and fix in handling of macro hygiene of the
<code>lambda</code> (<a href="https://savannah.gnu.org/bugs/index.php?27042">bug
#27042</a>).

</li><li> Spaces are now optional before and after the &rsquo;::&rsquo; in type specifiers.
The preferred syntax leave no space after the &rsquo;::&rsquo;, as in:

<pre class="verbatim">(define xx ::int 1)
</pre>
</li><li> <code>define-for-syntax</code> and <code>begin-for-syntax</code> work.

</li><li> You can now use <code>car</code>, <code>cdr</code> etc to work with <code>syntax</code>
objects that wrap lists, as in SRFI-72.

</li><li> You can now define a package alias:

<pre class="verbatim">(define-alias jutil java.util)
(define mylist :: jutil:List (jutil:ArrayList))
</pre>
</li><li> <code>--module-static</code> is now the default. A new
<code>--module-nonstatic</code> (or <code>--no-module-static</code>) option can be
used to get the old behavior.

</li><li> You can use <code>access:</code> to specify that a field is <code>'volatile</code>
or <code>'transient</code>.

</li><li> You can now have type-specifiers for multiple variables in a <code>do</code>.

</li><li> Imported variables are read-only.

</li><li> Exported variables are only made into Locations when needed.

</li><li> The letter used for the exponent in a floating-point literal determines
its type: <code>12s2</code> is a <code>java.lang.Float</code>, <code>12d2</code> is a
<code>java.lang.Double</code>, <code>12l2</code> is a <code>java.math.BigInteger</code>,
<code>12e2</code> is a <code>gnu.math.DFloat</code>.

</li><li> Internal: Asking for a <code>.class</code> file using
<code>getResourceAsStream</code> on an <code>ArrayClassLoader</code> will now open a
<code>ByteArrayInputStream</code> on the class bytes.

</li><li> A new <code>disassemble</code> function.

</li><li> If <code>exp1</code> has type <code>int</code>, the type of <code>(+ exp1 1)</code> is now
(32-bit) <code>int</code>, rather than (unlimited-precision) <code>integer</code>.
Similar for <code>long</code> expressions, other arithmetic operations (as
appropriate), and other untyped integer literals (as long as they fit in
32/64 bits respectively).

</li><li> Many more oprimization/specializations of arithmetic, especially when
argument types are known.

</li><li> Top-level bindings in a module compiled with <code>--main</code> are now
implicitly module-private, unless there is an explicit
<code>module-export</code>.

</li><li> <a href="http://srfi.schemers.org/srfi-2/srfi-2.html">SRFI-2</a>
(<code>and-let*</code>: an <code>and</code> with local bindings, a guarded <code>*</code>
special form) is now supported.

</li><li> The reader now supports shared sub-objects, as in
<a href="http://srfi.schemers.org/srfi-38/srfi-38.html">SRFI-38</a> and Common
Lisp: <code>(#2=(3 4) 9 #2# #2#)</code>. (Writing shared sub-objects is not
yet implemented.)

</li><li> A module compiled with <code>--main</code> by default exports no bindings
(unless overriden by an explicit <code>module-export</code>).

</li><li> Factor out compile-time only code from run-time code. The new
<code>kawart-version.jar</code> is smaller because it has less compile-time
only code. (Work in progress.)
</li><li> More changes for R6RS compatibility:

<ul>
<li> The reader now recognizes <code>+nan.0</code>, <code>+inf.0</code> and variations.

</li><li> The <code>div</code>, <code>mod</code>, <code>div0</code>, <code>mod0</code>,
<code>div-and-mod</code>, <code>div0-and-mod0</code>, <code>inexact</code> and
<code>exact</code> functions were implemented.

</li><li> <code>command-line</code> and <code>exit</code>.

</li></ul>

</li></ul>

<span id="Kawa-1_002e9_002e90-_0028August-8_002c-2009_0029"></span><h4 class="subheading">Kawa 1.9.90 (August 8, 2009)</h4>
<span id="g_t_0023kawa_002d1_002e9_002e90_002daugust_002d8_002d2009"></span><ul>
<li> Support for <code>javax.script</code>.

</li><li> Support for <a href="Regular-expressions.html">regular expressions</a>.

</li><li> Performance improvements:

<ul>
<li> Emit <code>iinc</code> instruction (to increment a local <code>int</code> by a
constant).

</li><li> Inline the <code>not</code> function if the argument is constant.

</li><li> If <code>call-with-current-continuation</code> is only used to exit a block in
the current method, optimize to a <code>goto</code>.

</li><li> Generate <code>StackMapTable</code> attributes when targeting Java 6.

</li><li> Kawa can now inline a function with multiple calls (without code
duplication) if all call sites have the same return location
(continuation). For example: <code>(if p (f a) (f b))</code>. Also mutually
tail-recursive functions are inlined, so you get constant stack space
even without <code>--full-tailcalls</code>. (Thanks for Helmut Eller for a
prototype.)
</li></ul>

</li><li> A number of changes for R6RS compatibility:

<ul>
<li> The <code>char-titlecase</code>, <code>char-foldcase</code>, <code>char-title-case?</code>
library functions are implemented.

</li><li> Imported variables are read-only.

</li><li> Support the R6RS <code>import</code> keyword, including support for renaming.

</li><li> Support the R6RS <code>export</code> keyword (though without support for
renaming).

</li><li> Implemented the <code>(rnrs hashtables)</code> library.

</li><li> Implemented the <code>(rnrs sorting)</code> library.

</li><li> CommonLisp-style keyword syntax is no longer supported (for Scheme): A
colon followed by an identifier is no longer a keyword (though an
identifier followed by a colon is still a keyword). (One reason for this
change is to support SRFI-97.)

</li><li> The character names <code>#\delete</code>, <code>#\alarm</code>, <code>#\vtab</code> are
now supported. The old names <code>#\del</code>, <code>#\rubout</code>, and
<code>#\bel</code> are deprecated.

</li><li> Hex escapes in character literals are supported. These are now printed
where we before printed octal escapes.

</li><li> A hex escape in a string literal should be terminated by a semi-colon,
but for compatibily any other non-hex-digit will also terminate the
escape. (A terminating semi-colon will be skipped, though a different
terminator will be included in the string.)

</li><li> A backslash-whitespace escape in a string literal will not only ignore
the whitespace through the end of the line, but also any initial
whitespace at the start of the following line.

</li><li> The comment prefix <code>#;</code> skips the following S-expression, as
specified by
<a href="http://srfi.schemers.org/srfi-62/srfi-62.html">SRFI-62</a>.

</li><li> All the
<a href="http://www.r6rs.org/final/html/r6rs-lib/r6rs-lib-Z-H-12.html#node_sec_11.4">R6RS
exact bitwise arithmetic</a> functions are now implemented and
<a href="Logical-Number-Operations.html">documented in the manual</a>. The new
standard functions (for example <code>bitwise-and</code>) are now preferred
over the old functions (for example <code>logand</code>).

</li><li> If <code>delete-file</code> fails, throws an exception instead of returning
<code>#f</code>.

</li></ul>

</li><li> The code-base now by default assumes Java 5 (JDK 1.5 or newer), and
pre-built <code>jar</code> files will require Java 5. Also, the Kawa source
code now uses generics, so you need to use a generics-aware
<code>javac</code>, passing it the appropriate <code>--target</code> flag.

</li><li> New SRFIs supported:

<ul>
<li> <a href="http://srfi.schemers.org/srfi-62/srfi-62.html">SRFI-62</a> -
S-expression comments.

</li><li> <a href="http://srfi.schemers.org/srfi-64/srfi-64.html">SRFI-64</a> - Scheme
API for test suites.

</li><li> <a href="http://srfi.schemers.org/srfi-95/srfi-95.html">SRFI-95</a> - Sorting
and Merging.

</li><li> <a href="http://srfi.schemers.org/srfi-97/srfi-97.html">SRFI-97</a> - Names for
SRFI Libraries. This is a naming convention for R6RS <code>import</code>
statements to reference SRFI libraries.

</li></ul>

</li><li> In BRL text outside square brackets (or nested like <code>]this[</code>) now
evaluates to <code>UnescapedData</code>, which a Scheme quoted string
evaluates to <code>String</code>, rather than an <code>FString</code>. (All of the
mentioned types implement <code>java.lang.CharSequence</code>.)

</li><li> You can now
<a href="http://per.bothner.com/blog/2009/AndroidHelloScheme/">run Kawa
Scheme programs on Android</a>, Google&rsquo;s mobile-phone operating system.

</li><li> The macro <code>resource-url</code> is useful for accessing resources.

</li><li> A new command-line option <code>--target</code> (or <code>-target</code>) similar to
<code>javac</code>&rsquo;s <code>-target</code> option.

</li><li> If there is no console, by default create a window as if <code>-w</code> was
specificed.

</li><li> If a class method (defined in <code>define-class</code>,
<code>define-simple-class</code> or <code>object</code>) does not have its parameter
or return type specified, search the super-classes/interfaces for
matching methods (same name and number of parameters), and if these are
consistent, use that type.

</li><li> Trying to modify the <code>car</code> or <code>cdr</code> of a literal list now
throws an exception.

</li><li> The <code>.zip</code> archive created by <code>compile-file</code> is now
compressed.

</li><li> Java5-style varargs-methods are recognized as such.

</li><li> When evaluating or loading a source file, we now always compile to
bytecode, rather than interpreting &ldquo;simple&rdquo; expressions. This makes
semantics and performance more consistent, and gives us better exception
stack traces.

</li><li> The Scheme type specifier <code>&lt;integer&gt;</code> now handles automatic
conversion from <code>java.math.BigInteger</code> and the <code>java.lang</code>
classes <code>Long</code>, <code>Integer</code>, <code>Short</code>, and <code>Byte</code>. The
various standard functions that work on <code>&lt;integer&gt;</code> (for example
<code>gcd</code> and <code>arithmetic-shift</code>) can be passed (say) a
<code>java.lang.Integer</code>. The generic functions such as <code>+</code> and the
real function <code>modulo</code> should also work. (The result is still a
<code>gnu.math.IntNum</code>.)

</li><li> If a name such as (<code>java.util</code>) is lexically unbound, and there is
a known package with that name, return the <code>java.lang.Package</code>
instance. Also, the colon operator is extended so that
<code>package:name</code> evaluates to the <code>Class</code> for
<code>package.name</code>.

</li><li> <code>`prefix:,expression</code> works - it finds a symbol in <code>prefix</code>&rsquo;s
package (aka namespace), whose local-name is the value of
<code>expression</code>.

</li><li> A quantity <code>3.0cm</code> is now syntactic sugar for
<code>(* 3.0 unit:cm)</code>. Similarly:<br>
<code>(define-unit name value)</code><br>
is equivalent to:<br>
<code>(define-constant unit:name value)</code><br>
This means that unit names follow normal name-lookup rules (except being
in the <code>unit</code> &ldquo;package&rdquo;), so for example you can have local unit
definitions.

</li><li> You can specify whether a class has public or package access, and
whether it is translated to an interface or class.

</li><li> You can declare an abstract method by writing <code>#!abstract</code> as its
body.

</li><li> If a name of the form <code>type?</code> is undefined, but <code>type</code> is
defined, then treat the former as
<code>(lambda (x) (instance? x type))</code>.
</li><li> A major incompatible (but long-sought) change: Java strings (i.e.
<code>java.lang.String</code> values) are now Scheme strings, rather than
Scheme symbols. Since Scheme strings are mutable, while Java
<code>String</code>s are not, we use a different type for mutable strings:
<code>gnu.lists.FString</code> (this is not a change). Scheme string literals
are <code>java.lang.String</code> values. The common type for Scheme string is
<code>java.lang.CharSequence</code> (which was introducted in JDK 1.4).

<p>Scheme symbols are now instances of
<a href="api/gnu/mapping/Symbol.html"><code>gnu.mapping.Symbol</code></a>,
specifically the <code>SimpleSymbol</code> class.
</p>
</li><li> A fully-qualified class name such as <code>java.lang.Integer</code> now
evaluates to the corresponding <code>java.lang.Class</code> object. I.e. it is
equivalent to the Java term <code>java.lang.Integer.class</code>. This assumes
that the name does not have a lexical binding, <em>and</em> that it exists
in the class-path at compile time.

<p>Array class names (such as <code>java.lang.Integer[]</code>) and primitive
types (such as <code>int</code>) also work.
</p>
<p>The older angle-bracket syntax <code>&lt;java.lang.Integer&gt;</code> also works and
has the same meaning. It also evaluates to a <code>Class</code>. It used to
evaluate to a <a href="api/gnu/bytecode/Type.html"><code>Type</code></a>, so this is
a change.
</p>
<p>The name bound by a <code>define-simple-class</code> now evaluates to a
<code>Class</code>, rather than a
<a href="api/gnu/bytecode/ClassType.html"><code>ClassType</code></a>. A
<code>define-simple-class</code> is not allowed to reference non-static
module-level bindings; for that use <code>define-class</code>.
</p>
</li><li> New convenience macro
<a href="Syntax-and-conditional-compilation.html"><code>define-syntax-case</code></a>.

</li></ul>

<span id="Kawa-1_002e9_002e1-_0028January-23_002c-2007_0029"></span><h4 class="subheading">Kawa 1.9.1 (January 23, 2007)</h4>
<span id="g_t_0023kawa_002d1_002e9_002e1_002djanuary_002d23_002d2007"></span><ul>
<li> Fix some problems building Kawa from source using <code>configure+make</code>.
</li></ul>

<span id="Kawa-1_002e9_002e0-_0028January-21_002c-2007_0029"></span><h4 class="subheading">Kawa 1.9.0 (January 21, 2007)</h4>
<span id="g_t_0023kawa_002d1_002e9_002e0_002djanuary_002d21_002d2007"></span><ul>
<li> New types and functions for working with <a href="Paths.html">paths and
URIs</a>.

</li><li> Reader macros URI, namespace, duration.

</li><li> Simplified <a href="Source-distribution.html">build using gcj</a>, and added
configure flag &ndash;with-gcj-dbtool.

</li><li> If two &ldquo;word&rdquo; values are written, a space is written between them. A
word is most Scheme values, including numbers and lists. A Scheme string
is treated as a word by <code>write</code> but by not <code>display</code>.

</li><li> A new <code>--pedantic</code> command-line flag. It currently only affects the
XQuery parser.

</li><li> The <code>load-compile</code> procedure was removed.

</li><li> The string printed by the <code>--version</code> switch now includes the
Subversion revision and date (but only if Kawa was built using
<code>make</code> rather than <code>ant</code> from a checked-out Subversion tree).

</li><li> Kawa development now uses the
<a href="http://subversion.tigris.org/">Subversion (svn)</a> version control
system instead of CVS.

</li><li> Show file/line/column on unbound symbols (both when interpreted and when
compiled).

</li><li> Cycles are now allowed between <code>require</code>&rsquo;d modules. Also, compiling
at set of modules that depend on each other can now specified on the
compilation command line in any order, as long as needed <code>require</code>
forms are given.

</li><li> The <a href="PathExpressions.html">&ldquo;colon notation&rdquo; has been
generalized.</a>. The syntax <code>object:name</code> generally means to extract
a component with a given <code>name</code> from <code>object</code>, which may be an
object, a class, or a namespace.

</li><li> New command-line options <code>--debug-error-prints-stack-trace</code> and
<code>--debug-warning-prints-stack-trace</code> provide stack trace on static
error messages.

</li><li> The <a href="Software-License.html">license for the Kawa software</a> has been
changed to the
<a href="http://opensource.org/licenses/mit-license.php">X11/MIT license</a>.

</li><li> A much more <a href="Array-operations.html">convenient syntax for working
with Java arrays</a>.

<p>The same function-call syntax also works for Scheme vectors, uniform
vectors, strings, lists - and anything else that implements
<code>java.util.List</code>.
</p>
</li><li> The fields and methods of a class and its bases classes are in scope
within methods of the class.
</li><li> Unnamed procedures (such as lambda expressions) are printed with the
source filename and line.

</li><li> The numeric compare functions (<code>=</code>, <code>&lt;=</code>, etc) and
<code>number-&gt;string</code> now work when passed standard Java <code>Number</code>
objects (such as <code>java.lang.Long</code> or <code>java.math.BigDecimal</code>).
</li><li> <a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI-10</a> is now
implemented, providing the <code>#,(name args ...)</code> form. Predefined
constructor <code>name</code>s so far are <code>URI</code> and <code>namespace</code>. The
<code>define-reader-ctor</code> function is available if you
<code>(require 'srfi-10)</code>.

</li><li> A new <code>--script</code> option makes it easier to write Unix shell
scripts.

</li><li> Allow general URLs for loading (including the <code>-f</code> flag),
compilation and <code>open-input-file</code>, if the &ldquo;file name&rdquo; starts with
a URL &ldquo;scheme&rdquo; like <code>http:</code>.

</li><li> Classes defined (<em>e.g.</em> with <code>define-simple-class</code>) in a
module can now mutually reference each other. On the other hand, you can
no longer <code>define-class</code> if the class extends a class rather than
an interface; you must use <code>define-simple-class</code>.

</li><li> <code>KawaPageServlet</code> now automatically selects language.

</li><li> <code>provide</code> macro.
</li><li> <code>quasisyntax</code> and the convenience syntax <code>#`</code>, from
<a href="http://srfi.schemers.org/srfi-72/srfi-72.html">SRFI-72</a>.
</li><li> <code>define-for-syntax</code>, <code>syntax-source</code>, <code>syntax-line</code>, and
<code>syntax-column</code>, for better compatibility with mzscheme.
</li><li> <a href="http://srfi.schemers.org/srfi-34/srfi-34.html">SRFI-34</a> (Exception
Handling for Programs), which implements <code>with-exception-handler</code>,
<code>guard</code>, and <code>raise</code>, is now available, if you
<code>(require 'srfi-34)</code>.<br>
Also, <a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI-35</a>
(Conditions) is available, if you <code>(require 'srfi-35)</code>.
</li><li> The <code>case-lambda</code> form from
<a href="http://srfi.schemers.org/srfi-16/srfi-16.html">SRFI-16</a> is now
implemented more efficiently.

</li></ul>

<span id="Kawa-1_002e8-_0028October-18_002c-2005_0029"></span><h4 class="subheading">Kawa 1.8 (October 18, 2005)</h4>
<span id="g_t_0023kawa_002d1_002e8_002doctober_002d18_002d2005"></span><p><a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69 &ldquo;Basic hash
tables&rdquo;</a> is now available, if you <code>(require 'hash-table)</code> or
<code>(require 'srfi-69)</code>. This is an optimized and Java-compatible port
whose default hash function calls the standard <code>hashCode</code> method.
</p>
<p>A <code>define-simple-class</code> can now have one (or more) explicit
constructor methods. These have the spcial name <code>*init*</code>. You can
call superclass constructors or sibling constructors (<code>this</code>
constructor calls) using the (admittedly verbose but powerful)
<code>invoke-special</code> form.
</p>
<p>The <code>runnable</code> function creates a <code>Runnable</code> from a
<code>Procedure</code>. It is implemented using the new class
<code>RunnableClosure</code>, which is now also used to implement
<code>future</code>.
</p>
<p>The <code>kawa</code> command can now be run &ldquo;in-place&rdquo; from the build
directory: <code>$build_dir/bin/kawa</code>.
</p>
<p>The special field name <code>class</code> in <code>(static-name type 'class)</code>
or <code>(prefix:.class)</code> returns the <code>java.lang.Class</code> object
corresponding to the <code>type</code> or <code>prefix</code>. This is similar to
the Java syntax.
</p>
<p>Contructing an instance (perhaps using <code>make</code>) of a class defined
using <code>define-simple-class</code> in the current module is much more
efficient, since it no longer uses reflection. (Optimizing classes
defined using <code>define-class</code> is more difficult.) The constructor
function defined by the <code>define-record-type</code> macro is also
optimized.
</p>
<p>You can now access instance methods using this short-hand:
<code>(*:methodname instance arg ...)</code><br>
This is equivalent to: <code>(invoke instance 'methodname arg ...)</code>
</p>
<p>You can now also access a fields using the same colon-notation as used
for accessing methods, except you write a dot before the field name:<br>
<code>(type:.fieldname)</code> <code> ;; </code>is like:
<code>(static-field type 'fieldname)</code>.<br>
<code>(*:.fieldname instance)</code> <code>;;</code> is like:
<code>(field 'fieldname instance)</code><br>
<code>(type:.fieldname instance)</code> <code>;;</code> is like:
<code>(*:.fieldname (as instance type))</code><br>
These all work with <code>set!</code> - for example:
<code>(set! (*:.fieldname instance) value)</code>.
</p>
<p>In the above uses of colon-notation, a <code>type</code> can be any one of:<br>
- a namespace prefix bound using <code>define-namespace</code> to a namespace
uri of the form <code>&quot;class:classname&quot;</code>;<br>
- a namespace prefix using <code>define-namespace</code> bound to a
<code>&lt;classname&gt;</code> name, which can be a fully-qualified class name or a
locally-declared class, or an alias (which might be an imported
class);<br>
- a fully qualified name of a class (that exists at compile-time), as in
<code>(java.lang.Integer:toHexString 123)</code>; or<br>
- a <code>&lt;classname&gt;</code> variable, for example:
<code>(&lt;list&gt;:list3 11 12 13)</code>.
</p>
<p>New fluid variables <code>*print-base*</code>, <code>*print-radix*</code>,
<code>*print-right-margin*</code>, and <code>*print-miser-width*</code> can control
output formatting. (These are based on Common Lisp.)
</p>
<p>You can new emit elipsis (<code>...</code>) in the output of a <code>syntax</code>
template using the syntax <code>(... ...)</code>, as in other
<code>syntax-case</code> implementations.
</p>
<p>The <code>args-fold</code> program-argument processor from
<a href="http://srfi.schemers.org/srfi-37/srfi-37.html">SRFI-37</a> is
available after you <code>(require 'args-fold)</code> or
<code>(require 'srfi-37)</code>.
</p>
<p>The <code>fluid-let</code> form now works with lexical bindings, and should be
more compatible with other Scheme implementations.
</p>
<p><code>(module-export namespace:prefix)</code> can be used to export a
namespace prefix.
</p>
<p>Static modules are now implemented more similarly to non-static modules.
Specifically, the module body is not automatically run by the class
initializer. To get the old behavior, use the new
<code>--module-static-run</code> flag. Alternatively, instead of
<code>(module-static #t)</code> use <code>(module-static 'init-run)</code>.
</p>
<p>Implement <a href="http://srfi.schemers.org/srfi-39/srfi-39.html">SRFI-39</a>
&quot;Parameter-objects&quot;. These are like anonymous fluid values and use the
same implementation. <code>current-input-port</code>,
<code>current-output-port</code>, and <code>current-error-port</code> are now
parameters.
</p>
<p>Infer types of variables declared with a <code>let</code>.
</p>
<p>Character comparisons (such as <code>char-=?</code>, <code>char-ci&lt;?</code>)
implemented much more efficiently &mdash; and (if using Java5) work for
characters not in the Basic Multilingual Plane.
</p>
<p>Major re-write of symbol and namespace handling. A
<a href="api/gnu/mapping/Symbol.html"><code>Symbol</code></a> is now immutable,
consisting of a &quot;print-name&quot; and a pointer to a
<a href="api/gnu/mapping/Namespace.html"><code>Namespace</code></a> (package). An
<a href="api/gnu/mapping/Environment.html"><code>Environment</code></a> is a mapping
from <code>Symbol</code> to
<a href="api/gnu/mapping/Location.html"><code>Location</code></a>.
</p>
<p>Rename <code>Interpreter</code> to
<a href="api/gnu/expr/Language.html"><code>Language</code></a> and
<code>LispInterpreter</code> to
<a href="api/gnu/kawa/lispexpr/LispLanguage.html"><code>LispLanguage</code></a>.
</p>
<p>Constant-time property list operations.
</p>
<p>Namespace-prefixes are now always resolved at compile-time, never at
run-time.
</p>
<p><code>(define-namespace PREFIX &lt;CLASS&gt;)</code> is loosely the same as
<code>(define-namespace PREFIX &quot;class:CLASS&quot;)</code> but does the right thing
for classes defined in this module, including nested or non-simple
classes.
</p>
<p>Macros capture proper scope automatically, not just when using require.
This allows some internal macros to become private.
</p>
<p>Major re-write of the macro-handling and hygiene framework. Usable
support for <code>syntax-case</code>; in fact some of the primitives (such as
<code>if</code>) are now implemented using <code>syntax-case</code>.
<code>(syntax form)</code> (or the short-cut <code>#!form)</code> evaluates to a
syntax object. <code>(define-syntax (mac x) tr)</code> same as
<code>(define-syntax mac (lambda (x) tr))</code>. The following non-hygienic
forms are equivalent:
</p>
<pre class="verbatim">  (define-macro (macro-name (param ...) transformer)
  (define-macro macro-name (lambda (param ...) transformer))
  (defmacro macro-name (PARAM ...) transformer)
</pre>
<p>Allow vectors and more general ellipsis-forms in patterns and templates.
</p>
<p>A new configure switch <code>--with-java-source=version</code> allows you to
tweak the Kawa sources to match Java compiler and libraries you&rsquo;re
using. The default (and how the sources are distributed) is <code>2</code>
(for &quot;Java 2&quot; &ndash; jdk 1.2 or better), but you can also select &quot;<code>1</code>&quot;
(for jdk 1.1.x), and &quot;<code>5</code>&quot; for Java 5 (jdk 1.5). You can also
specify a jdk version number: &quot;<code>1.4.1</code>&quot; is equivalent to &quot;2&quot; (for
now). Note the default source-base is incompatible with Java 5 (or more
generally JAXB 1.3 or DOM 3), unless you also <code>--disable-xml</code>.
</p>
<p>Configure argument <code>--with-servlet</code>[<code>=servlet-api.jar</code>]
replaces <code>--enable-servlet</code>.
</p>
<p>Function argument in error message are now numbered starting at one.
Type errors now give better error messages.
</p>
<p>A new function calling convention, used for <code>--full-tailcalls</code>. A
function call is split up in two parts: A
<code>match0</code>/.../<code>matchN</code> method checks that the actual arguments
match the expected formal arguments, and leaves them in the per-thread
<a href="api/gnu/mapping/CallContext.html"><code>CallContext</code></a>. Then after
the calling function returns, a zero-argument <code>apply()</code> methods
evaluates the function body. This new convention has long-term
advantages (performance, full continuations), but the most immediate
benefit is better handling of generic (otherloaded) functions. There are
also improved error messages.
</p>
<p>Real numbers, characters, Lisp/Scheme strings
(<a href="api/gnu/lists/FString.html"><code>FString</code></a>) and symbols all now
implement the <code>Comparable</code> interface.
</p>
<p>In <code>define-class</code>/<code>define-simple-class</code>: [Most of this work
was funded by <a href="http://www.mercedsystems.com/">Merced Systems</a>.]
</p>
<ul>
<li> You can specify
<code>access: </code>[<code>'private</code>|<code>'protected</code>|<code>'publi</code>c|<code>'package</code>]
to set the Java access permissions of fields and methods.
</li><li> Methods can be static by using the <code>access: 'static</code> specifier.
</li><li> The reflective routines <code>invoke</code> , <code>field</code> ,
<code>static-field</code> , <code>slot-ref</code> , <code>slot-set!</code> can now access
non-public methods/fields when appropriate.
</li><li> Such classes are no longer initialized when the containing module is
loaded.
</li><li> The <code>expr</code> in <code>init-form: expr</code> is now evaluated in the outer
scope.
</li><li> A new <code>init: expr</code> evalues <code>expr</code> in the inner scope.
</li><li> An option name following <code>allocation:</code> can now be a string literal
or a quoted symbol. The latter is preferred: <code>allocation: 'class</code>.
</li><li> Added <code>'static</code> as a synonym for <code>'class</code> following
<code>allocation:</code>.
</li><li> Initialization of static field (<code>allocation: 'class init: expr</code>)
now works, and is performed at class initialization time.
</li><li> You can use unnamed &ldquo;dummy fields&rdquo; to add initialization-time actions
not tied to a field:

<pre class="verbatim">  (define-simple-class Foo ()
    (:init (perform-some-action)))
</pre>
</li></ul>

<span id="Kawa-1_002e7_002e90-_00282003_0029"></span><h4 class="subheading">Kawa 1.7.90 (2003)</h4>
<span id="g_t_0023kawa_002d1_002e7_002e90_002d2003"></span><p>Various fixes and better error messages in number parsing. Some
optimizations for the divide function.
</p>
<p>New framework for controlling compiler warnings and other features,
supporting command-line flags, and the Scheme forms
<code>with-compile-options</code> and <code>module-compile-options</code>. The flag
<code>--warn-undefined-variable</code> is useful for catching typos.
Implementation funded by <a href="http://www.mercedsystems.com/">Merced
Systems</a>.
</p>
<p>New <code>invoke-special</code> syntax form (implemented by Chris Dean).
</p>
<p>New <code>define-variable</code> form (similar to Common Lisp&rsquo;s
<code>defvar</code>).
</p>
<span id="Kawa-1_002e7-_0028June-7_002c-2003_0029"></span><h4 class="subheading">Kawa 1.7 (June 7, 2003)</h4>
<span id="g_t_0023kawa_002d1_002e7_002djune_002d7_002d2003"></span><p><a href="api/gnu/kawa/servlet/KawaPageServlet.html"><code>KawaPageServlet</code></a>
allows automatic loading and on-the-fly compilation in a servlet engine.
See
<a href="../qexo/simple-xquery-webapp.html">http://www.gnu.org/software/qexo/simple-xquery-webapp.html</a>.
</p>
<p>The default source-base requires various Java 2 features, such as
collection. However, <code>make-select1</code> will comment out Java2
dependencies, allowing you to build Kawa with an older Java
implementation.
</p>
<p>The <code>-f</code> flag and the load function can take an absolute URL. New
Scheme functions <code>load-relative</code> and <code>base-uri</code>.
</p>
<p>Imported implementation of cut and cute from
<a href="http://srfi.schemers.org/srfi-26/srfi-26.html">SRFI-26</a> (Notation
for Specializing Parameters without Currying).
</p>
<p>The way top-level definitions (including Scheme procedures) are mapped
into Java fields is changed to use a mostly reversible mapping. (The
mapping to method names remains more natural but non-reversible.)
</p>
<p><code>define-alias</code> of types can now be exported from a module.
</p>
<p>New <code>--no-inline</code> and <code>--inline=none</code> options.
</p>
<p>You can use <code>define-namespace</code> to define &ldquo;namespace aliases&rdquo;.
This is used for the new short-hard syntax for method invocation:<br>
<code>(define-namespace Int32 &quot;class:java.lang.Integer&quot;)</code><br>
<code>(Int32:toHexString 255)</code> =&gt; <code>&quot;ff&quot;</code><br>
<code>(Int32:toString (Int32:new &quot;00255&quot;))</code> =&gt; <code>&quot;255&quot;</code><br>
Alternatively, you can write:<br>
<code>(java.lang.Integer:toHexString 255)</code> =&gt; <code>&quot;ff&quot;</code>
</p>
<p><a href="http://srfi.schemers.org/srfi-9/srfi-9.html">SRFI-9</a>
(define-record-type) has been implemented, and compiled to a
<code>define-class</code>, with efficient code.
</p>
<p>The configure option <code>--with-collections</code> is now the default.
</p>
<p>Unknowns are no longer automatically static.
</p>
<p>If type not specified in a declaration, don&rsquo;t infer it from it initial
value. If no return type is specified for a function, default to
<code>Object</code>, rather than the return type of the body. (The latter
leads to undesirable different behaviour if definitions are
re-arranged.)
</p>
<p>You can now define and use classes defined using <code>object</code>,
<code>define-class</code>, and <code>define-simple-class</code> from the
&ldquo;interpreter&rdquo;, as well as the compiler. Also, a bug where inherited
fields did not get initialized has been fixed.
</p>
<p>There are several new procedures useful for servlets.
</p>
<p>Numerical comparisions (<code>&lt;</code>, <code>&lt;=</code>, etc) now generates
optimized bytecode if the types of the operands have certain known
types. including efficient code for <code>&lt;int&gt;</code>, <code>&lt;long&gt;</code>,
<code>&lt;double&gt;</code>, and <code>&lt;integer&gt;</code>. Much more code can now (with type
declaration) be written just as efficiently in Scheme as in Java.
</p>
<p>There have been some internal re-arranging of how Expressions are
processed. The Scheme-specific Translator type now inherits from
Compilation, which replaces the old Parser class. A Complation is now
allocated much earlier, as part of parsing, and includes a
SourceMessages object. SourcesMessages now includes (default) line
number, which is used by Compilation for the &quot;current&quot; line numbers. The
ExpWalker class includes a SourceMessages instance (which it gets from
the Compilation). CanInline.inline method now takes ExpWalker parameter.
Checking of the number or parameters, and mapping known procedures to
Java methods are now both done during the inlining pass.
</p>
<p>The user-visible effect is that Kawa can now emit error mesages more
cleanly more places; the inlining pass can be more agressive, and can
emit better error messages, which yields better type information. This
gives us better code with fewer warnings about unknown methods.
</p>
<span id="Changes-from-Kawa-1_002e6_002e98-to-1_002e6_002e99_002e"></span><h4 class="subheading">Changes from Kawa 1.6.98 to 1.6.99.</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e98_002dto_002d1_002e6_002e99_002e"></span><p>A new language front-end handles a tiny subset of XSLT. An example is
the check-format-users test in gnu/xquery/testsuite/Makefile.
</p>
<p>There are now converters between SAX2 and Consumer events, and a basic
implementation of XMLReader based on XMLParser.
</p>
<p>The function as-xml prints a value in XML format.
</p>
<p>Srfi-0 (cond-expand), srfi-8 (receive), and srfi-25 (multi-dimensional
arrays) are now implemented. So is srfi-1 (list library), though that
requires doing (require &rsquo;list-lib).
</p>
<p>The JEmacs code is being re-organized, splitting out the Swing-dependent
code into a separate gnu.jemacs.swing package. This should make it
easier to add JEmacs implementation without Swing.
</p>
<p>The class gnu.expr.Interpreter has various new &rsquo;eval&rsquo; methods that are
useful for evaluating Scheme/BRL/XQuery/... expressions from Java.
</p>
<p>Kawa now uses current versions of autoconf, autoamke, and libtool,
allowing the use of automake file inclusion.
</p>
<p>The comparisons <code>&lt;&lt;</code>, <code>&lt;=</code>, <code>-</code>, <code>&gt;</code>, and <code>=&gt;</code>
now compile to optimized Java arithmetic if both operands are
<code>&lt;int&gt;</code> or a literal that fits in <code>&lt;int&gt;</code>.
</p>
<span id="Changes-from-Kawa-1_002e6_002e97-to-1_002e6_002e98"></span><h4 class="subheading">Changes from Kawa 1.6.97 to 1.6.98</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e97_002dto_002d1_002e6_002e98"></span><p>Generated HTML and Postscrpt documents are no longer included in the
source distribution. Get <code>kawa-doc-version.tar.gz</code> instead.
</p>
<p>(format #t ...) and (format PORT ...) now returns #!void instead of #t.
</p>
<p>Support fluid bindings (fluid-let) for any thread, not just Future and
main.
</p>
<p>A Unix script header <code>#!/PROGRAM</code> is ignored.
</p>
<p>You can now take the same Kawa &quot;web&quot; program (written in Scheme,
KRL/BRL, or XQuery) and run it as either a servlet or a CGI script.
</p>
<p>There are a number of new functions for accessing HTTP requests and
generating HTTP responses.
</p>
<p>Kawa now supports a new experimental programming KRL (the &quot;Kawa Report
Language&quot;). You select this language using &ndash;krl on the Kawa command
link. It allows Scheme code to be inside template files, like HTML
pages, using a syntax based on BRL (brl.sourceforge.net). However, KRL
has soem experimental changes to both BRL and standard Scheme. There is
also a BRL-compatibile mode, selected using &ndash;brl, though that currently
only supports a subset of BRL functions.
</p>
<p>If language is not explicitly specified and you&rsquo;re running a source file
(e.g. &quot;java kawa.repl myscript.xql&quot;), Kawa tried to derive the language
from the the filename extension (e.g. &quot;xql&quot;). It still defaults to
Scheme if there is no extension or the extension is unrecognized.
</p>
<p>New command-line option &ndash;output-format alias &ndash;format can be used to
over-ride the format used to write out top-level (repl, load) values.
</p>
<p>XMLPrinter can now print in (non-well-formed-XML) HTML.
</p>
<span id="Changes-from-Kawa-1_002e6_002e96-to-1_002e6_002e97"></span><h4 class="subheading">Changes from Kawa 1.6.96 to 1.6.97</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e96_002dto_002d1_002e6_002e97"></span><p>Changed lots of error messages to use pairs of single quotes rather than
starting with a backquote (accent grave): &rsquo;name&rsquo; instead of &lsquo;name&rsquo;. Many
newer fonts make the latter look bad, so it is now discouraged.
</p>
<p>The types <code>&lt;String&gt;</code> and <code>&lt;java.lang.String&gt;</code> new behave
differently. The type <code>&lt;java.lang.String&gt;</code> now works just like
(say) <code>&lt;java.util.Hashtable&gt;</code>. Converting an object to a
<code>&lt;java.lang.String&gt;</code> is done by a simple coercion, so the incoming
value must be a java.lang.String reference or null. The special type
<code>&lt;String&gt;</code> converts any object to a java.string.String by calling
toString; it also handles null by specially testing for it.
</p>
<p>For convenience (and backwards compatibility) Kawa uses the type
<code>&lt;String&gt;</code> (rather than <code>&lt;java.lang.String&gt;</code>) when it sees the
Java type <code>java.lang</code>.String, for example in the argument to an
<code>invoke</code>.
</p>
<p>The default behaviour of &rsquo;[&rsquo; and &rsquo;] was changed back to be token (word)
constituents, matching R5RS and Common Lisp. However, you can easily
change this behaviour using the new setBrackMode method or the
defaultBracketMode static field in ReadTable.
</p>
<p>You can now build Kawa from source using the Ant build system (from
Apache&rsquo;s Jakarta project), as an alternative to using the traditional
configure+make system. An advantage of Ant is that it works on most Java
systems, without requiring a Unix shell and commands. Specifically, this
makes it easy to build Kawa under MS-Windows. Thanks to James White for
contributing this support.
</p>
<p>Added (current-error-port) which does the obvious.
</p>
<p>The new let-values and let-values* macros from srfi-11 provide a more
convenient way to use multiple values.
</p>
<p>All the abstract apply* and eval* methods now specify &rsquo;throws
Throwable&rsquo;. A bunch of code was changed to match. The main visible
advantage is that the throw and primitive-throw procedures work for any
Throwable without requiring it to be (confusingly) wrapped.
</p>
<span id="Changes-from-Kawa-1_002e6_002e95-to-1_002e6_002e96"></span><h4 class="subheading">Changes from Kawa 1.6.95 to 1.6.96</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e95_002dto_002d1_002e6_002e96"></span><p>A new compilation flag &ndash;servlet generates a Servlet which can be
deployed in a servlet engin like Tomcat. This is experimental, but it
seesm to work for both Scheme source and XQuery source.
</p>
<p>The interface gnu.lists.CharSequence was renamed to avoid conflitcs with
the (similar) interface java.lang.CharSequence in JDK 1.4beta.
</p>
<p>New &ndash;help option (contributed by Andreas Schlapbach).
</p>
<p>Changed the code generation used when &ndash;full-tailcalls. It now is closer
to that used by default, in that we don&rsquo;t generate a class for each
non-inlined procedure. In both cases calling an unknown procedure
involves executing a switch statement to select a method. In addition to
generating fewer classes and simplifying one of the more fragile parts
of Kawa, it is also a step towards how full continuations will be
implemented.
</p>
<p>Changed the convention for name &quot;mangling&quot; - i.e. how Scheme names are
mapped into Java names. Now, if a Scheme name is a valid Java name it is
used as is; otherwise a reversible mangling using &quot;$&quot; characters is
used. Thus the Scheme names <code>'&lt;</code> and <code>'$Leq</code> are both mapped
into the same Java name <code>&quot;$Leq&quot;</code>. However, other names not
containing &quot;<code>$</code>&quot; should no longer clash, including pairs like
&quot;<code>char-letter?</code>&quot; and &quot;<code>charLetter?</code>&quot; and &quot;<code>isCharLetter</code>&quot;
which used to be all mapped to &quot;<code>isCharLetter</code>&quot;. Now only names
containing &quot;<code>$</code>&quot; can be ambiguous.
</p>
<p>If the compiler can determine that all the operands of (+ ...) or (-
...) are floating-point, then it will generate optimized code using Java
primitive arithmetic.
</p>
<p>Guile-style keyword syntax &rsquo;#:KEYWORD&rsquo; is recognized. (Note this
conflicts with Common Lisp syntax for uninterned symbols.)
</p>
<p>New syntax forms define-class and define-simple-class allow you to
define classes more easily. define-class supports true multiple
inheritance and first class class values, where each Scheme class is
compiled to a pair of an inteface and a class. define-simple-class
generates more efficient and Java-compatible classes.
</p>
<span id="Changes-from-Kawa-1_002e6_002e94-to-1_002e6_002e95_002e"></span><h4 class="subheading">Changes from Kawa 1.6.94 to 1.6.95.</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e94_002dto_002d1_002e6_002e95_002e"></span><p>A new language &quot;xquery&quot; implements a (so far small subset of) XQuery,
the draft XML Query languaage.
</p>
<p>Various internal (Java API) changes: Changes to gnu.expr.Interpreter to
make it easier to add non-Lisp-like languages; gnu.lists.Consumer now
has an endAttribute method that need to be called after each attribute,
rather than endAttributes that was called after all of them.
</p>
<p>If configured with &ndash;with-gcj, Kawa builds and intalls a &rsquo;gckawa&rsquo; script
to simlify linking with needed libraries.
</p>
<p>The <code>setter</code> function is now inlined, and
<code>(set! (field X 'N) V)</code> and <code>(set! (static-field &lt;T&gt; &quot;N) V)</code>
are now inlined.
</p>
<p>If configured <code>--with-gcj</code>, then a <code>gckawa</code> helper script is
installed, to make it easier to link Kawa+gcj-compiled applications.
</p>
<span id="Changes-from-Kawa-1_002e6_002e92-to-1_002e6_002e94"></span><h4 class="subheading">Changes from Kawa 1.6.92 to 1.6.94</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e92_002dto_002d1_002e6_002e94"></span><p>The JEmacs code now depends on CommonLisp, rather than vice versa, which
means Commonlisp no longer depends on Swing, and can be built with GCJ.
CommonLisp and JEmacs symbols are now implemented using Binding, not
String.
</p>
<span id="Changes-from-Kawa-1_002e6_002e90-to-1_002e6_002e92"></span><h4 class="subheading">Changes from Kawa 1.6.90 to 1.6.92</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e90_002dto_002d1_002e6_002e92"></span><p>Kawa now installs as a .jar file (kawa.jar symlinked to
kawa-VERSION.jar), rather than a collection of .class files.
</p>
<p>The Kawa manual includes instructions for how to build Kawa using GCJ,
and how to compile Scheme code to a native executable using GCJ.
</p>
<p>Kawa now has builtin pretty-printer support, using an algorithm from
Steel Bank Common Lisp converted from Lisp to Java. The high-level
Common Lisp pretty-printing features are mostly not yet implemented, but
the low-level support is there. The standard output and error ports
default to pretty-printing.
</p>
<p>A new formatting framework uses the Consumer interface from gnu.lists.
You can associate a format with an output port. Common Lisp and JEmacs
finally print using their respective syntaxes.
</p>
<p>All output ports (OutPort instances) are now automatically flushed on
program exit, using a new WriterManager helper class.
</p>
<p>The new commmand-line option &ndash;debug-print-expr causes the Expression
for each expression to be printed. The option &ndash;debug-print-final-expr
is similar, but prints Expressions after optimization and just before
compilation. They are printed using the new pretty-printer.
</p>
<p>Changed calling convention for &ndash;full-tailcalls to write results to a
Consumer, usually a TreeList or something to be printed. A top-level
ModuleBody now uses the same CpsProcedure convention. This is useful for
generating xml or html.
</p>
<p>New libtool support allows kawa to be built as a shared library.
</p>
<p>The new configure flag &ndash;with-gcj uses gcj to compile Kawa to both
.class files and native code. This is experimental.
</p>
<span id="Changes-from-Kawa-1_002e6_002e70-to-1_002e6_002e90"></span><h4 class="subheading">Changes from Kawa 1.6.70 to 1.6.90</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e70_002dto_002d1_002e6_002e90"></span><p>The reader (for Scheme and Lisp) has been re-written to be table-driven,
based on the design of Common Lisp readtables.
</p>
<p>The new gnu.lists package has new implementations of sequence-related
classes. It replaces most of gnu.kawa.util. See the package.html file.
</p>
<p>If the expected type of a non-unary <code>+</code> or <code>-</code> is <code>&lt;int&gt;</code>
or <code>&lt;long&gt;</code> and the operands are integeral types, then the operands
will converted to the primitive integer type and the addition or
subtraction done using primitive arithmetic. Similarly if the expected
type is <code>&lt;float&gt;</code> or <code>&lt;long&gt;</code> and the operands have
appropriate type. This optimization an make a big performance
difference. (We still need to also optimize compare operations like
<code>(&lt; x y)</code> to really benefit from <code>&lt;int&gt;</code> declarations of loop
variables.)
</p>
<p>The implementation of procedure closures has been changed to basically
be the same as top-level procedures (except when &ndash;full-tailcalls is
specified): Each procedure is now an instance of a ModuleMethod, which
each &quot;frame&quot; is an instance of ModuleBody, just like for top-level
functions. This sometimes reduces the number of classes generated, but
more importantly it simplifies the implementation.
</p>
<p>A new <a href="api/gnu/xml/package-summary.html"><code>gnu.xml</code></a> package
contains XML-related code, currently an XML parser and printer, plus
some XPath support. The class
<a href="api/gnu/lists/TreeList.html"><code>gnu.lists.TreeList</code></a> (alias
<code>&lt;document&gt;</code>) is useful for compactly representing nested
structures, including XML documents. If you <code>(require 'xml)</code> you
will get Scheme interfaces (<code>print-as-xml</code> and
<code>parse-xml-from-url</code>) to these classes.
</p>
<p>New package gnu.kawa.functions, for primitive functions (written in
Java).
</p>
<p>The map and for-each procedure is now inlined. This is most especially
beneficial when it allows the mapped-over procedure to also be inlined,
such as when that procedure is a lambda expression.
</p>
<p>Added documentation on compiling with Jikes. Renamed some classes to
avoid warning when compiling with Jikes.
</p>
<p>The reverse! procedure was added.
</p>
<p>Internal changes: * If a variable reference is unknown, create a
Declaration instance with the IS_UNKNOWN flag to represent an imported
binding. * The ExpWalker framework for &quot;tree walking&quot; Expressions had a
bit of reorganization. * New package gnu.kawa.functions, for primitive
functions (written in Java).
</p>
<p>Added a hook for constant-folding and other optimization/inlining at
traversal (ExpWalker) time. Optimization of + and - procedures to use
primitive Java operations when the operands are primitive types.
</p>
<p>Implementation of SRFI-17. Change the definitions of (set! (f x ...)
val) to ((setter f) x ... val), rather then the old ((setter f) val x
...). You can now associate a setter with a procedure, either using
make-procedure or set-procedure-property!. Also, (setter f) is now
inlined, when possible.
</p>
<p>Internally, Syntax (and hence Macro) no longer extend Declaration.
</p>
<p>Various Java-level changes, which may be reflected in Scheme later: *
gnu.kawa.util.Consumer interface is similar to ObjectOutput and SAX&rsquo;s
ContentHandler interfaces. * A gnu.expr.ConsumerTarget is used when
evaluating to an implicit Consumer. * These interfaces will make it easy
to write functional-style but efficient code for transforming data
streams, including XML. * gnu.kawa.util.FString is now variable-size.
</p>
<span id="Changes-from-Kawa-1_002e6_002e68-to-1_002e6_002e70"></span><h4 class="subheading">Changes from Kawa 1.6.68 to 1.6.70</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e68_002dto_002d1_002e6_002e70"></span><p>The bare beginnings of Common Lisp support, enabled by the &ndash;commonlisp
(or &ndash;clisp) command line option. This is so far little more than a hack
of the EmacsLisp support, but with lexical scoping and CL-style format.
</p>
<span id="Changes-from-Kawa-1_002e6_002e66-to-1_002e6_002e68"></span><h4 class="subheading">Changes from Kawa 1.6.66 to 1.6.68</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e66_002dto_002d1_002e6_002e68"></span><p>JEmacs news:
</p>
<ul>
<li> Define emacs-version as Kawa version but with leading 0 instead of 1.
For example, the current value is &quot;0.6.68 JEmacs&quot;.
</li><li> New testsuite directory.
</li><li> Improved autoload framework. Handle ELisp autoload comments.
</li><li> Handle escape and meta-key.
</li><li> Handle lot more of ELisp.
</li><li> Lots more is now done in ELisp, using .el files imported from XEmacs.
</li><li> Incomplete support for setting mark, including using selection.
</li><li> Basic (but incomplete) implementation of (interactive spec).
</li><li> Common Lisp extensions: typep, default arguments.
</li><li> A new status.html file to note what works and what doesn&rsquo;t.
</li></ul>

<p>You can now specify in <code>define</code> and <code>define-private</code> the type
of a variable. If the variable is module-level,
<code>(define name :: &lt;type&gt; value)</code> creates a field named
&ldquo;<code>name</code>&rdquo; having the specified type and initial value. (If type is
not specified, the default is not <code>Object</code>, but rather a
<code>Binding</code> that <em>contains</em> the variable&rsquo;s value.)
</p>
<p>You can now define the type of a module-level variable: In
(define[-private] :: type expression) New (define-constant name [::
type] expression) definition form.
</p>
<p>A procedure can now have arbitrary properties associated with it. Use
procedure-property and set-procedure-property! to get and set them.
</p>
<p>The new procedure make-procedure creates a generic procedure that may
contain one or more methods, as well as specified properties.
</p>
<p>New declaration form define-base-unit. Both it and define-unit have been
re-implemented to be module-safe. Basically &rsquo;(define-unit ft 12in)&rsquo; is
sugar for &rsquo;(define-constant ft$unit (... (* 12 in$unit)))&rsquo;, where
ft$unit and in$unit are standard identifiers managed by the module
system. Also, the output syntax for units and quantities is cleaner.
</p>
<p>The new declaration (module-export name ...) allows control over the
names exported from a module. The new declaration (module-static ...)
allows control over which definitions are static and which are
non-static. This makes it easier to use a module as a Java class.
</p>
<p>Procedures names that accidentally clash with inherited method names
(such as &quot;run&quot;) are now re-named.
</p>
<p>Simple aliases (define-aliases defining an alias for a variable name)
are implemented more efficiently.
</p>
<p>The package hierarchy is getter cleaner, with fewer cyclic dependencies:
The gnu.math package no longer has any dependencies on kawa.* or gnu.*.
Two classes were moved from gnu.text to other classes, avoiding another
cyclic package dependency between gnu.text and gnu.mapping. The new
gnu.kawa.lispexpr is for compile-time handling of Lisp-like languages.
</p>
<p>Compliation of literals has been re-done. A class that can be used in a
literal no longer needs to be declared as Compilable. Instead, you
declare it as implementaing java.io.Externalizable, and make sure it has
appropriate methods.
</p>
<p>All the standard &quot;data&quot; types (i.e. not procedures or ports) now
implement java.io.Externalizable, and can thus be serialized. If they
appear in literals, they can also be compiled.
</p>
<p>Created a new class gnu.kawa.util.AbstractString, with the Scheme alias
<code>&lt;abstract-string&gt;</code>. The old gnu.kawa.util.FString now extends
AbstractString. A new class CharBuffer provides an growable buffer, with
markers (automatically-adjusted positions). Many of the Scheme
<code>&lt;string&gt;</code> procedures now work on <code>&lt;abstract-string&gt;</code>. The
JEmacs BufferContnat class (contains the characters of a buffer) now
extends CharBuffer.
</p>
<p>Some JEmacs changes to support a &quot;mode&quot; concept, as well as preliminary
support for inferior-process and telnet modes.
</p>
<p>New section in manual / web page for projects using Kawa.
</p>
<p>The record feasture (make-record-type etc) how handles &quot;funny&quot; type and
fields names that need to be &quot;mangled&quot; to Java names.
</p>
<p>Re-did implementation of define-alias. For example, you can define
type-aliases:<br>
<code>(define-alias &lt;marker&gt; &lt;gnu.jemacs.buffer.Marker&gt;)</code><br>
and then use &lt;marker&gt; instead of &lt;gnu.jemacs.buffer.Marker&gt;.
</p>
<p><code>(field array 'length)</code> now works.
</p>
<span id="Changes-from-Kawa-1_002e6_002e64-to-1_002e6_002e66"></span><h4 class="subheading">Changes from Kawa 1.6.64 to 1.6.66</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e64_002dto_002d1_002e6_002e66"></span><p>Added documentation to the manual for Homogeneous numeric vector
datatypes (SRFI-4).
</p>
<p>You can now specify characters using their Unicode value: #\u05d0 is
alef.
</p>
<p>Kawa now uses a more mnemonic name mangling Scheme. For example, a
Scheme function named <code>&lt;=</code> would get compiled to method
<code>$Ls$Eq</code>.
</p>
<p>There is now working and useful module support, thought not all features
are implemented. The basic idea is that a module can be any class that
has a default constructor (or all of whose fields and methods are
static); the public fields and methods of such a class are its exported
definitions. Compiling a Scheme file produces such a module. Doing:<br>
<code> (require &lt;classname&gt;)</code><br>
will create an anonymous instance of <code>&lt;classname&gt;</code> (if needed), and
add all its exported definitions to the current environment. Note that
if you import a class in a module you are compiling, then an instance of
the module will be created at compile-time, and imported definitions are
not re-imported. (For now you must compile a module, you cannot just
load it.)
</p>
<p>The define-private keyword creates a module-local definition.
</p>
<p>New syntax to override some properties of the current module:<br>
<code>(module-name &lt;name&gt;)</code> overrides the default name for a module.<br>
<code>(module-extends &lt;class&gt;)</code> specifies the super-class.<br>
<code>(module-implements &lt;interface&gt; ...)</code> specfies the implemented
interfaces.
</p>
<p>The syntax: (require &rsquo;keyword) is syntactic sugar for (require
&lt;classname&gt;) where the classname is find is a &quot;module catalog&quot;
(currently hard-wired). This provides compatibility with Slib. The Slib
&quot;features&quot; gen-write, pretty-print, pprint-file, and printf are now
available in Kawa; more will be added, depending on time and demand. See
the package directory gnu/kawa/slib for what is available.
</p>
<span id="Changes-from-Kawa-1_002e6_002e62-to-1_002e6_002e64"></span><h4 class="subheading">Changes from Kawa 1.6.62 to 1.6.64</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e62_002dto_002d1_002e6_002e64"></span><p>A lot of improvements to JEmacs (see JEmacs.SourceForge.net).
</p>
<p>kawa-compiled-VERSION.zip is replaced by kawa-compiled-VERSION.jar.
</p>
<p>You can now use Kawa to generate applets, using the new &ndash;applet switch,
Check the &quot;Applet compilation&quot; section in the manual. Generating an
application using the &ndash;main flag should work again. Neither &ndash;applet
nor &ndash;main has Scheme hard-wired any more.
</p>
<p>A new macro &lsquo;(this)&rsquo; evaluates to the &quot;this object&quot; - the current
instance of the current class. The current implementation is incomplete,
and buggy, but it will have to do for now.
</p>
<p>The command-line argument -f FILENAME will load the same files types as
load.
</p>
<p>When a source file is compiled, the top-level definitions (procedures,
variables, and macros) are compiled to final fields on the resulting
class. This are not automatically entered into the current environment;
instead that is the responsibility of whoever loads the compiled class.
This is a major step towards a module system for Kawa.
</p>
<p>There is a new form define-private which is like define, except that the
defined name is not exported from the current module.
</p>
<p>A procedure that has optional arguments is now typically compiled into
multiple methods. If it&rsquo;s a top-level procedure, these will be methods
in the modules &quot;ModuleBody&quot; class, with the same (mangled) name. The
compiler can in many cases call the appropriate method directly.
Usually, each method takes a fixed number of arguments, which means we
save the overhead of creating an array for the arguments.
</p>
<p>A top-level procedure declared using the form (define (NAME ARS ...)
BODY ..) is assumed to be &quot;constant&quot; if it isn&rsquo;t assigned to in the
current compilation unit. A call in the same compilation unit will now
be implemented as a direct method call. This is not done if the prcedure
is declared with the form: (define NAME (lambda (ARGS ,,,) BODY ...)
</p>
<p>gnu.expr.Declaration no longer inherits from gnu.bytecode.Variable.
</p>
<p>A gnu.mapping.Environment now resolves hash index collisions using
&quot;double hashing&quot; and &quot;open addressing&quot; instead of &quot;chaining&quot; through
Binding. This allows a Binding to appear in multiple Environments.
</p>
<p>The classes Sequence, Pair, PairWithPosition, FString, and Char were
moved from kawa.lang to the new package gnu.kawa.util. It seems that
these classes (except perhaps Char) belong together. The classes List
and Vector were also moved, and at the same time renamed to LList and
FVector, respectively, to avoid clashed with classes in java.util.
</p>
<p>New data types and procedures for &quot;uniform vectors&quot; of primitive types
were implemented. These follow the SRFI-4 specification, which you can
find at http://srfi.schemers.org/srfi-4/srfi-4.html .
</p>
<p>You can now use the syntax <code>name :: type</code> to specify the type of a
parameter. For example:<br>
<code>(define (vector-length x :: &lt;vector&gt;) (invoke x 'length))</code><br>
The following also works:<br>
<code>(define (vector-length (x :: &lt;vector&gt;)) ...)</code>.
</p>
<p><code>(define-member-alias name object [fname])</code> is new syntactic sugar
for <code>(define-alias name (field object fname))</code>, where the default
for <code>fname</code> is the mangling of <code>name</code>.
</p>
<span id="Changes-from-Kawa-1_002e6_002e60-to-1_002e6_002e62"></span><h4 class="subheading">Changes from Kawa 1.6.60 to 1.6.62</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e60_002dto_002d1_002e6_002e62"></span><p>The new function &lsquo;invoke&rsquo; allows you to call a Java method. All of
&lsquo;invoke&rsquo;, &lsquo;invoke-static&rsquo; and &lsquo;make&rsquo; now select the bets method. They
are also inlined at compile time in many cases. Specifically, if there
is a method known to be definitely applicable, based on compile-time
types of the argument expressions, the compiler will choose the most
specific such method.
</p>
<p>The functions slot-ref, slot-set!, field, and static-field are now
inlined by the compiler when it can.
</p>
<p>Added open-input-string, open-output-string, get-output-string from
SRFI-6. See http://srfi.schemers.org/srfi-6/srfi-6.html.
</p>
<p>The manual has a new section &quot;Mapping Scheme names to Java names&quot;, and a
new chapter &quot;Types&quot;. The chapters &quot;Extensions&quot;, &quot;Objects and Classes&quot;,
and &quot;Low-level functions&quot; have been extensivley re-organized.
</p>
<p>The Kawa license has been simplified. There used to be two licenses: One
for the packages gnu.*, and one for the packages kawa.*. There latter
has been replaced by the former. The &quot;License&quot; section of the manual was
also improved.
</p>
<span id="Changes-from-Kawa-1_002e6_002e59-to-1_002e6_002e60"></span><h4 class="subheading">Changes from Kawa 1.6.59 to 1.6.60</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e59_002dto_002d1_002e6_002e60"></span><p>There is a new package gnu.kawa.reflect. Some classes that used to be in
kawa.lang or kawa.standard are now there.
</p>
<p>The procedures slot-ref and slot-set! are now available. They are
equivalent to the existing &lsquo;field&rsquo;, but reading a field &lsquo;x&rsquo; will look
for &lsquo;getX&rsquo; method if there is no public &lsquo;x&rsquo; field; writing to a field
will look for &lsquo;setX&rsquo;.
</p>
<p>The procedure &lsquo;make&rsquo; makes it convenient to create new objects.
</p>
<p>There is now a teaser screen snapshot of &quot;JEmacs&quot; at
http://www.bothner.com/~per/papers/jemacs.png.
</p>
<p>The html version of the manual now has a primitive index. The manual has
been slightly re-organized, with a new &quot;Classes and Objects&quot; chapter.
</p>
<p>The new functions invoke-static and class-methods allow you to call an
arbitary Java method. They both take a class specification and a method
name. The result of class-methods is a generic procedure consisting of
those methods whose names match. (Instance methods are also matched;
they are treated the asme as class methods with an extra initial
argument.) The invoke-static function also takes extra arguments, and
actually calls the &quot;best&quot;-matching method. An example:
</p>
<pre class="verbatim">        (invoke-static &lt;java.lang.Thread&gt; 'sleep 100)
</pre>
<p>Many fewer classes are now generated when compiling a Scheme file. It
used to be that each top-level procedure got compiled to its own class;
that is no longer the case. The change should lead to faster startup and
less resource use, but procedure application will probably be noticably
slower (though not so much slower as when reflection is used). The
reason for the slowdown is that we in the general case now do an extra
method call, plus a not-yet-optimized switch statement. This change is
part of the new Kawa module system. That will allow the compiler to
substitute direct methods calls in more cases, which I hope will more
than make up for the slowdown.
</p>
<p>A Scheme procedure is now in general compiled to a Java method whose
name is a &quot;mangling&quot; of the Scheme procedure&rsquo;s name. If the procedure
takes a variable number of parameters, then &quot;$V&quot; is added to the name;
this indicates that the last argument is a Java array containing the
rest of the arguments. Conversely, calling a Java method whose name ends
in &quot;$V&quot; passes any excess arguments in the last argument, which must be
an array type.
</p>
<p>Many changes to the &quot;Emacs-emulation&quot; library in gnu.jemacs.buffer: *
Implemented commands to read and save files. * We ask for file and
buffer names using a dialog pop-up window. * Split windows correctly, so
that the windows that are not split keep their sizes, the windows being
split gets split as specified, and the frame does not change size. Now
also handles horizonal splits. * Fairly good support for buffer-local
keymaps and Emacs-style keymap search order. A new class BufferKeymap
manages the active keymaps of a buffer. Multi-key key-sequences are
handled. Pending prefix keys are remembered on a per-buffer basis
(whereas Emacs does it globally).
</p>
<p>There is now some low-level support for generic procedures.
</p>
<p>The R5RS primitives let-syntax and letrec-syntax for defining local
syntax extensions (macros) should now work. Also define-syntax works as
an internal definition. All of these should now be properly &quot;hygienic&quot;.
(There is one known exception: symbols listed among the literals lists
are matched as raw symbols, rather that checking that the symbol has the
same binding, if any, as at the defining site.) The plan is to support
general functions as hygienic rewriters, as in the Chez Scheme
&quot;syntax-case&quot; system; as one part of that plan, the syntax-case
primitive is available, but so far without any of the supporting
machinary to support hygiene.
</p>
<p>The read-line procedure was added. This allows you to efficiently read a
line from an input port. The interface is the same as scsh and Guile.
</p>
<span id="Changes-from-Kawa-1_002e6_002e58-to-1_002e6_002e59"></span><h4 class="subheading">Changes from Kawa 1.6.58 to 1.6.59</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e58_002dto_002d1_002e6_002e59"></span><p>define-alias now works both top-level and inside a function.
</p>
<p>Optimized eqv? so if one of the arguments is constant and not Char or
Numeric, inline it the same way eq? is. (This helps case when the labels
are symbols, which help the &quot;lattice&quot; benchmark.) ???
</p>
<p>The Emacs-related packages are now grouped under a new gnu.jemacs
package.
</p>
<p>Improved framework for catching errors. This means improved error
messages when passing a parameter of the wrong type. Many standard
procedures have been improved.
</p>
<p>Simplified, documented, and tested (!) procedure for building Kawa from
source under Windows (95/98/NT).
</p>
<p>New macros trace and untrace for tracing procedures. After executing
(trace PROCEDURE), debugging output will be written (to the standard
error port) every time PROCEDURE is called, with the parameters and
return value. Use (untrace PROCEDURE) to turn tracing off.
</p>
<p>New utility functions (system-tmpdir) and (make-temporary-file
[format]).
</p>
<p>A new (unfinished) framework supports multiple languages. The
command-line option &ndash;elisp selects Emacs Lisp, while &ndash;scheme (the
default) selects Scheme. (The only difference so far is the reader
syntax; that will change.)
</p>
<p>The &lsquo;format&rsquo; function now provides fairly complete functionality for
CommonLisp-style formatting. (See the Comon Lisp hyperspec at
http://www.harlequin.com/education/books/HyperSpec/Body/sec_22-3.html.)
The floating point formatters (~F, ~E, ~G, ~$) now pass the formatst.scm
test (from Slib, but with some &quot;fixes&quot;; in the testsuite directory).
Also, output ports now track column numbers, so <code>~T</code> and <code>~&amp;</code>
also work correctly.
</p>
<p>A new package gnu.emacs provides various building blocks for building an
Emacs-like text editor. These classes are only compiled when Kawa is
configured with the new &ndash;with-swing configuration option. This is a
large initial step towards &quot;JEmacs&quot; - an Emacs re-implemented to use
Kawa, Java, and Swing, but with full support (using gnu.elisp) for
traditional Emacs Lisp. For more imformation see
gnu/emacs/overview.html.
</p>
<p>A new configuration option &ndash;with-swing can be used if Swing is
available. It is currently only used in gnu.emacs, but that may change.
</p>
<span id="Changes-from-Kawa-1_002e6_002e56-to-1_002e6_002e58"></span><h4 class="subheading">Changes from Kawa 1.6.56 to 1.6.58</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e56_002dto_002d1_002e6_002e58"></span><p>Kawa is now &quot;properly tail-recursive&quot; if you invoke it with the
&ndash;full-tail-calls flag. (Exception: the eval procedure does not perform
proper tail calls, in violation of R5RS. This will be fixed in a future
release.) Code compiled when &ndash;full-tail-calls is in effect is also
properly tail-recursive. Procedures compiled with &ndash;full-tail-calls can
call procedures compiled without it, and vice versa (but of course
without doing proper tail calls). The default is still
&ndash;no-full-tail-calls, partly because of performance concerns, partly
because that provides better compatibility with Java conventions and
tools.
</p>
<p>The keywords let (including named let), let*, and letrec support type
specifiers for the declared variables For example:
</p>
<pre class="verbatim">    (let ((lst :: &lt;list&gt; (foo x))) (reverse lst))
</pre>
<p>Square brackets [ ... ] are allowed as a synonym of parentheses ( ... ).
</p>
<span id="Changes-from-Kawa-1_002e6_002e55-to-1_002e6_002e57"></span><h4 class="subheading">Changes from Kawa 1.6.55 to 1.6.57</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e55_002dto_002d1_002e6_002e57"></span><p>A new command-line flag &ndash;server PORT specifies that Kawa should run as
a telnet server on the specified PORT, creating a new read-eval-print
loop for each connection. This allows you to connect using any telnet
client program to a remote &quot;Kawa server&quot;.
</p>
<p>A new front-end program, written in C, that provides editing of input
lines, using the GNU readline library. This is a friendlier interface
than the plain &quot;java kawa.repl&quot;. However, because kawa.c needs readline
and suitable networking library support, it is not built by default, but
only when you configure Kawa with the &ndash;enable-kawa-frontend flag.
</p>
<p>The way Scheme names are mapped (&quot;mangled&quot;) into Java identifiers is now
more natural. E.g. &quot;foo-bar?&quot; now is mapped to &quot;isFooBar&quot;.
</p>
<p>New syntax (object (SUPERS ...) FIELD-AND-METHODS ...) for creating a
new object instance of an anonymous class. Now fairly powerful.
</p>
<p>New procedures field and static-field for more convenient field access.
</p>
<p>Syntactic sugar: <code>(lambda args &lt;type&gt; body)</code> -&gt;
<code>(lambda args (as &lt;type&gt; body))</code>. This is especially useful for
declaring methods in classes.
</p>
<p>A new synchonized form allows you to synchronize on an arbitrary Java
object, and execute some forms while having an exclusive lock on the
object. (The syntax matches that used by Skij.)
</p>
<span id="Changes-from-Kawa-1_002e6_002e53-to-1_002e6_002e55"></span><h4 class="subheading">Changes from Kawa 1.6.53 to 1.6.55</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e53_002dto_002d1_002e6_002e55"></span><p>New &ndash;debug-dump-zip option writes out a .zip file for compilation.
(Useful for debugging Kawa.)
</p>
<p>You can now declare parameter types.
</p>
<p>Lot of work on more efficient procedure representation and calling
convention: Inlining, directly callable statics method, plus some
procedures no longer generate a separate Class.
</p>
<p>Local functions that are only called from one locations, except for
tail-recursion, are now inlined. This inlines do loops, and most &quot;named
let&quot; loops.
</p>
<p>New representation of closures (closures with captured local variables).
We no longer use an array for the closure. Instead we store the captured
variables in the Procedure itself. This should be faster (since we can
use field accesses rather than array indexing, which requires bounds
checking), and avoids a separate environment object.
</p>
<p>If the compiler sees a function call whose (non-lexically-bound) name
matches an existing (globally-defined) procedure, and that procedure
instance has a static method named either &quot;apply&quot; or the mangled
procedure name, them the compiler emits a direct call to that method.
This can make a very noticable speed difference, though it may violate
strict Scheme sementics, and some code may break.
</p>
<p>Partial support for first-class &quot;location&quot; variables.
</p>
<span id="Changes-from-Kawa-1_002e6_002e53-to-1_002e6_002e54"></span><h4 class="subheading">Changes from Kawa 1.6.53 to 1.6.54</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e53_002dto_002d1_002e6_002e54"></span><p>Created new packages gnu.mapping and gnu.expr. Many classes were moved
from kawa.lang to the new packages. (This is part of the long-term
process of splitting Kawa into more manageable chunks, separating the
Scheme-specific code from the language-independent code, and moving
classes under the gnu hierarchy.)
</p>
<p>You can now write keywords with the colon first (e.g. :KEYWORD), which
has exactly the same effect and meaning as putting the colon last (e.g.
KEYWORD:). The latter is preferred is being more consistent with normal
English use of punctuation, but the former is allowed for compatibility
with soem other Scheme implementations and Common Lisp.
</p>
<span id="Changes-from-Kawa-1_002e6_002e52-to-1_002e6_002e53"></span><h4 class="subheading">Changes from Kawa 1.6.52 to 1.6.53</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e6_002e52_002dto_002d1_002e6_002e53"></span><p>The new package gnu.text contains facilities for reading, formatting,
and manipulating text. Some classes in kawa.lang where moved to there.
</p>
<p>Added string-upcase!, string-downcase!, string-capitalize!,
string-upcase, string-downcase, and string-capitalize; compatible with
Slib.
</p>
<p>Character constants can now use octal notation (as in Guile). Writing a
character uses octal format when that seems best.
</p>
<p>A format function, similar to that in Common Lisp (and Slib) has been
added.
</p>
<p>The default parameter of a #!optional or #!key parameter can now be
#!null.
</p>
<span id="Changes-since-Kawa-1_002e6_002e51"></span><h4 class="subheading">Changes since Kawa 1.6.51</h4>
<span id="g_t_0023changes_002dsince_002dkawa_002d1_002e6_002e51"></span><p>The &quot;record&quot; feature has been changed to that a &quot;record-type descriptor&quot;
is now a gnu.bytecode.ClassType (a <code>&lt;record-type&gt;</code>), rather than a
java.lang.Class. Thus make-record-type now returns a
<code>&lt;record-typee&gt;</code>, not a Class, and <code>record-type-descriptor</code>
takes a <code>&lt;record-typee&gt;</code>, not a Class.
</p>
<p>More robust Eval interfaces.
</p>
<p>New Lexer abstract class. New ScmRead class (which extends Lexer) now
contains the Scheme reader (moved from Inport). Now read errors are kept
in queue, and can be recovered from.
</p>
<p>Comparing an exact rational and an inexact real (double) is now done as
if by first converting the double to exact, to satisfy R5RS.
</p>
<span id="Changes-since-Kawa-1_002e6_002e1"></span><h4 class="subheading">Changes since Kawa 1.6.1</h4>
<span id="g_t_0023changes_002dsince_002dkawa_002d1_002e6_002e1"></span><p>The compile virtual method in Expression now takes a Target object,
representing the &quot;destination&quot;. The special ConditionalTarget is used to
evaluate the test of an &rsquo;if expression. This allows us to generate much
better code for and, or, eq?, not and nested if inside an if.
</p>
<p>Added port-line, port-column, and set-port-line! to match Guile.
</p>
<p>The Makefiles have been written so all out-of-date .java (or .scm).
files in a directory are compiled using a single invocation of javac (or
kawa). Building Kawa should now be much faster. (But note that this
depends on unreleased recent autoamke changes.)
</p>
<p>How the Kawa version number is compiled into Kawa was changed to make it
easier for people who want to build from source on non-Unix-like
systems.
</p>
<p>A new gnu.ecmascript package contains an extremely incomplete
implementation of ECMSScript, the ECMA standardized version of
JavaScript. It includes an ECMAScript lexer (basically complete), parser
(the framework is there but most of the language is missing), incomplete
expression evaluation, and a read-eval-print-loop (for testing only).
</p>
<span id="Changes-in-Kawa-1_002e6_002e1"></span><h4 class="subheading">Changes in Kawa 1.6.1</h4>
<span id="g_t_0023changes_002din_002dkawa_002d1_002e6_002e1"></span><p>Improved Kawa home page with extra links, pointer to Java-generated api
docs, and homepages for gnu.math and gnu.bytecode.
</p>
<p>Implemented system, make-process, and some related procedures.
</p>
<p>Added macros for primitive access to object fields, static fields, and
Java arrays. Added constant-fold syntax, and used it for the other
macros.
</p>
<p>The &ndash;main flag compiles Scheme code to an application (containing a
main method), which can be be invoked directly by a Java interpreter.
</p>
<p>Implemented &ndash;version (following GNU standards) as kawa.repl
command-line flag.
</p>
<span id="Changes-since-Kawa-1_002e5_002e93"></span><h4 class="subheading">Changes since Kawa 1.5.93</h4>
<span id="g_t_0023changes_002dsince_002dkawa_002d1_002e5_002e93"></span><p>Adding make procedure to create new objects/records.
</p>
<p>Extended (set! (f . args) value) to be equivalent to ((setter f) value .
args). Implemented setter, as well as (setter car) and (setter cdr).
</p>
<p>Can now get and set a record field value using an application: (rec
&rsquo;fname) gets the value of the field named fname in record rec. (set!
(rec &rsquo;fname) value) sets the value of the field named fname in rec.
</p>
<p>A partial re-write of the implementation of input ports and the Scheme
reader, to fix some problems, add some features, and improve
performance.
</p>
<p>Compiled .class files are now installed in $(datadir)/java, rather than
$(prefix)/java. By default, that means they are installed in
/usr/local/shared/java, rather than /usr/local/java.
</p>
<p>There is now internal infrastructure to support inlining of procedures,
and general procedure-specific optimized code generation.
</p>
<p>There is better testing that the right number of arguments are passed to
a procedure, and better error messages when you don&rsquo;t. If the procedure
is inlined, you get a compile-time error message.
</p>
<p>The functions created by primitive-constructor,
primitive-virtual-method, primitive-static-method, and
primitive-interface-method are now first-class procedure values. They
use the Java reflection facily, except when the compiler can directly
inline them (in which case it generates the same efficient bytecodes as
before).
</p>
<p>New functions instance? (tests type membership) and as (converts).
</p>
<p>The kawa.html is now split into several files, one per chapter. The
table of contents is now kawa_toc.html.
</p>
<p>The syntactic form try-catch provides low-level exception handler
support. It is basically the same as Java&rsquo;s try/catch form, but in
Scheme syntax. The new procedure primitive-throw throws an exception
object.
</p>
<p>The higher-level catch and throw procedures implement exception handling
where the handler is specified with a &quot;key&quot; (a symbol). These functions
were taken from Guile.
</p>
<p>The error function has been generalized to take multiple arguments (as
in Guile). It is now a wrapper around (throw &rsquo;misc-error ...).
</p>
<p>There is a new &quot;friendly&quot; GUI access to the Kawa command-line. If you
invoke kawa.repl with the -w flag, a new interaction window is created.
This is uses the AWT TextArea class. You can create multiple &quot;consoles&quot;.
They can either share top-level enevironments, or have separate
environments. This window interface has some nice features, including
editing. Added a scheme-window procedure, which is another way to create
a window.
</p>
<span id="Changes-since-Kawa-1_002e5"></span><h4 class="subheading">Changes since Kawa 1.5</h4>
<span id="g_t_0023changes_002dsince_002dkawa_002d1_002e5"></span><p>The default prompt now shows continuations lines differently.
</p>
<p>The copy-file function was added.
</p>
<p>The variable port-char-encoding controls how external files are
converted to/from internal Unicode characters. It also controls whether
CR and CR-LF are converted to LF.
</p>
<p>The reader by default no longer down-cases letters in symbols. A new
variable symbol-read-case control how case is handled: &rsquo;P (the default)
preserves case; &rsquo;U upper-cases letters; &rsquo;D or -&quot; down-cases letters; and
&rsquo;I inverts case.
</p>
<p>The gnu.bytecode package now supports exception handlers. The new
syntactic form try-finally supports a cleanup hook that is run after
some other code finishes (normally or abnormally). Try-finally is used
to implement dynamic-wind and fluid-let.
</p>
<p>The environment handling has been improved to support thread-specific
environments, a thread-safe fluid-let, and multiple top-levels. (The
latter still needs a bit of work.)
</p>
<p>The gnu.bytecode package has been extensively changed. There are new
classes representing the various standard Attributes, and data
associated with an attribute is now stored there.
</p>
<p>Added new procedures environment-bound? and
scheme-implementation-version.
</p>
<p>Scheme symbols are represented as java.lang.String objects. Interned
symbols are interned Strings; uninterned symbols are uninterned Strings.
Note that Java strings literals are automatically interned in JDK 1.1.
This change makes symbols slightly more efficient, and moves Kawa closer
to Java.
</p>
<p>Ports now use the JDK 1.1 character-based Reader and Writer classes,
rather than the byte-oriented InputStream and OutputStream classes. This
supports different reading and writing different character encodings [in
theory - there is no support yet for other than Ascii or binary files].
</p>
<p>An interactive input port now has a prompt function associated with it.
It is settable with set-input-port-prompter!. The prompt function takes
one argument (the input port), and returns a prompt string. There are
also user functions for inquiring about the current line and column
number of an input port.
</p>
<p>The R4RS procedures transcript-on and transcript-off are implemented.
</p>
<p>Standard types can be referred to using syntax similar to RScheme. For
example Scheme strings now have the type <code>&lt;string&gt;</code> which is
preferred to &quot;<code>kawa.lang.FString</code>&quot; (which in addition to being
longer, is also more suspectible to changes in internal implementation).
Though these types are first-class values, this is so far mainly useful
for invoking primitive methods.
</p>
<span id="Changes-from-Kawa-1_002e4-to-1_002e5"></span><h4 class="subheading">Changes from Kawa 1.4 to 1.5</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e4_002dto_002d1_002e5"></span><p>Execute a ~/.kawarc.scm file on startup, if it exists.
</p>
<p>Add a number of functions for testing, renaming, and deleting files.
These are meant to be compatible with scsh, Guile, and MIT Scheme:
file-exists?, file-directory?, file-readable?, file-writable?,
delete-file, rename-file, create-diretory, and the variable
home-directory.
</p>
<p>Fixed some small bugs, mainly in gnu.math and in load.
</p>
<p>Generalize apply to accept an arbitrary Sequence, or a primitive Java
array.
</p>
<span id="Changes-from-Kawa-1_002e2-to-1_002e4"></span><h4 class="subheading">Changes from Kawa 1.2 to 1.4</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e2_002dto_002d1_002e4"></span><p>The codegen package has been renamed gnu.bytecode. The kawa.math package
has been moved to gnu.math. Both packages have new license: No
restrictions if you use an unmodified release, but GNU General Public
License. Let me know if that causes problems. The rest of Kawa still has
the old license.
</p>
<p>Implement defmacro and gentemp.
</p>
<p>Implement make-record-type and related functions to create and use new
record types. A record type is implemented as a java.lang.Class object,
and this feature depends on the new reflection features of JDK 1.1.
</p>
<p>Implement keywords, and extend lambda parameter lists to support
#!optional #!rest and #!keyword parameters (following DSSSL).
</p>
<p>Added more primitives to call arbitrary interface and constructor
methods.
</p>
<span id="Changes-from-Kawa-1_002e0-to-1_002e2"></span><h4 class="subheading">Changes from Kawa 1.0 to 1.2</h4>
<span id="g_t_0023changes_002dfrom_002dkawa_002d1_002e0_002dto_002d1_002e2"></span><p>Added primitives to make it easy to call arbitrary Java methods from
Scheme.
</p>
<p>Exact rational arithetic is now fully implemented. All integer functions
now believed to correctly handle bignums. Logical operations on exact
integers have been implemented. These include all the logical functions
from Guile.
</p>
<p>Complex numbers are implemented (except {,a}{sin,cos,tan}).
Quantities (with units) are implemented (as in DSSSL).
</p>
<p>Eval is available, as specified for R5RS. Also implemented are
scheme-report-environment, null-environment, and
interaction-environment.
</p>
<p>Internal define is implemented.
</p>
<p>Rough support for multiple threads is implemented.
</p>
<p>Moved kawa class to kawa/repl. Merged in kawac (compiler) functionality.
A &rsquo;kawa&rsquo; shell-script is now created. This is now the preferred
interface to both the interactive evaluator and the compiler (on
Unix-like systems).
</p>
<p>Now builds &quot;without a snag&quot; using Cafe 1.51 under Win95. (Symantec JIT
(ver 2.00b19) requires disabling JIT - <code>JAVA_COMPCMD=disable</code>.)
Compiles under JDK 1.1 beta (with some warnings).
</p>
<p>A testsuite (and testing framework) was added.
</p>
<p>Documentation moved to doc directory. There is now an internals
overview, in doc/kawa-tour.ps.
</p>
<span id="Changes-since-0_002e4"></span><h4 class="subheading">Changes since 0.4</h4>
<span id="g_t_0023changes_002dsince_002d0_002e4"></span><p>The numeric classes have been re-written. There is partial support for
bignums (infinite-precision integers), but divide (for example) has not
been implemented yet. The representation of bignums uses 2&rsquo;s complement,
where the &quot;big digits&quot; are laid out so as to be compatible with the mpn
functions of the GNU Multi-Precision library (gmp). (The intent is that
a future version of Kawa will support an option to use gmp native
functions for speed.)
</p>
<p>The kawa application takes a number of useful command-line switches.
</p>
<p>Basically all of R4RS has been implemented. All the essential forms and
functions are implemented. Almost all of the optional forms are
implemented. The exceptions are transcript-on, transcript-off, and the
functions for complex numbers, and fractions (exact non-integer
rationals).
</p>
<p>Loading a source file with load now wraps the entire file in a lambda
(named &quot;atFileLevel&quot;). This is for better error reporting, and
consistency with compile-file.
</p>
<span id="Changes-since-0_002e3"></span><h4 class="subheading">Changes since 0.3</h4>
<span id="g_t_0023changes_002dsince_002d0_002e3"></span><p>The hygienic macros described in the appendix to R4RS are now impemented
(but only the define-syntax form). They are used to implement the
standard &quot;do&quot; form.
</p>
<p>The R5RS multiple value functions <code>values</code> and
<code>call-with-values</code> are implemented.
</p>
<p>Macros (and primitive syntax) can now be autoloaded as well as
procedures.
</p>
<p>New kawac application compiles to one or more .class files.
</p>
<p>Compile time errors include line numbers. Uncaught exceptions cause a
stack trace that includes .scm line numbers. This makes it more
practical to debug Kawa with a Java debugger.
</p>
<p>Quasiquotation is implemented.
</p>
<p>Various minor bug fixes and optimizations.
</p>
<span id="Changes-since-0_002e2"></span><h4 class="subheading">Changes since 0.2</h4>
<span id="g_t_0023changes_002dsince_002d0_002e2"></span><p>The biggest single change is that Scheme procedures are now compiled to
Java bytecodes. This is mainly for efficiency, but it also allows us to
do tail-recursion-elimination in some cases.
</p>
<p>The &quot;codegen&quot; library is included. This is a toolkit that handles most
of the details needed to generate Java bytecode (.class) files.
</p>
<p>The internal structure of Kawa has been extensively re-written,
especially how syntax transforms, eval, and apply are done, largely due
to the needs for compilation.
</p>
<p>Almost all the R4RS procedures are now implemented, except that there
are still large gaps in Section 6.5 &quot;Numbers&quot;.
</p>
<hr>
</div>
<div class="chapter" id="Features">
<div class="header">
<p>
Next: <a href="#Community" accesskey="n" rel="next">The Kawa Community</a>, Previous: <a href="#News" accesskey="p" rel="prev">News - Recent Changes</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Features-1"></span><h2 class="chapter">2 Features</h2>

<p>Runs on the Java platform, with no native code needed.
</p>
<p>Extends the <a href="http://en.wikipedia.org/wiki/Scheme_%28programming_language%29">Scheme language</a>, following the <a href="http://r7rs.org/">R7RS</a> specification from 2013.
Scheme has many implementations, and is much used in research and teaching.
</p>
<p>Programs <a href="http://per.bothner.com/blog/2010/Kawa-in-shootout/">run fast</a>
- roughly as fast as Java programs,
and much faster than other &ldquo;scripting languages&rdquo;.
This is due to a sophisticated compiler,
compile-time transformations, type inference, and optional type declarations.
</p>
<p>Full, convenient, and efficient access to the huge set of Java libraries
means you can access objects, methods, fields, and classes without run-time overhead.
</p>
<p>Start-up times are fast.  You don&rsquo;t have to wait for a lot of
initialization.  Even if you start with source code, the parser
and compiler are fast.
</p>
<p><a href="#Scripts">Running Command Scripts</a> are simple Kawa source files
that can run as an application or command.  These are simple to write,
start, and run efficiently, since they&rsquo;re automatically
compiled before execution.
</p>
<p>Alternatively, you can embed Kawa as a <a href="#Evaluating-Scheme-expressions-from-Java">scripting language for Java applications</a>.
</p>
<p>Deployment is easy and flexible.  You just need the Kawa jar file.
</p>
<p><a href="#Macros">Macros</a> and <a href="#Named-quasi_002dliterals">custom named literals</a> make it easy
to extend the syntax and implement Domain-Specific Languages.
</p>
<p>Kawa provides the usual <a href="#REPL-Console">read-eval-print loop</a>, as well as batch modes.
</p>
<p>Kawa has builtin <a href="#Pretty_002dprinting">pretty-printer</a> support, and fancy formatting.
</p>
<p>Kawa supports class-definition facilities, and separately-compiled modules.
</p>
<p>You can <a href="#Allocating-objects">allocate and initialize objects</a>
with a compact &ldquo;builder&rdquo; syntax.  It works out-of-the-box
(with no run-time overhead) on many classes and APIs,
but can be customized if need be.
</p>
<p>A library for functional <a href="#Composable-pictures">composable pictures</a>
lets you create &ldquo;picture&rdquo; objects,
display them, transform them, combine them, convert to
SVG or images, and more.
This can be &ldquo;printed&rdquo; directly in the Kawa console
(either the DomTerm console or the Swing one).
</p>
<p><a href="#Building-JavaFX-applications">JavaFX programming</a> is simpler.
</p>
<p>You can <a href="#Building-for-Android">run Kawa programs on Android</a>,
and there is special handling to make <a href="#Android-view-construction">constructing View objects</a> easier.
</p>
<p>Flexible shell-like functionality, including <a href="#process-literals">process literals</a>.
</p>
<p><a href="#Server_002dside-scripts">Web page scripts</a> are easy to write and install
with <a href="#Self_002dconfiguring-page-scripts">self-configuring web servers</a>,
optionally using <a href="#Servlets">servlets</a> and <a href="#XML-literals">XML literals</a>.
</p>
<p><a href="#Arrays">Multi-dimensional Arrays</a> and sequences have a lot of flexibility:
Arrays can be multi-dimensional;
you can use an array as an index (which generalizes slices and permutations);
you can define a lazy array using a function that maps indexes to values;
you can re-map the indexes to yield a transformed array.
</p>
<p>Many useful features for mathematics and numerics:
</p><ul>
<li> The full &ldquo;numeric tower&rdquo; includes infinite-precision
rational numbers and complex numbers.
</li><li> Compile-time optimization of arithmetic
with the use of type declarations and inference.
</li><li> A <a href="#Quantities"><em>quantity</em></a> is a real number with a unit,
such as <code>3cm</code>.
</li><li> <a href="#Quaternions">Quaternions</a> are a 4-dimensional generalization of complex numbers.
Unsigned primitive integer types (<code>ubyte</code>, <code>ushort</code>,
<code>uint</code>, <code>ulong</code>) are implemented efficiently without
object allocation.
</li></ul>

<p>A <a href="#Lazy-evaluation">lazy value</a> wraps an expression which is evaluated
only when it is needed.
</p>
<p>Kawa provides a <a href="#Framework">framework</a> for implementing other programming languages,
and comes with incomplete support for CommonLisp, Emacs Lisp, and
EcmaScript, and
<a href="http://www.gnu.org/software/qexo/">XQuery</a>.
</p>

<ul class="section-toc">
<li><a href="#Implemented-SRFIs" accesskey="1">Implemented SRFIs</a></li>
<li><a href="#Compatibility" accesskey="2">Compatibility with standards</a></li>
</ul>
<hr>
<div class="section" id="Implemented-SRFIs">
<div class="header">
<p>
Next: <a href="#Compatibility" accesskey="n" rel="next">Compatibility with standards</a>, Up: <a href="#Features" accesskey="u" rel="up">Features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Implemented-SRFIs-1"></span><h3 class="section">2.1 Implemented SRFIs</h3>

<p>Kawa implements the following semi-standard SRFIs
(<a href="http://srfi.schemers.org/">Scheme Request for Implementation</a>):
</p><ul>
<li> <a href="http://srfi.schemers.org/srfi-0/srfi-0.html">SRFI 0</a>: Feature-based conditional expansion construct,
using <code>cond-expand</code> - see <a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI 1</a>: List Library, if <code>(require 'list-lib)</code> - see <a href="#SRFI_002d1">SRFI-1</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-2/srfi-2.html">SRFI 2</a>: AND-LET*: an AND with local bindings, a guarded LET* special form.
</li><li> <a href="http://srfi.schemers.org/srfi-4/srfi-4.html">SRFI 4</a>: Homogeneous numeric vector datatypes - see <a href="#Uniform-vectors">Uniform vectors</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-6/srfi-6.html">SRFI 6</a>: Basic String Ports - see <a href="#Ports">Ports</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-8/srfi-8.html">SRFI 8</a>: <code>receive</code>: Binding to multiple values - see <a href="#Multiple-values">Multiple values</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-9/srfi-9.html">SRFI 9</a>: Defining Record Types, using <code>define-record-type</code>
- see <a href="#Record-types">Record types</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-10/srfi-10.html">SRFI 10</a>: <code>#,</code> external form for special named types.
This is deprecated for various reasons, including that it conflicts
with syntax-case <code>unsyntax</code>.
Better to use srfi-108 <a href="#Named-quasi_002dliterals">Named quasi-literals</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-11/srfi-11.html">SRFI 11</a>: Syntax for receiving multiple values,
using <code>let-values</code> and <code>let*-value</code> - see <a href="#Multiple-values">Multiple values</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-13/srfi-13.html">SRFI 13</a>: String Library.
Needs some polishing.
</li><li> <a href="http://srfi.schemers.org/srfi-14/srfi-14.html">SRFI 14</a>: Character-set Library - see <a href="#Character-sets">Character sets</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-16/srfi-16.html">SRFI 16</a>: Syntax for procedures of variable arity,
using <a href="http://srfi.schemers.org/srfi-16/srfi-16.html"><code>case-lambda</code></a>.
</li><li> <a href="http://srfi.schemers.org/srfi-17/srfi-17.html">SRFI 17</a>: Generalized <code>set!</code> - see <a href="#Locations">Locations</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-23/srfi-23.html">SRFI 23</a>: Error reporting mechanism, using <code>error</code> - see <a href="#Exceptions">Exception handling</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-25/srfi-25.html">SRFI 25</a>: Multi-dimensional Array Primitives - see <a href="#Arrays">Multi-dimensional Arrays</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-26/srfi-26.html">SRFI 26</a>: Notation for Specializing Parameters without Currying - see <a href="#Procedures">Procedures</a>. 
</li><li> <a href="http://srfi.schemers.org/srfi-28/srfi-28.html">SRFI 28</a>: Basic Format Strings - see <a href="#Format">Formatted Output (Common-Lisp-style)</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-30/srfi-30.html">SRFI 30</a>: Nested Multi-line Comments.
</li><li> <a href="http://srfi.schemers.org/srfi-35/srfi-35.html">SRFI 35</a>: Conditions.
</li><li> <a href="http://srfi.schemers.org/srfi-37/srfi-37.html">SRFI 37</a>: <a href="http://srfi.schemers.org/srfi-37/srfi-37.html"><code>args-fold</code> - a program argument processor</a>, if <code>(require 'args-fold)</code>.
</li><li> <a href="http://srfi.schemers.org/srfi-38/srfi-38.html">SRFI 38</a>: External Representation for Data With Shared Structure.
The <code>read-with-shared-structure</code> is missing, but subsumed by <code>read</code>.
</li><li> <a href="http://srfi.schemers.org/srfi-39/srfi-39.html">SRFI 39</a>:
See <a href="#Parameter-objects">Parameter objects</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI 41</a>: Streams - see <a href="#Streams">Streams - lazy lists</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-45/srfi-45.html">SRFI 45</a>: Primitives for Expressing Iterative Lazy Algorithms - see <a href="#Lazy-evaluation">Lazy evaluation</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-60/srfi-60.html">SRFI 60</a>: Integers as Bits. - see <a href="#Logical-Number-Operations">Logical Number Operations</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-62/srfi-62.html">SRFI 62</a>: S-expression comments.
</li><li> <a href="http://srfi.schemers.org/srfi-64/srfi-64.html">SRFI 64</a>: A Scheme API for test suites.
</li><li> <a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI 69</a>: Basic hash tables - see <a href="#Hash-tables">Hash tables</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-87/srfi-87.html">SRFI 87</a>: <code>=&gt;</code> in <code>case</code> clauses.
</li><li> <a href="http://srfi.schemers.org/srfi-88/srfi-88.html">SRFI 88</a>: Keyword objects - see <a href="#Keywords">Keywords</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-95/srfi-95.html">SRFI 95</a>: Sorting and Merging.
</li><li> <a href="http://srfi.schemers.org/srfi-97/srfi-97.html">SRFI 97</a>: Names for SRFI Libraries.
</li><li> <a href="http://srfi.schemers.org/srfi-98/srfi-98.html">SRFI 98</a>: An interface to access environment variables
</li><li> <a href="http://srfi.schemers.org/srfi-101/srfi-101.html">SRFI 101</a>: Purely Functional Random-Access Pairs and Lists - see <a href="#SRFI_002d101">SRFI-101</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-107/">SRFI 107</a>: XML reader syntax - see <a href="#XML-literals">XML literals</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-108/">SRFI 108</a>: Named quasi-literal constructors - see <a href="#Named-quasi_002dliterals">Named quasi-literals</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-109/srfi-109.html">SRFI-109</a>: Extended string quasi-literals - see <a href="#string-quasi_002dliterals">string quasi-literals</a>.
</li><li> <a href="http://srfi.schemers.org/srfi-118/srfi-118.html">SRFI-118</a>: Simple adjustable-size strings (<code>string-append!</code> and <code>string-replace!</code>).
</li></ul>

<hr>
</div>
<div class="section" id="Compatibility">
<div class="header">
<p>
Previous: <a href="#Implemented-SRFIs" accesskey="p" rel="prev">Implemented SRFIs</a>, Up: <a href="#Features" accesskey="u" rel="up">Features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compatibility-with-standards"></span><h3 class="section">2.2 Compatibility with standards</h3>

<p>Kawa implements all the required and optional features of R7RS,
with the following exceptions.
</p>
<p>The entire &ldquo;numeric tower&quot; is implemented.
However, some transcendental functions only work on reals.
Integral functions do not necessarily work on
inexact (floating-point) integers.
(The whole idea of &ldquo;inexact integer&quot; in R5RS seems rather pointless ...)
</p>
<p>Also, <code>call-with-current-continuation</code> is only &ldquo;upwards&quot; (?).
I.e. once a continuation has been exited, it cannot be invoked.
These restricted continuations can be used to implement catch/throw
(such as the examples in R4RS), but not co-routines or backtracking.
</p>
<p>Kawa now does general tail-call elimination, but only if
you use the flag <code>--full-tail-calls</code>.  (Currently, the
<code>eval</code> function itself is not fully tail-recursive, in violation
of R5RS.)   The <code>--full-tail-calls</code> flag is not on by default,
partly because it is noticably slower (though I have not measured how
much), and partly I think it is more useful for Kawa to be compatible
with standard Java calling conventions and tools.
Code compiled with <code>--full-tail-calls</code> can call code
 compiled without it and vice versa.
</p>
<p>Even without <code>--full-tail-calls</code>, if the
compiler can prove that the procedure being called is the current
function, then the tail call will be replaced by a jump.
This includes must &ldquo;obvious&rdquo; cases of calls to the
current function named using <code>define</code> or <code>letrec</code>,
and many cases of mutual tail-recursion (including
state-machines using <code>letrec</code>).
</p>
<p>By default, symbols are case sensitive.
</p>
<p>Kawa implements most of the features of the expression language of DSSSL,
the Scheme-derived ISO-standard Document Style Semantics and Specification
Language for SGML.  Of the core expression language, the only features
missing are character properties, <code>external-procedure</code>,
the time-relationed procedures, and character name escapes in
string literals.
From the full expression language, Kawa additionally is missing
<code>format-number</code>, <code>format-number-list</code>, and language objects.
Quantities, keyword values, and the expanded <code>lambda</code> form
(with optional and keyword parameters) are supported.
</p>
<hr>
</div>
</div>
<div class="chapter" id="Community">
<div class="header">
<p>
Next: <a href="#Installation" accesskey="n" rel="next">Getting and installing Kawa</a>, Previous: <a href="#Features" accesskey="p" rel="prev">Features</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="The-Kawa-Community"></span><h2 class="chapter">3 The Kawa Community</h2>


<ul class="section-toc">
<li><a href="#Reporting-bugs" accesskey="1">Reporting bugs</a></li>
<li><a href="#Mailing-lists" accesskey="2">General Kawa email and discussion</a></li>
<li><a href="#Acknowledgements" accesskey="3">Acknowledgements and thanks</a></li>
<li><a href="#Support" accesskey="4">Technical Support for Kawa</a></li>
<li><a href="#Projects" accesskey="5">Projects using Kawa</a></li>
<li><a href="#Ideas-and-tasks" accesskey="6">Ideas and tasks for contributing to Kawa</a></li>
</ul>
<hr>
<div class="section" id="Reporting-bugs">
<div class="header">
<p>
Next: <a href="#Mailing-lists" accesskey="n" rel="next">General Kawa email and discussion</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Reporting-bugs-1"></span><h3 class="section">3.1 Reporting bugs</h3>

<p>To report a bug or a feature request
use the <a href="https://gitlab.com/kashell/Kawa/issues">Issue Tracker</a>.
This does require a <a href="https://gitlab.com/">GitLab</a> account;
if this is a problem you can use the Savannah bug tracker.
</p>
<span id="Older-Savannah-bug-tracker"></span><h4 class="subsubheading">Older Savannah bug tracker</h4>

<p>The older bug tracker for Kawa on Savannah is still available,
but we request you use
the <a href="https://gitlab.com/kashell/Kawa/issues">GitLab Issue Tracker</a>
for new issues.
</p>
<p>To report a bug or feature request for Kawa (including Qexo or JEmacs) through Savannah,
use the
<a href="http://savannah.gnu.org/bugs/?func=additem&amp;group=kawa">bug-submission page</a>.
You can browse and comment on existing bug reports
using the <a href="http://savannah.gnu.org/bugs/?group=kawa">Kawa Bugzilla page</a>.
</p>
<p>When a bug report is created or modified, mail is automatically sent to the
<a href="mailto:bug-kawa@gnu.org">bug-kawa@gnu.org</a> list.  You can subscribe, unsubscribe, or browse
the archives through the
<a href="http://mail.gnu.org/mailman/listinfo/bug-kawa"><code>bug-kawa</code> web interface</a>.
</p>
<hr>
</div>
<div class="section" id="Mailing-lists">
<div class="header">
<p>
Next: <a href="#Acknowledgements" accesskey="n" rel="next">Acknowledgements and thanks</a>, Previous: <a href="#Reporting-bugs" accesskey="p" rel="prev">Reporting bugs</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="General-Kawa-email-and-discussion"></span><h3 class="section">3.2 General Kawa email and discussion</h3>

<p>The general Kawa email list is <a href="mailto:kawa@sourceware.org">kawa@sourceware.org</a>.
This mailing list is used for announcements, questions, patches,
and general discussion relating to Kawa.  If you wish to subscribe,
send a blank message request to <a href="mailto:kawa-subscribe@sourceware.org">kawa-subscribe@sourceware.org</a>.
To unsubscribe, send a blank message to
<a href="mailto:kawa-unsubscribe@sourceware.org">kawa-unsubscribe@sourceware.org</a>.
(If your mail is forwarded and you&rsquo;re not sure which email address you&rsquo;re
subscribed as, send mail to the address following <code>mailto:</code> in the
<code>List-Unsubscribe</code> line in the headers of the messages you get from
the list.)
</p>
<p>You can browse the <a href="http://sourceware.org/ml/kawa/">archive of past messages</a>.
</p>
<p>There are separate mailing lists for
<a href="http://mail.gnu.org/mailman/listinfo/qexo-general">Qexo</a>
and <a href="http://lists.sourceforge.net/mailman/listinfo/jemacs-info">JEmacs</a>.
</p>
<hr>
</div>
<div class="section" id="Acknowledgements">
<div class="header">
<p>
Next: <a href="#Support" accesskey="n" rel="next">Technical Support for Kawa</a>, Previous: <a href="#Mailing-lists" accesskey="p" rel="prev">General Kawa email and discussion</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Acknowledgements-and-thanks"></span><h3 class="section">3.3 Acknowledgements and thanks</h3>

<p>The author and project leader of Kawa is
<a href="http://per.bothner.com/">Per Bothner</a>
<a href="mailto:per@bothner.com">per@bothner.com</a>.
</p>
<p>Kawa is a re-write of Kawa 0.2, which was a Scheme interpreter written by
R. Alexander Milowski <a href="mailto:alex@milowski.com">alex@milowski.com</a>.
</p>
<p>Thanks to Cygnus Solutions (now part of Red Hat) for sponsoring
the initial development of Kawa, and then transferring
their ownership interest to Per.
</p>
<span id="Financial-support"></span><h4 class="subsubheading">Financial support</h4>

<p>Ean Schuessler and <a href="http://www.brainfood.com/">Brainfood</a>
provided financial support and encouragement.
</p>
<p>Thanks to Chris Dean, Dean Ferreyra, and others
at <a href="http://www.mercedsystems.com/">Merced Systems</a> for financial
support and other contributions.
</p>
<p><a href="http://google.com/">Google</a> through their
<a href="http://code.google.com/soc/">Summer of Code</a> project
sponsored Charles Turner during Summer 2011 and 2012,
and sponsored Andrea Bernardini Summer 2014.
</p>
<p>Thomas Kirk and AT&amp;T provided financial support, and useful bug reports.
</p>
<span id="Various-contributions"></span><h4 class="subsubheading">Various contributions</h4>

<p><a href="http://jcubic.pl/">Jakub Jankiewicz</a> contributed the Kawa logo.
</p>
<p>Helmut Eller provided SLIME support, syntaxutils.scm, and many bug reports.
</p>
<p>Daniel Bonniot for multiple small improvements
to gnu.bytecode and gnu.expr.
</p>
<p>Jamison Hope for multiple contributions,
including quaternion support, the SRFI-14 implementation,
Ant improvements, and Google Summer of Code mentoring.
</p>
<p>Jim White for Ant support and other improvements.
</p>
<p>Bruce R. Lewis implemented <a href="#KRL">KRL</a> and made other contributions.
</p>
<p>Geoff Berry: Handle Exceptions attribute.  Other improvements.
</p>
<p>Shad Gregory improved JEmacs.
</p>
<p>Al Petrofsky improved gnu.math printing and added some IntNum methods.
</p>
<p>Marco Vezzoli:  SRFI-1 tailoring for Kawa.
</p>
<p>Albert Ting - old GuiConsole code.
</p>
<p>Christian Surlykke ported JEmacs to use SWT.
</p>
<p>Geoff Berry for various gnu.bytecode improvements.
</p>
<p>Ivelin Ivanov and Tom Reilly for servlet support.
</p>
<p>Anthony Green for Fedora packaging.
</p>
<p>Charles Turner for pretty-printer improvements,
improvements in the Common Lips support, and other changes.
</p>
<p>Andrea Bernardini optimized the implementation of <code>case</code>.
</p>
<p>Julien Rousseau and Marius Kjeldahl contributed to Android support.
</p>
<p>Peter Lane for many documentation improvements.
</p>
<span id="Small-fixes-and-improvements"></span><h4 class="subsubheading">Small fixes and improvements</h4>

<p>Patrick Barta;
Joseph Bowbeer;
Dominique Boucher;
Alexander Bunkenburg;
Harold Carr;
Emmanuel Castro;
Álvaro Castro-Castilla;
Heather Downs;
Francisco Vides Fernández;
Nic Ferrier;
Oliver Flasch;
Weiqi Gao;
Luke Gorrie;
Mario Domenech Goulart;
Zvi Har&rsquo;E;
Jeff Haynes;
Ethan Herdrick;
Joerg-Cyril Hoehle;
Elliott Hughes;
Mike Kenne;
Brian Jones;
Gerardo Jorvilleur;
Simon Josefsson (JEmacs menu);
Thomas Kirk;
Jay Krell;
Edouard Parmelan;
Walter C. Pelissero;
Rafael Jesus Alcantara Perez;
Lynn Quam;
Marcus Otto;
Terje Pedersen (some XQuery functions);
Matthias Radestock;
Ola Rinta-Koski;
Andreas Schlapbach;
Robert D. Skeels;
Benny Tsai;
Vladimir Tsichevski;
Matthieu Vachon;
Phil Walker;
Knut Wannheden;
Chris Wegrzyn.
</p>
<span id="Bug-reports-and-test-cases"></span><h4 class="subsubheading">Bug reports and test cases</h4>

<p>Seth Alves;
Khairul Azhar;
Bob Bane;
Hans Boehm;
Adrián Medraño Calvo;
Brian D. Carlstrom;
Luis Casillas;
Sudarshan S Chawathe;
Ken Dickey (format tests);
Helge Dietert;
Allan Erskine;
Marc Feeley (polytype.scm);
Margus Freudenthal;
Weiqi Gao;
Andrea Girotto;
Norman Hard;
Gerardo Horvilleur;
Yaroslav Kavenchuk;
Felix S Klock II;
Francois Leygues;
Mirko Luedde;
Leonardo Valeri Manera;
Kjetil S. Matheussen;
Alex Mitchell;
Alex Moiseenko
Edouard Parmelan;
Walter C. Pelissero;
Stephen L. Peters;
François Pinard;
Bill Robinson;
Dan Stanger (Eaton Vance);
Hallvard Traetteberg;
Taylor Venable;
Alessandro Vernet;
Tony White
John Whittaker;
Robert Yokota.
</p>
<span id="Code-ported-from-other-packages"></span><h4 class="subsubheading">Code ported from other packages</h4>

<p>Kawa includes Free Software originally written for other purposes,
but incorporated into Kawa, perhaps with some porting.  A partial list:
</p>
<p>Dorai Sitaram wrote pregexp.
</p>
<p>The <code>rationalize</code> algorithm is by Alan Bawden and Marc Feeley.
</p>
<p>Lars T Hansen wrote SRFI-11 (let-values, let*-values macros).
</p>
<p>Olin Shivers wrote the SRFI-1 list-processing library,
and the SRFI-13 reference impementation.
</p>
<p>John David Stone wrote SRFI-8 (receive macro)
</p>
<p>Jussi Piitulainen wrote the SRFI-25 specification and tests.
</p>
<p>Richard Kelsey and Michael Sperber wrote SRFI-34.
</p>
<p>Anthony Carrico wrote the SRFI-37 reference implementation.
</p>
<p>Panu Kalliokoski wrote the SRFI-69 reference implementation.
</p>
<p>Donovan Kolbly wrote the srfi-64 &ldquo;meta&rdquo; testsuite.
Alex Shinn improved SRFI-64 portability.
</p>
<p>Philip L. Bewig wrote the SRFI-41 (streams) specification and
reference implementation.
</p>
<p>Simon Tatham wrote listsort.
</p>
<p>Aubrey Jaffer wrote much of SLIB, some of which has been
imported into gnu.kawa.slib. He also wrote some tests we&rsquo;re using.
</p>
<hr>
</div>
<div class="section" id="Support">
<div class="header">
<p>
Next: <a href="#Projects" accesskey="n" rel="next">Projects using Kawa</a>, Previous: <a href="#Acknowledgements" accesskey="p" rel="prev">Acknowledgements and thanks</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Technical-Support-for-Kawa"></span><h3 class="section">3.4 Technical Support for Kawa</h3>

<p>If you have a project that depends on Kawa or one of its component
packages, you might do well to get paid priority support from
Kawa&rsquo;s author.
</p>
<p>The base price is $2400 for one year.  This entitles you to basic
support by email or phone.  Per <a href="mailto:per@bothner.com">per@bothner.com</a> will answer techical
questions about Kawa or its implementation, investigate bug reports, and
suggest work-arounds.  I may (at my discretion) provide fixes and
enhancements (patches) for simple problems.  Response for support
requests received during the day (California time) will normally be
within a few hours.
</p>
<p>All support requests must come through a single designated contact
person.  If Kawa is important to your business, you probably
want at least two contact people, doubling the price.
</p>
<p>If the support contract is cancelled (by either party), remaining
time will be prorated and refunded.
</p>
<p>Per is also available for development projects.
</p>
<hr>
</div>
<div class="section" id="Projects">
<div class="header">
<p>
Next: <a href="#Ideas-and-tasks" accesskey="n" rel="next">Ideas and tasks for contributing to Kawa</a>, Previous: <a href="#Support" accesskey="p" rel="prev">Technical Support for Kawa</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Projects-using-Kawa"></span><h3 class="section">3.5 Projects using Kawa</h3>

<p><a href="http://appinventor.mit.edu/">MIT App Inventor</a>
for Android (formerly Google App Inventor)
uses Kawa to translate its visual blocks language.
</p>
<p>The <a href="http://www.narrativeandplay.org/hypedyn/">HypeDyn</a> hypertext
fiction authoring tool is written in Kawa. HypeDyn (pronounced &quot;hyped
in&quot;) is a procedural hypertext fiction authoring tool for people who
want to create text-based interactive stories that adapt to reader
choice. HypeDyn is free to download and open source, and runs on
Linux, MacOS and Windows. This is a research project carried out at
the Department of Communications and New Media, National University of
Singapore.
</p>
<p><a href="http://www.nuecho.com">Nü Echo</a> develops high-performance speech
enabled applications. Nü Echo uses Kawa for the development of innovative
speech application development tools, like a complete 
<a href="http://www.nuecho.com/en/services/grammar.shtml">grammar IDE</a>.
</p>
<p><a href="http://www.mercedsystems.com/">Merced Systems, Inc.</a> uses Kawa
extensively in their contact center performance management product
Merced Peformance Suite.  Kawa Scheme is used for all development
and has allowed Merced to realize the large productivity gains
that come with using Scheme while still maintaining tight
integration with a large number of Java libraries.
</p>
<p>JEmacs is included in the Kawa distribution.  It is a project to
re-implement Emacs, allowing a mix of Java, Scheme, and Emacs Lisp.
It has its own <a href="http://jemacs.sourceforge.net/">home-page</a>.
</p>
<p>BRL (&ldquo;the Beautiful Report Language&quot;) is a database-oriented language
to embed in HTML and other markup.
<a href="http://brl.sourceforge.net/">BRL</a> allows you to embed Scheme in
an HTML file on a web server.
</p>
<p>The <a href="http://schemeway.sourceforge.net">SchemeWay Project</a> is a set of
<a href="http://www.eclipse.org">Eclipse</a> plug-ins for professional Scheme
programming. The first plugin released, SchemeScript, is a fully-featured
Scheme
editor customizable in Scheme. It embeds the Kawa Scheme system and has
many features that ease Kawa Scheme programming (like code completion on
variable names, 
class and method names, namespaces, etc).
</p>
<p>The Health Media Research Laboratory, part of the Comprehensive Cancer
Center at the University of Michigan, is using Kawa as an integral part of
its core tailoring technologies. Java programs using Kawa libraries are used
to administer customized web-based surveys, generate tailored feedback,
validate data, and &quot;characterize,&quot; or transform, data. Kawa code is embedded
directly in XML-formatted surveys and data dictionaries. Performance and
ease of implementation has far exceeded expectations. For more information
contact Paul R. Potts, Technical Director, Health Media Research Lab,
<code>&lt;potts@umich.edu&gt;</code>.
</p>
<p>Mike Dillon (<code>mdillon@gjt.org</code>)
did the preliminary work of creating a
Kawa plugin for jEdit. It is called SchemeShell and provides a REPL inside
of the jEdit console for executing expressions in Kawa (much as the BeanShell
plugin does with the BeanShell scripting language).
It is currently available only via CVS from:
</p><div class="example">
<pre class="example">CVSROOT=:pserver:anonymous@cvs.jedit.sourceforge.net:/cvsroot/jedit
MODULE=plugins/SchemeShell
</pre></div>

<p>STMicroelectronics (<code>marco.vezzoli@st.com</code>)
uses Kawa in a prototypal
intranet 3tier information retrieval system as a communication protocol
between server and clients, and to do server agents programming.
</p>

<hr>
</div>
<div class="section" id="Ideas-and-tasks">
<div class="header">
<p>
Previous: <a href="#Projects" accesskey="p" rel="prev">Projects using Kawa</a>, Up: <a href="#Community" accesskey="u" rel="up">The Kawa Community</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Ideas-and-tasks-for-contributing-to-Kawa"></span><h3 class="section">3.6 Ideas and tasks for contributing to Kawa</h3>

<p>Kawa (like other Free Software projects) has no lack of tasks and projects
to work on.  Here are some ideas.
</p>
<p>The ones marked <i>(GSoC)</i> are probably most suitable for a Google
Summer of Code project, in being a reasonable size, self-contained, and not
depending on other tasks.
</p>
<ul class="section-toc">
<li><a href="#Run-interactive-process-in-separate-Java-Virtual-Machine_003a" accesskey="1">Run interactive process in separate Java Virtual Machine:</a></li>
<li><a href="#Better-dynamic-reload" accesskey="2">Better dynamic reload</a></li>
<li><a href="#Easier-Access-to-Native-Libraries-using-JNA_002fJNR" accesskey="3">Easier Access to Native Libraries using JNA/JNR</a></li>
<li><a href="#Types-for-units" accesskey="4">Types for units</a></li>
<li><a href="#Compiler-should-use-class_002dfile-reading-instead-of-reflection" accesskey="5">Compiler should use class-file reading instead of reflection</a></li>
<li><a href="#Mutually-dependent-Java-and-Scheme-modules" accesskey="6">Mutually dependent Java and Scheme modules</a></li>
<li><a href="#Use-Java_002d7-MethodHandles-and-invokedynamic" accesskey="7">Use Java-7 MethodHandles and invokedynamic</a></li>
<li><a href="#Parameterized-types" accesskey="8">Parameterized types</a></li>
<li><a href="#Optimized-function-types-and-values-using-MethodHandles" accesskey="9">Optimized function types and values using MethodHandles</a></li>
<li><a href="#Full-continuations">Full continuations</a></li>
<li><a href="#Faster-tailcalls">Faster tailcalls</a></li>
<li><a href="#TreeList_002doptimization">TreeList-optimization</a></li>
<li><a href="#Asynchronous-evaluation">Asynchronous evaluation</a></li>
<li><a href="#REPL-console-and-other-REPL-improvement">REPL console and other REPL improvement</a></li>
<li><a href="#XQuery_002d3_002e0-functionality">XQuery-3.0 functionality</a></li>
<li><a href="#XQuery_002dupdates">XQuery-updates</a></li>
<li><a href="#Common-Lisp-support">Common Lisp support</a></li>
<li><a href="#JEmacs-improvements">JEmacs improvements</a></li>
<li><a href="#Improved-IDE-integration">Improved IDE integration</a></li>
<li><a href="#Hop_002dstyle-web-programming">Hop-style web programming</a></li>
<li><a href="#String-localization">String localization</a></li>
<li><a href="#Data-binding">Data binding</a></li>
<li><a href="#Decimal-arithmetic-and-repeated-decimals">Decimal arithmetic and repeated decimals</a></li>
<li><a href="#Optional-strict-typing-along-with-an-explicit-dynamic-type">Optional strict typing along with an explicit <code>dynamic</code> type</a></li>
</ul>
<div class="subsection" id="Run-interactive-process-in-separate-Java-Virtual-Machine_003a">
<h4 class="subsection">3.6.1 Run interactive process in separate Java Virtual Machine:</h4>
<p><i>(GSoC)</i>
</p>
<p>When developing and testing it is useful for the REPL to support
hot-swapping (replacing functions on-the-fly) and debugging.
The main goal being able to smoothly reload changed modules
(files or functions), and have other modules not break.
Debugging (such as setting breakpoints) would not be a priority
for this project, but could be a follow-on project.
Skills: Should be experienced with Java, and interested in learning
about <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jvmti/index.html">JVM TI</a> and similar low-level parts of the platform.
Difficulty: Challenging, but you can study
how <a href="https://en.wikipedia.org/wiki/Jshell">Java-9&rsquo;s new jshell</a>
uses the JVM TI.
</p>
</div>
<div class="subsection" id="Better-dynamic-reload">
<h4 class="subsection">3.6.2 Better dynamic reload</h4>

<p><i>(GSoC - this is related to the previous item)</i>
</p>
<p>Kawa does a lot of optimizations and inlining.  This conflicts
with being able to &ldquo;reload&rdquo; a module into an already-running
interactive environment.
</p>
<p>We could add an option to load a module in &ldquo;reloadable&rdquo; mode.
Kawa already patches an old function object (a <code>ModuleMethod</code>)
so existing references to the function get automatically updated.
However, there are problems if the &ldquo;signature&rdquo; of the function
changes - for example if the return type (declared or inferred)
becomes more general.  In those cases the best thing is to
re-compile any code that depends on the modified function.
</p>
<p>Reloading a module that defines a class is even trickier,
at least if there are existing instances that should
work as the updated class.  We can handle the special case
where only method bodies change: In reloadable mode, each
method body is compiled to a separate function, the
actual body indirects to the function.  We must also
recognize when compiling a new version of the same
class, which requires a textual comparison between the
old and new versions, or a structural comparison
between the old class and the new code.
</p>
<p>When it comes to top-level variables, an issue is when
to re-evaluate the initializing expression.  It is reasonable
to do so if and only if the expression is modified, which
again requires a textual comparison.
</p>
</div>
<div class="subsection" id="Easier-Access-to-Native-Libraries-using-JNA_002fJNR">
<h4 class="subsection">3.6.3 Easier Access to Native Libraries using JNA/JNR</h4>
<p><i>(GSoC)</i>
</p>
<p>The traditional way to access native (C/C++) functions is using JNI,
but it&rsquo;s very awkward.
JNA and <a href="https://github.com/jnr">JNR</a> are <a href="http://www.oracle.com/technetwork/java/jvmls2013nutter-2013526.pdf">much easier to use</a>.
This project would design and implement an easy-to-use Kawa wrapper for
for JNR.  You should study existing JNR wrappers, such as that for JRuby.
Difficulty: Medium.  Need to study existing wrappers and &quot;foreign
function interfaces&quot; (in multiple languages) and design one suitable for Kawa.
Some Scheme (Kawa) experience would be helpful.  
</p>
</div>
<div class="subsection" id="Types-for-units">
<h4 class="subsection">3.6.4 Types for units</h4>

<p><i>(GSoC)</i>
</p>
<p>Kawa supports units (such as <code>cm^2</code> for square centimeters)
and <a href="#Quantities">quantities</a> (such as <code>4cm^2</code>).
We would like to integrate these into the type system, both
for performance and compile-time type checking.
</p>
<p>For syntax we can use a pseudo-parameterized type <code>quantity</code>.  For example:
</p><div class="example">
<pre class="example">(define a1 ::quantity[cm^2] 4cm^2)
(* 2.0 a1) ;; &rArr; 8cm^2
(+ 2.0 a1) ;; <i>compile-time error</i>
</pre></div>
<p>The run-time type of the variable <code>a1</code> should be
a primitive <code>double</code>, without object allocation.
Of course when <code>a1</code> is converted to an object, we
create a <code>Quantity</code>, not a <code>Double</code>.
We can build on Kawa&rsquo;s existing framework for
non-standard primitive types such as <code>character</code> and <code>ulong</code>.
Skills: Need good Java experience, and somewhat familiar with the
Java Virtual Machine.
You will need to become comfortable reading &lt;code&gt;javap&lt;/code&gt; output.
Difficulty: Modest.
</p>
</div>
<div class="subsection" id="Compiler-should-use-class_002dfile-reading-instead-of-reflection">
<h4 class="subsection">3.6.5 Compiler should use class-file reading instead of reflection</h4>
<p>The Kawa compiler currently uses reflection to determine properties
(such as exported function definitions) from referenced classes.
It would be better to read class files.
This should not be too difficult, since the <code>gnu.bytecode</code> library
abstracts over class information read by reflection or class reading.
</p>
</div>
<div class="subsection" id="Mutually-dependent-Java-and-Scheme-modules">
<h4 class="subsection">3.6.6 Mutually dependent Java and Scheme modules</h4>

<p><i>(GSoC - maybe)</i>
</p>
<p>We&rsquo;d like a command for compiling a list of Java and Scheme
source files that may have mutual dependencies.  A good way
to do this is to hook into <code>javac</code>, which is quite extensible
and pluggable.
</p>
<p>One could do something like:
</p><ol>
<li> Read the &ldquo;header&quot; of each Kawa source file, to determine the
name of the generated main class.
</li><li> Enter these class names into the javac tables as &ldquo;uncompleted&rdquo;
classes.
</li><li> Start compiling the Java files.  When this requires the members
of the Kawa classes, switch to the Kawa files.  From javac,
treat these as pre-compiled .class files.  I.e. we treat the Kawa
compiler as a black box that produces Symbols in the same way as
reading class files.  At this point we should only need the
initial &ldquo;scan&rdquo; phase on Kawa.
</li><li> If necessary, finish compiling remaining Kawa files.
</li></ol>

<p>This approach may not immediately provide as robust mixed-language
support as is ideal, but it is more amenable to incremental improvement
than a standalone stub-generator.
</p>
<p>This project is good if you know or want to learn how <code>javac</code> works.
</p>
</div>
<div class="subsection" id="Use-Java_002d7-MethodHandles-and-invokedynamic">
<h4 class="subsection">3.6.7 Use Java-7 MethodHandles and invokedynamic</h4>
<p>Java 7 supports MethodHandles which are meant to provide better
performance (ultimately) for dynamic languages.
See <a href="http://jcp.org/en/jsr/detail?id=292">JSR 292</a>
and the <a href="http://openjdk.java.net/projects/mlvm/">Da Vinci Machine Project</a>.
Kawa makes limited use of MethodHandles, and no use of invokedynamic.
There is more to be done.  For example, we
can start by optimizing arithmetic when the types are unknown
at compile-time.  They could make implementing
generic functions (multimethods) more efficient.
At some point we want to compile lambdas in the same way
as Java 8 does. This can potentially
be more efficient than Kawa&rsquo;s current mechanism.
</p>
<p>Remi Forax&rsquo;s <a href="https://github.com/forax/vmboiler">vmboiler</a> is
a small library on top of ASM that generates optimistically typed bytecodes.
It could be useful for ideas.
</p>
<span id="task_002dparameterized_002dtypes"></span></div>
<div class="subsection" id="Parameterized-types">
<h4 class="subsection">3.6.8 Parameterized types</h4>
<p><i>(GSoC)</i>
</p>
<p>Kawa has some limited support for parameterized types, but
it&rsquo;s not used much.  Improve type inferencing.
Support definition of parameterized classes.
Better use of parameterized types for sequence class.
Support wildcards.  
(It might be better to have wild-carding be associated with
declarations, as in Scala or <a href="http://openjdk.java.net/jeps/300">proposed for Java</a>, rather than uses.)
See also <a href="http://openjdk.java.net/jeps/8043488">http://openjdk.java.net/jeps/8043488</a>.
</p>
</div>
<div class="subsection" id="Optimized-function-types-and-values-using-MethodHandles">
<h4 class="subsection">3.6.9 Optimized function types and values using MethodHandles</h4>
<p><i>(GSoC)</i>
</p>
<p>Kawa doesn&rsquo;t have true function types: Parameter and result types
are only handled for &ldquo;known&rdquo; functions.  The general case with
optional and keyword parameter is complicated, but simple
fixed-arity procedure types would be very useful.
</p>
<p>The following syntax is suggested:
</p><div class="example">
<pre class="example">procedure[(<var>T1</var> .. <var>Tn</var>) <var>Tr</var>]
</pre></div>
<p><var>T1</var> through <var>T1</var> are types of the parameters, and
<var>Tr</var> is the type of the result.
For example: <code>procedure[(vector int) string]</code>.
We call this a typed-procedure type (in contrast to plain <code>procedure</code>).
</p>
<p>If a value has a typed-procedure type then its run-time representation
is a just a <code>MethodHandle</code>.  If such a procedure is called,
the generated bytecode is to just call its <code>invokeExact</code> method.
The argument expressions are converted (and type-checked) the same
way as if we were calling a statically-known procedure.
</p>
<p>Note that passing an <code>int</code> argument
of to <code>procedure[(vector int) string]</code> value does <em>not</em>
require allocating an object to &ldquo;box&rdquo; the <code>int</code>;
we can pass a plain <code>int</code> as-is.
Thus using typed-procedure types can lead to major speed-up.
For example the <code>lib-test.scm</code> should become much faster.
</p>
<p>Converting a known procedure to a typed-procedure type is usually
just a matter of creating a <code>MethodHandle</code> that references the
method implementing the procedure.  Some glue code may be needed
if the types aren&rsquo;t identical, or if the procedure is a closure.
</p>
<p>Converting a type-procedure value <code>p</code> to generic value (such
as untyped <code>procedure</code> or <code>object</code>) can be though of as
wrapping it in a <code>lambda</code>:
</p><div class="example">
<pre class="example">((lambda (arg1::vector arg2::int)::string (p arg1 arg2))
</pre></div>

<p>Coercing a generic value or an untyped procedure to a typed-procedure would
need to generate a method whose signature matches the typed-procedure type,
and in the body of the method use a generic apply.
</p>
<p>Coercing from one typed-procedure type to a different typed-procedure type
is a combination of the above techniques (as if converting first to object and
then to the target type), though some optimizations are worth doing.
</p>
<p>Adding varargs support can be done later.
</p>

<p>We need a fall-back mechanism for platforms (such as Android)
that don&rsquo;t support <code>MethodHandle</code>s.  The easiest is to
just treat a typed-procedure type as plain <code>procedure</code> at run-time,
though we still want the compile-time type-checking,
</p>
</div>
<div class="subsection" id="Full-continuations">
<h4 class="subsection">3.6.10 Full continuations</h4>
<p><em>Currently being worked on.</em>
</p>
<p>Add support for full continuations, which is the major
feature missing for Kawa to qualify as a &ldquo;true Scheme&rdquo;.
One way to implement continuations is to add a add that converts
the abstract syntax tree to continuation-passing-style, and then
expand the existing full-tail-call support to manage a stack.
There are other ways to solve the problem.
This may benefit from <a href="#task_002dfaster_002dtailcalls">Faster tailcalls</a>.
</p>
</div>
<div class="subsection" id="Faster-tailcalls">
<h4 class="subsection">3.6.11 Faster tailcalls</h4>
<span id="task_002dfaster_002dtailcalls"></span><p>Make <code>--full-tailcalls</code> run faster.
This may depend on (or incorporate)
<a href="#task_002dTreeList_002doptimization">TreeList-optimization</a>. 
</p>
<span id="task_002dTreeList_002doptimization"></span></div>
<div class="subsection" id="TreeList_002doptimization">
<h4 class="subsection">3.6.12 TreeList-optimization</h4>
<p>The <a href="http://www.gnu.org/software/kawa/api/gnu/lists/TreeList.html">TreeList</a> class is a data structure for &ldquo;flattened&rdquo; trees.  It is used for
XML-style nodes, for multiple values, and for the full-tail-call API.
The basic concept is fine, but it could do with some re-thinking
to make make random-access indexing fast.  Also, support for updating
is insufficient.  (This needs someone into designing and hacking on
low-level data-structures, along with lots of profiling and testing.)
</p>
</div>
<div class="subsection" id="Asynchronous-evaluation">
<h4 class="subsection">3.6.13 Asynchronous evaluation</h4>

<p>C# recently added <code>asynch</code> and <code>await</code> keywords
for <a href="http://msdn.microsoft.com/en-us/vstudio/gg316360">asynchronous programming</a>.  Kawa&rsquo;s recently improved support for lazy programming
seems like a good framework for equivalent functionality:
Instead of an <code>asynch</code> method that returns a <code>Task&lt;T&gt;</code>,
the Kawa programmer would write a function that returns a <code>lazy[T]</code>.
This involves some design work, and modifying the compiler to
rewrite the function body as needed.
</p>
<p>This is related to full continuations, as the re-writing is similar.
</p>
<span id="task_002dREPL_002dimprovements"></span></div>
<div class="subsection" id="REPL-console-and-other-REPL-improvement">
<h4 class="subsection">3.6.14 REPL console and other REPL improvement</h4>
<p><em>Currently being worked on.</em>
</p>
<p>Improvements to the read-eval-print console.
In addition to a traditional Swing console,
it would be useful to support using a web browser as a remote terminal,
possibly using web-sockets.
(This allows &ldquo;printing&rdquo; HTML-expressions, which can be a useful way
to learn and experiment with web technologies.)
See <a href="http://per.bothner.com/blog/2007/ReplPane/">here</a> for an article
on the existing Swing REPL, along with some to-do items.
Being able to hide and show different parts of the output might be nice.
Being able to link from error messages to source might be nice.
Better handling of redefinitions is discussed 
<a href="http://per.bothner.com/blog/2009/REPL-for-JavaFX/">here in the context of JavaXF Script</a>; this is a general REPL issue, mostly independent of the GUI for it.
</p>
<p>An interesting possibility is to use the <a href="http://ipython.org/">IPython</a>
framework.  There are existing ports for Scala: either
<a href="https://github.com/mattpap/IScala">IScala</a>
or <a href="https://github.com/Bridgewater/scala-notebook">Scala Notebook</a>.
</p>
</div>
<div class="subsection" id="XQuery_002d3_002e0-functionality">
<h4 class="subsection">3.6.15 XQuery-3.0 functionality</h4>
<p><i>(GSoC, for some subset)</i>
</p>
<p>It would be nice to update the XQuery (Qexo) support
to some subset of <a href="http://www.w3.org/TR/xquery-30/">XQuery 3.0</a>.
</p>
</div>
<div class="subsection" id="XQuery_002dupdates">
<h4 class="subsection">3.6.16 XQuery-updates</h4>
<p>It would be nice to support <a href="http://www.w3.org/TR/xquery-update-10/">XQuery updates</a>.  This depends on <a href="#task_002dTreeList_002doptimization">TreeList-optimization</a>. 
</p>
<span id="task_002dcommon_002dlisp"></span></div>
<div class="subsection" id="Common-Lisp-support">
<h4 class="subsection">3.6.17 Common Lisp support</h4>
<p>Kawa supports a small subset of the Common Lisp language, but it supports
a much larger subset of core Common Lisp concepts and data structures, some
designed with Common Lisp functionality in mind.  Examples include
packages, arrays, expanded function declarations, type specifications,
and format.  A lot could be done to improve the Common Lisp support
with modest effort.  Some Common Lisp features could also be useful
for Scheme: Documentation strings (or markup) as Java annotations,
better MOP-like introspection, and generic methods a la defmethod
(i.e. with multiple definition statements, possibly in separate files,
as opposed to the current make-procedure) all come to mind.
Being able to run some existing Common Lisp code bases with
at most modest changes should be the goal.
One such package to start with might be an
<a href="http://aperiodic.net/phil/archives/Geekery/notes-on-lisp-testing-frameworks.html">existing test framework</a>, perhaps
<a href="http://common-lisp.net/project/bese/FiveAM.html">FivaAM</a>.
Full Common Lisp compatibility is nice, but let&rsquo;s walk before we can run.
</p>
</div>
<div class="subsection" id="JEmacs-improvements">
<h4 class="subsection">3.6.18 JEmacs improvements</h4>

<p><i>(GSoC, for some subset)</i>
</p>
<p>A lot of work is needed to make
<a href="http://jemacs.sourceforge.net/">JEmacs</a> useful.
One could try to import a useful package and see what works and what fails.
Or one may look at basic editing primitives.
Enhancements may be needed to core Emacs Lisp language primitives
(enhancing <a href="#task_002dcommon_002dlisp">Common Lisp support</a> may help),
or to the display engine.
</p>
<p>Emacs now supports <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Lexical-Binding.html">lexical bindings</a> - we should do the same.
</p>
</div>
<div class="subsection" id="Improved-IDE-integration">
<h4 class="subsection">3.6.19 Improved IDE integration</h4>
<p>There is some Kawa support for Eclipse (Schemeway), and possibly
other IDEs (NetBeans, IntelliJ).  But many improvements are
desirable.
<a href="#task_002dREPL_002dimprovements">REPL improvements</a> may be a component of this.
</p>
<ul class="section-toc">
<li><a href="#Plugin-for-NetBeans-IDE" accesskey="1">Plugin for NetBeans IDE</a></li>
<li><a href="#Plugin-for-Eclipse-IDE" accesskey="2">Plugin for Eclipse IDE</a></li>
<li><a href="#Improve-Emacs-integration" accesskey="3">Improve Emacs integration</a></li>
</ul>
<div class="subsubsection" id="Plugin-for-NetBeans-IDE">
<h4 class="subsubsection">3.6.19.1 Plugin for NetBeans IDE</h4>

<p>Kawa-Scheme support for the NetBeans IDE would be useful.
One could perhaps build on the Clojure plugin.
</p>
</div>
<div class="subsubsection" id="Plugin-for-Eclipse-IDE">
<h4 class="subsubsection">3.6.19.2 Plugin for Eclipse IDE</h4>

<p>Kawa-Scheme support for the Eclipse IDE would be useful.
Probably makes sense to
enhance <a href="http://sourceforge.net/projects/schemeway/">SchemeWay</a>.
It may also make sense to build on
the <a href="http://www.eclipse.org/dltk/">Dynamic Languages Toolkit</a>,
possibly making use of <a href="http://schemeide.sourceforge.net/">Schemeide</a>,
though DLTk seems more oriented towards interpreted non-JVM-based languages.
</p>
</div>
<div class="subsubsection" id="Improve-Emacs-integration">
<h4 class="subsubsection">3.6.19.3 Improve Emacs integration</h4>

<p><a href="http://en.wikipedia.org/wiki/SLIME">SLIME</a> is an Emacs mode
that provides IDE-like functionality.  It supports Kawa.
</p>
<p><a href="http://jdee.sourceforge.net/">JDEE</a> is a Java development environment,
so might have better hooks to the JVM and Java debugging architecture.
</p>
<p><a href="http://cedet.sourceforge.net/">CEDET</a> is a more general
framework of development tools.
</p>
</div>
</div>
<div class="subsection" id="Hop_002dstyle-web-programming">
<h4 class="subsection">3.6.20 Hop-style web programming</h4>
<p><a href="http://hop.inria.fr/">Hop</a> is an interesting design
for integrating server-side and client-side programming using
a Scheme dialect.  These ideas seem like they would port
quite well to Kawa.
</p>
</div>
<div class="subsection" id="String-localization">
<h4 class="subsection">3.6.21 String localization</h4>

<p><i>(GSoC)</i>
</p>
<p>Support localization by extending the
<a href="http://srfi.schemers.org/srfi-109/srfi-109.html">SRFI_109</a>
syntax, in the manner of (and compatible with)
<a href="http://www.gnu.org/software/gettext/">GNU gettext</a>.
I.e. optionally specify a localization key (to use as an index
in the translation database); if there is no key specified,
default to using the literal parts of the string.
</p>
</div>
<div class="subsection" id="Data-binding">
<h4 class="subsection">3.6.22 Data binding</h4>
<p>Implement a &ldquo;bind&rdquo; mechanism similar to that
of <a href="http://docs.oracle.com/javafx/1.3/tutorials/core/dataBinding/">JavaFX Script</a>.
The idea is that when you initialize a variable or field,
instead of initializing it to a fixed value, you bind it to
an expression depending on other variables.
We install &ldquo;listeners&rdquo; on those variables, so when those variables
change, we update the bound variable.
This feature is useful in many applications, but the initial
focus could be GUI programming and perhaps web programming.
</p>
</div>
<div class="subsection" id="Decimal-arithmetic-and-repeated-decimals">
<h4 class="subsection">3.6.23 Decimal arithmetic and repeated decimals</h4>

<p><i>(GSoC. Possibly a bit light for a full Summer project,
but can be extended or combined with other projects.)</i>
</p>
<p>Exact decimal arithmetic is a variation of exact rational arithmetic,
but may be more user-friendly.  In particular, printing using
decimals is generally nicer than fractions.
It is also sometimes useful to specify an explicit scale,
so we can distinguish 0.2 from 0.20.
We can use the Java <code>BigDecimal</code> class, but run into problems
with division - for example <code>(/ 1.0 3.0)</code>.
We should implement a subclass of <code>RatNum</code> that generalizes
<code>BigDecimal</code> to also handle repeating decimals.
We need a lexical syntax for repeating decimals.
Possible ideas: <code>0._81_</code> or <code>0.#81</code>.
If a Scheme number literal is specified as exact and has either
a decimal point or an exponent (for example <code>#e1.25</code>), then it should
read as an exact decimal, not a fraction.
</p>
</div>
<div class="subsection" id="Optional-strict-typing-along-with-an-explicit-dynamic-type">
<h4 class="subsection">3.6.24 Optional strict typing along with an explicit <code>dynamic</code> type</h4>

<p><i>(GSoC)</i>
</p>
<p>Kawa currently implements &ldquo;optimistic&rdquo; typing: The compiler only
complains if an expression has no values in common with the target type
- for example, if assigning a <code>string</code> expression to an <code>integer</code>
variable.
It would be interesting to experiment with a
<code>--strict-typing</code> option (which would never be the default):
Strict typing would only allow &ldquo;widening&rdquo; conversions - i.e.
that the expression type be a subtype of the target type.
For example it would complain if assigning a <code>number</code> to an <code>integer</code>
unless you used an explicit cast.
</p>
<p>To make this easier to work with we&rsquo;d make use
of the <a href="#dynamic_002dtype"><code>dynamic</code> type</a>, similar to
<a href="https://msdn.microsoft.com/en-us/library/dd264736.aspx">what
<code>C#</code> does</a>: Any expression can be converted
to or from <code>dynamic</code> without the compiler complaining.
Similarly, if <code>x</code> is <code>dynamic</code> then <code>x:name</code>
is allowed by the compiler regardless of <code>name</code>, with all checking
being deferred to run-time.  If a variable is declared without a type,
it should default to <code>dynamic</code>.  The <code>dynamic</code> type
is represented in the VM as <code>object</code> but with an annotation
(like we do with <code>character</code>).
</p>
<p>The type-checker might need some changes to better distinguish
implicit conversions from explicit casts.
</p>
<hr>
</div>
</div>
</div>
<div class="chapter" id="Installation">
<div class="header">
<p>
Next: <a href="#Tutorial" accesskey="n" rel="next">Kawa Scheme Tutorial</a>, Previous: <a href="#Community" accesskey="p" rel="prev">The Kawa Community</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Getting-and-installing-Kawa"></span><h2 class="chapter">4 Getting and installing Kawa</h2>


<ul class="section-toc">
<li><a href="#Getting-Kawa" accesskey="1">Getting Kawa</a></li>
<li><a href="#Running-Java" accesskey="2">Getting and running Java</a></li>
<li><a href="#Binary-distribution" accesskey="3">Installing and using the binary distribution</a></li>
<li><a href="#Source-distribution" accesskey="4">Installing and using the source distribution</a></li>
</ul>
<hr>
<div class="section" id="Getting-Kawa">
<div class="header">
<p>
Next: <a href="#Running-Java" accesskey="n" rel="next">Getting and running Java</a>, Up: <a href="#Installation" accesskey="u" rel="up">Getting and installing Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Getting-Kawa-1"></span><h3 class="section">4.1 Getting Kawa</h3>

<p>You can compile Kawa from the source distribution.
Alternatively, you can install the pre-compiled binary distribution.
</p>
<p>You can get Kawa sources and binaries from the Kawa ftp site
<a href="ftp://ftp.gnu.org/pub/gnu/kawa/">ftp://ftp.gnu.org/pub/gnu/kawa/</a>,
or from a <a href="http://www.gnu.org/order/ftp.html">mirror site</a>.
</p>
<p>The current release of the Kawa source code is
<a href="ftp://ftp.gnu.org/pub/gnu/kawa/kawa-2.93.tar.gz">ftp://ftp.gnu.org/pub/gnu/kawa/kawa-2.93.tar.gz</a>.
(To unpack <code>.tar.gz</code> files Windows users can use
<a href="http://www.7-zip.org/">7-Zip</a>, which is Free Software.)
</p>
<p>The corresponding pre-compiled release
is <a href="ftp://ftp.gnu.org/pub/gnu/kawa/kawa-2.93.zip">ftp://ftp.gnu.org/pub/gnu/kawa/kawa-2.93.zip</a>.
The most recent snapshot is
<a href="ftp://ftp.gnu.org/pub/gnu/kawa/kawa-latest.zip">ftp://ftp.gnu.org/pub/gnu/kawa/kawa-latest.zip</a>.
Instructions for using either are <a href="#Binary-distribution">here</a>.
</p>
<ul class="section-toc">
<li><a href="#Getting-the-development-sources-using-Git" accesskey="1">Getting the development sources using Git</a></li>
</ul>
<div class="subsection" id="Getting-the-development-sources-using-Git">
<h4 class="subsection">4.1.1 Getting the development sources using Git</h4>

<p>The Kawa sources are managed using a
<a href="https://gitlab.com/kashell/Kawa">git</a> repository.
If you want the very latest version grab
<a href="https://git-scm.com/downloads">a git client</a>,
and then check out the source using this command:
</p><div class="example">
<pre class="example">git clone https://gitlab.com/kashell/Kawa.git
</pre></div>

<p>After a checkout you will need to run:
</p><div class="example">
<pre class="example">./autogen.sh
</pre></div>
<p>before proceding with instructions for <a href="#Source-distribution">building the source distribution</a>.
</p>
<p>Once you have it checked out, you can keep it up-to-date with <code>git pull</code>.
</p>
<p>You can also
<a href="https://gitlab.com/kashell/Kawa/tree/master">browse the git archive</a> online.
</p>
<hr>
</div>
</div>
<div class="section" id="Running-Java">
<div class="header">
<p>
Next: <a href="#Binary-distribution" accesskey="n" rel="next">Installing and using the binary distribution</a>, Previous: <a href="#Getting-Kawa" accesskey="p" rel="prev">Getting Kawa</a>, Up: <a href="#Installation" accesskey="u" rel="up">Getting and installing Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Getting-and-running-Java"></span><h3 class="section">4.2 Getting and running Java</h3>

<p>Before installing Kawa, you will need a working Java system.
The released Kawa jar file assumes Java 8 or newer.
You need to build Kawa from source if you have Java 5, Java 6,
or are targeting Android.
(Older versions of Kawa have been reported to
work with JDK from 1.1, Kaffe, Symantec Cafe, J++, and GCJ,
but these are no longer supported.)
</p>
<p>The discussion below assumes you are using the Java Developer&rsquo;s Kit
(JDK) from Oracle.  You can download free copies of
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 8</a> for various platforms.
</p>

<p>The program <code>java</code> is the Java interpreter.
The program <code>javac</code> is the Java compiler,
and is needed if you want to compile the source release yourself.
Both programs must be in your <code>PATH</code>.
If you have the JDK in directory <code>$JAVA_HOME</code>,
and you are using a Bourne-shell compatible shell
(/bin/sh, ksh, bash, and some others) you can set <code>PATH</code> thus:
</p><div class="example">
<pre class="example">PATH=$JAVA_HOME/bin:$PATH
export PATH
</pre></div>

<hr>
</div>
<div class="section" id="Binary-distribution">
<div class="header">
<p>
Next: <a href="#Source-distribution" accesskey="n" rel="next">Installing and using the source distribution</a>, Previous: <a href="#Running-Java" accesskey="p" rel="prev">Getting and running Java</a>, Up: <a href="#Installation" accesskey="u" rel="up">Getting and installing Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Installing-and-using-the-binary-distribution"></span><h3 class="section">4.3 Installing and using the binary distribution</h3>

<p>The binary release comes as a <code>.zip</code> archive that
includes Kawa itself (as a <code>.jar</code> file <code>kawa-<var>version</var>.jar</code>),
some third-party helper libraries, <code>kawa</code> command scripts
(for GNU/Linux/Unix/MacOS or Windows),
and documentation (basically this manual).
</p>
<p>After downloading (see <a href="#Getting-Kawa">Getting Kawa</a>), extract the files
from the <code>.zip</code> archive using a suitable <code>unzip</code> program,
which will create a directory <code>kawa-<var>version</var></code>,
with <code>lib</code>, <code>bin</code>, and <code>doc</code> sub-directories.
In the following, we assume the environment variable <code>KAWA_HOME</code>
refers to this directory:
</p><div class="example">
<pre class="example">unzip ~/Downloads/kawa-<var>version</var>.zip
export KAWA_HOME=`pwd`/kawa-<var>version</var>
</pre></div>

<p>The binary release requires Java 8 or later.
If you have an older Java implementation, or build for a mobile
environment like Android,
then you will need to get the source distribution.
</p>
<p>If you want to use Kawa as part of some other application,
you just need the <code>$KAWA_HOME/lib/kawa.jar</code>.
</p>
<span id="Running-the-kawa-command"></span><h4 class="subsubheading">Running the <code>kawa</code> command</h4>

<p>To run a Kawa script file or the Kawa read-eval-print-loop
run the Kawa application.  There are various way to do so.
</p>
<p>The recommended way is to execute the <code>$KAWA_HOME/bin/kawa</code> Bash
shell script.
This should work on most Unix-like platforms that have Bash installed,
including GNU/Linux, BSD, MacOS, and Cygwin/MingW.
(Please report if you have problems.)
</p>
<p>The script assumes that either a suitable <code>java</code> program is
in your <code>PATH</code>; or the <code>JAVA</code> environment variable
names a suitable <code>java</code> executable; or that <code>JAVA_HOME</code>
is set so <code>$JAVA_HOME/bin/java</code> is suitable.
</p>
<p>If you want to put <code>kawa</code> in your search path you can of course do:
</p><div class="example">
<pre class="example">PATH=$KAWA_HOME/bin:$PATH
</pre></div>
<p>Alternatively you can create a symbolic link in an already-searched directory.
For example:
</p><div class="example">
<pre class="example">cd /usr/local/bin
ln -s $KAWA_HOME/bin/kawa kawa
</pre></div>

<p>The <code>bin/kawa.bat</code> script works on Windows.
</p>
<p>Both scripts add some helper libraries, including support for input editing.
</p>
<p>It is also possible to run Kawa using <code>java</code> directly:
</p><div class="example">
<pre class="example">java -jar $KAWA_HOME/lib/kawa.jar
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">CLASSPATH=$KAWA_HOME/lib/kawa.jar
export CLASSPATH
java kawa.repl
</pre></div>
<p>On Windows:
</p><div class="example">
<pre class="example">set classpath=%KAWA_HOME%\lib\kawa.jar
</pre></div>

<p>To run Kawa in a fresh window use the -w flag:
</p><div class="example">
<pre class="example">kawa -w
</pre></div>
<p>or
</p><div class="example">
<pre class="example">java kawa.repl -w
</pre></div>

<span id="Reading-the-documentation"></span><h4 class="subsubheading">Reading the documentation</h4>

<p>The file <code>doc/kawa-manual.epub</code> contains the Kawa documention
packaged as an electronic book, which is readable by most
e-book readers.  Plugins are also available for common browsers,
for example <a href="http://www.epubread.com">EPUBReader</a> for <code>firefox</code>.
</p>
<p>Even easier is to invoke
<a href="#browse_002dmanual_002doption"><code>bin/kawa --browse-manual</code></a>
(or on Windows: <code>bin\kawa.bat --browse-manual</code>).
</p>
<p>An <code>epub</code> is essentially a zip archive, which you can unzip:
</p><div class="example">
<pre class="example">cd $KAWA_HOME/doc
unzip kawa-manual.epub
</pre></div>
<p>Then you can use a plain browser
with the URL <code>file:$KAWA_HOME/doc/OEBPS/index.xhtml</code>.
</p>
<hr>
</div>
<div class="section" id="Source-distribution">
<div class="header">
<p>
Previous: <a href="#Binary-distribution" accesskey="p" rel="prev">Installing and using the binary distribution</a>, Up: <a href="#Installation" accesskey="u" rel="up">Getting and installing Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Installing-and-using-the-source-distribution"></span><h3 class="section">4.4 Installing and using the source distribution</h3>
<p>The Kawa release normally comes as a gzip-compressed tar file named
&lsquo;<samp>kawa-2.93.tar.gz</samp>&rsquo;.
Two methods are supporting for compiling the Kawa sources;
choose whichever is most convenient for you.
</p>
<p>One method uses the traditional GNU <code>configure</code> script,
followed by running <code>make</code>.  This works well on Unix-like
systems, such as GNU/Linux.
You can also use this method on Microsoft Windows,
with the help of tools from <a href="http://www.MinGW.org/">MinGW</a>
or <a href="http://www.cygwin.org/">Cygwin</a>.
</p>
<p>The other method uses the <code>ant</code> command, a Java-based
build system released by Apache&rsquo;s Jakarta project.  This uses
an <code>build.xml</code> file in place of <code>Makefile</code>s, and
works on non-Unix systems such as Microsoft Windows.  However,
the <code>ant</code> method does not support all
the features of the <code>configure</code>+<code>make</code> method.
</p>
<ul class="section-toc">
<li><a href="#Build-Kawa-using-configure-and-make" accesskey="1">Build Kawa using <code>configure</code> and <code>make</code></a></li>
<li><a href="#Building-the-documentation" accesskey="2">Building the documentation</a></li>
<li><a href="#Build-Kawa-using-ant" accesskey="3">Build Kawa using <code>ant</code></a></li>
</ul>
<div class="subsection" id="Build-Kawa-using-configure-and-make">
<h4 class="subsection">4.4.1 Build Kawa using <code>configure</code> and <code>make</code></h4>

<p>(See <a href="#building_002don_002dWindows_002dwith_002dmake">below</a> for some notes for building
on Microsoft Windows.)
</p>
<p>If you have a <code>tar.gz</code> file, first unpack that in your build directory:
</p><div class="example">
<pre class="example">tar xzf kawa-2.93.tar.gz
cd kawa-2.93
</pre></div>

<p>If you&rsquo;re building from the Git repository, you need to
generate <code>configure</code> and some other files. This is
easiest done with the <code>autogen.sh</code> script:
</p><div class="example">
<pre class="example">./autogen.sh
</pre></div>

<p>Then you must configure the sources.  This you do in
the same way you configure most other GNU software.  Normally
you can just run the configure script with no arguments:
</p>
<div class="example">
<pre class="example">./configure
</pre></div>
<p>The <code>configure</code> script takes a number of <a href="#configure-options">options</a>.
</p>
<p>If you have installed Kawa before, make sure your <code>CLASSPATH</code>
does not include old versions of Kawa, or other classes that may
conflict with the new ones.
</p>
<p>Then you need to compile all the .java source files.
Just run make:
</p><div class="example">
<pre class="example">make
</pre></div>
<p>This assumes that &lsquo;<samp>java</samp>&rsquo; and &lsquo;<samp>javac</samp>&rsquo; are the java interpreter
and compiler, respectively.
</p>
<p>It has been reported that parallel make doesn&rsquo;t work,
so don&rsquo;t use the <code>-j2</code> or above options.
</p>
<p>You can now test the system by running Kawa in place:
</p><div class="example">
<pre class="example">java kawa.repl
</pre></div>

<p>or you can run the test suite:
</p><div class="example">
<pre class="example">make check
</pre></div>

<p>or you can install the compiled files:
</p><div class="example">
<pre class="example">make install
</pre></div>

<p>This will install your classes into <code>$PREFIX/share/java</code> (and its
sub-directories).  Here <code>$PREFIX</code> is the directory you specified
to configure with the <code>--prefix</code> option, or <code>/usr/local</code> if you
did not specify a <code>--prefix</code> option.
</p>
<p>To use the installed files, you need to set <code>CLASSPATH</code> so
that <code>$PREFIX/share/java/kawa.jar</code> is in the path:
</p><div class="example">
<pre class="example">CLASSPATH=$PREFIX/share/java/kawa.jar
export CLASSPATH
</pre></div>
<p>This is done automatically if you use the &lsquo;<samp>kawa</samp>&rsquo; script.
</p>
<span id="configure-options"></span><span id="index-configure-options"></span>
<ul class="section-toc">
<li><a href="#Configure-options" accesskey="1">Configure options</a></li>
<li><a href="#Building-on-Windows-using-MinGW" accesskey="2">Building on Windows using MinGW</a></li>
<li><a href="#Building-on-Windows-using-Cygwin" accesskey="3">Building on Windows using Cygwin</a></li>
</ul>
<div class="subsubsection" id="Configure-options">
<h4 class="subsubsection">4.4.1.1 Configure options</h4>

<p>The <code>configure</code> script takes a number of options.
The <code>--help</code> switch gives you a list of options.
The following are some of the more common or important ones.
</p>
<dl compact="compact">
<dt><span><code>--prefix=<var>install-dir</var></code></span></dt>
<dt><span><code>--prefix <var>install-dir</var></code></span></dt>
<dd><p>By default <code>make install</code> will install the compiled <code>.jar</code>
files info <code>/usr/local/share/java</code>,
the <code>kawa</code> command into <code>/usr/local/bin</code>,
and so on in <code>/usr/local</code>.
The <code>--prefix</code> option causes the files to be installed
under <code><var>install-dir</var></code> instead of <code>/usr/local</code>.
For example to install the <code>.jar</code> in <code>/opt/kawa/share/java</code>
and otherwise use <code>/opt/kawa</code> do:
</p><div class="example">
<pre class="example">./configure --prefix=/opt/kawa
</pre></div>

</dd>
<dt><span><code>--with-java-source=<var>version</var></code></span></dt>
<dd><p>As distributed, the Kawa source code requires Java 8.
If you only have Java 7, Java 6, or Java 5, use the <code>--with-java-source</code> option:
</p><div class="example">
<pre class="example">./configure --with-java-source=6
</pre></div>

<p>Kawa no longer supports older verisons of Java (JDK 1.4 or older).
It might be possible to use a tool
like <a href="http://retroweaver.sourceforge.net/">Retroweaver</a>
on the Kawa <code>.jar</code> to fix up Java 5 dependencies.
Contact the Kawa author if you want to be a tester for this.
</p>
</dd>
<dt><span><code>--with-docbook-stylesheet[=<var>path</var>]</code></span></dt>
<dd><p>Build the documentation (this manual) as an electronic book
(in ebook format) or a website, using
the DocBook xslt stylesheets.
(You can build the documentation without DocBook, but using
it enables nicer-looking and more functional documentation.)
</p>
<p>The stylesheets are found using <var>path</var>;
the file <code><var>path</var>/epub3/chunk.xsl</code> needs to exist.
(For example, on Fedora 25 <var>path</var> can be <code>/usr/share/sgml/docbook/xsl-ns-stylesheets</code>,
while on Debian use <code>/usr/share/xml/docbook/stylesheet/docbook-xsl-ns</code>.)
</p>
</dd>
<dt><span><code>--with-domterm</code></span></dt>
<dt><span><code>--with-domterm=<var>domterm_home</var></code></span></dt>
<dd><p>Compile with extra support for the <a href="#Using-DomTerm">DomTerm</a>
terminal emulator library, where <code><var>domterm_home</var></code>
is such that <code><var>domterm_home</var>/lib/domterm.jar</code> exists.
(Some DomTerm support is built-in regardless.)
</p>
<p>If you use this option along with <code>--with-javafx</code>
then creating a new <a href="#REPL-Console">REPL</a> window
will create a DomTerm window.
</p>
<p>As an optional convenience, you can use the <code>domterm.jar</code>
in the Kawa binary distribution.
</p>
</dd>
<dt><span><code>--with-jline3</code></span></dt>
<dt><span><code>--with-jline3=<var>jline3.jar</var></code></span></dt>
<dd><p>Build support for using <a href="https://github.com/jline/jline3">JLine 3</a>,
which is a library for handling console input, similar to GNU readline.
If specified, the <var>jline3.jar</var> is added to the classpath of the
generated <code>kawa.sh</code> or <code>kawa</code> shell program.
</p>
<p>An advantage of <code>--with-jline3</code> (compared to
<code>--enable-kawa-frontend</code>) is that the former works without native code
(on most Unix-like platforms), and it does not require a C wrapper program.
</p>
<p>As an optional convenience, you can use the <code>jline.jar</code>
in the Kawa binary distribution.
</p>
</dd>
<dt><span><code>--with-domterm</code></span></dt>
<dt><span><code>--with-domterm=<var>domterm.jar</var></code></span></dt>
<dd><p>Compile with extra support for the <a href="#Using-DomTerm">DomTerm</a>
terminal emulator library.  (Some DomTerm support is built-in regardless.)
</p>
<p>If you use this option along with <code>--with-javafx</code>
then creating a new <a href="#REPL-Console">REPL</a> window
will create a DomTerm window.
</p>
<p>As an optional convenience, you can use the <code>domterm.jar</code>
in the Kawa binary distribution.
</p>
</dd>
<dt><span><code>--with-servlet</code></span></dt>
<dt><span><code>--with-servlet=<var>servlet-jar</var></code></span></dt>
<dd><p>Build support for <a href="#Servlets">servlets</a>, which are used in web servers.
This requires the <code>servlet-api.jar</code> (available various places including
<a href="http://tomcat.apache.org/">Tomcat</a> or
<a href="https://glassfish.java.net/">Glassfish</a>),
for <code>javax.servlet.Servlet</code> and related classes.
If this class isn&rsquo;t in your classpath, specify its location
as <code><var>servlet-jar</var></code>. For example:
</p><div class="example">
<pre class="example">./configure --with-servlet=/path/to/servlet-api.jar 
</pre></div>

</dd>
<dt><span><code>--enable-jemacs</code></span></dt>
<dd><p>Build JEmacs (enable Emacs-like text editor) and support (a subset of)
the Emacs Lisp language.  JEmacs is a proof of concept - not really
usable or maintained.
</p>
</dd>
<dt><span><code>--with-javafx</code></span></dt>
<dt><span><code>--with-javafx=<var>javafx-jar</var></code></span></dt>
<dt><span><code>--with-javafx=<var>java-home</var></code></span></dt>
<dd><p>Set this flag to enable the convenience features
for <a href="#Building-JavaFX-applications">JavaFX</a>.
The JavaFX classes are included in JDK 8 (but not OpenJDK 8),
and you don&rsquo;t need to specify <code><var>javafx-jar</var></code> or <code><var>java-home</var></code>.
For JDK 7 you need to specify <code><var>javafx-jar</var></code>
(the path to <code>javafx.rt</code>) or <code><var>java-home</var></code>
(the value of the <code>$JAVA_HOME</code>).
</p>
</dd>
<dt><span><code>--with-android=<var>android-jar</var></code></span></dt>
<dd><p>Build for the Android platform.
This requires <a href="#Building-for-Android">special instructons</a>.
</p>
</dd>
<dt><span><code>--enable-kawa-frontend</code></span></dt>
<dd><p>If you have the GNU &lsquo;<samp>readline</samp>&rsquo; library installed, you might try
adding the &lsquo;<samp>--enable-kawa-frontend</samp>&rsquo; flag.
This will build the
&lsquo;<samp>kawa</samp>&rsquo; front-end program, which provides input-line editing
and an input history.  You can get &lsquo;<samp>readline</samp>&rsquo; from archives
of GNU programs, including <a href="ftp://www.gnu.org/">ftp://www.gnu.org/</a>.
</p>
<p>Note that using JLine, enabled by <code>--with-jline3</code>,
is now recommended instead of using the <code>readline</code> frontend.
</p>
<p>You may need to specify to <code>make</code> where to find
the <code>readline</code> include files (with <code>READLINE_INCLUDE_PATH</code>)
and the library (with <code>READINE_LIB_PATH</code>).
For example on OS/X you need to do:
</p><div class="example">
<pre class="example">make READLINE_INCLUDE_PATH=-I/usr/local/unix/readline/include \
     READLINE_LIB_PATH=-L/usr/local/unix/readline/lib
</pre></div>
</dd>
</dl>

<span id="building_002don_002dWindows_002dwith_002dmake"></span></div>
<div class="subsubsection" id="Building-on-Windows-using-MinGW">
<h4 class="subsubsection">4.4.1.2 Building on Windows using MinGW</h4>

<p>The Kawa <code>configure</code> and <code>make</code> process assumes Unix-like
tools, which you can get from <a href="http://mingw.org">the MinGW project</a>.
Download the MingGW Installation Manager, and use it to install
at least <code>mingw-developer-toolkit</code>.
(Also installing <code>msys-groff</code> avoids a minor problem
building the documentation.)
</p>
<p>The <code>C:\MinGW\msys\1.0\msys.bat</code> script creates a command window
with the <code>bash</code> shell and the <code>PATH</code> set up as needed.
Alternatively, you can use the standard Windows command prompt
if you set your <code>PATH</code> as described in <a href="http://mingw.org/wiki/Getting_Started">here</a>.
</p>
</div>
<div class="subsubsection" id="Building-on-Windows-using-Cygwin">
<h4 class="subsubsection">4.4.1.3 Building on Windows using Cygwin</h4>

<p>The free <a href="http://sourceware.org/cygwin/">Cygwin</a>
environment can be used for building Kawa: The Kawa configure script
recognizes Cygwin, and modifies the classpath to use Windows-style
path separators.
</p>
<p>Beyond the base packages, you probably want to install <code>autoconf</code>,
<code>automake</code>, <code>git</code>, <code>texinfo</code>, <code>groff</code>,
<code>make</code>, and <code>diffutils</code>.
</p>
<p>Cygwin (unlike MinGW) has a current version of <code>makeinfo</code>, but
an undiagnosed bug still prevents building <code>kawa.info</code>.
You can work around that problem with <code>touch doc/kawa.info</code>.
</p>
</div>
</div>
<div class="subsection" id="Building-the-documentation">
<h4 class="subsection">4.4.2 Building the documentation</h4>

<ul class="section-toc">
<li><a href="#Plain-HTML-documentation" accesskey="1">Plain HTML documentation</a></li>
<li><a href="#Fancier-HTML-documentation" accesskey="2">Fancier HTML documentation</a></li>
<li><a href="#Using-ebook-readers-or-the-_002d_002dbrowse_002dmanual-option" accesskey="3">Using ebook readers or the &ndash;browse-manual option</a></li>
<li><a href="#Building-a-printable-PDF-file" accesskey="4">Building a printable PDF file</a></li>
</ul>
<div class="subsubsection" id="Plain-HTML-documentation">
<h4 class="subsubsection">4.4.2.1 Plain HTML documentation</h4>

<p>You can build a plain HTML version of the documentation
(using <code>makeinfo</code> from the <code>texinfo</code> distribution):
</p><div class="example">
<pre class="example">cd doc &amp;&amp; make kawa-html/index.html
</pre></div>

<p>In this case, point your browser at
<code>file:/<var>kawa_srcdir</var>/doc/kawa-html/index.html</code>.
</p>
</div>
<div class="subsubsection" id="Fancier-HTML-documentation">
<h4 class="subsubsection">4.4.2.2 Fancier HTML documentation</h4>

<p>To build the documentation in a nicer form suitable for a web-site
you need <code>makeinfo</code> <em>and</em> the DocBook XSLT tools
(and to have run <code>configure</code> with
the <code>--with-docbook-stylesheet</code> option):
</p><div class="example">
<pre class="example">cd doc &amp;&amp; make web/index.html
</pre></div>

<p>You can then point your browser at <code>file:/<var>kawa_srcdir</var>/doc/web/index.html</code>.
</p>
</div>
<div class="subsubsection" id="Using-ebook-readers-or-the-_002d_002dbrowse_002dmanual-option">
<h4 class="subsubsection">4.4.2.3 Using ebook readers or the &ndash;browse-manual option</h4>

<p>To build an <code>EPUB</code> file suitable for ebook readers,
as well as enabling support for the
<a href="#browse_002dmanual_002doption"><code>kawa --browse-manual</code> option</a>, do:
</p>
<div class="example">
<pre class="example">cd doc &amp;&amp; make kawa-manual.epub
</pre></div>

<p>This also requires the DocBook XSLT tools.
</p>
</div>
<div class="subsubsection" id="Building-a-printable-PDF-file">
<h4 class="subsubsection">4.4.2.4 Building a printable PDF file</h4>

<p>To build a <code>pdf</code> file suitable for printing or online viewing do:
</p><div class="example">
<pre class="example">cd doc &amp;&amp; make kawa.pdf
</pre></div>

<p>The resulting <code>kawa.pdf</code> is somewhat unsatisfactory - when viewed online,
links aren&rsquo;t clickable.  Furthermore, box drawing characters are missing.
</p>
</div>
</div>
<div class="subsection" id="Build-Kawa-using-ant">
<h4 class="subsection">4.4.3 Build Kawa using <code>ant</code></h4>

<p>Kawa now includes an Ant buildfile (<code>build.xml</code>).
<a href="http://ant.apache.org">Ant</a> is a part of the Apache
Jakarta project.
If you don&rsquo;t hava Ant installed,
get it from <a href="http://ant.apache.org/bindownload.cgi">http://ant.apache.org/bindownload.cgi</a>.
The build is entirely Java based and works equally well on *nix, Windows,
and presumably most any other operating system.
</p>
<p>Once Ant has been installed and configured (you may need to set the
<code>JAVA_HOME</code>, and <code>ANT_HOME</code> environment variables), you should
be able to change to the directory containing the <code>build.xml</code> file,
and invoke the &lsquo;<samp>ant</samp>&rsquo; command.  With the default settings, a
successful build will result in a <code>kawa-2.93.jar</code> in the
current directory.
</p>
<p>There are a few Ant &quot;targets&quot; of interest (they can be supplied on the
Ant command line):
</p>
<dl compact="compact">
<dt><span><code>all</code></span></dt>
<dd><p>This is the default, it does <code>classes</code> and <code>jar</code>.
</p></dd>
<dt><span><code>classes</code></span></dt>
<dd><p>Compiles all the files into <code>*.class</code> files into the directory
specified by the <code>build.dir</code> property.
</p></dd>
<dt><span><code>jar</code></span></dt>
<dd><p>Builds a jar into into the directory
specified by the <code>dist.dir</code> property.
</p></dd>
<dt><span><code>runw</code></span></dt>
<dd><p>Run Kawa in a GUI window.
</p></dd>
<dt><span><code>clean</code></span></dt>
<dd><p>Deletes all files generated by the build, including the jar.
</p></dd>
</dl>

<p>There is not yet a <code>test</code> target for running the testsuite.
</p>
<p>There are various &ldquo;properties&quot; that control what <code>ant</code> does.  You can
override these on the command line or by editing the
<code>build.properties</code> file in the same directory as <code>build.xml</code>.
For example, the <code>build.dir</code> property tells <code>ant</code> where to
build temporary files, and where to leave the resulting <code>.jar</code>
file.  For example, to leave the generated files in the sub-directory
named <code>BUILD</code> do:
</p><div class="example">
<pre class="example">ant -Dbuild.dir=BUILD
</pre></div>
<p>A sample <code>build.properties</code> is provided and it contains
comments explaining many of the options.
</p>
<p>Here are a few general properties that help to customize your build:
</p><dl compact="compact">
<dt><span><code>build.dir</code></span></dt>
<dd><p>Path to put the temporary files used for building.
</p></dd>
<dt><span><code>dist.dir</code></span></dt>
<dd><p>Path to put the resulting jar file.
</p></dd>
<dt><span><code>version.local</code></span></dt>
<dd><p>A suffix to add to the version label for your customized version.
</p></dd>
<dt><span><code>debug</code></span></dt>
<dd><p>Whether (true/false) the Javac &quot;-g&quot; option is enabled.
</p></dd>
<dt><span><code>optimize</code></span></dt>
<dd><p>Whether (true/false) the Javac &quot;-O&quot; option is enabled.
</p></dd>
</dl>

<p>Here are some Kawa-specific ones (all <code>true</code>/<code>false</code>):
<code>with-collections</code>, <code>with-references</code>, <code>with-awt</code>,
<code>with-swing</code>, <code>enable-jemacs</code>, and <code>enable-servlet</code>&gt;
See the sample <code>build.properties</code> for more information on these.
</p>
<p>If you change any of the build properties, you will generally want to do
an &lsquo;<samp>ant clean</samp>&rsquo; before building again as the build is often not able to
notice that kind of change.  In the case of changing a directory path,
you would want to do the <code>clean</code> before changing the path.
</p>
<p>A special note for NetBeans users:
For some reason the build-tools target which compiles an Ant task won&rsquo;t
compile with the classpath provided by NetBeans.
You may do &lsquo;<samp>ant build-tools</samp>&rsquo; from the command line outside of NetBeans,
in which case you will not want to use the <code>clean</code> target as that
will delete the tool files as well.
You can use the <code>clean-build</code> and/or <code>clean-dist</code>
targets as appropriate.  Alternatively you can add <code>ant.jar</code> to the
<code>build-tools</code> classpath by copying or linking it into a <code>lib/ext</code>
directory in Kawa&rsquo;s source directory (the one containing the <code>build.xml</code>
file).
</p>

<hr>
</div>
</div>
</div>
<div class="chapter" id="Tutorial">
<div class="header">
<p>
Next: <a href="#Running" accesskey="n" rel="next">How to start up and run Kawa</a>, Previous: <a href="#Installation" accesskey="p" rel="prev">Getting and installing Kawa</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Kawa-Scheme-Tutorial"></span><h2 class="chapter">5 Kawa Scheme Tutorial</h2>

<p><em>This is obviously incomplete, but it may be useful,
especially if you&rsquo;re starting with Kawa from scratch.</em>
If you&rsquo;re new to Scheme you might also check out one of these tutorials:
Takafumi Shido&rsquo;s
<a href="http://www.shido.info/lisp/idx_scm_e.html">Yet Another Scheme Tutorial</a>;
Dorai Sitaram&rsquo;s <a href="http://www.ccs.neu.edu/home/dorai/t-y-scheme/t-y-scheme-Z-H-1.html">Teach Yourself Scheme in Fixnum Days</a>; or
Paul Wilson&rsquo;s <a href="ftp://ftp.cs.utexas.edu/pub/garbage/cs345/schintro-v14/schintro_toc.html">An Introduction to Scheme and its Implementation</a>.
</p>

<ul class="section-toc">
<li><a href="#Tutorial-_002d-Introduction" accesskey="1">Introduction</a></li>
<li><a href="#Tutorial-_002d-Booleans" accesskey="2">Booleans</a></li>
<li><a href="#Tutorial-_002d-Numbers" accesskey="3">Numbers</a></li>
<li><a href="#Tutorial-_002d-Functions" accesskey="4">Functions</a></li>
<li><a href="#Tutorial-_002d-Variables" accesskey="5">Variables</a></li>
<li><a href="#Tutorial-_002d-Pictures" accesskey="6">Composable pictures</a></li>
<li><a href="#Tutorial-_002d-Sequences" accesskey="7">Lists and sequences</a></li>
<li><a href="#Tutorial-_002d-Objects" accesskey="8">Creating and using objects</a></li>
<li><a href="#Tutorial-_002d-Types" accesskey="9">Types and declarations</a></li>
<li><a href="#Tutorial-_002d-Exceptions-and-errors">Exceptions and errors</a></li>
<li><a href="#Tutorial-_002d-Classes">Classes</a></li>
<li><a href="#Tutorial-_002d-Other-Java-features">Other Java features</a></li>
</ul>
<hr>
<div class="section" id="Tutorial-_002d-Introduction">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Booleans" accesskey="n" rel="next">Booleans</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Introduction"></span><h3 class="section">5.1 Introduction</h3>
<p>You&rsquo;ve heard about all the hot scripting languages
&ndash; you might even be tired of hearing about them.
But Kawa offers you something different than the
scripting-language <i>du-jour</i> can.
You may be interested in one that runs on the Java virtual machine,
either because you have to interact with other Java tools,
or because you like having access to all the Java packages out there.
Or maybe you don&rsquo;t care about Java, but you care about performance.
If so, let me tell you about Kawa, which is actually one of the
very oldest language implementations running on the Java Virtual Machine,
dating back to 1996.
</p>
<p>The Kawa language is a dialect/implementation of the Scheme language.
(The Kawa project also supports other languages, including
<a href="http://www.w3.org/XML/Query">XQuery</a>
and <a href="http://jemacs.sourceforge.net">Emacs Lisp</a>,
as well as tools for implementing mew programming languages,
but we won&rsquo;t cover that in this tutorial.)
</p>
<p><a href="http://www.schemers.org/">Scheme</a>
is an established language with many
<a href="http://community.schemewiki.org/?scheme-faq-standards#implementations">implementations</a>,
a <a href="http://www.schemers.org/Documents/Standards/">standard</a> specification
(the traditional <a href="http://www.schemers.org/Documents/Standards/R5RS/">R5RS</a>,
<a href="http://www.r6rs.org/">R6RS</a> which was ratified in 2007,
and <a href="http://www.r7rs.org/">R7RS</a> which was ratified in 2013),
and is used by universities for both teaching and research.
Scheme also has a reputation for being difficult to learn,
with a weird parenthesis-heavy syntax,
and hard-to-understand concepts like <a href="http://en.wikipedia.org/wiki/Continuation">continuations</a>.
Luckily, you don&rsquo;t need to understand continuations!
(Kawa doesn&rsquo;t fully implement them anyway.)
</p>
<p>The following assumes that Kawa is already installed on your computer;
if not see these <a href="#Installation">installation instructions</a>.
Running the <code>kawa</code> command in interactive mode
is a good way start learning Kawa:
</p><div class="example">
<pre class="example">$ <kbd>kawa</kbd>
#|kawa:1|# <kbd></kbd>
</pre></div>
<p>If you don&rsquo;t have <code>kawa</code> but you have a
Kawa &ldquo;jar&rdquo; and you have Java installed you can instead do:
</p>
<div class="example">
<pre class="example">$ <kbd>java -jar kawa-<var>version-number</var>.jar</kbd>
#|kawa:1|# <kbd></kbd>
</pre></div>

<p>The prompt string has the form of a Scheme comment,
to make it easier to cut-and-paste.
Kawa is expecting you type in an expression or command,
which it will evaluate, and then print out the result.
For example, a quoted string is a simple expression that evaluates to a
string value, which will print as itself, before printing the next prompt:
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>&quot;Hello, world!&quot;</kbd>
Hello, world!
#|kawa:2|# <kbd></kbd>
</pre></div>

<p>The most noticable difference from most other programming languages
is that Scheme uses &ldquo;prefix&rdquo; notation for function calls.
For example Kawa has a function <code>max</code> which returns the
largest value of the arguments.
Instead of <code>max(5, 7, 3)</code>
you write <code>(max 5 7 3)</code>:
</p>
<div class="example">
<pre class="example">(max 5 7 3) &rArr; 7
</pre></div>

<p>(We use the <code>&rArr;</code> symbol above to indicate that
the expression <code>(max 5 7 3)</code> evaluates to the
value <code>7</code>.)
</p>
<p>The prefix notation may feel a bit weird, but you quickly
get used to it, and it has some advantages.
One is consistency: What are special infix operators in most languages
are just regular functions in Scheme.
For example, addition is just a regular function call,
and <code>+</code> is just a regular function name:
</p><div class="example">
<pre class="example">(+ 2.5 1.2) &rArr; 3.7
</pre></div>

<p>The same prefix notation is used for special operations like assignments:
</p><div class="example">
<pre class="example">#|kawa:1|# <kbd>(set! sqrt-of-2 (sqrt 2))</kbd>
#|kawa:2|# <kbd>sqrt-of-2</kbd>
1.4142135623730951
</pre></div>

<hr>
</div>
<div class="section" id="Tutorial-_002d-Booleans">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Numbers" accesskey="n" rel="next">Numbers</a>, Previous: <a href="#Tutorial-_002d-Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Booleans"></span><h3 class="section">5.2 Booleans</h3>

<p>Scheme uses the syntax <code>#t</code> and <code>#f</code>
for Boolean true and false value, respectively.  For example, the
&ldquo;less-than&rdquo; function is named <code>&lt;</code>.
Its result is true if the first argument is less than the second (or, if
there are more than two arguments, that they are in increasing order):
</p><div class="example">
<pre class="example">(&lt; 3 4) &rArr; #t
(&lt; -3 -4) &rArr; #f
(&lt; 2 3 5 7 11)) &rArr; #t
</pre></div>

<p>The <code>if</code> special form takes two or three sub-expressions:
It evaluates the first expression.
If that is true it evaluates the second expression;
otherwise it evaluates the third expression, if provided:
</p><div class="example">
<pre class="example">(if (&lt; 3 4) (+ 5 5) (+ 5 6)) &rArr; 10
</pre></div>

<p>We call <code>if</code> a special form rather than a function,
because for a function all the arguments are evaluated before the
function is called, but in a special form that is not neceassarily the case.
</p>
<p>In addition to <code>#t</code> any value except <code>#f</code>
counts as &ldquo;true&rdquo; when evaluating the first expression of an <code>if</code>:
</p>
<div class="example">
<pre class="example">(if 0 (+ 5 5) (+ 5 6)) &rArr; 11
</pre></div>

<p>You can use <code>and</code>, <code>or</code>,
and <code>not</code> to create complex boolean expressions.
Of these <code>and</code> and <code>or</code>
are special forms that only evaluate as many of the sub-expressions as needed.
</p><div class="example">
<pre class="example">(if (not (and (&gt;= i 0) (&lt;= i 9)))
    (display &quot;error&quot;))
</pre></div>

<p>You can use the <code>cond</code> form as an alternative to
<code>if</code>:
</p><div class="example">
<pre class="example">(cond ((&lt; 3 3) 'greater)
      ((&gt; 3 3) 'less)
      (else ’equal))       &rArr; equal
</pre></div>

<p>The null value (written as <code>#!null</code> in Kawa or <code>null</code> in Java)
is also considered as false.
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Numbers">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Functions" accesskey="n" rel="next">Functions</a>, Previous: <a href="#Tutorial-_002d-Booleans" accesskey="p" rel="prev">Booleans</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Numbers-1"></span><h3 class="section">5.3 Numbers</h3>

<span id="Exact-integers-and-fractions"></span><h4 class="subheading">Exact integers and fractions</h4>

<p>Kawa has the usual syntax for decimal integers.
Addition, subtraction, and multiplication
are written using the usual <code>+</code>,
<code>-</code>, and  <code>*</code>,
but these are all prefix functions that take a variable number of arguments:
</p>
<div class="example">
<pre class="example">(+ 1 2 3) &rArr; 6
(- 10 3 4) &rArr; (- (- 10 3) 4)  &rArr; 3
(* 2 -6)  &rArr; -12
</pre></div>

<p>Kawa has arbitrary-precision integers.
</p>
<p>Let us implement the <a href="http://en.wikipedia.org/wiki/Factorial">factorial</a> function.
Type in the following (we&rsquo;ll look at the syntax shortly):
</p><div class="example">
<pre class="example">#|kawa:1|# <kbd>(define (factorial x)</kbd>
#|(---:2|# <kbd>  (if (&lt; x 1) 1</kbd>
#|(---:3|# <kbd>    (* x (factorial (- x 1)))))</kbd>
</pre></div>

<p>(The prompt changes to indicate a continuation line.)
This binds the name <code>factorial</code>
to a new function, with formal parameter <code>x</code>.
This new function is immediately compiled to Java bytecodes,
and later a JIT compiler may compile it to native code.
</p>
<p>A few tests:
</p><div class="example">
<pre class="example">#|kawa:4|# <kbd>(list (factorial 3) (factorial 4))</kbd>
(6 24)
#|kawa:5|# <kbd>(factorial 30)</kbd>
265252859812191058636308480000000
</pre></div>

<span id="Floating_002dpoint-real-numbers"></span><h4 class="subheading">Floating-point real numbers</h4>

<p>Given what was said above about being able to add, subtract and multiply integers,
the following may be unexpected:
</p>
<div class="example">
<pre class="example">#|kawa:1|# (/ 2 3)
2/3
#|kawa:2|# (+ (/ 1 3) (/ 2 3))
1
</pre></div>

<p>In many languages, dividing two integers, as 2/3, would result in 0.  At best,
the result would be a floating point number, similar to 0.666667.  Instead,
Kawa has a <em>rational</em> number type, which holds the results of divisions
<em>exactly</em>, as a proper fraction.  Hence, adding one third to two thirds
will always result in exactly one.
</p>
<p>Floating-point real numbers are known in Kawa as <em>inexact</em> numbers, as
they cannot be stored exactly.  Consider:
</p>
<div class="example">
<pre class="example">#|kawa:3|# (exact? 2/3)
#t
#|kawa:4|# (exact? 0.33333333)
#f
#|kawa:5|# (exact-&gt;inexact 2/3)
0.6666666666666666
</pre></div>

<p>The first two examples check numbers for being <code>exact?</code>; there is a
corresponding <code>inexact?</code> test.  The last shows how an exact number can be
converted to an inexact form.
</p>
<p>Numbers are converted between exact and inexact versions when required
within operations or procedures:
</p>
<div class="example">
<pre class="example">#|kawa:6|# (+ 0.33333333 2/3)
0.9999999966666666
#|kawa:7|# (inexact? (+ 0.33333333 2/3))
#t
#|kawa:8|# (sin 2/3)
0.618369803069737
</pre></div>

<span id="Complex-numbers"></span><h4 class="subheading">Complex numbers</h4>

<p>A <em>complex</em> number is made from two parts: a <em>real</em> part and an
<em>imaginary</em> part.  They are written <code>2+3i</code>.  A complex number can
be manipulated just like other numbers:
</p>
<div class="example">
<pre class="example">#|kawa:9|# (+ 2+3i 5+2i)
7+5i
#|kawa:10|# (* 2+3i 4-3i)
17+6i
#|kawa:11|# (integer? (+ 2+3i -3i))
#t
</pre></div>

<p>Notice how in the last example the result is an integer, which Kawa recognises.
</p>
<p>Kawa also includes <a href="#Quaternions">quaternion</a> numbers.
</p>
<span id="Units-and-dimensions"></span><h4 class="subheading">Units and dimensions</h4>

<p>In many applications, numbers have a <em>unit</em>.  For example, 5 might be
a number of dollar bills, a weight on a scale, or a speed.  Kawa enables us
to represent numbers as <em>quantities</em>: numbers along with their unit.
For example, with weight, we might measure weight in pounds and ounces,
where an ounce is 1/16 of a pound.
</p>
<p>Using Kawa, we can define units for our weight measurements, and specify the 
units along with numbers:
</p>
<div class="example">
<pre class="example">#|kawa:12|# (define-base-unit pound &quot;Weight&quot;)
#|kawa:13|# (define-unit ounce 0.0625pound)
#|kawa:14|# 3pound
3.0pound
#|kawa:15|# (+ 1pound 5ounce)
1.3125pound
</pre></div>

<p>In this example we define a base unit, the pound, and a unit based on it, the
ounce, which is valued at 0.0625 pounds (one sixteenth).  Numbers can then be
written along with their unit (making them quantities).  Arithmetic is possible 
with quantities, as shown in the last line, and Kawa will do the smart thing
when combining units.  In this case, 1 pound and 5 ounces is combined to make
1.3125 pounds.
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Functions">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Variables" accesskey="n" rel="next">Variables</a>, Previous: <a href="#Tutorial-_002d-Numbers" accesskey="p" rel="prev">Numbers</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Functions"></span><h3 class="section">5.4 Functions</h3>

<p>To declare a new function use <code>define</code>,
which has the following form:
</p><div class="example">
<pre class="example">(define (<var>function-name</var> <var>parameter-names</var>) <var>body</var>)
</pre></div>

<p>This creates a new function named <var>function-name</var>,
which takes <var>parameter-names</var> as parameters.
When the function is called, the  <var>parameter-names</var>
are initialized with the actual arguments. Then <var>body</var>
is evaluated, and its value becomes the result of the call.
</p>
<p>For example, in the <code>factorial</code> function we looked at recently,
the <var>function-name</var> is <code>factorial</code>,
and the <var>parameter-names</var> is <code>x</code>:
</p>
<div class="example">
<pre class="example">(define (factorial x)
  (if (&lt; x 1) 1
  (* x (factorial (- x 1)))))
</pre></div>

<span id="Anonymous-functions"></span><h4 class="subheading">Anonymous functions</h4>


<p>An <em>anonymous</em> function is simply a function which does not have a name.
We define an anonymous function using a <em>lambda expression</em>, which has
the following form:
</p><div class="example">
<pre class="example">(lambda (<var>parameter-names</var>) <var>body</var>)
</pre></div>

<p>The lambda expression has the <var>parameter-names</var> and <var>body</var> of a
function, but it has no name.  What is the point of this?
</p>
<p>An important example is creating a function to act on a list, perhaps using
<code>map</code>.  The <code>map</code> function takes two parameters: the first is a
function which takes a value and returns a value; the second is a list.  Here,
we want to double every number in the list.
</p>
<p>The usual way of doing this is to create a named function, called
<code>double</code>, and then apply it to a list:
</p>
<div class="example">
<pre class="example">#|kawa:1|# (define (double x)
#|.....2|#    (* 2 x))
#|kawa:3|# (map double (list 1 2 3 4 5))
(2 4 6 8 10)
</pre></div>

<p>Instead, anonymous functions make it easy to create a function to work on a
list, without having to define it in advance:
</p>
<div class="example">
<pre class="example">#|kawa:4|# (map (lambda (x) (* 2 x)) (list 1 2 3 4 5))
(2 4 6 8 10)
#|kawa:5|# (define y 3)
#|kawa:6|# (map (lambda (x) (* x y)) (list 1 2 3 4 5))
(3 6 9 12 15)
</pre></div>

<p>The first example shows the double example rewritten as an anonymous function.
The second example shows how the anonymous function can be changed to
fit the place in which it is used: here, the value of <var>y</var> determines the
value by which the list values are multiplied.
</p>
<p>Notice that we can name our anonymous functions, in just the same way we
name any value in Kawa, using <code>define</code>:
</p>
<div class="example">
<pre class="example">(define double
   (lambda (n)
       (* 2 n)))
</pre></div>

<p>although more frequently we use the short-hand for defining functions, which we
have already met:
</p>
<div class="example">
<pre class="example">(define (double n)
  (* 2 n))
</pre></div>

<p>Anonymous functions are &ldquo;first-class values&rdquo; in Kawa, and can be passed to
other functions as arguments (like we did with <code>map</code>), and they can even
be created and returned by functions as results.
</p>
<span id="Optional_002c-rest-and-keyword-parameters"></span><h4 class="subheading">Optional, rest and keyword parameters</h4>

<p>You can declare a function that takes optional arguments,
or a variable number of arguments.  You can also use keyword parameters.
</p>
<p>The following function illustrates the use of <em>optional</em> arguments.  The function
identifies an optional argument <code>z</code>: if the function is called with 3 arguments, <code>z</code>
will be bound to the third value, otherwise it will be <code>#f</code>.
</p>
<div class="example">
<pre class="example">(define (addup x y #!optional z)
  (if z
    (+ x y z)
    (+ x y)))
</pre></div>

<p>The following examples show <code>addup</code> applied to 2, 3 and invalid arguments.  It is an error to
pass just one argument or more than three: <code>x</code> and <code>y</code> are compulsory, but <code>z</code> is
optional.
</p>
<div class="example">
<pre class="example">#|kawa:12|# (addup 1 2)
3
#|kawa:13|# (addup 1 2 3)
6
#|kawa:14|# (addup 1)
/dev/stdin:14:1: call to 'addup' has too few arguments (1; min=2, max=3)
#|kawa:15|# (addup 1 2 3 4)
/dev/stdin:15:1: call to 'addup' has too many arguments (4; min=2, max=3)
</pre></div>

<p>In this example, a better way to define the function would be to include a
default value for <code>z</code>, for when its value is not given by the caller.
This is done as follows, with the same behavior as above:
</p>
<div class="example">
<pre class="example">(define (addup x y #!optional (z 0))
  (+ x y z))
</pre></div>

<p>You can include as many optional parameters as you wish, after the <code>#!optional</code>.
</p>
<p><em>Rest</em> arguments are an alternative way to pass an undefined number of
arguments to a function.  Here is <code>addup</code> written with rest arguments,
notice the variable name after the . (dot):
</p>
<div class="example">
<pre class="example">(define (addup x y . args)
  (+ x y (apply + args)))
</pre></div>

<p>The <code>args</code> are simply a list of all remaining values.  The following now all work, as the
function only requires a minimum of two numbers:
</p>
<div class="example">
<pre class="example">#|kawa:4|# (addup 1 2)
3
#|kawa:5|# (addup 1 2 3)
6
#|kawa:6|# (addup 1 2 3 4 5 6 7 8)
36
</pre></div>

<p>An alternative way to identify the rest args is with <code>#!rest</code>:
</p>
<div class="example">
<pre class="example">(define (addup x y #!rest args)
  (+ x y (apply + args)))
</pre></div>

<p>Finally, it can be useful to identify parameters by name and, for this, Kawa
provides <em>keyword</em> arguments.  Consider the following function:
</p>
<div class="example">
<pre class="example">(define (vector-3d #!key x y z)
  (make-vector x y z))
#|kawa:40|# (vector-3d #:x 2 #:z 3 #:y 4)
#(2 4 3)
</pre></div>

<p><code>vector-3d</code> is defined with three keyword arguments: <code>x</code>, <code>y</code>, and <code>z</code>.  When the
function is called, we identify the name for each value by writing <code>#:</code> at the start of the name.
This allows us to write the arguments in any order.  Keyword parameters can also be given default
values, as with optional parameters.  Keyword parameters with no default value, and no value in the caller,
will get the value <code>#f</code>.
</p>
<p>In the caller, keywords are symbols with <code>#:</code> at the front (or <code>:</code> at
the end): <a href="#Keywords">read more here</a>.
</p>
<p>All these extended types of arguments are available both for &ldquo;named&rdquo; and for &ldquo;anonymous&rdquo; functions.
Optional, rest and keyword arguments can be mixed together, along with the usual arguments.
For details <a href="#Extended-formals">read more here.</a>
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Variables">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Pictures" accesskey="n" rel="next">Composable pictures</a>, Previous: <a href="#Tutorial-_002d-Functions" accesskey="p" rel="prev">Functions</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Variables"></span><h3 class="section">5.5 Variables</h3>

<p>You can declare a variable using a <code>!</code> form.
This takes a variable name, and an expression.  It declares a new
variable with the given name, and gives it the value of the expression.
</p><div class="example">
<pre class="example">#|kawa:1|# (! binary-kilo 1024)
#|kawa:2|# (! binary-mega (* binary-kilo binary-kilo))
#|kawa:3|# binary-mega
1048576
</pre></div>

<p>If you prefer, you can use <code>define</code> instead of <code>!</code>:
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(define binary-kilo 1024)</kbd>
#|kawa:2|# <kbd>(define binary-mega (* binary-kilo binary-kilo))</kbd>
#|kawa:3|# <kbd>binary-mega</kbd>
1048576
</pre></div>

<p>The advantage of using <code>define</code> is that it is portable
to other Scheme implementations.
The advantages of using <code>!</code> is that it is shorter;
it generalizes to patterns (see later);
and it guards against accidentally &ldquo;shadowing&rdquo; a variable
by a nested variable with the same name.
</p>
<p>A <code>!</code> (or <code>define</code>) typed into the command-line
defines a top-level variable.
</p>
<p>You can also declare local variables, which are variables defined for
a given block of code.  For example, in the following code <code>let</code>
is used to set up a local binding of <code>x</code> to 3: this does not affect
the outer binding of <code>x</code> to 5:
</p>
<div class="example">
<pre class="example">(define x 5)

(let ((x 3))
  (display x))  &rArr; 3

(display x)     &rArr; 5
</pre></div>

<p>Alternative forms for defining local variables are
<code>let</code>, <code>let*</code>, or <code>letrec</code>/<code>letrec*</code>.
</p>
<p>The differences are in the order in which definitions are made.
<code>let</code> evaluates all its definitions in the environment holding
at the start of the <code>let</code> statement.  In the following example,
the local variables are defined using values from the global variables:
</p>
<div class="example">
<pre class="example">(define x 5)
(define y 2)

(let ((x (+ 2 y))  ; uses value of global y, i.e. 2
      (y (+ 3 x))) ; uses value of global x, i.e. 5
  (display (list x y)))  &rArr; (4 8)
</pre></div>

<p><code>let*</code> instead evaluates each definition in the environment holding
at the start of the <code>let*</code> statement, along with all <em>previous</em>
local definitions. In the following example, <code>y</code> is now defined with the
<em>local</em> value of <code>x</code>:
</p>
<div class="example">
<pre class="example">(define x 5)
(define y 2)

(let* ((x (+ 2 y))  ; uses value of global y, i.e. 2
       (y (+ 3 x))) ; uses value of local x, i.e. 4
  (display (list x y)))  &rArr; (4 7)
</pre></div>

<p><code>letrec/letrec*</code> are similar, but allow the definition of recursive
functions:
</p>
<div class="example">
<pre class="example">(letrec ((is-even? (lambda (n) (and (not (= 1 n))
                                    (or (zero? n)
                                        (is-odd? (- n 1))))))
         (is-odd? (lambda (n) (and (not (zero? n))
                                   (or (= 1 n)
                                       (is-even? (- n 1)))))))
  (display (is-even? 11)))   &rArr; #f
</pre></div>

<hr>
</div>
<div class="section" id="Tutorial-_002d-Pictures">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Sequences" accesskey="n" rel="next">Lists and sequences</a>, Previous: <a href="#Tutorial-_002d-Variables" accesskey="p" rel="prev">Variables</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Composable-pictures-1"></span><h3 class="section">5.6 Composable pictures</h3>

<p>The <code>pictures</code> library lets you create geometric shapes
and images, and combine them in interesting ways.
You first need to import the library:
</p><div class="example">
<pre class="example">(import (kawa pictures))
</pre></div>
<p>The easiest way to use and learn the library
is with a suitable REPL, where you can type
expressions that evaluate to pictures values,
and view the resulting pictures directly on the console.
The easiest way is to start the <code>kawa</code> command with the <code>-w</code>
flag.  Alternatively, you can use
a <a href="#Using-DomTerm">DomTerm</a>-based terminal emulator
such as <code>qtdomterm</code> (which is shown in the image below),
and then the <code>kawa</code> command.
</p>
<img src="images/domterm-pictures-1.png" alt="images/domterm-pictures-1">

<p>The above image shows two simple examples: a filled
circle (radius 30 pixels, color magenta), and a non-filled rotated rectangle
(color maroon 3-pixel wide strokes).
</p>
<p>See <a href="#Composable-pictures">Composable pictures</a> for details and more examples.
</p>
<span id="Shapes-and-coordinates"></span><h4 class="subheading">Shapes and coordinates</h4>

<p>A <em>shape</em> is a geometrical figure consisting of
one or more curves and lines.  One kind of shape is a circle;
you can create one with the <code>circle</code> procedure,
specifying the radius in &ldquo;pixels&rdquo;.
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(import (kawa pictures))</kbd>
#|kawa:2|# <kbd>(circle 30)</kbd>
<img src="images/fill-circ-1.png" alt="images/fill-circ-1">
</pre></div>
<p>It you print a shape, it will show it as a thin black curve.
</p>
<p>A <em>point</em> has two real-numbered parts: the point&rsquo;s x-coordinate,
and its y-coordinate.
The x-coordinate increases as you move right along the page/screen,
while the y-coordinate increases as you move <em>down</em>.
(Unlike traditional mathematics, where
the y-coordinate increases as you go up.)
The unit distance is one &ldquo;pixel&rdquo;, which is defined as CSS or HTML.
You can create a point with <code>&amp;P</code> operator.
For example:
</p><div class="example">
<pre class="example">&amp;P[30 20]
</pre></div>
<p>is a point 30 pixels right and 20 pixels down from the origin point.
To create a circle centered on that point do <code>(center 30 &amp;P[30 20])</code>.
</p>
<p>The expression <code>(rectangle &amp;P[10 20] &amp;P[50 40])</code> creates
a rectangle whose upper left corner is (10,20) and whose
lower right corner is (50,40).
</p>
<p>A <em>dimension</em> is a pair, a width and height,
and is written:
</p><div class="example">
<pre class="example">&amp;D[<var>width</var> <var>height</var>]
</pre></div>
<p>In addition to being used for sizes,
a dimension is also used for relative offsets.
For example, the previous rectangle could also
be written  <code>(rectangle &amp;P[10 20] &amp;D[40 20])</code>.
</p>
<p>You can use <code>line</code> to create a line.
More generally, if you specify <var>n</var> points you get a
<em>polyline</em> of <var>n-1</var> line segments:
</p><div class="example">
<pre class="example">#|kawa:3|# <kbd>(line &amp;P[10 20] &amp;P[50 60] &amp;P[90 0])</kbd>
<img src="images/polyline-1.png" alt="images/polyline-1">
</pre></div>
<p>The same line using dimensions for relative offsets:
</p><div class="example">
<pre class="example">#|kawa:4|# <kbd>(line &amp;P[10 20] &amp;D[40 20] &amp;D[40 -60])</kbd>
</pre></div>

<p>A <em>closed shape</em> is one whose end point is the same as its start point.
The <code>polygon</code> function creates one using straight line segments
</p><div class="example">
<pre class="example">#|kawa:5|# <kbd>(polygon &amp;P[10 20] &amp;P[50 60] &amp;P[90 0])</kbd>
<img src="images/polygon-1.png" alt="images/polygon-1">
</pre></div>

<span id="Colors-and-filling"></span><h4 class="subheading">Colors and filling</h4>

<p>You can override the default color (black) using the
<code>with-paint</code> procedure, which takes a color and a picture
to produce a new picture:
</p><div class="example">
<pre class="example">#|kawa:6|# <kbd>(with-paint 'red (circle 32))</kbd>
</pre></div>

<p>The first argument can be either one of the standard CSS/HTML5 color
names (such as <code>'red</code> or <code>'medium-slate-blue</code>),
or an integer representing an sRGB color, usually written
as a hex literal in the form <code>#xRRGGBB</code>:
</p><div class="example">
<pre class="example">#|kawa:7|# <kbd>(with-paint #x0808FF (circle 32))</kbd>
</pre></div>

<p>The name <code>with-paint</code> is because the first argument
can be not just a color, but a general &ldquo;paint&rdquo;, such as
a gradient or a background image.  However, we won&rsquo;t go into that.
</p>
<p>If the shape is closed, you can &ldquo;fill&rdquo; its inside:
</p><div class="example">
<pre class="example">(fill (circle 32))
</pre></div>

<p>You can change the color using <code>with-paint</code>:
</p><div class="example">
<pre class="example">(with-paint 'goldenrod (fill (circle 32)))
</pre></div>
<p>or as an extra argument to <code>fill</code>:
</p><div class="example">
<pre class="example">(fill 'goldenrod (circle 32))
</pre></div>

<p>draw TODO
</p>
<span id="Images-1"></span><h4 class="subheading">Images</h4>
<p>An image is a picture represented as a rectangular grid of color values.
It may be a photograph from a camera, or be created by a painting
program like Photoshop or gimp.
You can use <code>image-read</code> to read an image from a file,
typically a <code>.png</code> or <code>.jpg</code> file.
</p>
<div class="example">
<pre class="example">#|kawa:10|# <kbd>(define img1 (image-read &quot;http://pics.bothner.com/2013/Cats/06t.jpg&quot;))</kbd>
#|kawa:11|# <kbd>img1</kbd>
<img src="images/image-cat-1a.png" alt="images/image-cat-1a">
</pre></div>

<span id="Transforms-TODO"></span><h4 class="subheading">Transforms TODO</h4>

<div class="example">
<pre class="example">#|kawa:12|# <kbd>(scale 0.6 (rotate 30 img1))</kbd>
<img src="images/image-cat-1b.png" alt="images/image-cat-1b">
</pre></div>

<span id="Combining-and-adjusting-pictures-TODO"></span><h4 class="subheading">Combining and adjusting pictures TODO</h4>

<span id="Using-and-combining-pictures-TODO"></span><h4 class="subheading">Using and combining pictures TODO</h4>

<hr>
</div>
<div class="section" id="Tutorial-_002d-Sequences">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Objects" accesskey="n" rel="next">Creating and using objects</a>, Previous: <a href="#Tutorial-_002d-Pictures" accesskey="p" rel="prev">Composable pictures</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Lists-and-sequences"></span><h3 class="section">5.7 Lists and sequences</h3>

<p>A <em>sequence</em> is a generalized array or list:
Zero or more values treated as a compound value.
Sequences have certain common operations, including indexing and iteration.
(<i>Technical note:</i> Sequences generally implement the <code>java.util.List</code>
interface, but Kawa will also treat strings and native
Java arrays as sequences.)
</p>
<span id="Lists-2"></span><h4 class="subheading">Lists</h4>

<p>In traditional Lisp-family languages, the <em>list</em> is the
most important kind of sequence.
(Don&rsquo;t confuse Java&rsquo;s <code>List</code> interface with Kawa&rsquo;s use of the
word <i>list</i>.  They&rsquo;re related, in that a Kawa &ldquo;list&rdquo; implements
the <code>List</code> interface, so any <i>list</i> is also <code>List</code>,
but not vice versa.)
</p>
<p>A list is implemented as a chain of linked <em>pairs</em>.
You can create a constant list by quoting a parenthesized list:
</p><div class="example">
<pre class="example">'(3 4 (10 20 30) &quot;a string&quot;)
</pre></div>

<p>See <a href="#Lists">Lists</a> for details and operations.
</p>
<span id="Vectors-2"></span><h4 class="subheading">Vectors</h4>

<p>A <em>vector</em> is a sequence that is implemented by storing the elements
side-by-side in memory.
A vector uses less space than a list of the same length,
and is generally more efficient than a list.
</p>
<p>To create a vector you can use a bracketed list:
</p><div class="example">
<pre class="example">(! vec1 ['A 'B 'C 'D 'E 'F])
</pre></div>
<p>This creates a vector of 6 symbols and binds it to <code>vec1</code>.
To select an element you can use the traditional
<code>vector-ref</code> procedure:
</p><div class="example">
<pre class="example">(vector-ref vec1 3) &rArr; 'D
</pre></div>
<p>Alternatively, in Kawa you can use function-call notation:
</p><div class="example">
<pre class="example">(vec1 3) &rArr; 'D
</pre></div>

<p>You can also create a vector using the traditional <code>vector</code> constructor:
</p><div class="example">
<pre class="example">(! vec2 (vector 'A 'B 'C 'D 'E 'F))
</pre></div>
<p>There is one important difference between <code>vec1</code> and <code>vec2</code>:
You can modify <code>vec2</code> by changing some or all of its elements.
You can&rsquo;t do that for <code>vec1</code>.
(We say that <code>vec1</code> is an <em>immutable</em> or <em>constant</em> vector,
while  <code>vec1</code> is a <em>mutable</em> or <em>modifiable</em> vector.)
To change an element use either the traditional <code>vector-set!</code>
procedure, or function-call notation:
</p><div class="example">
<pre class="example">(vector-set! vec2 2 'Y)
(set! (vec2 4) 'Z)
vec2 &rArr; ['A 'B 'Y 'D 'Z 'F]
(vector-set! vec1 2 'Y) &rArr; <i>throws exception</i>
</pre></div>

<p>See <a href="#Vectors">Vectors</a> for details and operations.
</p>
<span id="Java-arrays-and-primitive-vectors"></span><h4 class="subheading">Java arrays and primitive vectors</h4>

<p>See <a href="#Array-operations">Using Java arrays</a> for examples.
</p>
<span id="Indexing-of-general-sequences"></span><h4 class="subheading">Indexing of general sequences</h4>

<p>You can use function-call notation to index a generalized sequence,
whether it is a list, vector, any <code>java.util.List</code>,
native Java array, or string:
</p><div class="example">
<pre class="example">((list 'A 'B 'C 'D) 2)  &rArr; 'C
(&quot;abcdef&quot; 3)  &rArr;  &rArr;
(! farr (float[] 1.5 3 4.5))  ;; native Java array
(farr 2) &rArr; 4.5
</pre></div>

<p>Note that indexing a list with an index <var>i</var> will be slow, since it
has to step through the list <var>i</var> times.  (So don&rsquo;t do that!)
</p>
<span id="Ranges-2"></span><h4 class="subheading">Ranges</h4>

<p>A <em>range</em> is a sequence of numbers in order,
spaced uniformly apart.  Usually, these are (exact) integers
that increase by one.  The usual notation is:
</p><div class="example">
<pre class="example">[<var>start</var> &lt;: <var>end</var>]
</pre></div>
<p>This is the sequence of integers starting with the integer <var>start</var>
(inclusive) and ending with the integer <var>end</var> (exclusive).
For example <code>[3 &lt;: 7]</code> is the sequence <code>[3 4 5 6]</code>.
</p>
<p>The &lsquo;<samp>&lt;:</samp>&rsquo; is a keyword; the <code>&lt;</code> is a mnemonic for the
set of integers that are <code>&lt;</code> the end value 6.
You can also use <code>&lt;=:</code> if you want to include the upper bound:
<code>[4 &lt;=: 8]</code> is <code>[4 5 6 7 8]</code>.
</p>
<p>You can use <code>&gt;=:</code> or <code>&gt;:</code> for a decreasing range.
<code>[5 &gt;=: 1]</code> or <code>[5 &gt;: 0]</code> both evaluate to <code>[5 4 3 2 1]</code>.
You can also specifify a step value: <code>[1 by: 2 &lt;=: 9]</code>,
which evaluates to <code>[1 3 5 7 9]</code>.
(<a href="#Ranges">Details here</a>.)
</p>
<span id="Using-vector-and-ranges-indexes"></span><h4 class="subheading">Using vector and ranges indexes</h4>

<p>If an index is a sequence of integers,
the result is a new sequence (of the same type)
selecting only the elements matching the index values.
For example:
</p><div class="example">
<pre class="example">#|kawa:2|# <kbd>(vec1 [3 5 2])</kbd>
#(D F C)
</pre></div>
<p>In general, <code>((V1 V2) I)</code> is <code>(V1 (V2 I))</code>.
</p>
<p>You can use a range to create a slice - a contiguous subset of a list.
</p><div class="example">
<pre class="example">#|kawa:3|# <kbd>(vec1 [2 &lt;: 6])</kbd>
#(C D E F)
</pre></div>

<p>A range is different from a vector integer in that you can use
a range as the index in the LHS of a set!:
</p>
<div class="example">
<pre class="example">#|kawa:4|# <kbd>(set! (vec1 [2 &lt;: 4]) #(a b c d e))</kbd>
#|kawa:5|# <kbd>vec1</kbd>
#(A B a b c d e E F)
</pre></div>

<p>Notice how the number of replaced elements can be different
then the number of elements in the replacement value.
I.e. you can do insertion and deletion this way.
</p>
<div class="example">
<pre class="example">#|kawa:7|# <kbd>(! str1 (string-copy &quot;ABCDEF&quot;))</kbd>
#|kawa:8|# <kbd>(set! (str1 [2 &lt;: 5]) &quot;98&quot;)</kbd>
AB98F
</pre></div>

<hr>
</div>
<div class="section" id="Tutorial-_002d-Objects">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Types" accesskey="n" rel="next">Types and declarations</a>, Previous: <a href="#Tutorial-_002d-Sequences" accesskey="p" rel="prev">Lists and sequences</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Creating-and-using-objects"></span><h3 class="section">5.8 Creating and using objects</h3>

<p>An <em>object</em> is a value that has the following features:
</p><ul>
<li> class - each object is an instance of a specific class,
making it part of the class hierarchy, which is an important
aspect of the type system;
</li><li> properties - various fields and methods, depending on the class;
</li><li> identity - it is distinct from all other objects,
even if all the properties are the same.
</li></ul>

<p>We later discuss <a href="#Tutorial-_002d-Classes">how to write a new class</a>.
Here we assume you&rsquo;re using an existing class, which
could be written in Java or Scheme.
</p>
<span id="Creating-a-new-object"></span><h4 class="subheading">Creating a new object</h4>

<p>To create a new object of class <code>T</code> you call <code>T</code> as if it
were a function, passing it the various constructor arguments:
</p><div class="example">
<pre class="example">(java.io.File &quot;src&quot; &quot;build.xml&quot;)
</pre></div>

<p>If there are keyword arguments they are used to initialize
the corresponding named properties:
</p><div class="example">
<pre class="example">(! button1 (javax.swing.JButton text: &quot;Do it!&quot; tool-tip-text:  &quot;do it&quot;))
</pre></div>
<p>This create a new <code>JButton</code> object (using <code>JButton</code>&rsquo;s
default constructor), and sets the <code>text</code> and <code>tool-tip-text</code>
properties (by calling <code>JButton</code>&rsquo;s <code>setText</code>
and <code>setToolTipText</code> methods).
If there are constructor arguments, they must come before the keywords.
</p>
<p>For objects that have components or elements, you
can list these at the end.  For example:
</p><div class="example">
<pre class="example">(java.util.ArrayList 11 22 33)
</pre></div>
<p>This creates a fresh <code>java.util.ArrayList</code> (using the
default constructor), and then calls the <code>add</code> method 3 times.
</p>
<p>If you prefer you can use the <code>make</code> procedure,
but that only handle simple constructor calls:
</p><div class="example">
<pre class="example">(make java.io.File &quot;src&quot; &quot;build.xml&quot;)
</pre></div>

<p>See <a href="#Allocating-objects">Allocating objects</a> for details.
</p>
<span id="Calling-instance-methods"></span><h4 class="subheading">Calling instance methods</h4>

<p>Given an object <var>obj</var> of a class that has a method <var>meth</var>,
you can call it with argumens <var>v1</var> ... <var>v2</var> using <a href="#Colon-notation">Property access using colon notation</a>:
</p><div class="example">
<pre class="example">(<var>obj</var>:<var>meth</var> <var>v1</var> ... <var>v2</var>)
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(button1:paintImmediately 10 10 30 20)
</pre></div>

<p>If you prefer, you can use the <code>invoke</code> procedure,
normally with a quoted method name:
</p><div class="example">
<pre class="example">(invoke button1 'paintImmediately 10 10 30 20)
</pre></div>
<p>You need to use <code>invoke</code> (rather than colon notation)
if <var>obj</var> is a <code>Class</code> or a type expression, or its class
implements <code>gnu.mapping.HasNamedParts</code>.
</p>
<p>See <a href="#Method-operations">Calling Java methods from Scheme</a> for details.
</p>
<span id="Accessing-properties"></span><h4 class="subheading">Accessing properties</h4>

<p>If <var>obj</var> has a field or property named <var>fld</var> you can also use colon
notation:
</p><div class="example">
<pre class="example"><var>obj</var>:<var>fld</var>
</pre></div>

<p>You use the same syntax whether <var>fld</var> is an actual field in the
object, or a <em>property</em> (in the Java Beans sense).  The
latter is implemented using a getter/setter pair:
Methods named <code>get<var>F</var></code> and  <code>set<var>F</var></code>, respectively.
For example:
</p><div class="example">
<pre class="example">button1:tool-tip-text
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(button1:getToolTipText)
</pre></div>

<p>You can also change a field or property using colon notation:
</p><div class="example">
<pre class="example">(set! <var>obj</var>:<var>fld</var> <var>value</var>)
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(set! button1:tool-tip-text &quot;really do it!&quot;)
</pre></div>
<p>This is equivalent to:
</p><div class="example">
<pre class="example">(button1:setToolTipText &quot;really do it!&quot;)
</pre></div>

<p>Instead of colon notation, you can use the <code>field</code> procedure.
</p>
<p>See <a href="#Field-operations">Accessing object fields</a> for details.
</p>
<span id="Static-fields-and-methods"></span><h4 class="subheading">Static fields and methods</h4>

<p>Kawa views static properties and methods as
properties and methods of the class itself.
To call a static method use the syntax:
</p><div class="example">
<pre class="example">(<var>clas</var>:<var>meth</var> <var>v1</var> ... <var>vn</var>)
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(java.math.BigDecimal:valueOf 12345 2) &rArr; 123.45
</pre></div>

<p>To access a static field do <code><var>clas</var>:<var>fld</var></code>.  For example:
</p><div class="example">
<pre class="example">java.awt.Color:RED
</pre></div>

<p>You can also use the <code>static-field</code> and <code>invoke-static</code> procedures.
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Types">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Exceptions-and-errors" accesskey="n" rel="next">Exceptions and errors</a>, Previous: <a href="#Tutorial-_002d-Objects" accesskey="p" rel="prev">Creating and using objects</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Types-and-declarations"></span><h3 class="section">5.9 Types and declarations</h3>

<p>A <em>type</em> is a named value for a set
of objects with related properties.
For example, <code>vector</code> is the type for standard Scheme vectors.
You can use a type to specify that a variable can only have
values of the specified type:
</p>
<div class="example">
<pre class="example">#|kawa:5|# <kbd>(define v ::vector #(3 4 5))</kbd>
#|kawa:6|# <kbd>v</kbd>
#(3 4 5)
#|kawa:7|# <kbd>(set! v 12)</kbd>
/dev/stdin:7:1: warning - cannot convert literal (of type gnu.math.IntNum) to vector
Value (12) for variable 'v' has wrong type (gnu.math.IntNum) (gnu.math.IntNum cannot be cast to gnu.lists.FVector)
	at atInteractiveLevel$7.run(stdin:7)
	at gnu.expr.ModuleExp.evalModule(ModuleExp.java:302)
	at kawa.Shell.run(Shell.java:275)
	at kawa.Shell.run(Shell.java:186)
	at kawa.Shell.run(Shell.java:167)
	at kawa.repl.main(repl.java:870)
Caused by: java.lang.ClassCastException: gnu.math.IntNum cannot be cast to gnu.lists.FVector
	... 6 more
</pre></div>

<p>Using a type specification catches errors, and makes your programs
more readable.  It can also allow the Kawa compiler to generate code
that runs faster.
</p>
<p>You can use a type to check that a value is an instance of the type,
using either the <code>instance?</code> function:
</p>
<div class="example">
<pre class="example">(instance? #(3 4 5) vector) &rArr; #t
(instance? '(3 4 5) vector) &rArr; #f
</pre></div>

<p>As a convenience, you can use a type-name followed by a &ldquo;<code>?</code>&rdquo;:
</p><div class="example">
<pre class="example">(<var>type</var>? <var>val</var>) == (instance? <var>val</var> <var>type</var>)
</pre></div>

<p>You can &ldquo;call&rdquo; a type as if it were a function,
which constructs a new instance of the type.
The following example shows how to construct a normal Scheme vector,
and a Java array of ints:
</p>
<div class="example">
<pre class="example">|kawa:1|# (vector )
#()
#|kawa:2|# (instance? (vector ) vector)
#t
#|kawa:3|# (define x (int[] 1 2 3))
#|kawa:4|# x
[1 2 3]
#|kawa:5|# (instance? x int[])
#t
</pre></div>

<p>A fully-qualified Java class is a type name.
So are the names of Java primitive types.
So are Java array types, as shown above.
</p>
<p>e.g. a JFrame is constructed by using its class name as a function:
</p>
<div class="example">
<pre class="example">#|kawa:6|# (javax.swing.JFrame )
javax.swing.JFrame[frame0,0,25,0x0,invalid,hidden,layout=java.awt.BorderLayout,
title=,resizable,normal,defaultCloseOperation=HIDE_ON_CLOSE,
rootPane=javax.swing.JRootPane[,0,0,0x0,invalid,
layout=javax.swing.JRootPane$RootLayout,alignmentX=0.0,alignmentY=0.0,border=,
flags=16777673,maximumSize=,minimumSize=,preferredSize=],rootPaneCheckingEnabled=true]
</pre></div>

<p>A type is a true run-time value:
</p>
<div class="example">
<pre class="example">(define mytypes (list vector list string))
(instance? #(3 4 5) (car mytypes) &rArr; #t
</pre></div>

<p>The <code>define-alias</code> form is useful for defining shorter names
for types, like a generalization of Java&rsquo;s <code>import</code> statement:
</p>
<div class="example">
<pre class="example">(define-alias jframe javax.swing.JFrame)
</pre></div>

<hr>
</div>
<div class="section" id="Tutorial-_002d-Exceptions-and-errors">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Classes" accesskey="n" rel="next">Classes</a>, Previous: <a href="#Tutorial-_002d-Types" accesskey="p" rel="prev">Types and declarations</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Exceptions-and-errors"></span><h3 class="section">5.10 Exceptions and errors</h3>

<p>Kawa supports the exception framework and forms
from R6RS and R7RS.  See <a href="#Exceptions">Exception handling</a> for details.
</p>
<span id="Native-exception-handling-1"></span><h4 class="subheading">Native exception handling</h4>

<p>You can also work with native Java exceptions at a low level.
</p>
<p>The <code>primitive-throw</code> procedure throws a <code>Throwable</code> value.
It is implemented just like Java&rsquo;s <code>throw</code>.
</p><div class="example">
<pre class="example">(primitive-throw (java.lang.IndexOutOfBoundsException &quot;bad index&quot;))
</pre></div>

<p>You can catch an exception with the <code>try-catch</code> syntax.  For example:
</p><div class="example">
<pre class="example">(try-catch
  (do-a-bunch-of-stuff)
  (ex java.lang.Throwable
    (format #f &quot;caught ~a~%~!&quot; ex)
    (exit)))
</pre></div>

<p>A <code>try-finally</code> does the obvious:
</p><div class="example">
<pre class="example">(define (call-with-port port proc)
  (try-finally
   (proc port)
   (close-port port)))
</pre></div>

<p>Both <code>try-catch</code> and <code>try-finally</code> are
expression forms that can return values, while the corresponding
Java forms are statements that cannot return values.
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Classes">
<div class="header">
<p>
Next: <a href="#Tutorial-_002d-Other-Java-features" accesskey="n" rel="next">Other Java features</a>, Previous: <a href="#Tutorial-_002d-Exceptions-and-errors" accesskey="p" rel="prev">Exceptions and errors</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Classes"></span><h3 class="section">5.11 Classes</h3>

<p>See <a href="#Defining-new-classes">Defining new classes</a> for the gory details; no tutorial yet.
</p>
<hr>
</div>
<div class="section" id="Tutorial-_002d-Other-Java-features">
<div class="header">
<p>
Previous: <a href="#Tutorial-_002d-Classes" accesskey="p" rel="prev">Classes</a>, Up: <a href="#Tutorial" accesskey="u" rel="up">Kawa Scheme Tutorial</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Other-Java-features"></span><h3 class="section">5.12 Other Java features</h3>

<span id="Import"></span><h4 class="subheading">Import</h4>

<p>The <code>import</code> form can be used to avoid having to write
fully-qualified class names.  For example:
</p><div class="example">
<pre class="example">(import (class java.util
               Map
               (HashMap HMap)))
</pre></div>
<p>This defines aliases for two classes in the <code>java.util</code> package,
one with renaming:
<code>Map</code> is an alias for <code>java.util.Map</code>,
and <code>HMap</code> is an alias for <code>java.util.HashMap</code>.
</p>
<p>The <code>class</code> keyword is needed because the <code>import</code>
form is also used for Kawa&rsquo;s module system.
See <a href="#importing_002dclass_002dnames">importing-class-names</a> and <a href="#Importing">Importing from a library</a> for details.
</p>
<span id="Synchronized-blocks"></span><h4 class="subheading">Synchronized blocks</h4>

<p>You can use a <code>synchronized</code> expression:
</p>
<div class="example">
<pre class="example">(synchronized obj form1 ... formn)
</pre></div>
<p>This waits until it can get an exclusive lock on <var>obj</var>
and then evaluates <var>form1</var> through <var>formn</var>.
Unlike Java, this is an expression and returns the value of <var>formn</var>.
</p>
<span id="Annotations-1"></span><h4 class="subheading">Annotations</h4>

<p>You can write annotation declarations - see <a href="#Annotations">Annotations of declarations</a> for details.
</p>
<p>Kawa does not yet support annotations on types,
or declaring new annotation classes.
</p>
<hr>
</div>
</div>
</div>
<div class="part" id="Reference-Documentation">
<div class="header">
<p>
Next: <a href="#Syntax" accesskey="n" rel="next">Syntax</a>, Previous: <a href="#Tutorial" accesskey="p" rel="prev">Kawa Scheme Tutorial</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<h1 class="part">Reference Documentation</h1>
<hr>

<ul class="section-toc">
<li><a href="#Running" accesskey="1">How to start up and run Kawa</a></li>
<li><a href="#Syntax" accesskey="2">Syntax</a></li>
<li><a href="#Program-structure" accesskey="3">Program structure</a></li>
<li><a href="#Control-features" accesskey="4">Control features</a></li>
<li><a href="#Symbols-and-namespaces" accesskey="5">Symbols and namespaces</a></li>
<li><a href="#Procedures" accesskey="6">Procedures</a></li>
<li><a href="#Numbers" accesskey="7">Quantities and Numbers</a></li>
<li><a href="#Characters-and-text" accesskey="8">Characters and text</a></li>
<li><a href="#Data-structures" accesskey="9">Data structures</a></li>
<li><a href="#Eval-and-Environments">Eval and Environments</a></li>
<li><a href="#Debugging">Debugging</a></li>
<li><a href="#Input_002dOutput">Input, output, and file handling</a></li>
<li><a href="#Types">Types</a></li>
<li><a href="#Objects-Classes-and-Modules">Object, Classes and Modules</a></li>
<li><a href="#XML-tools">Working with XML and HTML</a></li>
<li><a href="#Miscellaneous">Miscellaneous topics</a></li>
<li><a href="#FAQs">Frequently Asked Questions</a></li>
<li><a href="#Framework">The Kawa language framework</a></li>
<li><a href="#License">License</a></li>
</ul>
<div class="chapter" id="Running">
<span id="How-to-start-up-and-run-Kawa"></span><h2 class="chapter">6 How to start up and run Kawa</h2>

<p>The easiest way to start up Kawa is to run the &lsquo;<samp>kawa</samp>&rsquo; program.
This finds your Java interpreter, and sets up &lsquo;<samp>CLASSPATH</samp>&rsquo; correctly.
If you have installed Kawa such that <code>$PREFIX/bin</code> is in your <code>$PATH</code>,
just do:
</p><div class="example">
<pre class="example">kawa
</pre></div>
<p>However, &lsquo;<samp>kawa</samp>&rsquo; only works if you have a Unix-like environment.
On some platforms, &lsquo;<samp>kawa</samp>&rsquo; is a program that uses the GNU
&lsquo;<samp>readline</samp>&rsquo; library to provide input line editing.
</p>
<p>To run Kawa manually, you must start a Java Virtual Machine.
How you do this depends on the Java implementation.
For Oracle&rsquo;s JDK, and some other implementations, you must have the
Java evaluator (usually named <code>java</code>) in your <code>PATH</code>.
You must also make sure that the <code>kawa/repl.class</code> file,
the rest of the Kawa packages, and the standard Java
packages can be found by searching CLASSPATH.
See <a href="#Running-Java">Getting and running Java</a>.
</p>
<p>Then you do:
</p><div class="example">
<pre class="example">java kawa.repl
</pre></div>

<p>In either case, you will then get the &lsquo;<samp>#|kawa:1|#</samp>&rsquo; prompt,
which means you are
in the Kawa read-eval-print-loop.  If you type a Scheme
expression, Kawa will evaluate it.  Kawa will then print the
result (if there is a non-&quot;void&quot; result).
</p>

<ul class="section-toc">
<li><a href="#Options" accesskey="1">Command-line arguments</a></li>
<li><a href="#Scripts" accesskey="2">Running Command Scripts</a></li>
<li><a href="#REPL-Console" accesskey="3">The REPL (read-eval-print-loop) console</a></li>
<li><a href="#Exiting" accesskey="4">Exiting Kawa</a></li>
<li><a href="#Compiling" accesskey="5">Compiling to byte-code</a></li>
</ul>
<hr>
<div class="section" id="Options">
<div class="header">
<p>
Next: <a href="#Scripts" accesskey="n" rel="next">Running Command Scripts</a>, Previous: <a href="#Running" accesskey="p" rel="prev">How to start up and run Kawa</a>, Up: <a href="#Running" accesskey="u" rel="up">How to start up and run Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Command_002dline-arguments"></span><h3 class="section">6.1 Command-line arguments</h3>

<span id="index-options"></span>
<p>You can pass various flags to Kawa, for example:
</p><div class="example">
<pre class="example">kawa -e '(display (+ 12 4))(newline)'
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">java kawa.repl -e '(display (+ 12 4))(newline)'
</pre></div>
<p>Either causes Kawa to print &lsquo;<samp>16</samp>&rsquo;, and then exit.
</p>
<p>At startup, Kawa executes an init file from the user&rsquo;s home
directory.
The init file is named <code>.kawarc.scm</code> on Unix-like systems
(those for which the file separator is <code>'/'</code>),
and <code>kawarc.scm</code> on other systems.
This is done before the read-eval-print loop
or before the first <code>-f</code> or <code>-c</code> argument.  (It is not run
for a <code>-e</code> command, to allow you to set options to override
the defaults.)
</p>
<ul class="section-toc">
<li><a href="#Argument-processing" accesskey="1">Argument processing</a></li>
<li><a href="#General-options" accesskey="2">General options</a></li>
<li><a href="#Options-for-language-selection" accesskey="3">Options for language selection</a></li>
<li><a href="#Options-for-warnings-and-errors" accesskey="4">Options for warnings and errors</a></li>
<li><a href="#Options-for-setting-variables" accesskey="5">Options for setting variables</a></li>
<li><a href="#Options-for-the-REPL-console" accesskey="6">Options for the REPL console</a></li>
<li><a href="#Options-for-controlling-output-formatting" accesskey="7">Options for controlling output formatting</a></li>
<li><a href="#Options-for-compiling-and-optimizing" accesskey="8">Options for compiling and optimizing</a></li>
<li><a href="#Options-for-debugging" accesskey="9">Options for debugging</a></li>
<li><a href="#Options-for-web-servers">Options for web servers</a></li>
<li><a href="#Options-for-the-JVM">Options for the JVM</a></li>
</ul>
<div class="subsection" id="Argument-processing">
<h4 class="subsection">6.1.1 Argument processing</h4>

<p>Kawa processes the command-line arguments in order.
Options (which either start with &lsquo;<samp>-</samp>&rsquo; or contain a &lsquo;<samp>=</samp>&rsquo;)
may &ldquo;use up&rdquo; one or more command arguments.
Some of the options (&lsquo;<samp>-c</samp>&rsquo;, &lsquo;<samp>-e</samp>&rsquo;, &lsquo;<samp>-f</samp>&rsquo;, &lsquo;<samp>-s</samp>&rsquo;,
&lsquo;<samp>-C</samp>&rsquo;, <code>-w</code>, &lsquo;<samp>--</samp>&rsquo;, <code>--browse-manual</code>)
are <em>action options</em>; others set various properties.
</p>
<p>When all the command-line arguments have been &ldquo;used up&rdquo;
and if no action options have been seen,
then Kawa enters an interactive read-eval-print loop.
(If an action option has been seen, we&rsquo;re done.)
</p>
<p>If the next command-line argument is not an option
(does not start with &lsquo;<samp>-</samp>&rsquo; nor contains a &lsquo;<samp>=</samp>&rsquo;)
then we&rsquo;re done if we&rsquo;ve seen an action option (and the
last action option wasn&rsquo;t preceded by <code>--with-arg-count</code>).
(Presumably any remaining arguments were command-line-arguments
used by the action option.)
</p>
<p>Otherwise, the first remaining argument names either a
file that is read and evaluated, or a compiled class.
In the former case, the whole file is read and compiled as a module
before being loaded (unlike the <code>-f</code> flag which reads and
evaluates the file command by command.)
If the argument is the fully-qualified name of a class,
then the class is loaded, an instance allocated,
and its <code>run</code> method invoked.  If the class was compiled from
a Kawa Scheme module, then invoking <code>run</code> has the
effect of evaluating the module body.
The <code>command-line-arguments</code> vector is set to any remaining
arguments after the file/class name.
(This can be overridden with the <code>--with-arg-count</code> option.
Command-line processing continues if there are any further arguments.)
</p>
</div>
<div class="subsection" id="General-options">
<h4 class="subsection">6.1.2 General options</h4>

<dl compact="compact">
<dt><span><code>-e <var>expr</var></code></span></dt>
<dd><p>Kawa evaluates <var>expr</var>, which contains one or more Scheme expressions.
Does not cause the <code>~/.kawarc.scm</code> init file to be run.
</p></dd>
<dt><span><code>-c <var>expr</var></code></span></dt>
<dd><p>Same as &lsquo;<samp>-e <var>expr</var></samp>&rsquo;, except that it
does cause the <code>~/.kawarc.scm</code> init file to be run.
</p></dd>
<dt><span><code>-f <var>filename-or-url</var></code></span></dt>
<dd><p>Kawa reads and evaluates expressions from the file named
by <var>filename-or-url</var>.  If the latter is &lsquo;<samp>-</samp>&rsquo;,
standard input is read (with no prompting).  Otherwise,
it is equivalent to evaluating &lsquo;<samp>(load &quot;<var>filename-or-url</var>&quot;)</samp>&rsquo;.
The <var>filename-or-url</var> is interpreted as a URL
if it is absolute - it starts with a &quot;URI scheme&quot; like <code>http:</code>.
</p></dd>
<dt><span><code>-s</code></span></dt>
<dt><span><code>--</code></span></dt>
<dd><p>The remaining arguments (if any) are passed to &lsquo;<samp>command-line-arguments</samp>&rsquo;
and (the <code>cdr</code> of) <code>(command-line</code>),
and an interactive read-eval-print loop is started.
This uses the same &quot;console&quot; as where you started up Kawa;
use &lsquo;<samp>-w</samp>&rsquo; to get a new window.
</p></dd>
<dt><span><code>--script <var>filename-or-url</var></code></span></dt>
<dt><span><code>--script<var>N</var> <var>filename-or-url</var></code></span></dt>
<dd><p>The global variable &lsquo;<samp>command-line-arguments</samp>&rsquo; is set to the remaining
arguments (if any).
Kawa reads and evaluates expressions from the file named
by <var>filename-or-url</var>.
If <code>script</code> is followed by an integer <var>N</var>,
then <var>N</var> lines are skipped first.
</p>
<p>Skipping some initial lines is useful if you want to have a non-Kawa
preamble before the actual Kawa code.
One use for this is for Kawa shell scripts (see <a href="#Scripts">Running Command Scripts</a>).
</p>
</dd>
<dt><span><code>-w</code></span></dt>
<dt><span><code>-w<var>sub-option</var></code></span></dt>
<dd><p>Creates a new top-level window, and runs an interactive read-eval-print
in the new window.  See <a href="#New_002dWindow">New-Window</a>.
Same as <code>-e (scheme-window #t)</code>.
You can specify multiple &lsquo;<samp>-w</samp>&rsquo; options, and also use &lsquo;<samp>-s</samp>&rsquo;.
</p></dd>
<dt><span><code>--help</code></span></dt>
<dd><p>Prints out some help.
</p></dd>
<dt><span><code>--version</code></span></dt>
<dd><p>Prints out the Kawa version number, and then exits.
</p>
<p>If Kawa was built with a <code>.git</code> repository present,
also prints the result of <code>git describe</code>.
<span id="browse_002dmanual_002doption"></span></p></dd>
<dt><span><code>--browse-manual</code></span></dt>
<dt><span><code>--browse-manual=<var>command</var></code></span></dt>
<dd><p>Browse a local copy of the documentation (this manual).
</p>
<p>This creates a mini web-server that reads
from <code>doc/kawa-manual.epub</code>, which is
included in the binary distributions, but not built by default from source.
</p>
<p>If no <var>command</var> is specified, creates a new window or tab
in your default web browser.
If <var>command</var> is a string containing <code>%U</code>,
then Kawa replaces <code>%U</code> with a URL that references itself,
and then executes the resulting command.
If <var>command</var> does not contain <code>%U</code>, then
<var>command</var> becomes <var>command</var><code>&quot; %U&quot;</code>.
For example to use the Firefox browser to browse the manual do either of:
</p><div class="example">
<pre class="example">kawa --browse-manual=firefox
kawa --browse-manual=&quot;firefox %U&quot;
</pre></div>

</dd>
<dt><span><code>--server <var>portnum</var></code></span></dt>
<dd><p>Start a server listening from connections on the specified <var>portnum</var>.
Each connection using the Telnet protocol causes a new read-eval-print-loop
to start.  This option allows you to connect using any
Telnet client program to a remote &quot;Kawa server&quot;.
</p></dd>
<dt><span><code>--with-arg-count=<var>argc</var></code></span></dt>
<dd><p>This option is used before an action option (such as <code>-f</code>).
The <var>argc</var> arguments after the action become the
value of the <code>command-line-arguments</code> during the action.
When the action is finished, command-line-processing resumes
after skipping the <var>argc</var> arguments.
</p>
<p>For example:
</p><div class="example">
<pre class="example">$ kawa -f a.scm -f b.scm x y
</pre></div>
<p>When evaluating <code>a.scm</code> the <code>command-line-arguments</code>
by default is <em>all</em> the remaining arguments: <code>[&quot;-f&quot; &quot;b.scm&quot; &quot;x&quot; &quot;y&quot;]</code>.
Then <code>b.scm</code> is evaluated with <code>command-line-arguments</code>
set to <code>[&quot;x&quot; &quot;y&quot;]</code>
</p>
<div class="example">
<pre class="example">$ kawa --with-arg-count=0 -f a.scm -f b.scm x y
</pre></div>
<p>In this case <code>a.scm</code> is evaluated with <code>command-line-arguments</code>
set to the empty vector <code>[]</code>, and then <code>b.scm</code> is evaluated with <code>command-line-arguments</code>
set to <code>[&quot;x&quot; &quot;y&quot;]</code>
</p>
<div class="example">
<pre class="example">$ kawa --with-arg-count=4 -f a.scm -f b.scm x y
</pre></div>
<p>In this case <code>a.scm</code> is evaluated with <code>command-line-arguments</code>
set to <code>[&quot;-f&quot; &quot;b.scm&quot; &quot;x&quot; &quot;y&quot;]</code>. Since command-line processing
skips the arguments specified by <code>--with-arg-count=4</code>,
in this case <code>b.scm</code> is not evaluated.
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-language-selection">
<h4 class="subsection">6.1.3 Options for language selection</h4>

<dl compact="compact">
<dt><span><code>--scheme</code></span></dt>
<dd><p>Set the default language to Scheme.
(This is the default unless you select another language,
or you name a file with a known extension on the command-line.)
</p></dd>
<dt><span><code>--r5rs</code></span></dt>
<dt><span><code>--r6rs</code></span></dt>
<dt><span><code>--r7rs</code></span></dt>
<dd><p>Provide better compatibility with the specified Scheme standards.
(This is a work-in-progress.)
For example <code>--r6rs</code> aims to disable Kawa extensions
that conflict with R6RS.  It does not aim to disable all extensions,
only incompatible extensions.
These extensions disable the colon operator and keyword literals,
as well as the use of initial &lsquo;<samp>@</samp>&rsquo; as a splicing operator.
The &ldquo;<code>l</code>&rdquo; exponent suffix of a number literal creates a
floating-point double, rather than a <code>BigInteger</code>.
Selecting <code>--r5rs</code> makes symbols by default
case-insensitive.
</p></dd>
<dt><span><code>--elisp</code></span></dt>
<dt><span><code>--emacs</code></span></dt>
<dt><span><code>--emacs-lisp</code></span></dt>
<dd><p>Set the default language to Emacs Lisp.
(The implementation is quite incomplete.)
</p></dd>
<dt><span><code>--lisp</code></span></dt>
<dt><span><code>--clisp</code></span></dt>
<dt><span><code>--clisp</code></span></dt>
<dt><span><code>--commonlisp</code></span></dt>
<dt><span><code>--common-lisp</code></span></dt>
<dd><p>Set the default language to CommonLisp.
(The implementation is <em>very</em> incomplete.)
</p></dd>
<dt><span><code>--krl</code></span></dt>
<dd><p>Set the default language to KRL.  See <a href="#KRL">KRL - The Kawa Report Language for generating XML/HTML</a>.
</p></dd>
<dt><span><code>--brl</code></span></dt>
<dd><p>Set the default language to KRL, in BRL-compatibility mode.  See <a href="#KRL">KRL - The Kawa Report Language for generating XML/HTML</a>.
</p></dd>
<dt><span><code>--xquery</code></span></dt>
<dd><p>Set the default language to the draft XML Query language.
See the <a href="http://www.gnu.org/software/qexo/">Kawa-XQuery page</a>
for more information.
</p></dd>
<dt><span><code>--xslt</code></span></dt>
<dd><p>Set the default language to XSLT (XML Stylesheet Language Transformations).
(The implementation is <em>very</em> incomplete.)
See the <a href="http://www.gnu.org/software/qexo/xslt.html">Kawa-XSLT page</a>
for more information.
</p></dd>
<dt><span><code>--pedantic</code></span></dt>
<dd><p>Try to follow the approprate language specification to the letter,
even in corner cases, and even if it means giving up some
Kawa convenience features.  This flag so far only affects
the XQuery parser, but that will hopefully change.
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-warnings-and-errors">
<h4 class="subsection">6.1.4 Options for warnings and errors</h4>

<dl compact="compact">
<dd><span id="index-_002d_002dwarn_002dwhatever"></span>
<span id="index-_002d_002dno_002dwarn_002dwhatever"></span>
<span id="index-warn_002dundefined_002dvariable"></span>
</dd>
<dt><span><code>--warn-undefined-variable</code></span></dt>
<dd><p>Emit a warning if the code references a variable which is neither in
lexical scope nor in the compile-time dynamic (global) environment.
This is useful for catching typos.
(A <code>define-variable</code> form can be used to silence warnings.
It declares to the compiler that a variable is to be resolved dynamically.)
This defaults to on;
to turn it off use the <code>--no-warn-undefined-variable</code> flag.
<span id="index-warn_002dunknown_002dmember"></span>
</p></dd>
<dt><span><code>--warn-unknown-member</code></span></dt>
<dd><p>Emit a warning if the code references a named member (field or method)
for which there is no match in the compile-time type of the receiver.
This defaults to on;
to turn it off use the <code>--no-warn-unknown-member</code> flag.
<span id="index-warn_002dinvoke_002dunknown_002dmethod"></span>
</p></dd>
<dt><span><code>--warn-invoke-unknown-method</code></span></dt>
<dd><p>Emit a warning if the <code>invoke</code> function calls a named method
for which there is no matching method in the compile-time type of the receiver.
This defaults to the value of <code>--warn-unknown-member</code>,
to turn it off use the <code>--no-warn-invoke-unknown-method</code> flag.
<span id="index-warn_002dunused"></span>
</p></dd>
<dt><span><code>--warn-unused</code></span></dt>
<dd><p>Emit a warning if a variable is unused or code never executed. This defaults
to on; to turn it off use the <code>--no-warn-unused</code> flag.
<span id="index-warn_002dunreachable"></span>
</p></dd>
<dt><span><code>--warn-unreachable</code></span></dt>
<dd><p>Emit a warning if the code can never be executed. This defaults to on;
to turn it off use the <code>--no-warn-unreachable</code> flag.
<span id="index-warn_002dvoid_002dused"></span>
</p></dd>
<dt><span><code>--warn-void-used</code></span></dt>
<dd><p>Emit a warning if an expression depends on an expression
that is void (always has zero values), including call to <code>void</code>
functions and method.  Also warn if an expression depends on a
conditional (<code>if</code>) that has no &ldquo;else&rdquo; clause.
Examples include using the value of <code>set-car!</code> as
an argument to a function, or to initialize a variable.
This defaults to on;
to turn it off use the <code>--no-warn-void-used</code> flag.
<span id="index-warn_002das_002derror"></span>
</p></dd>
<dt><span><code>--warn-as-error</code></span></dt>
<dd><p>Treat a compilation warning as if it were an error and halt compilation.
</p></dd>
</dl>

<p>An option can be followed by a value, as
in <code>--warn-invoke-unknown-method=no</code>.
For boolean options, the values <code>yes</code>, <code>true</code>, <code>on</code>, or <code>1</code>
enable the option, while <code>no</code>, <code>false</code>, <code>off</code>,
or <code>0</code> disable it.
You can also negate an option by prefixing it with <code>no-</code>:
The option <code>--no-warn-unknown-member</code>
is the same as <code>--warn-unknown-member=no</code>.
</p>
<p>These options can also be used in the module source, using
<code>module-compile-options</code> or <code>with-compile-options</code>.
(In that case they override the options on the command line.)
</p>
</div>
<div class="subsection" id="Options-for-setting-variables">
<h4 class="subsection">6.1.5 Options for setting variables</h4>

<dl compact="compact">
<dt><span><code><var>name</var>=<var>value</var></code></span></dt>
<dd><p>Set the global variable with the specified <var>name</var> to the given <var>value</var>.
The type of the <var>value</var> is currently unspecified; the plan is for it
to be like XQuery&rsquo;s <em>untyped atomic</em> which can be coerced as needed.
</p></dd>
<dt><span><code>{<var>namespace-uri</var>}<var>local-name</var>=<var>value</var></code></span></dt>
<dd><p>Set the global variable with the specified namespace uri and
namespace-local name to the given value.
</p></dd>
</dl>

<p>These options are processed when invoking the <code>kawa</code>
application (i.e. the <code>kawa.repl</code> application).
If you want a Kawa application compiled with <code>--main</code>
to process these these assignments, call the
<code>process-command-line-assignments</code> utility function.
</p>
<dl compact="compact">
<dt><span><code>-D<var>variable-name</var>=<var>variable-value</var></code></span></dt>
<dd><p>Sets the JVM property <var>variable-name</var> to <var>variable-value</var>,
using the <code>setProperty</code> method of <code>java.lang.System</code>.
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-the-REPL-console">
<h4 class="subsection">6.1.6 Options for the REPL console</h4>

<dl compact="compact">
<dt><span><code>--console</code></span></dt>
<dt><span><code>--no-console</code></span></dt>
<dd><p>Usually Kawa can detect when the standard input port is a &ldquo;console&rdquo;
or &ldquo;terminal&rdquo;, but these are useful for overriding that detection.
The <code>--console</code> flag is useful when the standard input is a pipe,
but you want to direct Kawa to treat it as an interactive terminal.
The <code>--no-console</code> flag was useful for older pre-Java-6
implementations that did not have the <code>java.lang.Console</code> class.
</p></dd>
<dt><span><code>console:type=</code><var>console-types</var></span></dt>
<dt><span><code>console:use-jline=</code>[<code>yes</code>|<code>no</code>]</span></dt>
<dt><span><code>console:jline-mouse=</code>[<code>yes</code>|<code>no</code>]</span></dt>
<dd><p>See the <a href="#REPL-Console">The REPL (read-eval-print-loop) console</a> section.
</p></dd>
<dt><span><code>console:prompt1=<var>prompt1</var></code></span></dt>
<dt><span><code>console:prompt2=<var>prompt2</var></code></span></dt>
<dd><p>Initialize <a href="#input_002dprompt1"><code>input-promp1</code> and <code>input-prompt2</code></a>, respectively.
</p></dd>
</dl>
<p>See also the <code>--output-format</code> flag.
</p>
</div>
<div class="subsection" id="Options-for-controlling-output-formatting">
<h4 class="subsection">6.1.7 Options for controlling output formatting</h4>

<span id="index-_002d_002doutput_002dformat"></span>
<dl compact="compact">
<dt><span><code>--output-format <var>format</var></code></span></dt>
<dt><span><code>--format <var>format</var></code></span></dt>
<dd><p>Change the default output format to that specified by <var>format</var>.
See <a href="#Named-output-formats">Named output formats</a> for more information and a list.
</p></dd>
</dl>

<dl compact="compact">
<dt><span><code>out:base=<var>integer</var></code></span></dt>
<dd><p>The number base (radix) to use by default when printing rational numbers.
Must be an integer between 2 and 36, and the default is of course 10.
For example the option <code>out:base=16</code> produces hexadecimal output.
Equivalent to setting the <code>*print-base*</code> variable.
</p></dd>
<dt><span><code>out:radix=no|yes</code></span></dt>
<dd><p>If true, prints an indicator of the radix used when printing rational numbers.
The default is <code>no</code>.
Equivalent to setting the <code>*print-radix*</code> variable.
</p></dd>
<dt><span><code>out:doctype-system=<var>system-identifier</var></code></span></dt>
<dd><p>If <code>out:doctype-system</code> is specified then a <code>DOCTYPE</code> declaration
is written before writing a top-level XML element, using
the specified <var>system-identifier</var>.
</p></dd>
<dt><span><code>out:doctype-public=<var>public-identifier</var></code></span></dt>
<dd><p>Ignored unless  <code>out:doctype-system</code> is also specified,
in which case the <var>public-identifier</var> is written
as the public identifiers of the <code>DOCTYPE</code> declaration.
</p></dd>
<dt><span><code>out:xml-indent=<var>kind</var></code></span></dt>
<dd><p>Controls whether extra line breaks and indentation are added
when printing XML.
If <var>kind</var> is <code>always</code> or <code>yes</code> then newlines and
appropriate indentation are added before and after each element.
If <var>kind</var> is <code>pretty</code> then the pretty-printer is used
to only add new lines when an element otherwise won&rsquo;t fit on a single line.
If <var>kind</var> is <code>no</code> (the default) then no extra line breaks
or indentation are added.
</p></dd>
<dt><span><code>out:line-length=<var>columns</var></code></span></dt>
<dt><span><code>out:right-margin=<var>columns</var></code></span></dt>
<dd><p>Specifies the maximum number of number of columns in a line
when the pretty-printer decides where to break a line.
(The two options are equivalent.)
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-compiling-and-optimizing">
<h4 class="subsection">6.1.8 Options for compiling and optimizing</h4>

<dl compact="compact">
<dt><span><code>--target <var>version</var></code></span></dt>
<dd><p>The <var>version</var> can be a JDK or Java specification version:
<code>5</code>, <code>6</code>, or <code>7</code>.
The JDK versions <code>1.5</code> and <code>1.6</code> are equivalent to <code>5</code>
or <code>6</code>, respectively.
Specify a JVM (classfile) version to target.  This is useful
if (for example) you use Java 6, but want to create <code>.class</code> files
that can run on Java 5.  In that case specify <code>--target 5</code>.
</p></dd>
</dl>

<p>The following options control which calling conventions are used:
</p><dl compact="compact">
<dt><span><code>--full-tailcalls</code></span></dt>
<dd><p>Use a calling convention that supports proper tail recursion.
</p></dd>
<dt><span><code>--no-full-tailcalls</code></span></dt>
<dd><p>Use a calling convention that does not support proper tail recursion.
Self-tail-recursion (i.e. a recursive call to the current function)
is still implemented correctly, assuming that the called function
is known at compile time.
</p></dd>
<dt><span><code>--no-inline</code></span></dt>
<dd><p>Disable inlining of known functions and methods.
The generated code runs slower, but you can more reliably trace procedures.
Normally Kawa will assume that a procedure <code>fn</code>
declared using a <code>(define (fn args) body)</code> form is constant,
assuming it isn&rsquo;t modified in the current module.  However, it is
possible some other module might modify the binding of <code>fn</code>.
You can use the <code>--no-inline</code> to disable the assumption that <code>fn</code>
is constant.
</p></dd>
</dl>

<p>The default is currently <code>--no-full-tailcalls</code> because
it is usually faster.
It is also closer to the Java call model, so may be better for people
primarily interested in using Kawa for scripting Java systems.
</p>
<p>Both calling conventions can co-exist:  Code compiled
with <code>--full-tailcalls</code> can call code compiled
with <code>--no-full-tailcalls</code> and vice versa.
</p>
<p>These options can also be used in the module source, using
<code>module-compile-options</code> or <code>with-compile-options</code>.
(In that case they override the options on the command line.)
</p>
<p>The options &lsquo;<samp>-C</samp>&rsquo;, &lsquo;<samp>-d</samp>&rsquo;, &lsquo;<samp>-T</samp>&rsquo;, &lsquo;<samp>-P</samp>&rsquo;, &lsquo;<samp>--main</samp>&rsquo;
&lsquo;<samp>--applet</samp>&rsquo;, and <code>--servlet</code> are used to compile a Scheme file;
see <a href="#Files-compilation">Compiling to a set of .class files</a>.
The options &lsquo;<samp>--module-static</samp>&rsquo;, <code>--module-nonstatic</code>,
<code>--no-module-static</code>, and <code>--module-static-run</code>
control how a module is mapped to a Java class; see <a href="#static_002dor_002dnon_002dmodules">static-or-non-modules</a>.
The option &lsquo;<samp>--connect <var>portnum</var></samp>&rsquo; is only used by
the &lsquo;<samp>kawa</samp>&rsquo; front-end program.
</p>
</div>
<div class="subsection" id="Options-for-debugging">
<h4 class="subsection">6.1.9 Options for debugging</h4>

<p>The following options are useful if you want to debug or understand
how Kawa works.
</p><dl compact="compact">
<dt><span><code>--debug-dump-zip</code></span></dt>
<dd><p>Normally, when Kawa loads a source file, or evaluates a non-trivial expression,
it generates new internal Java classes but does not write them out.  This
option asks it to write out generated classes in a &lsquo;<samp>.zip</samp>&rsquo; archive
whose name has the prefix &lsquo;<samp>kawa-zip-dump-</samp>&rsquo;.
</p></dd>
<dt><span><code>--debug-print-expr</code></span></dt>
<dd><p>Kawa translates source language forms into an internal <code>Expression</code>
data structure.  This option causes that data structure to be written out
in a readable format to the standard output.
</p></dd>
<dt><span><code>--debug-print-final-expr</code></span></dt>
<dd><p>Similar to the previous option, but prints out the <code>Expression</code> after
various transformations and optimizations have been done, and just before
code generation.
</p></dd>
<dt><span><code>--debug-syntax-pattern-match</code></span></dt>
<dd><p>Prints logging information to standard error when a <code>syntax-rules</code>
or <code>syntax-case</code> pattern matches.
</p></dd>
<dt><span><code>--debug-error-prints-stack-trace</code></span></dt>
<dd><p>Prints a stack trace with any error found during compilation.
</p></dd>
<dt><span><code>--debug-warning-prints-stack-trace</code></span></dt>
<dd><p>Prints a stack trace with any warning found during compilation.
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-web-servers">
<h4 class="subsection">6.1.10 Options for web servers</h4>

<p>JDK 6 (or later) includes a complete web server library.
</p>
<dl compact="compact">
<dt><span><code>--http-auto-handler <var>context-path</var> <var>appdir</var></code></span></dt>
<dd><p>Register a web application handler that uses files
in the directory <var>appdir</var> to handle HTTP (web) requests
containing the given <var>context-path</var>.  That is it handles
requests that start with <code>http://localhost:<var>port</var><var>context-path</var></code>.
(This assumes the <var>context-path</var> starts with a <code>/</code>.)
See <a href="#Self_002dconfiguring-page-scripts">Self-configuring web page scripts</a>.
</p></dd>
<dt><span><code>--http-start <var>port</var></code></span></dt>
<dd><p>Start the web server, listing on the specified <var>port</var>.
</p></dd>
</dl>

</div>
<div class="subsection" id="Options-for-the-JVM">
<h4 class="subsection">6.1.11 Options for the JVM</h4>

<p>The <code>kawa</code> front-end can pass options to the <code>java</code> launcher,
using <code>-J</code> or <code>-D</code> options.
These must be given <em>before</em> any other arguments.
For example:
</p><div class="example">
<pre class="example">kawa -J-Xms48m -Dkawa.command.name=foo foo.scm
</pre></div>
<p>is equivalent to (ignoring classpath issues):
</p><div class="example">
<pre class="example">java -Xms48m -Dkawa.command.name=foo kawa.repl foo.scm
</pre></div>
<p>You can also pass a <code>-D</code> option (but not a <code>-J</code> option) after the
class name, in which case it is processed by the Kawa command-line processor
rather than the <code>java</code> launcher.  The effect is normally the same.
</p>
<dl compact="compact">
<dt><span><code>-J<var>jvm-option</var></code></span></dt>
<dd><p>Passes the <var>jvm-option</var> to the <code>java</code> command,
before the class-name (<code>kawa.repl</code>) and Kawa options.
</p></dd>
<dt><span><code>-D<var>variable-name</var>=<var>variable-value</var></code></span></dt>
<dd><p>Sets the JVM property <var>variable-name</var> to <var>variable-value</var>.
Equivalent to <code>-J-D<var>variable-name</var>=<var>variable-value</var></code>.
</p></dd>
</dl>

<hr>
</div>
</div>
<div class="section" id="Scripts">
<div class="header">
<p>
Next: <a href="#REPL-Console" accesskey="n" rel="next">The REPL (read-eval-print-loop) console</a>, Previous: <a href="#Options" accesskey="p" rel="prev">Command-line arguments</a>, Up: <a href="#Running" accesskey="u" rel="up">How to start up and run Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Running-Command-Scripts"></span><h3 class="section">6.2 Running Command Scripts</h3>

<p>If you write a Kawa application, it is convenient to be able
to execute it directly (from the command line or clicking an icon, say),
without have to explicitly run <code>kawa</code> or <code>java</code>.
On Unix-like systems the easiest way to do this is to
write a small shell script that runs your Kawa application.
</p>
<p>For modest-sized applications it is convenient if the shell script
and the Kawa code can be in the same file.
Unix-like systems support a mechanism where a <em>script</em> can
specify a program that should execute it.  The convention
is that the first line of the file should start with the two characters
&lsquo;<samp>#!</samp>&rsquo; followed by the absolute path of the program that should
process (interpret) the script.
</p>
<p>(Windows has <em>batch files</em>, which are similar.)
</p>
<p>This convention works well for script languages that use &lsquo;<samp>#</samp>&rsquo;
to indicate the start of a comment, since the interpreter will
automatically ignore the line specifying the interpreter filename.
Scheme, however, uses &lsquo;<samp>#</samp>&rsquo; as a multi-purpose prefix,
and Kawa specifically uses &lsquo;<samp>#!</samp>&rsquo; as a prefix for
various <a href="#Special-named-constants">Special named constants</a> such as <code>#!optional</code>.
</p>
<p>Kawa does recognize the three-character sequence &lsquo;<samp>#!/</samp>&rsquo; at the
beginning of a file as special, and ignores it.
Here is an example:
</p><div class="example">
<pre class="example">#!/usr/local/bin/kawa
(format #t &quot;The command-line was:~{ ~w~}~%&quot; (command-line))
</pre></div>

<p>If you copy this text to a file named <code>/home/me/bin/scm-echo</code>,
set the execute permission, and make sure it is in your <code>PATH</code>,
then you can execute it just by naming it on command line:
</p><div class="example">
<pre class="example">$ chmod +x /home/me/bin/scm-echo
$ PATH=/home/me/bin:$PATH
$ scm-env a b
The command-line was: &quot;/home/me/bin/scm-echo&quot; &quot;a&quot; &quot;b&quot;
</pre></div>
<p>The system kernel will automatically execute <code>kawa</code>, passing it the
filename as an argument.
</p>
<p>Note that the full path-name of the <code>kawa</code> interpreter
must be hard-wired into the script.  This means you may have to edit
the script depending on where Kawa is installed on your system.
Another possible problem is that the interpreter must be an
actual program, not a shell script. Depending on how you configure
and install Kawa, <code>kawa</code> can be a real program or a script.
You can avoid both problems by the <code>env</code> program, available on
most modern Unix-like systems:
</p>
<div class="example">
<pre class="example">#!/usr/bin/env kawa
(format #t &quot;The command-line was:~{ ~w~}~%&quot; (command-line))
</pre></div>

<p>This works the same way, but assumes <code>kawa</code> is in the
command <code>PATH</code>.
</p>
<ul class="section-toc">
<li><a href="#Setting-kawa-options-in-the-script" accesskey="1">Setting kawa options in the script</a></li>
<li><a href="#Other-ways-to-pass-options-using-meta_002darg-or-_002d_002dscript" accesskey="2">Other ways to pass options using meta-arg or &ndash;script</a></li>
<li><a href="#Scripts-for-compiled-code" accesskey="3">Scripts for compiled code</a></li>
</ul>
<div class="subsection" id="Setting-kawa-options-in-the-script">
<h4 class="subsection">6.2.1 Setting kawa options in the script</h4>

<p>If you need to specify extra arguments to <code>kawa</code>,
you can run arbitrary shell command inside Scheme block comments.
Here is an example:
</p><div class="example">
<pre class="example">#!/bin/sh
#|
exec kawa out:base=16 out:radix=yes &quot;$0&quot; &quot;$*&quot;
|#
(format #t &quot;The command-line is:~{ ~w~}.~%&quot; (command-line))
(display &quot;It has &quot;)
(display (apply + (map string-length (command-line))))
(display &quot; characters.&quot;)
(newline)
</pre></div>

<p>The trick is to hide the shell code from Kawa inside
a <code>#|...|#</code> block-comment.  The start of the block comment
is a line starting with a <code>#</code>, so it is treated as a comment by the shell.
You can then invoke <code>kawa</code> (or <code>java</code> directly)
as you prefer, setting up class-path and jars as needed,
and passing whatever arguments you want.
(The shell replaces the <code>&quot;$0&quot;</code> by the name of the script, and
replaces the <code>&quot;$@&quot;</code> by the remaining arguments passed to the script.)
You need to make sure the shell finishes before it reaches
the end of the block comment or the Scheme code, which would confuse it.
The example uses <code>exec</code>, which tells the shell to <em>replace</em>
itself by <var>kawa</var>;
an alternative is to use the shell <code>exit</code> command.
</p>
<p>If you copy the above file to <code>/tmp/sch-echo</code> and make
that file executable, you can run it directly:
</p><div class="example">
<pre class="example">$ /tmp/scm-echo &quot;a b&quot; &quot;c d&quot;
The command-line is: &quot;/tmp/scm-echo&quot; &quot;a b c d&quot;.
It has #x14 characters.
</pre></div>

<p>When the Kawa reader sees the initial <code>#/</code> it sets
the command name to the file name, so it can be used by a future
call to <code>(command-name)</code>.  If you want to override
this you can use the <code>-Dkawa.command.name=<var>name</var></code> option.
</p>
<p>Using comments this way has the advantage that you have the
option of running the script &ldquo;manually&rdquo; if you prefer:
</p><div class="example">
<pre class="example">$ kawa /tmp/scm-echo out:base=8 &quot;x y&quot;
The command-line is: &quot;/tmp/scm-echo&quot; &quot;out:base=8&quot; &quot;x y&quot;.
It has 26 characters.
</pre></div>

</div>
<div class="subsection" id="Other-ways-to-pass-options-using-meta_002darg-or-_002d_002dscript">
<h4 class="subsection">6.2.2 Other ways to pass options using meta-arg or &ndash;script</h4>

<p>An argument consisting of just a <code>\</code> (backslash)
causes Kawa to read the <em>second</em> line looking for
options.  (Quotes and backslashes work like in the shell.)
These replace the backslash in the command line.
</p>
<p>This is a less verbose mechanism, but it requires an
absolute path to <code>kawa</code>, due to shell limitations.
</p>
<div class="example">
<pre class="example">#!/usr/bin/kawa \
  --scheme --full-tailcalls
(format #t &quot;The command-line is:~{ ~w~}.~%&quot; (command-line))
</pre></div>

<p>In this case the effective command line received by Kawa will
be <code>--scheme</code>, <code>--full-tailcalls</code>, followed by the
script filename, followed by other arguments specified when
running the script.
</p>
<p>The backslash used this way originated in
<a href="http://www.scsh.net">scsh</a> where it is called the <em>meta-arg</em>.
(Unlike scsh, Kawa&rsquo;s <code>#!</code> is not a block comment,
but a rest-of-line, though the backslash causes the following line
to also be skipped.) 
</p>
<p>An alternative method is to use the <code>--script2</code> option,
which tells Kawa to execute the script after ignoring
the initial two lines.  For example:
</p>
<div class="example">
<pre class="example">#!/bin/sh
exec kawa --commonlisp out:base=16 --script2 &quot;$0&quot; &quot;$@&quot;
(setq xx 20) (display xx) (newline)
</pre></div>

<p>This is slightly more compact than using block-comments as shown earlier,
but it has the disadvantage that you can&rsquo;t explicitly
use <code>kawa</code> or <code>java</code> to run the script unless you
make sure to pass it the <code>--script2</code> option.
</p>
</div>
<div class="subsection" id="Scripts-for-compiled-code">
<h4 class="subsection">6.2.3 Scripts for compiled code</h4>
<p>If you compile your Kawa application to class files (or better:
a <code>jar</code> file), you probably still want to write a small
shell script to set things up.  Here is one method:
</p>
<div class="example">
<pre class="example">#!/bin/sh
export CLASSPATH=/my/path
exec kawa -Dkawa.command.name=&quot;$0&quot; foo &quot;$@&quot;
</pre></div>

<p>Using the <code>kawa</code> front-end is a convenience, since it automatically
sets up the paths for the Kawa classes, and (if enabled) it
provides readline support for the default input port.
</p>
<p>Setting the <code>kawa.command.name</code> property to <code>&quot;$0&quot;</code>
(the filename used to invoke the script) enables
<code>(command-line</code>) to use the script name as the command name.
</p>
<p>You can invoke <code>java</code> directly, which is necessary when
running a <code>jar</code> file:
</p>
<div class="example">
<pre class="example">#!/bin/sh
exec java -cp /path/to/kawa -Dkawa.command.name=&quot;$0&quot; foo.jar &quot;$@&quot;
</pre></div>


<hr>
</div>
</div>
<div class="section" id="REPL-Console">
<div class="header">
<p>
Next: <a href="#Exiting" accesskey="n" rel="next">Exiting Kawa</a>, Previous: <a href="#Scripts" accesskey="p" rel="prev">Running Command Scripts</a>, Up: <a href="#Running" accesskey="u" rel="up">How to start up and run Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="The-REPL-_0028read_002deval_002dprint_002dloop_0029-console"></span><h3 class="section">6.3 The REPL (read-eval-print-loop) console</h3>

<p>The read-eval-print-loop (REPL) console is a convenient way to
do simple programming, test out things, and experiment.
As the name implies, the REPL repeatedly (in a loop)
prints out a prompt, reads an input command, evaluates it, then prints the result.
</p>
<p>The REPL is started when you invoke the <code>kawa</code> command
with no arguments.  For example:
</p>
<div class="example">
<pre class="example">$ <kbd>kawa</kbd>
#|kawa:1|# <kbd>(define pi (* 2 (asin 1)))</kbd>
#|kawa:2|# <kbd>(list pi (sqrt pi))</kbd>
(3.141592653589793 1.7724538509055159)
#|kawa:3|# <kbd></kbd>
</pre></div>

<p>The colors and styles used for the prompt and the user input
depend on user preference and the capabilities of the console device.
(If you read this on a color screen you should see pale green for the
prompt and pale yellow for the user input;
this matches the defaults for the DomTerm console.)
</p>
<p>You can <a href="#Prompts">change the prompt string</a> if you want.
The default format depends on the (programming) language used;
the one shown above is used for Scheme.
It has the form of a comment, which can be convenient for copying
and pasting lines.
</p>
<p>You can <a href="#Named-output-formats">change the output formatting</a> with
the <code>--output-format</code> command-line option.
</p>
<p>The basic console has few frills, but should work in any enviroment
where you have a console or terminal.  It has no dependencies,
except the kawa <code>.jar</code> file (and Java):
</p><div class="example">
<pre class="example">$ <kbd>java kawa-2.93.jar</kbd>
#|kawa:2|# <kbd></kbd>
</pre></div>

<p>On rare occason you may need to specify the <code>--console</code> flag.
</p>
<ul class="section-toc">
<li><a href="#Input-line-editing-and-history" accesskey="1">Input line editing and history</a></li>
<li><a href="#Running-a-Command-Interpreter-in-a-new-Window" accesskey="2">Running a Command Interpreter in a new Window</a></li>
<li><a href="#Using-DomTerm-1" accesskey="3">Using DomTerm</a></li>
</ul>
<div class="subsection" id="Input-line-editing-and-history">
<h4 class="subsection">6.3.1 Input line editing and history</h4>

<p>When typing a command in a console it is helpful to go back
and correct mistakes, repeat and edit previous commands, and so on.
How well you can do this varies a lot depending on which tools you use.
Kawa delegates input editing to an external tool.
The recommended and default input-editing tool is
the <a href="https://github.com/jline/jline3">JLine3 library</a>,
which is bundled with the Kawa binary distribution.
</p>
<p>JLine3 handles the normal editing comands, including arrow keys
for moving around in the input, and deleting with backspace or delete.
In general, JLine3 uses the same keybindings as GNU readline,
which are based on Emacs key-bindings.
</p>
<p>You can use the up-arrow to move to previous commands in the
input history and down-arrow to go forwards.
Control-R (&ldquo;reverse search&rdquo; searches backwards in the history
for a previous command that contains the search string.
</p>
<p>Multi-line commands are treated as a unit by JLine3:
If Kawa determines that input is &ldquo;incomplete&rdquo; it will
ask for continuation lines - and you can go back and edit previous
lines in the same command.
You can explicitly create a multi-line command with Escape-Space.
An entry in the command history may be multiple lines.
</p>
<p>Tab-completion works for Kawa-Scheme identifiers: If you type TAB
after an identifier, Kawa will present a list of possible completions.
</p>
<p>There are multiple alternatives to using JLine3.
You can use GNU readline (if you configured with <code>--enable-kawa-frontend</code>).
You can use a front-end program like <code>rlfe</code> or <code>fep</code>.
You can use Emacs shell or scheme mode.
You can also use DomTerm in line-edit mode, where the browser handles
the editing.
</p>
<dl compact="compact">
<dt><span><code>console:use-jline=</code>[<code>yes</code>|<code>no</code>]</span></dt>
<dd><p>Disable (with <code>no</code>) or enable (with <code>yes</code>, which is the default)
input line editing with JLine.
</p></dd>
<dt><span><code>console:console:jline-mouse=</code>[<code>yes</code>|<code>no</code>]</span></dt>
<dd><p>Enable (with <code>yes</code>) mouse click reporting from
most xterm-like terminals to JLine, which means you
can move the input cursor with the mouse.
This is disabled by default because it conflicts with other useful mouse
actions (text selection using drag; middle-button paste; right-button
context menu; and wheel mouse scrolling).
If you enable mouse-reporting, on most terminals you can get the
standard behavior when pressing the shift key.  E.g. to enable selection,
drag with the shift key pressed.  (However, mouse-wheel scrolling
may not work even with shift pressed.)
</p></dd>
</dl>

<span id="New_002dWindow"></span></div>
<div class="subsection" id="Running-a-Command-Interpreter-in-a-new-Window">
<h4 class="subsection">6.3.2 Running a Command Interpreter in a new Window</h4>

<p>Instead of using an existing terminal window for Kawa&rsquo;s REPL console,
you can request a new window.
The command-line options <code>-w</code> creates a new window.
Kawa also creates a new window when it needs to create a REPL
(for example if invoked with no options) and it is not running
in a console.
</p>
<p>You have a number of options for how the window appears and
what it supports, controlled by text following <code>-w</code>.
All except <code>-wswing</code> (and <code>-wconsole</code>) use DomTerm,
so they depend on some kind of web browser technology.
All except <code>-wswing</code> by default use  JLine3 input editing,
if available.
</p>
<dl compact="compact">
<dt><span><code>-w</code></span></dt>
<dd><p>Pick the default/preferred console implementation.
You can specify your preference with the <code>console:type=</code> option,
which is followed by one of the options below (without the <code>&quot;-w&quot;</code> prefix),
It can also be list of options separated by semi-colons, in which
case they are tried in order.
</p>
<p>The current default (it may change) is as if you specified:
</p><div class="example">
<pre class="example">console:type=&quot;google-chrome;browser;javafx;swing;console&quot;
</pre></div>

</dd>
<dt><span><code>-wbrowser</code></span></dt>
<dd><p>Creates a Kawa window or tab in your preferred desktop browser.
Kawa starts a builtin HTTP and WebSocket server to communicate with the browser.
</p></dd>
<dt><span><code>-wbrowser=<var>command</var></code></span></dt>
<dd><p>Uses <var>command</var> to display the Kawa REPL.
The <var>command</var> should include the pattern <code>%U</code>, which Kawa replaces
with a URL that it listens to.
(Alternatively, it can use the pattern <code>%W</code>, which Kawa replaces
with the port number of its WebSocket server.  However, this feature may be removed.)
If the is no <code>%</code> in the <var>command</var>, Kawa add <code>&quot; %U&quot;</code>.
Thus <code>-wbrowser=firefox</code> is the same as <code>-wbrowser=&quot;firefox %U&quot;</code>.
</p></dd>
<dt><span><code>-wgoogle-chrome</code></span></dt>
<dd><p>Creates a new Google Chrome window in &ldquo;app mode&rdquo; - i.e. with no location or menu bar.
This is the same as <code>-wbrowser=&quot;google-chrome --app=%U&quot;</code>.
</p></dd>
<dt><span><code>-wqtdomterm</code></span></dt>
<dd><p>Uses the <code>QtDomTerm</code> application.
Same as <code>-wbrowser=&quot;qtdomterm --connect localhost:%W&quot;</code>, where <code>%W</code>
is the port of the WebSocke server that Kawa starts.
</p></dd>
<dt><span><code>-wjavafx</code></span></dt>
<dd><p>Creates a new window using JavaFX WebView, which runs in the same JVM as Kawa.
While this doesn&rsquo;t currently have much in the way of Kawa-specific menus
or other features, it has the most potential for adding them in the future.
However, it does require JavaFX, which is not always available,
and which does not see a lot of love from Oracle. (It uses an old version of WebKit.)
</p></dd>
<dt><span><code>-wswing</code></span></dt>
<dd><p>Create a console using the Swing toolkit.
This is the old implementation of <code>-w</code>.
It is deprecated because it only supports the builtin Swing line editing.
(I.e. neither DomTerm or JLine3 features are available, though
&ldquo;printing&rdquo; <a href="#Composable-pictures">pictures</a> does work.)
</p></dd>
<dt><span><code>-wserve</code></span></dt>
<dt><span><code>-wserve=</code><var>port</var></span></dt>
<dd><p>Starts up an HTTP server (along with a WebSocket server),
but does not automatically create any browser windows.
Instead you can use any modern browser to load <code>http://localhost:<var>port</var>/</code>.
If <var>port</var> is not specified, the systems selects it (and prints it out).
</p></dd>
<dt><span><code>-wconsole</code></span></dt>
<dd><p>Same as <code>&quot;--&quot;</code> - i.e. it uses the existing console.
</p></dd>
<dt><span><code>console:type=</code><var>preference-list</var></span></dt>
<dd><p>Specify the behavior of plain <code>-w</code>.
</p></dd>
</dl>

<span id="Using-DomTerm"></span></div>
<div class="subsection" id="Using-DomTerm-1">
<h4 class="subsection">6.3.3 Using DomTerm</h4>

<p><a href="http://domterm.org">DomTerm</a> is a family of terminal emulators that use
the DomTerm JavaScript library.
</p>
<p>You can either have Kawa start DomTerm:
</p><div class="example">
<pre class="example">$ kawa <var>options</var> -w
</pre></div>
<p>or start a DomTerm terminal emulator and have it start Kawa:
</p><div class="example">
<pre class="example">$ domterm kawa <var>options</var> --
</pre></div>
<p>(You can also start a shell in a <code>domterm</code> window, and then start <code>kawa</code>.)
</p>
<p>Either approach works and both give you the benefits of DomTerm:
</p><ul>
<li> A xterm/ansi-compatible terminal emulator,
which means you can use (for example) JLine3 for input editing.
</li><li> You can &ldquo;print&rdquo; images, <a href="#Composable-pictures">pictures</a>, or HTML elements.
</li><li> Pretty-printing is handled by the terminal,
which means line-breaking is re-computed when window width changes.
</li><li> Hide/show buttons allow you to temporarily hide/unhide the output from a specific command.
</li><li> You can save a session as an HTML file,
which can be viewed later.
(Still with dynamic line-breaking and pretty-printing, as well as working hide/show buttons.)
The file is actually XHTML, so it can be processed with XML-reading tools.
</li><li> Distinct styles for prompts, input, error output and regular output,
which can be customized with CSS.
</li></ul>

<p>For now it is recommended to use both DomTerm and JLine3.
</p>
<dl class="def">
<dt id="index-domterm_002dload_002dstylesheet"><span class="category">Procedure: </span><span><strong>domterm-load-stylesheet</strong> <em>stylesheet [name]</em><a href='#index-domterm_002dload_002dstylesheet' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The string <var>stylesheet</var> should be a literal CSS stylesheet
which is downloaded into the current DomTerm console.
The new stylesheet is given the attribute <code>name=<var>name</var></code>,
where <var>name</var> defaults to <code>&quot;Kawa&quot;</code>.  If there is an
existing stylesheey whose <code>name</code> attribute is <var>name</var>,
it is replaced.
In this example we change the background color to light gray:
</p><div class="example">
<pre class="example">(domterm-load-stylesheet &quot;div.domterm { background-color: lightgray}&quot;)
</pre></div>
</dd></dl>

<hr>
</div>
</div>
<div class="section" id="Exiting">
<div class="header">
<p>
Next: <a href="#Compiling" accesskey="n" rel="next">Compiling to byte-code</a>, Previous: <a href="#REPL-Console" accesskey="p" rel="prev">The REPL (read-eval-print-loop) console</a>, Up: <a href="#Running" accesskey="u" rel="up">How to start up and run Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Exiting-Kawa"></span><h3 class="section">6.4 Exiting Kawa</h3>
<p>Kawa normally keeps running as long as there is an active
read-eval-print loop still awaiting input or there is an unfinished
other computation (such as requested by a &lsquo;<samp>-e</samp>&rsquo; or &lsquo;<samp>-f</samp>&rsquo; option).
</p>
<p>To close a read-eval-print-loop, you can type the special
literal <code>#!eof</code> at top level.  This is recognized as end-of-file.
Typing an end-of-file character (normally ctrl-D under Unix)
should also work, but that depends on your operating system
and terminal interface.
</p>
<p>If the read-eval-print-loop
is in a new window, you can select &lsquo;<samp>Close</samp>&rsquo; from the &lsquo;<samp>File</samp>&rsquo; menu.
</p>
<p>To exit the entire Kawa session, call the
<a href="#Exiting-the-current-process"><code>exit</code> procedure</a> (with 0 or 1 integer arguments).
</p>
<hr>
</div>
<div class="section" id="Compiling">
<div class="header">
<p>
Up: <a href="#Running" accesskey="u" rel="up">How to start up and run Kawa</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-byte_002dcode"></span><h3 class="section">6.5 Compiling to byte-code</h3>

<p>All Scheme functions and source files are invisibly compiled
into internal Java byte-codes.
(A traditional interpreter is used for macro-expansion.
Kawa used to also interpret &ldquo;simple&rdquo; expressions in interactive mode,
but always compiling makes things more consistent, and allows for
better stack traces on errors.)
</p>
<p>To save speed when loading large Scheme source files, you probably
want to pre-compile them and save them on your local disk.
There are two ways to do this.
</p>
<p>You can compile a Scheme source file to a single archive file.
You do this using the <code>compile-file</code> function.
The result is a single file that you can move around and <code>load</code>
just like the <code>.scm</code> source file.  You just specify the name
of the archive file to the <code>load</code> procedure.
Currently, the archive is a &quot;zip&quot; archive and has extension &quot;.zip&quot;;
a future release will probably use &quot;Java Archive&quot; (jar) files.
The advantage of compiling to an archive is that it is simple
and transparent.
</p>
<p>Alternatively, you can compile a Scheme source file to a
collection of &lsquo;<samp>.class</samp>&rsquo; files.
You then use the standard Java class loading mechanism to load the code.
The compiled class files do have to be installed somewhere
in the <code>CLASSPATH</code>.
</p>

<ul class="section-toc">
<li><a href="#Files-compilation" accesskey="1">Compiling to a set of .class files</a></li>
<li><a href="#Archive-compilation" accesskey="2">Compiling to an archive file</a></li>
<li><a href="#Compiling-using-Ant" accesskey="3">Compiling using Ant</a></li>
<li><a href="#Application-compilation" accesskey="4">Compiling to a standalone application</a></li>
<li><a href="#Applet-compilation" accesskey="5">Compiling to an applet</a></li>
<li><a href="#Compiling-to-executable" accesskey="6">Compiling to a native executable</a></li>
</ul>
<hr>
<div class="subsection" id="Files-compilation">
<div class="header">
<p>
Next: <a href="#Archive-compilation" accesskey="n" rel="next">Compiling to an archive file</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-a-set-of-_002eclass-files"></span><h4 class="subsection">6.5.1 Compiling to a set of .class files</h4>

<p>Invoking &lsquo;<samp>kawa</samp>&rsquo; (or &lsquo;<samp>java kawa.repl</samp>&rsquo;) with
the &lsquo;<samp>-C</samp>&rsquo; flag will compile
a &lsquo;<samp>.scm</samp>&rsquo; source file into one or more &lsquo;<samp>.class</samp>&rsquo; files:
</p><div class="example">
<pre class="example">kawa --main -C myprog.scm
</pre></div>

<p>You run it as follows:
</p><div class="example">
<pre class="example">kawa [-d <var>outdirectory</var>] [-P <var>prefix</var>] [-T <var>topname</var>] [--main | --applet | --servlet] -C <var>infile</var> ...
</pre></div>

<p>Note the &lsquo;<samp>-C</samp>&rsquo; must come last, because &lsquo;<samp>Kawa</samp>&rsquo; processes the
arguments and options in order,
</p>
<p>Here:
</p><dl compact="compact">
<dt><span><code>-C <var>infile</var> ...</code></span></dt>
<dd><p>The Scheme source files we want to compile.
</p></dd>
<dt><span><code>-d <var>outdirectory</var></code></span></dt>
<dd><p>The directory under which the resulting &lsquo;<samp>.class</samp>&rsquo; files will be.
The default is the current directory.
</p></dd>
<dt><span><code>-P <var>prefix</var></code></span></dt>
<dd><p>A string to prepend to the generated class names.
The default is the empty string.
</p></dd>
<dt><span><code>-T <var>topname</var></code></span></dt>
<dd><p>The name of the &quot;top&quot; class - i.e. the one that contains the code
for the top-level expressions and definitions.
The default is generated from the <var>infile</var> and <var>prefix</var>.
</p></dd>
<dt><span><code>--main</code></span></dt>
<dd><p>Generate a <code>main</code> method so that the resulting &quot;top&quot; class can
be used as a stand-alone application. See <a href="#Application-compilation">Compiling to a standalone application</a>.
</p></dd>
<dt><span><code>--applet</code></span></dt>
<dd><p>The resulting class inherits from <code>java.applet.Applet</code>,
and can be used as an applet.  See <a href="#Applet-compilation">Compiling to an applet</a>.
</p></dd>
<dt><span><code>--servlet</code></span></dt>
<dd><p>The resulting class implements <code>javax.servlet.http.HttpServlet</code>,
and can be used as a servlet in a servlet container like Tomcat.
</p></dd>
</dl>

<p>When you actually want to load the classes, the <var>outdirectory</var>
must be in your &lsquo;<samp>CLASSPATH</samp>&rsquo;.
You can use the <code>require</code> syntax or the <code>load</code> function to load the code,
by specifying the top-level class, either as a file name
(relative to <var>outdirectory</var>) or as a class name.
E.g. if you did:
</p><div class="example">
<pre class="example">kawa -d /usr/local/share/java -P my.lib. -T foo -C foosrc.scm
</pre></div>
<p>you can use either:
</p><div class="example">
<pre class="example">(require my.lib.foo)
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">(load &quot;my.lib.foo&quot;)
</pre></div>
<p>Using <code>require</code> is preferred as it imports the definitions
from <code>my.lib.foo</code> into the compile-time environment,
while <code>load</code> only imports the definitions into the run-time environment.
</p>
<p>If you are compiling a Scheme source file (say &lsquo;<samp>foosrc.scm</samp>&rsquo;)
that uses macros defined in some other file (say &lsquo;<samp>macs.scm</samp>&rsquo;),
you need to make sure the definitions are visible to the compiler.
One way to do that is with the &lsquo;<samp>-f</samp>&rsquo;:
</p><div class="example">
<pre class="example">kawa -f macs.scm -C foosrc.scm
</pre></div>

<p>Many of the options <a href="#Options">described earlier</a> are
relevant when compiling.  Commonly used options include language selection,
the <code>--warn-xxx</code> options, and <code>--full-tailcalls</code>.
</p>
<hr>
</div>
<div class="subsection" id="Archive-compilation">
<div class="header">
<p>
Next: <a href="#Compiling-using-Ant" accesskey="n" rel="next">Compiling using Ant</a>, Previous: <a href="#Files-compilation" accesskey="p" rel="prev">Compiling to a set of .class files</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-an-archive-file"></span><h4 class="subsection">6.5.2 Compiling to an archive file</h4>

<dl class="def">
<dt id="index-compile_002dfile"><span class="category">Procedure: </span><span><strong>compile-file</strong> <em>source-file compiled-archive</em><a href='#index-compile_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Compile the <var>source-file</var>, producing a <code>.zip</code> archive
<var>compiled-file</var>.
</p>

<p>For example, to byte-compile a file &lsquo;<samp>foo.scm</samp>&rsquo; do:
</p><div class="example">
<pre class="example">(compile-file &quot;foo.scm&quot; &quot;foo&quot;)
</pre></div>

<p>This will create &lsquo;<samp>foo.zip</samp>&rsquo;, which contains
byte-compiled JVM <code>.class</code> files.
You can move this file around, without worrying about class paths.
To load the compiled file, you can later <code>load</code> the
named file, as in either <code>(load &quot;foo&quot;)</code> or <code>(load &quot;foo.zip&quot;)</code>.
This should have the same effect as
loading &lsquo;<samp>foo.scm</samp>&rsquo;, except you will get the faster byte-compiled versions.
</p></dd></dl>

<hr>
</div>
<div class="subsection" id="Compiling-using-Ant">
<div class="header">
<p>
Next: <a href="#Application-compilation" accesskey="n" rel="next">Compiling to a standalone application</a>, Previous: <a href="#Archive-compilation" accesskey="p" rel="prev">Compiling to an archive file</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-using-Ant-1"></span><h4 class="subsection">6.5.3 Compiling using Ant</h4>
<span id="index-kawac"></span>
<p>Many Java projects use <a href="http://ant.apache.org">Ant</a>
for building Java projects.  Kawa includes a <code>&lt;kawac&gt;</code>
Ant task that simplifies compiling Kawa source files to classes.
See the <code>build.xml</code> in the Kawa source distribution for examples.
See the <a href="ant-kawac.html"><code>kawac</code> task documentation</a> for details.
</p>
<hr>
</div>
<div class="subsection" id="Application-compilation">
<div class="header">
<p>
Next: <a href="#Applet-compilation" accesskey="n" rel="next">Compiling to an applet</a>, Previous: <a href="#Compiling-using-Ant" accesskey="p" rel="prev">Compiling using Ant</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-a-standalone-application"></span><h4 class="subsection">6.5.4 Compiling to a standalone application</h4>

<p>A Java application is a Java class with a special method
(whose name is <code>main</code>).  The application can be invoked directly
by naming it in the Java command.
If you want to generate an application from a Scheme program,
create a Scheme source file with the definitions you need, plus
the top-level actions that you want the application to execute. 
</p>
<p>For example, assuming your Scheme file is 
<code>MyProgram.scm</code>, you  have two ways at your disposal to 
compile this Scheme program to a standalone application:
</p><ol>
<li> Compile
in the regular way described in the previous section, but add the
<code>--main</code> option.
<div class="example">
<pre class="example">kawa --main -C MyProgram.scm
</pre></div>

<p>The <code>--main</code> option will compile all Scheme programs
received in arguments to standalone applications.
</p></li><li> Compile
in the regular way decribed in the previous section, but add the 
<code>main: #t</code> module compile option to your module.
<div class="example">
<pre class="example">;; MyProgram.scm
(module-name &lt;myprogram&gt;)
(module-compile-options main: #t)
</pre></div>

<div class="example">
<pre class="example">kawa -C MyProgram.scm
</pre></div>

<p>This way you can compile multiple Scheme programs at once, and
still control which one(s) will compile to standalone application(s).
</p></li></ol>

<p>Both methods will create a <code>MyProgram.class</code> which you can either
<code>load</code> (as described in the previous section), or invoke as an application:
</p><div class="example">
<pre class="example">java MyProgram [<var>args</var>]
</pre></div>
<p>Your Scheme program can access the command-line arguments <var>args</var>
by using the global variable &lsquo;<samp>command-line-arguments</samp>&rsquo;,
or the R6RS function &lsquo;<samp>command-line</samp>&rsquo;.
</p>
<p>If there is no explicit <code>module-export</code> in a module compiled
with <code>--main</code> then no names are exported.  (The default
otherwise is for all names to be exported.)
</p>
<hr>
</div>
<div class="subsection" id="Applet-compilation">
<div class="header">
<p>
Next: <a href="#Compiling-to-executable" accesskey="n" rel="next">Compiling to a native executable</a>, Previous: <a href="#Application-compilation" accesskey="p" rel="prev">Compiling to a standalone application</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-an-applet"></span><h4 class="subsection">6.5.5 Compiling to an applet</h4>
<p>An applet is a Java class that inherits from <code>java.applet.Applet</code>.
The applet can be downloaded and run in a Java-capable web-browser.
To generate an applet from a Scheme program, write the Scheme
program with appropriate definitions of the functions &lsquo;<samp>init</samp>&rsquo;,
&lsquo;<samp>start</samp>&rsquo;, &lsquo;<samp>stop</samp>&rsquo; and &lsquo;<samp>destroy</samp>&rsquo;.  You must declare these
as zero-argument functions with a <code>&lt;void&gt;</code> return-type.
</p>
<p>Here is an example, based on the scribble applet in Flanagan&rsquo;s
&quot;Java Examples in a Nutshell&quot; (O&rsquo;Reilly, 1997):
</p><div class="example">
<pre class="example">(define-private last-x 0)
(define-private last-y 0)

(define (init) :: void
  (let ((applet (this)))
    (applet:addMouseListener
     (object (java.awt.event.MouseAdapter)
	     ((mousePressed e)
	      (set! last-x (e:getX))
	      (set! last-y (e:getY)))))
    (applet:addMouseMotionListener
     (object (java.awt.event.MouseMotionAdapter)
	     ((mouseDragged e)
	      (let ((g (applet:getGraphics))
		    (x (e:getX))
		    (y (e:getY)))
		(g:drawLine last-x last-y x y)
		(set! last-x x)
		(set! last-y y)))))))

(define (start) :: void (format #t &quot;called start.~%~!&quot;))
(define (stop) :: void (format #t &quot;called stop.~%~!&quot;))
(define (destroy) :: void (format #t &quot;called destroy.~%~!&quot;))
</pre></div>

<p>You compile the program with the &lsquo;<samp>--applet</samp>&rsquo; flag in addition to the
normal &lsquo;<samp>-C</samp>&rsquo; flag:
</p><div class="example">
<pre class="example">java kawa.repl --applet -C scribble.scm
</pre></div>

<p>You can then create a &lsquo;<samp>.jar</samp>&rsquo; archive containing your applet:
</p><div class="example">
<pre class="example">jar cf scribble.jar scribble*.class
</pre></div>

<p>Finally, you create an &lsquo;<samp>.html</samp>&rsquo; page referencing your applet
and its support <code>jar</code>s:
</p><div class="example">
<pre class="example">&lt;html&gt;&lt;head&gt;&lt;title&gt;Scribble testapp&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;Scribble testapp&lt;/h1&gt;
You can scribble here:
&lt;br&gt;
&lt;applet code=&quot;scribble.class&quot; archive=&quot;scribble.jar, kawa-2.93.jar&quot; width=200 height=200&gt;
Sorry, Java is needed.&lt;/applet&gt;
&lt;/body&gt;&lt;/html&gt;
</pre></div>

<p>The problem with using Kawa to write applets is that the Kawa <code>.jar</code>
file is quite big, and may take a while to download over a network connection.
Some possible solutions:
</p>
<ul>
<li> Try to strip out of the Kawa <code>.jar</code> any classes your
applet doesn&rsquo;t need.
</li><li> Java 2 provides a mechanism to install a <a href="http://java.sun.com/docs/books/tutorial/ext/basics/download.html">download extension</a>.
</li><li> Consider some alternative to applets, such as
<a href="http://java.sun.com/products/javawebstart/">Java Web Start</a>.
</li></ul>

<hr>
</div>
<div class="subsection" id="Compiling-to-executable">
<div class="header">
<p>
Previous: <a href="#Applet-compilation" accesskey="p" rel="prev">Compiling to an applet</a>, Up: <a href="#Compiling" accesskey="u" rel="up">Compiling to byte-code</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Compiling-to-a-native-executable"></span><h4 class="subsection">6.5.6 Compiling to a native executable</h4>

<p>In the past it was possible to compile a Scheme program to native code using GCJ.
However, using GCJ with Kawa is no longer supported,
as GCJ is no longer being actively maintained.
</p>

<hr>
</div>
</div>
</div>
<div class="chapter" id="Syntax">
<div class="header">
<p>
Next: <a href="#Program-structure" accesskey="n" rel="next">Program structure</a>, Previous: <a href="#Running" accesskey="p" rel="prev">How to start up and run Kawa</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Syntax-1"></span><h2 class="chapter">7 Syntax</h2>


<ul class="section-toc">
<li><a href="#Syntax-notation" accesskey="1">Notation</a></li>
<li><a href="#Lexical-and-datum-syntax" accesskey="2">Lexical and datum syntax</a></li>
<li><a href="#Lexical-syntax" accesskey="3">Lexical syntax</a></li>
<li><a href="#Datum-syntax" accesskey="4">Datum syntax</a></li>
<li><a href="#Hash_002dprefixed-forms" accesskey="5">Hash-prefixed forms</a></li>
<li><a href="#Primitive-expression-syntax" accesskey="6">Primitive expression syntax</a></li>
<li><a href="#Colon-notation" accesskey="7">Property access using colon notation</a></li>
<li><a href="#Bodies" accesskey="8">Programs and Bodies</a></li>
<li><a href="#Syntax-and-conditional-compilation" accesskey="9">Syntax and conditional compilation</a></li>
<li><a href="#Macros">Macros</a></li>
<li><a href="#Named-quasi_002dliterals">Named quasi-literals</a></li>
</ul>
<hr>
<div class="section" id="Syntax-notation">
<div class="header">
<p>
Next: <a href="#Lexical-and-datum-syntax" accesskey="n" rel="next">Lexical and datum syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Notation"></span><h3 class="section">7.1 Notation</h3>

<p>The formal syntax for Kawa Scheme is written in an extended <acronym>BNF</acronym>.
Non&ndash;terminals are written <var>like-this</var>.  Case is insignificant
for non&ndash;terminal names.
Literal text (terminals) are written <code><b>like this</b></code>.
</p>
<p>All spaces in the grammar are for legibility.
</p>
<p>The following extensions to <acronym>BNF</acronym> are used to make the
description more concise: <var>thing</var><sup>*</sup> or <var>thing</var><code>...</code>
both mean zero or more occurrences of <var>thing</var>,
and <var>thing</var><sup>+</sup> means at least one <var>thing</var>.
</p>
<p>Some non-terminal names refer to the Unicode scalar values of the same
name: <var>character-tabulation</var> (U+0009), <var>linefeed</var> (U+000A),
<var>carriage-return</var> (U+000D), <var>line-tabulation</var> (U+000B),
<var>form-feed</var> (U+000C), <var>space</var> (U+0020), <var>next-line</var>
(U+0085), <var>line-separator</var> (U+2028), and <var>paragraph-separator</var>
(U+2029).
</p>
<hr>
</div>
<div class="section" id="Lexical-and-datum-syntax">
<div class="header">
<p>
Next: <a href="#Lexical-syntax" accesskey="n" rel="next">Lexical syntax</a>, Previous: <a href="#Syntax-notation" accesskey="p" rel="prev">Notation</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Lexical-and-datum-syntax-1"></span><h3 class="section">7.2 Lexical and datum syntax</h3>

<p>The syntax of Scheme code is organized in three levels:
</p>
<ol>
<li> the <em>lexical syntax</em> that describes how a program text is split
into a sequence of lexemes,

</li><li> the <em>datum syntax</em>, formulated in terms of the lexical syntax, that
structures the lexeme sequence as a sequence of <em>syntactic data</em>,
where a syntactic datum is a recursively structured entity,

</li><li> the <em>program syntax</em> formulated in terms of the datum syntax,
imposing further structure and assigning meaning to syntactic data.
</li></ol>

<p>Syntactic data (also called <em>external representations</em>) double as a
notation for objects, and the <code>read</code> and
<code>write</code> procedures can be used for reading and writing syntactic data,
converting between their textual representation and the corresponding
objects.  Each syntactic datum represents a corresponding
<em>datum value</em>.  A syntactic datum can be used in a program to obtain the
corresponding datum value using <code>quote</code>.
</p>
<p>Scheme source code consists of syntactic data and (non&ndash;significant)
comments.  Syntactic data in Scheme source code are called <em>forms</em>.
(A form nested inside another form is called a <em>subform</em>.)
Consequently, Scheme&rsquo;s syntax has the property that any sequence of
characters that is a form is also a syntactic datum representing some
object.  This can lead to confusion, since it may not be obvious out of
context whether a given sequence of characters is intended to be a
representation of objects or the text of a program.  It is also a source
of power, since it facilitates writing programs such as interpreters or
compilers that treat programs as objects (or vice versa).
</p>
<p>A datum value may have several different external representations.  For
example, both <code>#e28.000</code> and <code>#x1c</code> are syntactic data
representing the exact integer object 28, and the syntactic data
<code>(8 13)</code>, <code>( 08 13 )</code>, <code>(8 . (13 . ()))</code> all represent a
list containing the exact integer objects 8 and 13.  Syntactic data that
represent equal objects (in the sense of <code>equal?</code>)
are always equivalent as forms of a program.
</p>
<p>Because of the close correspondence between syntactic data and datum
values, we sometimes uses the term <em>datum</em> for either a
syntactic datum or a datum value when the exact meaning is apparent from
the context.
</p>

<hr>
</div>
<div class="section" id="Lexical-syntax">
<div class="header">
<p>
Next: <a href="#Datum-syntax" accesskey="n" rel="next">Datum syntax</a>, Previous: <a href="#Lexical-and-datum-syntax" accesskey="p" rel="prev">Lexical and datum syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Lexical-syntax-1"></span><h3 class="section">7.3 Lexical syntax</h3>

<p>The lexical syntax determines how a character sequence is split into a
sequence of lexemes, omitting non&ndash;significant portions such as comments
and whitespace.  The character sequence is assumed to be text according
to the <a href="http://unicode.org/">Unicode standard</a>.
Some of the lexemes, such as
identifiers, representations of number objects, strings etc., of the
lexical syntax are syntactic data in the datum syntax, and thus
represent objects.  Besides the formal account of the syntax, this
section also describes what datum values are represented by these
syntactic data.
</p>
<p>The lexical syntax, in the description of comments, contains a forward
reference to <var>datum</var>, which is described as part of the datum
syntax.  Being comments, however, these <var>datum</var>s do not play a
significant role in the syntax.
</p>
<p>Case is significant except in representations of booleans, number
objects, and in hexadecimal numbers specifying Unicode scalar values.
For example, <code>#x1A</code> and <code>#X1a</code> are equivalent.  The identifier
<code>Foo</code> is, however, distinct from the identifier <code>FOO</code>.
</p>
<ul class="section-toc">
<li><a href="#Formal-account" accesskey="1">Formal account</a></li>
<li><a href="#Line-endings" accesskey="2">Line endings</a></li>
<li><a href="#Whitespace-and-comments" accesskey="3">Whitespace and comments</a></li>
<li><a href="#Identifiers" accesskey="4">Identifiers</a></li>
<li><a href="#Numbers-2" accesskey="5">Numbers</a></li>
</ul>
<div class="subsection" id="Formal-account">
<h4 class="subsection">7.3.1 Formal account</h4>

<p><var>Interlexeme-space</var> may occur on either side of any lexeme, but not
within a lexeme.
</p>
<p><var>Identifier</var>s, <code>.</code>, <var>number</var>s, <var>character</var>s, and
<var>boolean</var>s, must be terminated by a <var>delimiter</var> or by the end
of the input.
</p>

<div class="display">
<pre class="display"><span id="index-lexeme"></span><span id="meta_002dlexeme"></span><var>lexeme</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a> | <var>boolean</var> | <a href="#meta_002dnumber"><var>number</var></a>
         | <var>character</var> | <a href="#meta_002dstring"><var>string</var></a>
         | <code><b>(</b></code> |  <code><b>)</b></code> |  <code><b>[</b></code> |  <code><b>]</b></code> |  <code><b>#(</b></code>
         | <code><b>&rsquo;</b></code> | <code><b>&lsquo;</b></code> | <code><b>,</b></code> | <code><b>,@</b></code> | <code><b>.</b></code>
         | <code><b>#&rsquo;</b></code> |  <code><b>#&lsquo;</b></code> |  <code><b>#,</b></code> |  <code><b>#,@</b></code>
<span id="index-delimiter"></span><span id="meta_002ddelimiter"></span><var>delimiter</var> <tt>::=</tt> <code><b>(</b></code> |  <code><b>)</b></code> |  <code><b>[</b></code> | <code><b>]</b></code> | <code><b>&quot;</b></code> | <code><b>;</b></code> | <code><b>#</b></code>
         | <a href="#meta_002dwhitespace"><var>whitespace</var></a>
</pre></div>

<p>((UNFINISHED))
</p>
</div>
<div class="subsection" id="Line-endings">
<h4 class="subsection">7.3.2 Line endings</h4>

<p>Line endings are significant in Scheme in single&ndash;line comments
and within string literals.
In Scheme source code, any of the line endings in <var>line-ending</var>
marks the end of a line.  Moreover, the two&ndash;character line endings
<var>carriage-return</var> <var>linefeed</var> and <var>carriage-return</var>
<var>next-line</var> each count as a single line ending.
</p>
<p>In a string literal, a <var>line-ending</var> not preceded by a <code>\</code>
stands for a linefeed character, which is the standard line&ndash;ending
character of Scheme.
</p>
</div>
<div class="subsection" id="Whitespace-and-comments">
<h4 class="subsection">7.3.3 Whitespace and comments</h4>

<div class="display">
<pre class="display"><span id="index-intraline_002dwhitespace"></span><span id="meta_002dintraline_002dwhitespace"></span><var>intraline-whitespace</var> <tt>::=</tt> <var>space</var> | <var>character-tabulation</var>
<span id="index-whitespace"></span><span id="meta_002dwhitespace"></span><var>whitespace</var> <tt>::=</tt>  <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a>
         | <var>linefeed</var> | <var>line-tabulation</var> | <var>form-feed</var>
         | <var>carriage-return</var> | <var>next-line</var>
         | <i>any character whose category is Zs, Zl, or Zp</i>
<span id="index-line_002dending"></span><span id="meta_002dline_002dending"></span><var>line-ending</var> <tt>::=</tt> <var>linefeed</var> | <var>carriage return</var>
         | <var>carriage-return</var> <var>linefeed</var> | <var>next-line</var>
         | <var>carriage-return</var> <var>next-line</var> | <var>line-separator</var>
<span id="index-comment"></span><span id="meta_002dcomment"></span><var>comment</var> <tt>::=</tt>  <code><b>;</b></code> all subsequent characters up to a <var>line-ending</var>
                or <var>paragraph-separator</var>
         | <a href="#meta_002dnested_002dcomment"><var>nested-comment</var></a>
         | <code><b>#;</b></code> <a href="#meta_002dinterlexeme_002dspace"><var>interlexeme-space</var></a> <a href="#meta_002ddatum"><var>datum</var></a>
         | <a href="#meta_002dshebang_002dcomment"><var>shebang-comment</var></a>
<span id="index-nested_002dcomment"></span><span id="meta_002dnested_002dcomment"></span><var>nested-comment</var> <tt>::=</tt>  <code><b>#|</b></code> <a href="#meta_002dcomment_002dtext"><var>comment-text</var></a> <a href="#meta_002dcomment_002dcont"><var>comment-cont</var></a>* <code><b>|#</b></code>
<span id="index-comment_002dtext"></span><span id="meta_002dcomment_002dtext"></span><var>comment-text</var> <tt>::=</tt> character sequence not containing <code><b>#|</b></code> or <code><b>|#</b></code>
<span id="index-comment_002dcont"></span><span id="meta_002dcomment_002dcont"></span><var>comment-cont</var> <tt>::=</tt> <a href="#meta_002dnested_002dcomment"><var>nested-comment</var></a> <a href="#meta_002dcomment_002dtext"><var>comment-text</var></a>
<span id="index-atmosphere"></span><span id="meta_002datmosphere"></span><var>atmosphere</var> <tt>::=</tt> <a href="#meta_002dwhitespace"><var>whitespace</var></a> | <a href="#meta_002dcomment"><var>comment</var></a>
<span id="index-interlexeme_002dspace"></span><span id="meta_002dinterlexeme_002dspace"></span><var>interlexeme-space</var> <tt>::=</tt> <var>atmosphere</var><sup>*</sup>
</pre></div>

<p>As a special case the characters <code><b>#!/</b></code> are treated as starting a comment,
but only at the beginning of file.  These characters are used on
Unix systems as an <a href="http://en.wikipedia.org/wiki/Shebang_(Unix)">Shebang interpreter directive</a>.
The Kawa reader skips the entire line.
If the last non-whitespace character is <code><b>\</b></code>
(backslash) then the following line is also skipped, and so on.
</p><div class="display">
<pre class="display"><span id="index-shebang_002dcomment"></span><span id="meta_002dshebang_002dcomment"></span><var>shebang-comment</var> <tt>::=</tt> <code><b>#!</b></code> <var>absolute-filename</var> text up to non-escaped <var>line-ending</var>
</pre></div>

<p><em>Whitespace</em> characters are spaces, linefeeds, carriage returns,
character tabulations, form feeds, line tabulations, and any other
character whose category is Zs, Zl, or Zp.  Whitespace is used for
improved readability and as necessary to separate lexemes from each
other.  Whitespace may occur between any two lexemes, but not within a
lexeme.  Whitespace may also occur inside a string, where it is
significant.
</p>
<p>The lexical syntax includes several comment forms.  In all cases,
comments are invisible to Scheme, except that they act as delimiters,
so, for example, a comment cannot appear in the middle of an identifier
or representation of a number object.
</p>
<p>A semicolon (<code>;</code>) indicates the start of a line comment.  The
comment continues to the end of the line on which the semicolon appears.
</p>
<p>Another way to indicate a comment is to prefix a <a href="#meta_002ddatum"><var>datum</var></a>
with <code>#;</code>, possibly with
<var>interlexeme-space</var> before the <var>datum</var>.  The comment consists
of the comment prefix <code>#;</code> and the <var>datum</var> together.  This
notation is useful for &ldquo;commenting out&rdquo; sections of code.
</p>
<p>Block comments may be indicated with properly nested <code>#|</code> and
<code>|#</code> pairs.
</p><div class="example">
<pre class="example">#|
   The FACT procedure computes the factorial of a
   non-negative integer.
|#
(define fact
  (lambda (n)
    ;; base case
    (if (= n 0)
        #;(= n 1)
        1       ; identity of *
        (* n (fact (- n 1))))))
</pre></div>


</div>
<div class="subsection" id="Identifiers">
<h4 class="subsection">7.3.4 Identifiers</h4>

<div class="display">
<pre class="display"><span id="index-identifier"></span><span id="meta_002didentifier"></span><var>identifier</var> <tt>::=</tt> <a href="#meta_002dinitial"><var>initial</var></a> <a href="#meta_002dsubsequent"><var>subsequent</var></a>*
         | <a href="#meta_002dpeculiar_002didentifier"><var>peculiar-identifier</var></a>
<span id="index-initial"></span><span id="meta_002dinitial"></span><var>initial</var> <tt>::=</tt> <a href="#meta_002dconstituent"><var>constituent</var></a> | <a href="#meta_002dspecial_002dinitial"><var>special-initial</var></a>
         | <a href="#meta_002dinline_002dhex_002descape"><var>inline-hex-escape</var></a>
<span id="index-letter"></span><span id="meta_002dletter"></span><var>letter</var> <tt>::=</tt> <code><b>a</b></code> | <code><b>b</b></code> | <code><b>c</b></code> | ... | <code><b>z</b></code>
         | <code><b>A</b></code> | <code><b>B</b></code> | <code><b>C</b></code> | ... | <code><b>Z</b></code>
<span id="index-constituent"></span><span id="meta_002dconstituent"></span><var>constituent</var> <tt>::=</tt> <a href="#meta_002dletter"><var>letter</var></a>
         | <i>any character whose Unicode scalar value is greater than
             127, and whose category is Lu, Ll, Lt, Lm, Lo, Mn,
             Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co</i>
<span id="index-special_002dinitial"></span><span id="meta_002dspecial_002dinitial"></span><var>special-initial</var> <tt>::=</tt> <code><b>!</b></code> | <code><b>$</b></code> | <code><b>%</b></code> | <code><b>&amp;</b></code> | <code><b>*</b></code> | <code><b>/</b></code> | <code><b>&lt;</b></code> | <code><b>=</b></code>
         | <code><b>&gt;</b></code> | <code><b>?</b></code> | <code><b>^</b></code> | <code><b>_</b></code> | <code><b>~</b></code>
<span id="index-subsequent"></span><span id="meta_002dsubsequent"></span><var>subsequent</var> <tt>::=</tt> <a href="#meta_002dinitial"><var>initial</var></a> | <a href="#meta_002ddigit"><var>digit</var></a>
         | <i>any character whose category is Nd, Mc, or Me</i>
         | <a href="#meta_002dspecial_002dsubsequent"><var>special-subsequent</var></a>
<span id="index-digit"></span><span id="meta_002ddigit"></span><var>digit</var> <tt>::=</tt> <code><b>0</b></code> | <code><b>1</b></code> | <code><b>2</b></code> | <code><b>3</b></code> | <code><b>4</b></code> | <code><b>5</b></code> | <code><b>6</b></code> | <code><b>7</b></code> | <code><b>8</b></code> | <code><b>9</b></code>
<span id="index-oct_002ddigit"></span><span id="meta_002doct_002ddigit"></span><var>oct-digit</var> <tt>::=</tt> <code><b>0</b></code> | <code><b>1</b></code> | <code><b>2</b></code> | <code><b>3</b></code> | <code><b>4</b></code> | <code><b>5</b></code> | <code><b>6</b></code> | <code><b>7</b></code>
<span id="index-hex_002ddigit"></span><span id="meta_002dhex_002ddigit"></span><var>hex-digit</var> <tt>::=</tt> <a href="#meta_002ddigit"><var>digit</var></a>
         | <code><b>a</b></code> | <code><b>A</b></code> | <code><b>b</b></code> | <code><b>B</b></code> | <code><b>c</b></code> | <code><b>C</b></code> | <code><b>d</b></code> | <code><b>D</b></code> | <code><b>e</b></code> | <code><b>E</b></code> | <code><b>f</b></code> | <code><b>F</b></code>
<span id="index-special_002dsubsequent"></span><span id="meta_002dspecial_002dsubsequent"></span><var>special-subsequent</var> <tt>::=</tt> <code><b>+</b></code> | <code><b>-</b></code> | <code><b>.</b></code> | <code><b>@</b></code>
<span id="index-escape_002dsequence"></span><span id="meta_002descape_002dsequence"></span><var>escape-sequence</var> <tt>::=</tt> <a href="#meta_002dinline_002dhex_002descape"><var>inline-hex-escape</var></a>
         | <code><b>\</b></code><a href="#meta_002dcharacter_002dexcept_002dx"><var>character-except-x</var></a>
         | <a href="#meta_002dmulti_002descape_002dsequence"><var>multi-escape-sequence</var></a>
<span id="index-inline_002dhex_002descape"></span><span id="meta_002dinline_002dhex_002descape"></span><var>inline-hex-escape</var> <tt>::=</tt> <code><b>\x</b></code><a href="#meta_002dhex_002dscalar_002dvalue"><var>hex-scalar-value</var></a><code><b>;</b></code>
<span id="index-hex_002dscalar_002dvalue"></span><span id="meta_002dhex_002dscalar_002dvalue"></span><var>hex-scalar-value</var> <tt>::=</tt> <a href="#meta_002dhex_002ddigit"><var>hex-digit</var></a>+
<span id="index-multi_002descape_002dsequence"></span><span id="meta_002dmulti_002descape_002dsequence"></span><var>multi-escape-sequence</var> <tt>::=</tt> <code><b>|</b></code><a href="#meta_002dsymbol_002delement"><var>symbol-element</var></a><sup>*</sup><code><b>|</b></code>
<span id="index-symbol_002delement"></span><span id="meta_002dsymbol_002delement"></span><var>symbol-element</var> <tt>::=</tt>  <i>any character except</i> <code><b>|</b></code> <i>or</i> <code><b>\</b></code>
         | <a href="#meta_002dinline_002dhex_002descape"><var>inline-hex-escape</var></a> | <a href="#meta_002dmnemonic_002descape"><var>mnemonic-escape</var></a> | <code><b>\|</b></code>

<span id="index-character_002dexcept_002dx"></span><span id="meta_002dcharacter_002dexcept_002dx"></span><var>character-except-x</var> <tt>::=</tt> <i>any character except <code>x</code></i>
<span id="index-peculiar_002didentifier"></span><span id="meta_002dpeculiar_002didentifier"></span><var>peculiar-identifier</var> <tt>::=</tt> <code><b>+</b></code> | <code><b>-</b></code> | <code><b>...</b></code> | <code><b>-&gt;</b></code> <var>subsequent</var><sup>*</sup>
</pre></div>

<p>Most identifiers allowed by other programming languages are also
acceptable to Scheme.  In general, a sequence of letters, digits, and
&ldquo;extended alphabetic characters&rdquo; is an identifier when it begins with
a character that cannot begin a representation of a number object.  In
addition, <code>+</code>, <code>-</code>, and <code>...</code> are identifiers, as is a
sequence of letters, digits, and extended alphabetic characters that
begins with the two&ndash;character sequence <code>-&gt;</code>.  Here are some
examples of identifiers:
</p>
<div class="example">
<pre class="example">lambda         q                soup
list-&gt;vector   +                V17a
&lt;=             a34kTMNs         -&gt;-
the-word-recursion-has-many-meanings
</pre></div>

<p>Extended alphabetic characters may be used within identifiers as if they
were letters.  The following are extended alphabetic characters:
</p>
<div class="example">
<pre class="example">! $ % &amp; * + - . / &lt; = &gt; ? @ ^ _ ~
</pre></div>

<p>Moreover, all characters whose Unicode scalar values are greater than
127 and whose Unicode category is Lu, Ll, Lt, Lm, Lo, Mn, Mc, Me, Nd,
Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co can be used within
identifiers.  In addition, any character can be used within an
identifier when specified using an <var>escape-sequence</var>.  For example,
the identifier <code>H\x65;llo</code> is the same as the identifier
<code>Hello</code>.
</p>
<p>Kawa supports two additional non-R6RS ways of making
identifiers using special characters, both taken from Common Lisp:
Any character (except <code>x</code>) following a backslash is treated
as if it were a <var>letter</var>;
as is any character between a pair of vertical bars.
</p>

<p>Identifiers have two uses within Scheme programs:
</p><ul>
<li> Any identifier may be used as a <a href="#variable_002dreference">variable</a>
or as a <a href="#macro_002dreference">syntactic keyword</a>.
</li><li> When an identifier appears as or with in <a href="#literal_002dexpression">literal</a>,
it is being used to denote a <a href="#Simple-symbols">symbol</a>.
</li></ul>

<p>In contrast with older versions of Scheme, the syntax distinguishes
between upper and lower case in identifiers and in characters
specified via their names, but not in numbers, nor in inline hex
escapes used in the syntax of identifiers, characters, or strings.
The following directives give explicit control over case folding.
</p>
<dl class="def">
<dt id="index-_0023_0021fold_002dcase"><span class="category">Syntax: </span><span><strong>#!fold-case</strong><a href='#index-_0023_0021fold_002dcase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_0023_0021no_002dfold_002dcase"><span class="category">Syntax: </span><span><strong>#!no-fold-case</strong><a href='#index-_0023_0021no_002dfold_002dcase' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These directives may appear anywhere comments are permitted and are
treated as comments, except that they affect the reading of subsequent
data.  The <code>#!fold-case</code> directive causes the <code>read</code>
procedure to case-fold (as if by <code>string-foldcase</code>) each
identifier and character name subsequently read from the same
port. The <code>#!no-fold-case</code> directive causes the <code>read</code>
procedure to return to the default, non-folding behavior.
</p></dd></dl>

<p>Note that colon <code>:</code> is treated specially for
<a href="#Colon-notation">colon notation</a> in Kawa Scheme,
though it is a <var>special-initial</var> in standard Scheme (R6RS).
</p>
</div>
<div class="subsection" id="Numbers-2">
<h4 class="subsection">7.3.5 Numbers</h4>

<p>((INCOMPLETE))
</p>
<div class="display">
<pre class="display"><span id="index-number"></span><span id="meta_002dnumber"></span><var>number</var> <tt>::=</tt> ((TODO))
  | <a href="#meta_002dquantity"><var>quantity</var></a>
<span id="index-decimal"></span><span id="meta_002ddecimal"></span><var>decimal</var> <tt>::=</tt> <a href="#meta_002ddigit"><var>digit</var></a>+ <a href="#meta_002doptional_002dexponent"><var>optional-exponent</var></a>
  | <code><b>.</b></code> <a href="#meta_002ddigit"><var>digit</var></a>+ <a href="#meta_002doptional_002dexponent"><var>optional-exponent</var></a>
  | <a href="#meta_002ddigit"><var>digit</var></a>+ <code><b>.</b></code> <a href="#meta_002ddigit"><var>digit</var></a>+ <a href="#meta_002doptional_002dexponent"><var>optional-exponent</var></a>
</pre></div>

<div class="display">
<pre class="display"><span id="index-optional_002dexponent"></span><span id="meta_002doptional_002dexponent"></span><var>optional-exponent</var> <tt>::=</tt> <i>empty</i>
  | <a href="#meta_002dexponent_002dmarker"><var>exponent-marker</var></a> <a href="#meta_002doptional_002dsign"><var>optional-sign</var></a> <a href="#meta_002ddigit"><var>digit</var></a>+
<span id="index-exponent_002dmarker"></span><span id="meta_002dexponent_002dmarker"></span><var>exponent-marker</var> <tt>::=</tt> <code><b>e</b></code> | <code><b>s</b></code> | <code><b>f</b></code> | <code><b>d</b></code> | <code><b>l</b></code>
</pre></div>
<p>The letter used for the exponent in a floating-point literal determines
its type:
</p><dl compact="compact">
<dt><span><code><b>e</b></code></span></dt>
<dd><p>Returns a <code>gnu.math.DFloat</code> - for example <code>12e2</code>.
Note this matches the default when there is no <a href="#meta_002dexponent_002dmarker"><var>exponent-marker</var></a>.
</p></dd>
<dt><span><code><b>s</b></code> or <code><b>f</b></code></span></dt>
<dd><p>Returns a primitive <code>float</code> (or <code>java.lang.Float</code>
when boxed as an object) - for example <code>12s2</code> or <code>12f2</code>.
</p></dd>
<dt><span><code><b>d</b></code></span></dt>
<dd><p>Returns a primitive <code>double</code> (or <code>java.lang.Double</code> when boxed)
- for example <code>12d2</code>.
</p></dd>
<dt><span><code><b>l</b></code></span></dt>
<dd><p>Returns a <code>java.math.BigDecimal</code> - for example <code>12l2</code>.
</p></dd>
</dl>
<div class="display">
<pre class="display"><span id="index-optional_002dsign"></span><span id="meta_002doptional_002dsign"></span><var>optional-sign</var> <tt>::=</tt> <i>empty</i> | <code><b>+</b></code> | <code><b>-</b></code>
<span id="index-digit_002d2"></span><span id="meta_002ddigit_002d2"></span><var>digit-2</var> <tt>::=</tt> <code><b>0</b></code> | <code><b>1</b></code>
<span id="index-digit_002d8"></span><span id="meta_002ddigit_002d8"></span><var>digit-8</var> <tt>::=</tt> <code><b>0</b></code> | <code><b>1</b></code> | <code><b>2</b></code> | <code><b>3</b></code> | <code><b>4</b></code> | <code><b>5</b></code> | <code><b>6</b></code> | <code><b>7</b></code>
<span id="index-digit_002d10"></span><span id="meta_002ddigit_002d10"></span><var>digit-10</var> <tt>::=</tt> <a href="#meta_002ddigit"><var>digit</var></a>
<span id="index-digit_002d16"></span><span id="meta_002ddigit_002d16"></span><var>digit-16</var> <tt>::=</tt> <a href="#meta_002ddigit_002d10"><var>digit-10</var></a> | <code><b>a</b></code> | <code><b>b</b></code> | <code><b>c</b></code> | <code><b>d</b></code> | <code><b>e</b></code> | <code><b>f</b></code>
</pre></div>

<hr>
</div>
</div>
<div class="section" id="Datum-syntax">
<div class="header">
<p>
Next: <a href="#Hash_002dprefixed-forms" accesskey="n" rel="next">Hash-prefixed forms</a>, Previous: <a href="#Lexical-syntax" accesskey="p" rel="prev">Lexical syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Datum-syntax-1"></span><h3 class="section">7.4 Datum syntax</h3>

<p>The datum syntax describes the syntax of syntactic data in terms of a
sequence of <var>lexeme</var>s, as defined in the lexical syntax.
</p>
<p>The following grammar describes the syntax of syntactic data in terms of
various kinds of lexemes defined in the grammar in section &ldquo;Lexical
Syntax&rdquo;:
</p>
<div class="display">
<pre class="display"><span id="index-datum"></span><span id="meta_002ddatum"></span><var>datum</var> <tt>::=</tt> <a href="#meta_002ddefining_002ddatum"><var>defining-datum</var></a>
         | <a href="#meta_002dnondefining_002ddatum"><var>nondefining-datum</var></a>
         | <a href="#meta_002ddefined_002ddatum"><var>defined-datum</var></a>
<span id="index-nondefining_002ddatum"></span><span id="meta_002dnondefining_002ddatum"></span><var>nondefining-datum</var> <tt>::=</tt> <a href="#meta_002dlexeme_002ddatum"><var>lexeme-datum</var></a>
         | <a href="#meta_002dcompound_002ddatum"><var>compound-datum</var></a>

<span id="index-lexeme_002ddatum"></span><span id="meta_002dlexeme_002ddatum"></span><var>lexeme-datum</var> <tt>::=</tt> <a href="#meta_002dboolean"><var>boolean</var></a> | <var>number</var>
         | <a href="#meta_002dcharacter"><var>character</var></a> | <a href="#meta_002dstring"><var>string</var></a> | <a href="#meta_002dsymbol"><var>symbol</var></a>
<span id="index-symbol"></span><span id="meta_002dsymbol"></span><var>symbol</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-compound_002ddatum"></span><span id="meta_002dcompound_002ddatum"></span><var>compound-datum</var> <tt>::=</tt> <a href="#meta_002dlist"><var>list</var></a> | <a href="#meta_002dvector"><var>vector</var></a> | <a href="#meta_002duniform_002dvector"><var>uniform-vector</var></a> | <a href="#meta_002darray_002dliteral"><var>array-literal</var></a> | <a href="#meta_002dextended_002dstring_002dliteral"><var>extended-string-literal</var></a> | <a href="#meta_002dxml_002dliteral"><var>xml-literal</var></a>
<span id="index-list"></span><span id="meta_002dlist"></span><var>list</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002ddatum"><var>datum</var></a>*<code><b>)</b></code>
         | <code><b>(</b></code><a href="#meta_002ddatum"><var>datum</var></a><sup>+</sup> <code><b>.</b></code> <a href="#meta_002ddatum"><var>datum</var></a><code><b>)</b></code>
         | <a href="#meta_002dabbreviation"><var>abbreviation</var></a>
<span id="index-vector"></span><span id="meta_002dvector"></span><var>vector</var> <tt>::=</tt> <code><b>#(</b></code><a href="#meta_002ddatum"><var>datum</var></a><sup>*</sup><code><b>)</b></code>
</pre></div>

<span id="datum-labels"></span><ul class="section-toc">
<li><a href="#Datum-labels" accesskey="1">Datum labels</a></li>
<li><a href="#Abbreviations" accesskey="2">Abbreviations</a></li>
</ul>
<div class="subsection" id="Datum-labels">
<h4 class="subsection">7.4.1 Datum labels</h4>

<div class="display">
<pre class="display"><span id="index-datum_002dlabel"></span><span id="meta_002ddatum_002dlabel"></span><var>datum-label</var> <tt>::=</tt> <code><b>#</b></code><a href="#meta_002dindexnum"><var>indexnum</var></a><code><b>=</b></code>
<span id="index-defining_002ddatum"></span><span id="meta_002ddefining_002ddatum"></span><var>defining-datum</var> <tt>::=</tt> <a href="#meta_002ddatum_002dlabel"><var>datum-label</var></a><sup>+</sup><a href="#meta_002dnondefining_002ddatum"><var>nondefining-datum</var></a>
<span id="index-defined_002ddatum"></span><span id="meta_002ddefined_002ddatum"></span><var>defined-datum</var> <tt>::=</tt> <code><b>#</b></code><a href="#meta_002dindexnum"><var>indexnum</var></a><code><b>#</b></code>
<span id="index-indexnum"></span><span id="meta_002dindexnum"></span><var>indexnum</var> <tt>::=</tt> <a href="#meta_002ddigit"><var>digit</var></a><sup>+</sup>
</pre></div>

<p>The lexical syntax <code>#<var>n</var>=<var>datum</var></code> reads the
same as <var>datum</var>, but also results in <var>datum</var> being
labelled by <var>n</var>, which must a sequence of digits.
</p>
<p>The lexical syntax <code>#<var>n</var>#</code> serves as a reference to some
object labelled by <code>#<var>n</var>=</code>; the result is the same object
(in the sense of <code>eq?</code>) as the <code>#<var>n</var>=</code>.
</p>
<p>Together, these syntaxes permit the notation of structures
with shared or circular substructure.
</p>
<div class="example">
<pre class="example">(let ((x (list 'a 'b 'c)))
  (set-cdr! (cddr x) x)
  x)    &rArr; #0=(a b c . #0#)
</pre></div>

<p>The scope of a datum label is the portion of the outermost
datum in which it appears that is to the right of the label.
Consequently, a reference <code>#<var>n</var>#</code> can occur
only after a label <code>#<var>n</var>=</code>;
it is an error to attempt a forward reference.
In addition, it is an error if the reference appears as the labelled
object itself (as in <code>#<var>n</var>=#<var>n</var>#</code>), because the object
labelled by <code>#<var>n</var>=</code> is not well defined in this case.
</p>


</div>
<div class="subsection" id="Abbreviations">
<h4 class="subsection">7.4.2 Abbreviations</h4>

<div class="display">
<pre class="display"><span id="index-abbreviation"></span><span id="meta_002dabbreviation"></span><var>abbreviation</var> <tt>::=</tt> <a href="#meta_002dr6rs_002dabbreviation"><var>r6rs-abbreviation</var></a> | <a href="#meta_002dkawa_002dabbreviation"><var>kawa-abbreviation</var></a>
<span id="index-r6rs_002dabbreviation"></span><span id="meta_002dr6rs_002dabbreviation"></span><var>r6rs-abbreviation</var> <tt>::=</tt> <a href="#meta_002dabbrev_002dprefix"><var>abbrev-prefix</var></a> <a href="#meta_002ddatum"><var>datum</var></a>
<span id="index-abbrev_002dprefix"></span><span id="meta_002dabbrev_002dprefix"></span><var>abbrev-prefix</var> <tt>::=</tt> <code><b>&rsquo;</b></code> | <code><b>&lsquo;</b></code> | <code><b>,</b></code> | <code><b>,@</b></code>
         | <code><b>#&rsquo;</b></code> | <code><b>#&lsquo;</b></code>
<span id="index-kawa_002dabbreviation"></span><span id="meta_002dkawa_002dabbreviation"></span><var>kawa-abbreviation</var> <tt>::=</tt> XXX
</pre></div>

<p>The following abbreviations are expanded at read-time:
</p>
<dl compact="compact">
<dt><span><code><b>&rsquo;</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(quote</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>&lsquo;</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(quasiquote</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>,</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(unquote</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>,@</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(unquote-splicing</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>#&rsquo;</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(syntax</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>#&lsquo;</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(quasisyntax</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><code><b>#,</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(unsyntax</b></code> <var>datum</var><code><b>)</b></code>.
This abbreviation is currently only recognized when nested inside an explicit
<code><b>#&lsquo;</b></code><var>datum</var> form,
because of a conflict with SRFI-10 named constructors.
</p>
</dd>
<dt><span><code><b>#,@</b></code><var>datum</var></span></dt>
<dd><p>means <code><b>(unsyntax-splicing</b></code> <var>datum</var><code><b>)</b></code>.
</p>
</dd>
<dt><span><var>datum1</var><code><b>:</b></code><var>datum2</var></span></dt>
<dd><p>means <code><b>($lookup$</b></code> <var>datum1</var> <code><b>(quasiquote</b></code> <var>datum2</var><code><b>))</b></code>.
See <a href="#Colon-notation">Property access using colon notation</a>.
</p>
</dd>
<dt><span><code><b>[</b></code><var>expression</var> ...<code><b>]</b></code></span></dt>
<dd><p>means <code><b>($bracket-list$</b></code> <var>expression</var> ...<code><b>)</b></code>.
</p>
</dd>
<dt><span><var>operator</var><code><b>[</b></code><var>expression</var> ...<code><b>]</b></code></span></dt>
<dd><p>means <code><b>($bracket-apply$</b></code> <var>operator</var> <var>expression</var> ...<code><b>)</b></code>.
</p>
</dd>
</dl>

<hr>
</div>
</div>
<div class="section" id="Hash_002dprefixed-forms">
<div class="header">
<p>
Next: <a href="#Primitive-expression-syntax" accesskey="n" rel="next">Primitive expression syntax</a>, Previous: <a href="#Datum-syntax" accesskey="p" rel="prev">Datum syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Hash_002dprefixed-forms-1"></span><h3 class="section">7.5 Hash-prefixed forms</h3>

<p>A number of different special forms are indicated by an
initial hash (number) symbols (<code>#</code>).
Here is a table summarizing them.
</p>
<p>Case is ignored for the character followed the <code>#</code>.
Thus <code>#x</code> and <code>#X</code> are the same.
</p>
<dl compact="compact">
<dt><span><code><b>#:</b></code><var>keyword</var></span></dt>
<dd><p>Guile-style <a href="#Keywords">keyword</a> syntax.
</p></dd>
<dt><span><code><b>#\</b></code></span></dt>
<dd><p><a href="#meta_002dcharacter">Character literals</a>.
</p></dd>
<dt><span><code><b>#!</b></code></span></dt>
<dd><p>See <a href="#Special-named-constants">Special named constants</a>.
</p></dd>
<dt><span><code><b>#&lsquo;</b></code><var>datum</var></span></dt>
<dd><p>Equivalent to <code>(quasisyntax <var>datum</var>)</code>.
Convenience syntax for syntax-case macros.
</p></dd>
<dt><span><code><b>#&rsquo;</b></code><var>datum</var></span></dt>
<dd><p>Equivalent to <code>(syntax <var>datum</var>)</code>.
Convenience syntax for syntax-case macros.
</p></dd>
<dt><span><code><b>#,</b></code><var>datum</var></span></dt>
<dd><p>Equivalent to <code>(unsyntax <var>datum</var>)</code>.
Currently only recognized when inside a <code>#`<var>template</var></code> form. 
Convenience syntax for syntax-case macros.
</p></dd>
<dt><span><code><b>#,(</b></code><var>name</var> <var>datum</var> ...<code><b>)</b></code></span></dt>
<dd><p>Special named constructors.
This syntax is deprecated, because it conflicts with <code>unsyntax</code>.
It is only recognized when <em>not</em> in a <code>#`<var>template</var></code> form.
</p></dd>
<dt><span><code><b>#,@</b></code><var>datum</var></span></dt>
<dd><p>Equivalent to <code>(unsyntax-splicing <var>datum</var>)</code>.
</p></dd>
<dt><span><code><b>#(</b></code></span></dt>
<dd><p>A vector.
</p></dd>
<dt><span><code><b>#|</b></code></span></dt>
<dd><p>Start of nested-comment.
</p></dd>
<dt><span><code><b>#/</b></code><var>regex</var><code><b>/</b></code></span></dt>
<dd><p>See <a href="#Regular-expressions">Regular expressions</a>.
</p></dd>
<dt><span><code><b>#&lt;</b></code></span></dt>
<dd><p>See <a href="#XML-literals">XML literals</a>.
</p></dd>
<dt><span><code><b>#;</b></code><var>datum</var></span></dt>
<dd><p>A datum comment - the <var>datum</var> is ignored.
(An <var>interlexeme-space</var> may appear before the <var>datum</var>.)
</p></dd>
<dt><span><code><b>#</b></code><var>number</var><code><b>=</b></code><var>datum</var></span></dt>
<dd><p>A reference definition, allowing cyclic and shared structure.
Equivalent to the <var>datum</var>, but also defines an association between
the integer <var>number</var> and that <var>datum</var>, which can be
used by a subsequent <code>#<var>number</var>#</code> form.
</p></dd>
<dt><span><code><b>#</b></code><var>number</var><code><b>#</b></code></span></dt>
<dd><p>A back-reference, allowing cyclic and shared structure.
</p></dd>
<dt><span><code><b>#</b></code><var>R</var><code><b>a</b></code><var>datum</var></span></dt>
<dd><p>An <a href="#array_002dliterals">array literal</a>,
for a multi-dimensional array of rank <var>R</var>.
</p></dd>
<dt><span><code><b>#b</b></code></span></dt>
<dd><p>A binary (base-2) number.
</p></dd>
<dt><span><code><b>#d</b></code></span></dt>
<dd><p>A decimal (base-10) number.
</p></dd>
<dt><span><code><b>#e</b></code></span></dt>
<dd><p>A prefix to treat the following number as exact.
</p></dd>
<dt><span><code><b>#f</b></code></span></dt>
<dt><span><code><b>#false</b></code></span></dt>
<dd><p>The standard boolean false object.
</p></dd>
<dt><span><code><b>#f</b></code><var>n</var><code><b>(</b></code><var>number</var> ...<code><b>)</b></code></span></dt>
<dd><p>A uniform vector of floating-point numbers.
The parameter <var>n</var> is a precision, which can be 32 or 64.
See <a href="#Uniform-vectors">Uniform vectors</a>.
</p></dd>
<dt><span><code><b>#i</b></code></span></dt>
<dd><p>A prefix to treat the following number as inexact.
</p></dd>
<dt><span><code><b>#o</b></code></span></dt>
<dd><p>An octal (base-8) number.
</p></dd>
<dt><span><code><b>#</b></code><var>base</var><code><b>r</b></code></span></dt>
<dd><p>A number in the specified <var>base</var> (radix).
</p></dd>
<dt><span><code><b>#s</b></code><var>n</var><code><b>(</b></code><var>number</var> ...<code><b>)</b></code></span></dt>
<dd><p>A uniform vector of signed integers.
The parameter <var>n</var> is a precision, which can be 8, 16, 32, or 64.
See <a href="#Uniform-vectors">Uniform vectors</a>.
</p></dd>
<dt><span><code><b>#t</b></code></span></dt>
<dt><span><code><b>#true</b></code></span></dt>
<dd><p>The standard boolean true object.
</p></dd>
<dt><span><code><b>#u</b></code><var>n</var><code><b>(</b></code><var>number</var> ...<code><b>)</b></code></span></dt>
<dd><p>A uniform vector of unsigned integers.
The parameter <var>n</var> is a precision, which can be 8, 16, 32, or 64.
See <a href="#Uniform-vectors">Uniform vectors</a>.
</p></dd>
<dt><span><code><b>#x</b></code></span></dt>
<dd><p>A hexadecimal (base-16) number.
</p></dd>
</dl>

<p>The follow named constructor forms are supported:
</p>
<dl compact="compact">
<dt><span><code><b>#,(path</b></code> <var>path</var><code><b>)</b></code></span></dt>
<dt><span><code><b>#,(filepath</b></code> <var>path</var><code><b>)</b></code></span></dt>
<dt><span><code><b>#,(URI</b></code> <var>path</var><code><b>)</b></code></span></dt>
<dt><span><code><b>#,(symbol</b></code> <var>local-name</var> [<var>uri</var> [<var>prefix</var>]]<code><b>)</b></code></span></dt>
<dt><span><code><b>#,(symbol</b></code> <var>local-name</var> <var>namespace</var><code><b>)</b></code></span></dt>
<dt><span><code><b>#,(namespace</b></code> <var>uri</var> [<var>prefix</var>]<code><b>)</b></code></span></dt>
<dt><span><code><b>#,(duration</b></code> <var>duration</var><code><b>)</b></code></span></dt>
</dl>

<hr>
</div>
<div class="section" id="Primitive-expression-syntax">
<div class="header">
<p>
Next: <a href="#Colon-notation" accesskey="n" rel="next">Property access using colon notation</a>, Previous: <a href="#Hash_002dprefixed-forms" accesskey="p" rel="prev">Hash-prefixed forms</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Primitive-expression-syntax-1"></span><h3 class="section">7.6 Primitive expression syntax</h3>

<div class="display">
<pre class="display"><span id="index-expression"></span><span id="meta_002dexpression"></span><var>expression</var> <tt>::=</tt> <a href="#meta_002dliteral_002dexpression"><var>literal-expression</var></a> | <a href="#meta_002dvariable_002dreference"><var>variable-reference</var></a>
  | <a href="#meta_002dprocedure_002dcall"><var>procedure-call</var></a> | TODO
</pre></div>

<span id="literal_002dexpression"></span><ul class="section-toc">
<li><a href="#Literal-expressions" accesskey="1">Literal expressions</a></li>
<li><a href="#Variable-references" accesskey="2">Variable references</a></li>
<li><a href="#Procedure-calls" accesskey="3">Procedure calls</a></li>
</ul>
<div class="subsection" id="Literal-expressions">
<h4 class="subsection">7.6.1 Literal expressions</h4>

<div class="display">
<pre class="display"><span id="index-literal_002dexpression"></span><span id="meta_002dliteral_002dexpression"></span><var>literal-expression</var> <tt>::=</tt> <code><b>(quote</b></code> <a href="#meta_002ddatum"><var>datum</var></a><code><b>)</b></code>
  | <code><b>&rsquo;</b></code> <a href="#meta_002ddatum"><var>datum</var></a>
  | <var>constant</var> 
<span id="index-constant"></span><span id="meta_002dconstant"></span><var>constant</var> <tt>::=</tt> <var>number</var> | <var>boolean</var> | <var>character</var> | <var>string</var>
</pre></div>

<p><code>(quote <var>datum</var>)</code> evaluates to <var>datum</var>,
which may be any external representation of a Scheme object.
This notation is used to include literal constants in Scheme code.
</p><div class="example">
<pre class="example">(quote a)               &rArr;  a 
(quote #(a b c))        &rArr;  #(a b c)
(quote (+ 1 2))         &rArr;  (+ 1 2)
</pre></div>

<p><code>(quote <var>datum</var>)</code> may be abbreviated as <code>'<var>datum</var></code>.
The two notations are equivalent in all respects.
</p><div class="example">
<pre class="example">’a                      &rArr;  a
’#(a b c)               &rArr;  #(a b c)
’()                     &rArr;  ()
’(+ 1 2)                &rArr;  (+ 1 2)
’(quote a)              &rArr;  (quote a)
’’a                     &rArr;  (quote a)
</pre></div>

<p>Numerical constants, string constants, character constants,
bytevector constants, and boolean constants evaluate to
themselves; they need not be quoted.
</p>
<div class="example">
<pre class="example">145932          &rArr;  145932
#t              &rArr;  #t
&quot;abc&quot;           &rArr;  &quot;abc&quot;
</pre></div>

<p>Note that <a href="#Keywords">keywords</a> need to be quoted,
unlike some other Lisp/Scheme dialect, including Common Lisp,
and earlier versions of Kawa.  (Kawa currently evaluates a non-quoted
keyword as itself, but that will change.)
</p>
<span id="variable_002dreference"></span></div>
<div class="subsection" id="Variable-references">
<h4 class="subsection">7.6.2 Variable references</h4>

<div class="display">
<pre class="display"><span id="index-variable_002dreference"></span><span id="meta_002dvariable_002dreference"></span><var>variable-reference</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>
<p>An expression consisting of a variable is a variable reference if it is
not a macro use (see below).  The value of the variable reference is the
value stored in the location to which the variable is bound.  It is a
syntax violation to reference an unbound variable.
</p>
<p>The following example assumes the base library has been
imported:
</p>
<div class="example">
<pre class="example">(define x 28)
x   &rArr;  28
</pre></div>

</div>
<div class="subsection" id="Procedure-calls">
<h4 class="subsection">7.6.3 Procedure calls</h4>

<div class="display">
<pre class="display"><span id="index-procedure_002dcall"></span><span id="meta_002dprocedure_002dcall"></span><var>procedure-call</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002doperator"><var>operator</var></a> <a href="#meta_002doperand"><var>operand</var></a> &hellip;)
<span id="index-operator"></span><span id="meta_002doperator"></span><var>operator</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-operand"></span><span id="meta_002doperand"></span><var>operand</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
  | <a href="#meta_002dkeyword"><var>keyword</var></a> <a href="#meta_002dexpression"><var>expression</var></a>
  | <code>@</code> <a href="#meta_002dexpression"><var>expression</var></a>
  | <code>@:</code> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>A procedure call consists of expressions for the procedure to be called
and the arguments to be passed to it, with enclosing parentheses.  A
form in an expression context is a procedure call if <var>operator</var> is
not an identifier bound as a syntactic keyword.
</p>
<p>When a procedure call is evaluated, the operator and operand expressions
are evaluated (in an unspecified order) and the resulting procedure is
passed the resulting arguments.
</p>
<div class="example">
<pre class="example">(+ 3 4)                &rArr;  7
((if #f + *) 3 4)      &rArr;  12
</pre></div>

<p>The syntax <a href="#meta_002dkeyword"><var>keyword</var></a> <var>expression</var> is a <em>keyword argument</em>.
This is a mechanism for specifying arguments using a name rather than position,
and is especially useful for procedures with many optional paramaters.
Note that <a href="#meta_002dkeyword"><var>keyword</var></a> must be literal, and cannot be the
result from evaluating a non-literal expression.
(This is a change from previous versions of Kawa,
and is different from Common Lisp and some other Scheme dialects.)
</p>
<p>An expression prefixed by <code>@</code> or <code>@:</code> is
a splice argument.  The following expression must evaluate to an
&ldquo;argument list&rdquo; (see <a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a> for details);
each element in the argument
becomes a separate argument when call the <var>operator</var>.
(This is very similar to the &ldquo;spread&rdquo; operator is EcmaScript 6.)
</p>
<hr>
</div>
</div>
<div class="section" id="Colon-notation">
<div class="header">
<p>
Next: <a href="#Bodies" accesskey="n" rel="next">Programs and Bodies</a>, Previous: <a href="#Primitive-expression-syntax" accesskey="p" rel="prev">Primitive expression syntax</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Property-access-using-colon-notation"></span><h3 class="section">7.7 Property access using colon notation</h3>

<p>The <em>colon notation</em> accesses named parts (properties) of a value.
It is used to get and set fields, call methods, construct compound symbols,
and more.
Evaluating the form <code><var>owner</var>:<var>property</var></code>
evaluates the <code><var>owner</var></code> then it extracts the named <code><var>property</var></code> of the result.
</p>
<div class="display">
<pre class="display"><span id="index-property_002daccess_002dabbreviation"></span><span id="meta_002dproperty_002daccess_002dabbreviation"></span><var>property-access-abbreviation</var> <tt>::=</tt> <a href="#meta_002dproperty_002downer_002dexpression"><var>property-owner-expression</var></a><code><b>:</b></code><a href="#meta_002dproperty_002dname"><var>property-name</var></a>
<span id="index-property_002downer_002dexpression"></span><span id="meta_002dproperty_002downer_002dexpression"></span><var>property-owner-expression</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-property_002dname"></span><span id="meta_002dproperty_002dname"></span><var>property-name</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a> | <code><b>,</b></code><a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>The <var>property-name</var> is usually a literal name,
but it can be an unquoted <var>expression</var> (i.e. following a <code>,</code>),
in which case the name is evaluated at run-time.
No separators are allowed on either side of the colon.
</p>
<p>The input syntax <code><var>owner</var>:<var>part</var></code> is translated by
the Scheme reader to the internal representation <code>($lookup$ <var>owner</var> (quasiquote <var>part</var>))</code>.
</p>
<ul class="section-toc">
<li><a href="#Part-lookup-rules" accesskey="1">Part lookup rules</a></li>
<li><a href="#Specific-cases" accesskey="2">Specific cases</a></li>
</ul>
<div class="subsection" id="Part-lookup-rules">
<h4 class="subsection">7.7.1 Part lookup rules</h4>

<p>Evaluation proceeds as follows.
First <var>property-owner-expression</var> is
evaluated to yield an <var>owner</var> object.
Evaluating the <var>property-name</var> yields a <var>part</var> name,
which is a simple symbol: Either
the literal <var>identifier</var>, or the result of evaluating the
property-name <var>expression</var>.
If the <var>expression</var> evaluates to a string, it is converted to
a symbol, as if using <code>string-&gt;symbol</code>.
</p>
<ul>
<li> If the <var>owner</var> implements <code>gnu.mapping.HasNamedParts</code>,
then the result is that of invoking the <code>get</code> method of the <var>owner</var>
with the <var>part</var> name as a parameter.

<p>As a special case of this rule, if <var>owner</var> is a
<code>gnu.mapping.Namespace</code>, then the result is the
<a href="#Namespaces">compound symbol in that namespace</a>.
</p></li><li> If <var>owner</var> is a <code>java.lang.Class</code> or a <code>gnu.bytecode.ObjectType</code>,
the result is the static member named <var>part</var>
(i.e. a static field, method, or member class).
</li><li> If <var>owner</var> is a <code>java.lang.Package</code> object, we get the member
class or sub-package named <var>part</var>.
</li><li> Otherwise, we look for a named member (instance member or field).

<p>Note you can&rsquo;t use colon notation to invoke instance methods
of a <code>Class</code>, because it will match a previous rule.
For example if you want to invoke the <code>getDeclaredMethod</code>
method of the <code>java.util.List</code> , you can&rsquo;t write <code>(java.util.List:getDeclaredMethod</code> because that will look for a static method in <code>java.util.List</code>.
</p></li></ul>

<p>If the colon form is on the left-hand-side of an assignment (<code>set!</code>),
then the named part is modified as appropriate.
</p>

</div>
<div class="subsection" id="Specific-cases">
<h4 class="subsection">7.7.2 Specific cases</h4>

<p>Some of these are deprecated;
more compact and readable forms are usually preferred.
</p>
<ul class="section-toc">
<li><a href="#Invoking-methods" accesskey="1">Invoking methods</a></li>
<li><a href="#Accessing-fields" accesskey="2">Accessing fields</a></li>
<li><a href="#Type-literal" accesskey="3">Type literal</a></li>
<li><a href="#Type-cast" accesskey="4">Type cast</a></li>
<li><a href="#Type-test" accesskey="5">Type test</a></li>
<li><a href="#New-object-construction" accesskey="6">New object construction</a></li>
<li><a href="#Getting-array-length" accesskey="7">Getting array length</a></li>
</ul>
<div class="subsubsection" id="Invoking-methods">
<h4 class="subsubsection">7.7.2.1 Invoking methods</h4>

<div class="display">
<pre class="display"><code><b>(</b></code><var>instance</var><code><b>:</b></code><a href="#meta_002dmethod_002dname"><var>method-name</var></a> <var>arg</var> ...<code><b>)</b></code>
<code><b>(</b></code><var>class</var><code><b>:</b></code><a href="#meta_002dmethod_002dname"><var>method-name</var></a> <var>instance</var> <var>arg</var> ...<code><b>)</b></code>
<code><b>(</b></code><var>class</var><code><b>:</b></code><a href="#meta_002dmethod_002dname"><var>method-name</var></a> <var>arg</var> ...<code><b>)</b></code>
<code><b>(*:</b></code><a href="#meta_002dmethod_002dname"><var>method-name</var></a> <var>instance</var> <var>arg</var> ...<code><b>)</b></code>
</pre></div>

<p>For details see <a href="#Method-operations">Calling Java methods from Scheme</a>.
</p>
</div>
<div class="subsubsection" id="Accessing-fields">
<h4 class="subsubsection">7.7.2.2 Accessing fields</h4>

<div class="display">
<pre class="display"><var>class</var><code><b>:</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a>
<var>instance</var><code><b>:</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a>
<code><b>(</b></code><var>prefix</var><code><b>:.</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a> <var>instance</var><code><b>)</b></code>
</pre></div>

<p>For details see <a href="#Field-operations">Accessing object fields</a>.
</p>
</div>
<div class="subsubsection" id="Type-literal">
<h4 class="subsubsection">7.7.2.3 Type literal</h4>

<div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dtype"><var>type</var></a><code><b>:&lt;&gt;)</b></code>
</pre></div>
<p>Returns the <var>type</var>.
Deprecated; usually you can just write:
</p><div class="example">
<pre class="example"><var>type</var>
</pre></div>

</div>
<div class="subsubsection" id="Type-cast">
<h4 class="subsubsection">7.7.2.4 Type cast</h4>

<div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dtype"><var>type</var></a><code><b>:</b></code><code><b>@</b></code> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code>
</pre></div>
<p>Performs a cast.
Deprecated; usually you can just write:
</p><div class="example">
<pre class="example">-&gt;<var>type</var>
</pre></div>

</div>
<div class="subsubsection" id="Type-test">
<h4 class="subsubsection">7.7.2.5 Type test</h4>

<div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dtype"><var>type</var></a><code><b>:instanceof?</b></code> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code>
</pre></div>

<p>Deprecated; usually you can just write:
</p><div class="example">
<pre class="example">(<var>type</var>? <var>expression</var>)
</pre></div>

</div>
<div class="subsubsection" id="New-object-construction">
<h4 class="subsubsection">7.7.2.6 New object construction</h4>

<div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dtype"><var>type</var></a><code><b>:new</b></code> <var>arg</var> ...<code><b>)</b></code>
</pre></div>

<p>Deprecated; usually you can just write:
</p><div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dtype"><var>type</var></a> <var>arg</var> ...<code><b>)</b></code>
</pre></div>

</div>
<div class="subsubsection" id="Getting-array-length">
<h4 class="subsubsection">7.7.2.7 Getting array length</h4>

<div class="display">
<pre class="display"><a href="#meta_002dexpression"><var>expression</var></a><code><b>:length</b></code>
<code><b>(</b></code><a href="#meta_002dexpression"><var>expression</var></a><code><b>:.length)</b></code>
</pre></div>


<hr>
</div>
</div>
</div>
<div class="section" id="Bodies">
<div class="header">
<p>
Next: <a href="#Syntax-and-conditional-compilation" accesskey="n" rel="next">Syntax and conditional compilation</a>, Previous: <a href="#Colon-notation" accesskey="p" rel="prev">Property access using colon notation</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Programs-and-Bodies"></span><h3 class="section">7.8 Programs and Bodies</h3>

<span id="program-units"></span><span id="Program-units"></span><h4 class="subheading">Program units</h4>

<p>A <var>program-unit</var> consists of a sequence of definitions and expressions.
</p>
<div class="display">
<pre class="display"><span id="index-program_002dunit"></span><span id="meta_002dprogram_002dunit"></span><var>program-unit</var> <tt>::=</tt> <a href="#meta_002dlibrary_002ddefinition"><var>library-definition</var></a><sup>+</sup> [<a href="#meta_002dstatements"><var>statements</var></a>]
  | <a href="#meta_002dstatements"><var>statements</var></a>
<span id="index-statements"></span><span id="meta_002dstatements"></span><var>statements</var> <tt>::=</tt> <a href="#meta_002dstatement"><var>statement</var></a><sup>+</sup>
<span id="index-statement"></span><span id="meta_002dstatement"></span><var>statement</var> <tt>::=</tt> <var>definition</var> | <a href="#meta_002dexpression"><var>expression</var></a> | <code><b>(begin</b></code> <a href="#meta_002dstatement"><var>statement</var></a><sup>*</sup> <code><b>)</b></code>
</pre></div>

<p>Typically a <var>program-unit</var> corresponds to a single source file
(i.e.a named file in the file system).  Evaluating a <var>program-unit</var>
first requires the Kawa processor to analyze
the whole <var>program-unit</var> to determine which names are defined by the
definitions, and then evaluates each <var>statement</var> in order in the context
of the defined names.  The value of an <var>expression</var> is normally
discarded, but may be printed out instead, depending on the evaluating context.
</p>
<p>The read-eval-print-loop (REPL) reads one or more lines until it gets
a valid <var>program-unit</var>, and evaluates it as above, except that the
values of expressions are printed to the console (as if using the
<code>display</code> function).  Then the REPL reads and evaluates
another <var>program-unit</var>, and so on. A definition in an earlier
<var>program-unit</var> is remembered and is visible in a later <var>program-unit</var>
unles it is overridden.
</p>
<span id="index-encoding-specifier"></span>
<span id="index-coding-specifier"></span>
<p>A comment in the first 2 lines of a source file may contain an encoding
specification.  This can be used to tell the reader what kind of character
set encoding is used for the file.  This only works for a character
encoding that is compatible with ASCII (in the sense that if the
high-order bit is clear then it&rsquo;s an ASCII character),
and that are no non-ASCI characters in the lines upto and including
the encoding specification.
A basic example is:
</p><div class="example">
<pre class="example">;; -*- coding: utf-8 -*-
</pre></div>
<p>In general any string that matches the following regular expression works:
</p><div class="example">
<pre class="example">coding[:=]\s*([-a-zA-Z0-9]+)
</pre></div>

<span id="Libraries"></span><h4 class="subheading">Libraries</h4>

<span id="implicit-library"></span><p>A <var>program-unit</var> may contain <var>library-definitions</var>.
In addition, any <var>statements</var> in <var>program-unit</var> comprise
an <em>implicit library</em>, in that it can be given a name, and referenced
from other libraries.
Certain names defined in the <var>program-unit</var> can be exported,
and then they can be imported by other libraries.
For more information see <a href="#Module-classes">Modules and how they are compiled to classes</a>.
</p>
<p>It is recommended but not required that:
</p><ul>
<li> There should be at most one <var>library-definition</var> in a <var>program-unit</var>.
</li><li> The <var>library-name</var> of the <var>library-definition</var> should
match the name of the source file.  For example:
<div class="example">
<pre class="example">(define-library (foo bar) ...)
</pre></div>
<p>should be in a file named <code>foo/bar.scm</code>.
</p></li><li> If there is a <var>library-definition</var>, there should
be no extra <var>statements</var> - i.e no implicit library definition.
(It is disallowed to <code>export</code> any definitions from the
implicit library if there is also a <var>library-definition</var>.)
</li></ul>
<p>Following these recommendations makes it easier to locate
and organize libraries.
However, having multiple libraries in a single <var>program-unit</var>
is occasionally useful for source distribution and for testing.
</p>
<span id="Bodies-1"></span><h4 class="subheading">Bodies</h4>

<p>The <var>body</var> of a <code>lambda</code>, <code>let</code>, <code>let*</code>,
<code>let-values</code>, <code>let*-values</code>, <code>letrec</code>, or <code>letrec*</code>
expression, or that of a definition with a body consists of zero or more
definitions or expressions followed by a final expression.
(Standard Scheme requires that all definitions precede all expressions.)
</p>
<div class="display">
<pre class="display"><span id="index-body"></span><span id="meta_002dbody"></span><var>body</var> <tt>::=</tt> <a href="#meta_002dstatement"><var>statement</var></a><sup>*</sup>
</pre></div>

<p>Each identifier defined by a definition is local to the <var>body</var>.
That is, the identifier is bound, and the region of the binding is the
entire <var>body</var>.
Example:
</p>
<div class="example">
<pre class="example">(let ((x 5))
  (define foo (lambda (y) (bar x y)))
  (define bar (lambda (a b) (+ (* a b) a)))
  (foo (+ x 3)))
&rArr; 45
</pre></div>

<p>When <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms
occur in a body prior to the first expression, they are spliced into the
body.  Some or all of the body, including portions wrapped in
<code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms, may be
specified by a macro use.
</p>
<p>An expanded <var>body</var> containing variable definitions can be
converted into an equivalent <code>letrec*</code> expression.
(If there is a definition following expressions you may need to
convert the expressions to dummy definitions.)     For example,
the <code>let</code> expression in the above example is equivalent to
</p>
<div class="example">
<pre class="example">(let ((x 5))
  (letrec* ((foo (lambda (y) (bar x y)))
            (bar (lambda (a b) (+ (* a b) a))))
    (foo (+ x 3))))
</pre></div>


<hr>
</div>
<div class="section" id="Syntax-and-conditional-compilation">
<div class="header">
<p>
Next: <a href="#Macros" accesskey="n" rel="next">Macros</a>, Previous: <a href="#Bodies" accesskey="p" rel="prev">Programs and Bodies</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Syntax-and-conditional-compilation-1"></span><h3 class="section">7.9 Syntax and conditional compilation</h3>

<span id="Feature-testing"></span><h4 class="subheading">Feature testing</h4>

<dl class="def">
<dt id="index-cond_002dexpand"><span class="category">Syntax: </span><span><strong>cond-expand</strong> <em><a href="#meta_002dcond_002dexpand_002dclause"><var>cond-expand-clause</var></a><sup>*</sup> [<code><b>(else</b></code> command-or-definition*<code><b>)</b></code>]</em><a href='#index-cond_002dexpand' class='copiable-anchor'> &para;</a></span></dt>
<dd><div class="display">
<pre class="display"><span id="index-cond_002dexpand_002dclause"></span><span id="meta_002dcond_002dexpand_002dclause"></span><var>cond-expand-clause</var> <tt>::=</tt> <code><b>(</b></code><var>feature-requirement</var> <var>command-or-definition</var>*<code><b>)</b></code>
<span id="index-fff_002drec"></span><span id="index-feature_002drequirement"></span><span id="meta_002dfeature_002drequirement"></span><var>feature-requirement</var> <tt>::=</tt> <a href="#meta_002dfeature_002didentifier"><var>feature-identifier</var></a>
  | <code><b>(and</b></code> <a href="#meta_002dfeature_002drequirement"><var>feature-requirement</var></a><sup>*</sup><code><b>)</b></code>
  | <code><b>(or</b></code> <a href="#meta_002dfeature_002drequirement"><var>feature-requirement</var></a><sup>*</sup><code><b>)</b></code>
  | <code><b>(not</b></code> <a href="#meta_002dfeature_002drequirement"><var>feature-requirement</var></a><code><b>)</b></code>
  | <code><b>(library</b></code> <a href="#meta_002dlibrary_002dname"><var>library-name</var></a><code><b>)</b></code>
<span id="index-feature_002didentifier"></span><span id="meta_002dfeature_002didentifier"></span><var>feature-identifier</var> <tt>::=</tt> a symbol which is the name or alias of a SRFI
</pre></div>

<p>The <code>cond-expand</code> form tests for the existence of features at
macro-expansion time. It either expands into the body of one of its
clauses or signals an error during syntactic
processing. <code>cond-expand</code> expands into the body of the first clause
whose feature requirement is currently satisfied; the <code>else</code>
clause, if present, is selected if none of the previous clauses is
selected.
</p>
<p>The implementation has a set of
feature identifiers which are &ldquo;present&rdquo;, as well as a set
of libraries which can be imported.
The value of a
<var>feature-requirement</var> is determined by replacing each
<var>feature-identifier</var> by <code>#t</code> if it is present
(and <code>#f</code> otherwise);
replacing <code>(library <var>library-name</var>)</code>
by <code>#t</code> if <var>library-name</var> is importable (and <code>#f</code> otherwise);
and then evaluating the resulting expression as a Scheme boolean expression
under the normal interpretation of <code>and</code>, <code>or</code>, and <code>not</code>.
</p>
<p>Examples:
</p><div class="example">
<pre class="example">(cond-expand
    ((and srfi-1 srfi-10)
     (write 1))
    ((or srfi-1 srfi-10)
     (write 2))
    (else))
</pre></div>

<div class="example">
<pre class="example">(cond-expand
  (command-line
   (define (program-name) (car (argv)))))
</pre></div>

<p>The second example assumes that <code>command-line</code> is an alias for some
feature which gives access to command line arguments. Note that an error
will be signaled at macro-expansion time if this feature is not present.
</p>
<p>You can use <code>java-6</code>, <code>java-7</code>, <code>java-8</code>,
or <code>java-9</code> to check if the underlying Java
is a specific version or newer.
For example the name <code>java-7</code> matches for
either Java 7, Java 8, or newer, as
reported by <code>System</code> property <code>&quot;java.version&quot;</code>.
</p>
<p>You can use <code>class-exists:<var>ClassName</var></code> to check
if <code><var>ClassName</var></code> exists at compile-time.
The identifier <code>class-exists:org.example.MyClass</code>
is roughly equivalent to the test <code>(library (org example MyClass))</code>.
(The latter has some special handling for <code>(srfi ...)</code> as well
as builtin Kawa classes.)
</p></dd></dl>

<dl class="def">
<dt id="index-features"><span class="category">Procedure: </span><span><strong>features</strong><a href='#index-features' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of feature identifiers which <code>cond-expand</code>
treats as true.
This not a complete list - for example <code>class-exists:<var>ClassName</var></code>
feature identifiers are not included.
It is an error to modify this list.
Here is an example of what <code>features</code> might return:
</p><div class="example">
<pre class="example">(features)  &rArr;
(complex exact-complex full-unicode java-7 java-6 kawa
 ratios srfi-0 srfi-4 srfi-6 srfi-8 srfi-9 srfi-11
 srfi-16 srfi-17 srfi-23 srfi-25 srfi-26 srfi-28 srfi-30
 srfi-39 string-normalize-unicode threads)
</pre></div>
</dd></dl>

<span id="File-inclusion"></span><h4 class="subheading">File inclusion</h4>

<span id="include"></span><span id="include_002drelative"></span><dl class="def">
<dt id="index-include"><span class="category">Syntax: </span><span><strong>include</strong> <em>path<sup>+</sup></em><a href='#index-include' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-include_002drelative"><span class="category">Syntax: </span><span><strong>include-relative</strong> <em>path<sup>+</sup></em><a href='#index-include_002drelative' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-include_002dci"><span class="category">Syntax: </span><span><strong>include-ci</strong> <em>path<sup>+</sup></em><a href='#index-include_002dci' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These take one or more path names expressed as string literals,
find corresponding files, read the contents of the files in the specified order
as if by repeated applications of <code>read</code>, and effectively
replace the <code>include</code> with a <code>begin</code> form
containing what was read from the files.
</p>
<p>You can control the search path used for <code>include</code>
by setting the <code>kawa.include.path</code> property.  For example:
</p><div class="example">
<pre class="example">$ kawa -Dkawa.include.path=&quot;|:/opt/kawa-includes&quot;
</pre></div>
<p>The special <code>&quot;|&quot;</code> path element means to search
relative to the directory containing the including source file.
The default search path is <code>&quot;|:.&quot;</code> which means to first
search the directory containing the including source file,
and then search the directory specified by <code>(current-path)</code>.
</p>
<p>The search path for <code>include-relative</code> prepends <code>&quot;|&quot;</code>
before the search path used by <code>include</code>, so it always
searches first the directory containing the including source file.
Note that if the default search path is used then <code>include</code>
and <code>include-relative</code> are equivalent; there is only a difference
if the <code>kawa.include.path</code> property changes the default.
</p>
<p>Using <code>include-ci</code> is like <code>include</code>, except that it reads each
file as if it began with the <code>#!fold-case</code> directive.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Macros">
<div class="header">
<p>
Next: <a href="#Named-quasi_002dliterals" accesskey="n" rel="next">Named quasi-literals</a>, Previous: <a href="#Syntax-and-conditional-compilation" accesskey="p" rel="prev">Syntax and conditional compilation</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Macros-1"></span><h3 class="section">7.10 Macros</h3>
<span id="macro_002dreference"></span>
<p>Libraries and top&ndash;level programs can define and use new kinds of
derived expressions and definitions called <em>syntactic abstractions</em>
or <em>macros</em>.  A syntactic abstraction is created by binding a
keyword to a <em>macro transformer</em> or, simply, <em>transformer</em>.
</p>
<p>The transformer determines how a use of the macro (called a <em>macro
use</em>) is transcribed into a more primitive form.
</p>
<p>Most macro uses have the form:
</p>
<div class="example">
<pre class="example">(<var>keyword</var> <var>datum</var> &hellip;)
</pre></div>
<p>where <var>keyword</var> is an identifier that uniquely determines the kind
of form.  This identifier is called the <em>syntactic keyword</em>, or
simply <em>keyword</em>.  The number of <var>datum</var>s and the syntax of
each depends on the syntactic abstraction.
</p>
<p>Macro uses can also take the form of improper lists, singleton
identifiers, or <code>set!</code> forms, where the second subform of the
<code>set!</code> is the keyword:
</p>
<div class="example">
<pre class="example">(<var>keyword</var> <var>datum</var> &hellip; . <var>datum</var>)
<var>keyword</var>
(set! <var>keyword</var> <var>datum</var>)
</pre></div>

<p>The <code>define-syntax</code>, <code>let-syntax</code> and <code>letrec-syntax</code>
forms create bindings for keywords, associate them with macro
transformers, and control the scope within which they are visible.
</p>
<p>The <code>syntax-rules</code> and <code>identifier-syntax</code> forms create
transformers via a pattern language.  Moreover, the <code>syntax-case</code>
form allows creating transformers via arbitrary Scheme code.
</p>
<p>Keywords occupy the same name space as variables.  That is, within the
same scope, an identifier can be bound as a variable or keyword, or
neither, but not both, and local bindings of either kind may shadow
other bindings of either kind.
</p>
<p>Macros defined using <code>syntax-rules</code> and <code>identifier-syntax</code>
are &ldquo;hygienic&rdquo; and &ldquo;referentially transparent&rdquo; and thus preserve
Scheme&rsquo;s lexical scoping.
</p>
<ul>
<li> If a macro transformer inserts a binding for an identifier (variable or
keyword) not appearing in the macro use, the identifier is in effect
renamed throughout its scope to avoid conflicts with other identifiers.

</li><li> If a macro transformer inserts a free reference to an identifier, the
reference refers to the binding that was visible where the transformer
was specified, regardless of any local bindings that may surround the
use of the macro.
</li></ul>

<p>Macros defined using the <code>syntax-case</code> facility are also hygienic
unless <code>datum-&gt;syntax</code> is used.
</p>
<p>Kawa supports most of the <code>syntax-case</code> feature.
</p>
<p>Syntax definitions are valid wherever definitions are.
They have the following form:
</p>
<dl class="def">
<dt id="index-define_002dsyntax"><span class="category">Syntax: </span><span><strong>define-syntax</strong> <em>keyword <a href="#meta_002dtransformer_002dspec"><var>transformer-spec</var></a></em><a href='#index-define_002dsyntax' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>keyword</var> is a identifier, and <var>transformer-spec</var>
is a function that maps syntax forms to syntax forms,
usually an instance of <code>syntax-rules</code>.
If the <code>define-syntax</code> occurs at the top level, then the top-level
syntactic environment is extended by binding the <var>keyword</var>
to the specified transformer, but existing references to any top-level
binding for <var>keyword</var> remain unchanged.  Otherwise, it is an
<em>internal syntax definition</em>, and is local to the <var>body</var>
in which it is defined.
</p>
<div class="example">
<pre class="example">(let ((x 1) (y 2))
   (define-syntax swap!
     (syntax-rules ()
       ((swap! a b)
        (let ((tmp a))
          (set! a b)
          (set! b tmp)))))
   (swap! x y)
   (list x y))  &rArr; (2 1)
</pre></div>

<p>Macros can expand into definitions in any context that permits them.
However, it is an error for a definition to define an identifier
whose binding has to be known in order to determine the meaning
of the definition itself, or of any preceding definition that belongs
to the same group of internal definitions.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dsyntax_002dcase"><span class="category">Syntax: </span><span><strong>define-syntax-case</strong> <em>name <code><b>(</b></code>literals<code><b>)</b></code> <code><b>(</b></code>pattern expr<code><b>)</b></code> ...</em><a href='#index-define_002dsyntax_002dcase' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A convenience macro to make it easy to define <code>syntax-case</code>-style macros.
Defines a macro with the given <var>name</var> and list of <var>literals</var>.
Each <var>pattern</var> has the form of a <code>syntax-rules</code>-style pattern,
and it is matched against the macro invocation syntax form.
When a match is found, the corresponding <var>expr</var> is evaluated.
It must evaluate to a syntax form,
which replaces the macro invocation.
</p><div class="example">
<pre class="example">(define-syntax-case macro-name (literals)
  (pat1 result1)
  (pat2 result2))
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(define-syntax macro-name
  (lambda (form)
    (syntax-case form (literals)
      (pat1 result1)
      (pat2 result2))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-define_002dmacro"><span class="category">Syntax: </span><span><strong>define-macro</strong> <em><code><b>(</b></code>name lambda-list<code><b>)</b></code> form ...</em><a href='#index-define_002dmacro' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>This form is deprecated.</em>
Functionally equivalent to <code>defmacro</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-defmacro"><span class="category">Syntax: </span><span><strong>defmacro</strong> <em>name lambda-list form ...</em><a href='#index-defmacro' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>This form is deprecated.</em>
Instead of
</p><div class="example">
<pre class="example">(defmacro (<var>name</var> ...)
  (let ... `(... ,<var>exp</var> ...)))
</pre></div>
<p>you should probably do:
</p><div class="example">
<pre class="example">(define-syntax-case <var>name</var> ()
  ((_ ...) (let #`(... #,<var>exp</var> ...))))
</pre></div>
<p>and instead of
</p><div class="example">
<pre class="example">(defmacro (<var>name</var> ... <var>var</var> ...) `(... <var>var</var> ...))
</pre></div>
<p>you should probably do:
</p><div class="example">
<pre class="example">(define-syntax-case <var>name</var> ()
  ((_ ... <var>var</var> ...) #`(... <var>var</var> ...))
</pre></div>

<p>Defines an old-style macro a la Common Lisp,
and installs <code>(lambda <var>lambda-list</var> <var>form</var> ...)</code>
as the expansion function for <var>name</var>.
When the translator sees an application of <var>name</var>,
the expansion function is called with the rest of the application
as the actual arguments.  The resulting object must be a Scheme
source form that is futher processed (it may be repeatedly macro-expanded).
</p></dd></dl>

<dl class="def">
<dt id="index-gentemp"><span class="category">Procedure: </span><span><strong>gentemp</strong><a href='#index-gentemp' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new (interned) symbol each time it is called.
The symbol names are implementation-dependent.
(This is not directly macro-related, but is often used in conjunction
with <code>defmacro</code> to get a fresh unique identifier.)
</p></dd></dl>

<dl class="def">
<dt id="index-expand"><span class="category">Procedure: </span><span><strong>expand</strong> <em>form</em><a href='#index-expand' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The result of evaluating <var>form</var> is treated as a Scheme expression,
syntax-expanded to internal form, and then converted back to (roughly)
the equivalent expanded Scheme form.
</p>
<p>This can be useful for debugging macros.
</p>
<p>To access this function, you must first <code>(require 'syntax-utils)</code>.
</p><div class="example">
<pre class="example">(require 'syntax-utils)
(expand '(cond ((&gt; x y) 0) (else 1))) &rArr; (if (&gt; x y) 0 1)
</pre></div>
</dd></dl>

<ul class="section-toc">
<li><a href="#Pattern-language" accesskey="1">Pattern language</a></li>
<li><a href="#Identifier-predicates" accesskey="2">Identifier predicates</a></li>
<li><a href="#Syntax_002dobject-and-datum-conversions" accesskey="3">Syntax-object and datum conversions</a></li>
<li><a href="#Signaling-errors-in-macro-transformers" accesskey="4">Signaling errors in macro transformers</a></li>
<li><a href="#Convenience-forms" accesskey="5">Convenience forms</a></li>
</ul>
<div class="subsection" id="Pattern-language">
<h4 class="subsection">7.10.1 Pattern language</h4>

<p>A <var>transformer-spec</var> is an expression that evaluates to a
transformer procedure, which takes an input form and returns a
resulting form.  You can do general macro-time compilation with such a
procedure, commonly using <code>syntax-case</code> (which is documented
in the R6RS library specification).
However, when possible it is better to use the simpler
pattern language of <code>syntax-rules</code>:
</p>
<div class="display">
<pre class="display"><span id="index-transformer_002dspec"></span><span id="meta_002dtransformer_002dspec"></span><var>transformer-spec</var> <tt>::=</tt>
  <code><b>(syntax-rules (</b></code> <a href="#meta_002dtr_002dliteral"><var>tr-literal</var></a><sup>*</sup> <code><b>)</b></code> <a href="#meta_002dsyntax_002drule"><var>syntax-rule</var></a><sup>*</sup><code><b>)</b></code>
  | <code><b>(syntax-rules</b></code> <a href="#meta_002dellipsis"><var>ellipsis</var></a> <code><b>(</b></code> <a href="#meta_002dtr_002dliteral"><var>tr-literal</var></a><sup>*</sup> <code><b>)</b></code> <a href="#meta_002dsyntax_002drule"><var>syntax-rule</var></a><sup>*</sup><code><b>)</b></code>
  | <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-syntax_002drule"></span><span id="meta_002dsyntax_002drule"></span><var>syntax-rule</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002dlist_002dpattern"><var>list-pattern</var></a> <a href="#meta_002dsyntax_002dtemplate"><var>syntax-template</var></a><code><b>)</b></code>
<span id="index-tr_002dliteral"></span><span id="meta_002dtr_002dliteral"></span><var>tr-literal</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-ellipsis"></span><span id="meta_002dellipsis"></span><var>ellipsis</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>

<p>An instance of <code>syntax-rules</code> produces a new
macro transformer by specifying a sequence of hygienic
rewrite rules. A use of a macro whose keyword is associated
with a transformer specified by <code>syntax-rules</code> is matched
against the patterns contained in the <var>syntax-rule</var>s
beginning with the leftmost syntax rule . When a match is
found, the macro use is transcribed hygienically according
to the template.
The optional <var>ellipsis</var> species a symbol used to indicate
repetition; it defaults to <code>...</code> (3 periods).
</p>
<div class="display">
<pre class="display"><span id="index-syntax_002dpattern"></span><span id="meta_002dsyntax_002dpattern"></span><var>syntax-pattern</var> <tt>::=</tt>
  <a href="#meta_002didentifier"><var>identifier</var></a> | <a href="#meta_002dconstant"><var>constant</var></a> | <a href="#meta_002dlist_002dpattern"><var>list-pattern</var></a> | <a href="#meta_002dvector_002dpattern"><var>vector-pattern</var></a>
<span id="index-list_002dpattern"></span><span id="meta_002dlist_002dpattern"></span><var>list-pattern</var> <tt>::=</tt> <code><b>(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>)</b></code>
  | <code><b>(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>.</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a> <code><b>)</b></code>
  | <code><b>(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a> <a href="#meta_002dellipsis"><var>ellipsis</var></a> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>)</b></code>
  | <code><b>(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a> <a href="#meta_002dellipsis"><var>ellipsis</var></a> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>.</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><code><b>)</b></code>
<span id="index-vector_002dpattern"></span><span id="meta_002dvector_002dpattern"></span><var>vector-pattern</var> <tt>::=</tt> <code><b>#(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>)</b></code>
  | <code><b>#(</b></code> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a> <a href="#meta_002dellipsis"><var>ellipsis</var></a> <a href="#meta_002dsyntax_002dpattern"><var>syntax-pattern</var></a><sup>*</sup> <code><b>)</b></code>
</pre></div>

<p>An identifier appearing within a pattern can be an underscore
(<code>_</code>), a literal identifier listed in the list of <var>tr-literal</var>s,
or the <var>ellipsis</var>. All other identifiers appearing within a
pattern are pattern variables.
</p>
<p>The outer <var>syntax-list</var> of the pattern in a <var>syntax-rule</var>
must start with an identifier. It is not involved in the matching and
is considered neither a pattern variable nor a literal identifier.
</p>
<p>Pattern variables match arbitrary input elements and are
used to refer to elements of the input in the template.
It is an error for the same pattern variable to appear more
than once in a <var>syntax-pattern</var>.
</p>
<p>Underscores also match arbitrary input elements but are
not pattern variables and so cannot be used to refer to
those elements. If an underscore appears in the literals
list, then that takes precedence and underscores in the
pattern match as literals. Multiple underscores can
appear in a <var>syntax-pattern</var>.
</p>
<p>Identifiers that appear in <code>(<var>tr-literal</var><sup>*</sup>)</code> are interpreted
as literal identifiers to be matched against corresponding
elements of the input. An element in the input matches a
literal identifier if and only if it is an identifier and either
both its occurrence in the macro expression and its occurrence
in the macro definition have the same lexical binding,
or the two identifiers are the same and both have no lexical
binding.
</p>
<p>A subpattern followed by ellipsis can match zero or
more elements of the input, unless ellipsis appears in the
literals, in which case it is matched as a literal.
</p>
<p>More formally, an input expression <var>E</var> matches a pattern <var>P</var>
if and only if:
</p><ul>
<li> <var>P</var> is an underscore (<code><b>_</b></code>); or
</li><li> <var>P</var> is a non-literal identifier; or
</li><li> <var>P</var> is a literal identifier and <var>E</var> is an identifier with the
same binding; or
</li><li> <var>P</var> is a list <code><b>(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>n</sub></var><code><b>)</b></code> and
<var>E</var> is a list of <var>n</var> elements
that match <var>P<sub>1</sub></var> through <var>P<sub>n</sub></var>, respectively; or
</li><li> <var>P</var> is an improper list
<code><b>(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>n</sub></var> <code><b>.</b></code> <var>P<sub>n+1</sub></var><code><b>)</b></code> and
<var>E</var> is a list or improper list of <var>n</var> or more elements that
match <var>P<sub>1</sub></var> through <var>P<sub>n</sub></var>, respectively,
and whose <var>n</var>th tail matches <var>P<sub>n+1</sub></var>; or
</li><li> <var>P</var> is of the form
<code><b>(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>k</sub></var> <var>P<sub>e</sub></var> <var>ellipsis</var> <var>P<sub>k+1</sub></var> ... <var>P<sub>k+l</sub></var><code><b>)</b></code> where <var>E</var> is a proper list of <var>n</var> elements,
 the first <var>k</var> of which match <var>P<sub>1</sub></var> through <var>P<sub>k</sub></var>,
respectively, whose
next <var>n-k-l</var> elements each match <var>P<sub>e</sub></var>, and whose remaining
<var>l</var> elements match <var>P<sub>k+1</sub></var> through <var>P<sub>k+l</sub></var>; or
</li><li> <var>P</var> is of the form
<code><b>(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>k</sub></var> <var>P<sub>e</sub></var> <var>ellipsis</var> <var>P<sub>k+1</sub></var> ... <var>P<sub>k+l</sub></var> <code><b>.</b></code> <var>P<sub>x</sub></var><code><b>)</b></code>
where <var>E</var> is a list or improper list of <var>n</var> elements,
the first <var>k</var> of which match <var>P<sub>1</sub></var> through <var>P<sub>k</sub></var>,
whose next <var>n-k-l</var> elements each match <var>P<sub>e</sub></var>, and whose
remaining <var>l</var> elements match <var>P<sub>k+1</sub></var> through <var>P<sub>k+l</sub></var>,
and whose <var>n</var>th and final <code>cdr</code> matches <var>P<sub>x</sub></var>; or
</li><li> <var>P</var> is a vector of the form
<code><b>#(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>n</sub></var><code><b>)</b></code> and <var>E</var> is a
vector of <var>n</var> elements that match <var>P<sub>1</sub></var> through <var>P<sub>n</sub></var>; or
</li><li> <var>P</var> is of the form
<code><b>#(</b></code><var>P<sub>1</sub></var> ... <var>P<sub>k</sub></var> <var>P<sub>e</sub></var> <var>ellipsis</var> <var>P<sub>k+1</sub></var> ... <var>P<sub>k+l</sub></var><code><b>)</b></code>
where <var>E</var> is a vector of <var>n</var> elements the first
<var>k</var> of which match <var>P<sub>1</sub></var> through <var>P<sub>k</sub></var>,
whose next <var>n-k-l</var> elements each match <var>P<sub>e</sub></var>,
and whose remaining <var>l</var> elements match <var>P<sub>k+1</sub></var>
through <var>P<sub>k+l</sub></var>; or
</li><li> <var>P</var> is a constant and E is equal to <var>P</var> in the sense of the
<code>equal?</code> procedure.
</li></ul>

<p>It is an error to use a macro keyword, within the scope of
its binding, in an expression that does not match any of
the patterns.
</p><div class="display">
<pre class="display"><span id="index-syntax_002dtemplate"></span><span id="meta_002dsyntax_002dtemplate"></span><var>syntax-template</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a> | <a href="#meta_002dconstant"><var>constant</var></a>
   | <code><b>(</b></code><a href="#meta_002dtemplate_002delement"><var>template-element</var></a><sup>*</sup><code><b>)</b></code>
   | <code><b>(</b></code><a href="#meta_002dtemplate_002delement"><var>template-element</var></a> <a href="#meta_002dtemplate_002delement"><var>template-element</var></a><sup>*</sup> <code><b>.</b></code> <a href="#meta_002dsyntax_002dtemplate"><var>syntax-template</var></a> <code><b>)</b></code>
   | <code><b>(</b></code> <a href="#meta_002dellipsis"><var>ellipsis</var></a> <a href="#meta_002dsyntax_002dtemplate"><var>syntax-template</var></a><code><b>)</b></code>
<span id="index-template_002delement"></span><span id="meta_002dtemplate_002delement"></span><var>template-element</var> <tt>::=</tt> <a href="#meta_002dsyntax_002dtemplate"><var>syntax-template</var></a> [<a href="#meta_002dellipsis"><var>ellipsis</var></a>]
</pre></div>

<p>When a macro use is transcribed according to the template
of the matching <var>syntax-rule</var>, pattern variables that occur
in the template are replaced by the elements they match in
the input. Pattern variables that occur in subpatterns followed
by one or more instances of the identifier <var>ellipsis</var> are
allowed only in subtemplates that are followed by as many
instances of <var>ellipsis</var> . They are replaced in the output by
all of the elements they match in the input, distributed as
indicated. It is an error if the output cannot be built up
as specified.
</p>
<p>Identifiers that appear in the template but are not pattern
variables or the identifier <var>ellipsis</var> are inserted into the output
as literal identifiers. If a literal identifier is inserted as a
free identifier then it refers to the binding of that identifier
within whose scope the instance of <code>syntax-rules</code> appears.
If a literal identifier is inserted as a bound identifier then
it is in effect renamed to prevent inadvertent captures of
free identifiers.
</p>
<p>A template of the
form <code><b>(</b></code><var>ellipsis</var> <var>template</var><code><b>)</b></code> is
identical to <var>template</var>, except that <var>ellipses</var>
within the template have no special meaning.
That is, any <var>ellipses</var> contained within
<var>template</var> are treated as ordinary identifiers. In particular,
the template <code><b>(</b></code><var>ellipsis</var>  <var>ellipsis</var><code><b>)</b></code>
produces a single <var>ellipsis</var>. This allows syntactic
abstractions to expand into code containing ellipses.
</p>
<div class="example">
<pre class="example">(define-syntax be-like-begin
  (syntax-rules ()
    ((be-like-begin name)
     (define-syntax name
       (syntax-rules ()
         ((name expr (... ...))
          (begin expr (... ...))))))))

(be-like-begin sequence)
(sequence 1 2 3 4) &rArr; 4
</pre></div>

</div>
<div class="subsection" id="Identifier-predicates">
<h4 class="subsection">7.10.2 Identifier predicates</h4>

<dl class="def">
<dt id="index-identifier_003f"><span class="category">Procedure: </span><span><strong>identifier?</strong> <em><var>obj</var></em><a href='#index-identifier_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is an identifier, i.e., a syntax object
representing an identifier, and <code>#f</code> otherwise.
</p>
<p>The <code>identifier?</code> procedure is often used within a fender to verify
that certain subforms of an input form are identifiers, as in the
definition of <code>rec</code>, which creates self&ndash;contained recursive
objects, below.
</p>
<div class="example">
<pre class="example">(define-syntax rec
  (lambda (x)
    (syntax-case x ()
      ((_ x e)
       (identifier? #'x)
       #'(letrec ((x e)) x)))))

(map (rec fact
       (lambda (n)
         (if (= n 0)                 
             1
             (* n (fact (- n 1))))))
     '(1 2 3 4 5))    &rArr; (1 2 6 24 120)
 
(rec 5 (lambda (x) x))  &rArr; exception
</pre></div>
</dd></dl>


<p>The procedures <code>bound-identifier=?</code> and <code>free-identifier=?</code>
each take two identifier arguments and return <code>#t</code> if their arguments
are equivalent and <code>#f</code> otherwise.  These predicates are used to
compare identifiers according to their <em>intended use</em> as free
references or bound identifiers in a given context.
</p>
<dl class="def">
<dt id="index-bound_002didentifier_003d_003f"><span class="category">Procedure: </span><span><strong>bound-identifier=?</strong> <em><var>id</var><sub>1</sub> <var>id</var><sub>2</sub></em><a href='#index-bound_002didentifier_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>id</var><sub>1</sub> and <var>id</var><sub>2</sub> must be identifiers.
</p>
<p>The procedure <code>bound-identifier=?</code> returns <code>#t</code> if a binding for
one would capture a reference to the other in the output of the
transformer, assuming that the reference appears within the scope of the
binding, and <code>#f</code> otherwise.
</p>
<p>In general, two identifiers are <code>bound-identifier=?</code> only if both
are present in the original program or both are introduced by the same
transformer application (perhaps implicitly, see <code>datum-&gt;syntax</code>).
</p>
<p>The <code>bound-identifier=?</code> procedure can be used for detecting
duplicate identifiers in a binding construct or for other preprocessing
of a binding construct that requires detecting instances of the bound
identifiers.
</p></dd></dl>

<dl class="def">
<dt id="index-free_002didentifier_003d_003f"><span class="category">Procedure: </span><span><strong>free-identifier=?</strong> <em><var>id</var><sub>1</sub> <var>id</var><sub>2</sub></em><a href='#index-free_002didentifier_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>id</var><sub>1</sub> and <var>id</var><sub>2</sub> must be identifiers.
</p>
<p>The <code>free-identifier=?</code> procedure returns <code>#t</code> if and only if
the two identifiers would resolve to the same binding if both were to
appear in the output of a transformer outside of any bindings inserted
by the transformer.  (If neither of two like&ndash;named identifiers resolves
to a binding, i.e., both are unbound, they are considered to resolve to
the same binding.)
</p>
<p>Operationally, two identifiers are considered equivalent by
<code>free-identifier=?</code> if and only the topmost matching substitution
for each maps to the same binding or the identifiers have the same name
and no matching substitution.
</p>
<p>The <code>syntax-case</code> and <code>syntax-rules</code> forms internally use
<code>free-identifier=?</code> to compare identifiers listed in the literals
list against input identifiers.
</p>
<div class="example">
<pre class="example">(let ((fred 17))
  (define-syntax a
    (lambda (x)
      (syntax-case x ()
        ((_ id) #'(b id fred)))))
  (define-syntax b
    (lambda (x)
      (syntax-case x ()
        ((_ id1 id2)
         #`(list
             #,(free-identifier=? #'id1 #'id2)
             #,(bound-identifier=? #'id1 #'id2))))))
  (a fred))
    &rArr; (#t #f)
</pre></div>

<p>The following definition of unnamed <code>let</code> uses
<code>bound-identifier=?</code> to detect duplicate identifiers.
</p>
<div class="example">
<pre class="example">(define-syntax let
  (lambda (x)
    (define unique-ids?
      (lambda (ls)
        (or (null? ls)
            (and (let notmem? ((x (car ls)) (ls (cdr ls)))
                   (or (null? ls)
                       (and (not (bound-identifier=? x (car ls)))
                            (notmem? x (cdr ls)))))
                 (unique-ids? (cdr ls))))))
    (syntax-case x ()
      ((_ ((i v) ...) e1 e2 ...)
       (unique-ids? #'(i ...))
       #'((lambda (i ...) e1 e2 ...) v ...)))))
</pre></div>

<p>The argument <code>#'(i ...)</code> to <code>unique-ids?</code> is guaranteed to be
a list by the rules given in the description of <code>syntax</code> above.
</p>
<p>With this definition of <code>let</code>:
</p>
<div class="example">
<pre class="example">(let ((a 3) (a 4)) (+ a a))    &rArr; <i>syntax error</i>
</pre></div>

<p>However,
</p><div class="example">
<pre class="example">(let-syntax
  ((dolet (lambda (x)
            (syntax-case x ()
              ((_ b)
               #'(let ((a 3) (b 4)) (+ a b)))))))
  (dolet a))
&rArr; 7
</pre></div>

<p>since the identifier <code>a</code> introduced by <code>dolet</code> and the
identifier <code>a</code> extracted from the input form are not
<code>bound-identifier=?</code>.
</p>
<p>Rather than including <code>else</code> in the literals list as before, this
version of <code>case</code> explicitly tests for <code>else</code> using
<code>free-identifier=?</code>.
</p>
<div class="example">
<pre class="example">(define-syntax case
  (lambda (x)
    (syntax-case x ()
      ((_ e0 ((k ...) e1 e2 ...) ...
          (else-key else-e1 else-e2 ...))
       (and (identifier? #'else-key)
            (free-identifier=? #'else-key #'else))
       #'(let ((t e0))
           (cond
            ((memv t '(k ...)) e1 e2 ...)
            ...
            (else else-e1 else-e2 ...))))
      ((_ e0 ((ka ...) e1a e2a ...)
          ((kb ...) e1b e2b ...) ...)
       #'(let ((t e0))
           (cond
            ((memv t '(ka ...)) e1a e2a ...)
            ((memv t '(kb ...)) e1b e2b ...)
            ...))))))
</pre></div>

<p>With either definition of <code>case</code>, <code>else</code> is not recognized as
an auxiliary keyword if an enclosing lexical binding for <code>else</code>
exists.  For example,
</p>
<div class="example">
<pre class="example">(let ((else <code>#f</code>))
  (case 0 (else (write &quot;oops&quot;))))    &rArr; <i>syntax error</i>
</pre></div>

<p>since <code>else</code> is bound lexically and is therefore not the same
<code>else</code> that appears in the definition of <code>case</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Syntax_002dobject-and-datum-conversions">
<h4 class="subsection">7.10.3 Syntax-object and datum conversions</h4>

<dl class="def">
<dt id="index-syntax_002d_003edatum"><span class="category">Procedure: </span><span><strong>syntax-&gt;datum</strong> <em><var>syntax-object</var></em><a href='#index-syntax_002d_003edatum' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-syntax_002dobject_002d_003edatum"><span class="category">Deprecated procedure: </span><span><strong>syntax-object-&gt;datum</strong> <em><var>syntax-object</var></em><a href='#index-syntax_002dobject_002d_003edatum' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Strip all syntactic information from a syntax object and returns the
corresponding Scheme datum.
</p>
<p>Identifiers stripped in this manner are converted to their symbolic
names, which can then be compared with <code>eq?</code>.  Thus, a predicate
<code>symbolic-identifier=?</code> might be defined as follows.
</p>
<div class="example">
<pre class="example">(define symbolic-identifier=?
  (lambda (x y)
    (eq? (syntax-&gt;datum x)
         (syntax-&gt;datum y))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-datum_002d_003esyntax"><span class="category">Procedure: </span><span><strong>datum-&gt;syntax</strong> <em><var>template-id</var> <var>datum</var> [<var>srcloc</var>]</em><a href='#index-datum_002d_003esyntax' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-datum_002d_003esyntax_002dobject"><span class="category">Deprecated procedure: </span><span><strong>datum-&gt;syntax-object</strong> <em><var>template-id</var> <var>datum</var></em><a href='#index-datum_002d_003esyntax_002dobject' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>template-id</var> must be a template identifier and <var>datum</var> should
be a datum value.
</p>
<p>The <code>datum-&gt;syntax</code> procedure returns a syntax-object
representation of <var>datum</var> that contains the same contextual
information as <var>template-id</var>, with the effect that the syntax object
behaves as if it were introduced into the code when <var>template-id</var>
was introduced.
</p>
<p>If <var>srcloc</var> is specified (and neither <code>#f</code> or <code>#!null</code>),
it specifies the file position (including line number) for the result.
In that case it should be a syntax object representing
a list; otherwise it is currently ignored, though future extensions
may support other ways of specifying the position.
</p>
<p>The <code>datum-&gt;syntax</code> procedure allows a transformer to &ldquo;bend&rdquo;
lexical scoping rules by creating <em>implicit identifiers</em> that
behave as if they were present in the input form, thus permitting the
definition of macros that introduce visible bindings for or references
to identifiers that do not appear explicitly in the input form.  For
example, the following defines a <code>loop</code> expression that uses this
controlled form of identifier capture to bind the variable <code>break</code>
to an escape procedure within the loop body.  (The derived
<code>with-syntax</code> form is like <code>let</code> but binds pattern variables.)
</p>
<div class="example">
<pre class="example">(define-syntax loop
  (lambda (x)
    (syntax-case x ()
      ((k e ...)
       (with-syntax
           ((break (datum-&gt;syntax #'k 'break)))
         #'(call-with-current-continuation
             (lambda (break)
               (let f () e ... (f)))))))))

(let ((n 3) (ls '()))
  (loop
    (if (= n 0) (break ls))
    (set! ls (cons 'a ls))
    (set! n (- n 1))))
&rArr; (a a a)
</pre></div>

<p>Were <code>loop</code> to be defined as:
</p>
<div class="example">
<pre class="example">(define-syntax loop
  (lambda (x)
    (syntax-case x ()
      ((_ e ...)
       #'(call-with-current-continuation
           (lambda (break)
             (let f () e ... (f))))))))
</pre></div>

<p>the variable <code>break</code> would not be visible in <code>e ...</code>.
</p>
<p>The datum argument <var>datum</var> may also represent an arbitrary Scheme
form, as demonstrated by the following definition of <code>include</code>.
</p>
<div class="example">
<pre class="example">(define-syntax include
  (lambda (x)
    (define read-file
      (lambda (fn k)
        (let ((p (open-file-input-port fn)))
          (let f ((x (get-datum p)))
            (if (eof-object? x)
                (begin (close-port p) '())
                (cons (datum-&gt;syntax k x)
                      (f (get-datum p))))))))
    (syntax-case x ()
      ((k filename)
       (let ((fn (syntax-&gt;datum #'filename)))
         (with-syntax (((exp ...)
                        (read-file fn #'k)))
           #'(begin exp ...)))))))
</pre></div>

<p><code>(include &quot;filename&quot;)</code> expands into a <code>begin</code> expression
containing the forms found in the file named by <code>&quot;filename&quot;</code>.  For
example, if the file <samp>flib.ss</samp> contains:
</p>
<div class="example">
<pre class="example">(define f (lambda (x) (g (* x x))))
</pre></div>

<p>and the file <samp>glib.ss</samp> contains:
</p>
<div class="example">
<pre class="example">(define g (lambda (x) (+ x x)))
</pre></div>

<p>the expression:
</p>
<div class="example">
<pre class="example">(let ()
  (include &quot;flib.ss&quot;)
  (include &quot;glib.ss&quot;)
  (f 5))
</pre></div>

<p>evaluates to <code>50</code>.
</p>
<p>The definition of <code>include</code> uses <code>datum-&gt;syntax</code> to convert
the objects read from the file into syntax objects in the proper lexical
context, so that identifier references and definitions within those
expressions are scoped where the <code>include</code> form appears.
</p>
<p>Using <code>datum-&gt;syntax</code>, it is even possible to break hygiene
entirely and write macros in the style of old Lisp macros.  The
<code>lisp-transformer</code> procedure defined below creates a transformer
that converts its input into a datum, calls the programmer&rsquo;s procedure
on this datum, and converts the result back into a syntax object scoped
where the original macro use appeared.
</p>
<div class="example">
<pre class="example">(define lisp-transformer
  (lambda (p)
    (lambda (x)
      (syntax-case x ()
        ((kwd . rest)
         (datum-&gt;syntax #'kwd
           (p (syntax-&gt;datum x))))))))
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Signaling-errors-in-macro-transformers">
<h4 class="subsection">7.10.4 Signaling errors in macro transformers</h4>

<dl class="def">
<dt id="index-syntax_002derror"><span class="category">Syntax: </span><span><strong>syntax-error</strong> <em>message args<sup>*</sup></em><a href='#index-syntax_002derror' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>message</var> and <var>args</var> are treated similary as for
the <code>error</code> procedure.  However, the error is reported
when the <code>syntax-error</code> is expanded.
This can be used as a <code>syntax-rules</code>
template for a pattern that is an invalid use of the
macro, which can provide more descriptive error messages.
The <var>message</var> should be a string literal, and the <var>args</var>
arbitrary (non-evalualted) expressions providing additional information.
</p>
<div class="example">
<pre class="example">(define-syntax simple-let
  (syntax-rules ()
    ((_ (head ... ((x . y) val) . tail)
       body1 body2 ...)
     (syntax-error &quot;expected an identifier but got&quot; (x . y)))
    ((_ ((name val) ...) body1 body2 ...)
     ((lambda (name ...) body1 body2 ...)
      val ...))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-report_002dsyntax_002derror"><span class="category">Procedure: </span><span><strong>report-syntax-error</strong> <em>location message</em><a href='#index-report_002dsyntax_002derror' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This is a procedure that can be called at macro-expansion time
by a syntax transformer function.
(In contrast <code>syntax-error</code> is a syntax form used in the
expansion result.)
The <var>message</var> is reported as a compile-time error message.
The <var>location</var> is used for the source location (file name and
line/column numbers): In general it can be a <code>SourceLocator</code> value;
most commonly it is a syntax object for a sub-list of the input form
that is erroneous.
The value returned by <code>report-syntax-error</code> is an
instance of <code>ErrorExp</code>, which supresses further compilation.
</p>
<div class="example">
<pre class="example">(define-syntax if
  (lambda (x)
    (syntax-case x ()
                 ((_ test then)
                  (make-if-exp #'test #'then #!null))
                 ((_ test then else)
                  (make-if-exp #'test #'then #'else))
                 ((_ e1 e2 e3 . rest)
                  (report-syntax-error #'rest
                   &quot;too many expressions for 'if'&quot;))
                 ((_ . rest)
                  (report-syntax-error #'rest
                   &quot;too few expressions for 'if'&quot;)))))
</pre></div>
<p>In the above example, one could use the source form <code>x</code> for the
location, but using <code>#'rest</code> is more accurate.  Note that the following
is incorrect, because <code>e1</code> might not be a pair, in which case
we don&rsquo;t have location information for it (due to a Kawa limitation):
</p><div class="example">
<pre class="example">    (syntax-case x ()
                 ...
                 ((_ e1)
                  (report-syntax-error
                   #'e1 ;; <i>poor location specifier</i>
                   &quot;too few expressions for 'if'&quot;)))))
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Convenience-forms">
<h4 class="subsection">7.10.5 Convenience forms</h4>

<dl class="def">
<dt id="index-with_002dsyntax"><span class="category">Syntax: </span><span><strong>with-syntax</strong> <em>((<var>pattern</var> <a href="#meta_002dexpression"><var>expression</var></a>) &hellip;) <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-with_002dsyntax' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>with-syntax</code> form is used to bind pattern variables, just as
<code>let</code> is used to bind variables.  This allows a transformer to
construct its output in separate pieces, then put the pieces together.
</p>
<p>Each <var>pattern</var> is identical in form to a <code>syntax-case</code>
pattern.  The value of each <var>expression</var> is computed and
destructured according to the corresponding <var>pattern</var>, and pattern
variables within the <var>pattern</var> are bound as with
<code>syntax-case</code> to the corresponding portions of the value within
<var>body</var>.
</p>
<p>The <code>with-syntax</code> form may be defined in terms of
<code>syntax-case</code> as follows.
</p>
<div class="example">
<pre class="example">(define-syntax with-syntax
  (lambda (x)
    (syntax-case x ()
      ((_ ((p e0) ...) e1 e2 ...)
       (syntax (syntax-case (list e0 ...) ()
                 ((p ...) (let () e1 e2 ...))))))))
</pre></div>

<p>The following definition of <code>cond</code> demonstrates the use of
<code>with-syntax</code> to support transformers that employ recursion
internally to construct their output.  It handles all <code>cond</code> clause
variations and takes care to produce one-armed <code>if</code> expressions
where appropriate.
</p>
<div class="example">
<pre class="example">(define-syntax cond
  (lambda (x)
    (syntax-case x ()
      ((_ c1 c2 ...)
       (let f ((c1 #'c1) (c2* #'(c2 ...)))
         (syntax-case c2* ()
           (()
            (syntax-case c1 (else =&gt;)
             (((else e1 e2 ...) #'(begin e1 e2 ...))
              ((e0) #'e0)
              ((e0 =&gt; e1)
               #'(let ((t e0)) (if t (e1 t))))
              ((e0 e1 e2 ...)
               #'(if e0 (begin e1 e2 ...)))))
           ((c2 c3 ...)
            (with-syntax ((rest (f #'c2 #'(c3 ...))))
              (syntax-case c1 (=&gt;)
                ((e0) #'(let ((t e0)) (if t t rest)))
                ((e0 =&gt; e1)
                 #'(let ((t e0)) (if t (e1 t) rest)))
                ((e0 e1 e2 ...)
                 #'(if e0 
                        (begin e1 e2 ...)
                        rest)))))))))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-quasisyntax"><span class="category">Syntax: </span><span><strong>quasisyntax</strong> <em><var>template</var></em><a href='#index-quasisyntax' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-unsyntax"><span class="category">Auxiliary Syntax: </span><span><strong>unsyntax</strong><a href='#index-unsyntax' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-unsyntax_002dsplicing"><span class="category">Auxiliary Syntax: </span><span><strong>unsyntax-splicing</strong><a href='#index-unsyntax_002dsplicing' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>quasisyntax</code> form is similar to <code>syntax</code>, but it allows
parts of the quoted text to be evaluated, in a manner similar to the
operation of <code>quasiquote</code>.
</p>
<p>Within a <code>quasisyntax</code> <var>template</var>, subforms of <code>unsyntax</code>
and <code>unsyntax-splicing</code> forms are evaluated, and everything else is
treated as ordinary template material, as with <code>syntax</code>.
</p>
<p>The value of each <code>unsyntax</code> subform is inserted into the output in
place of the <code>unsyntax</code> form, while the value of each
<code>unsyntax-splicing</code> subform is spliced into the surrounding list or
vector structure.  Uses of <code>unsyntax</code> and <code>unsyntax-splicing</code>
are valid only within <code>quasisyntax</code> expressions.
</p>
<p>A <code>quasisyntax</code> expression may be nested, with each
<code>quasisyntax</code> introducing a new level of syntax quotation and each
<code>unsyntax</code> or <code>unsyntax-splicing</code> taking away a level of
quotation.  An expression nested within <em>n</em> <code>quasisyntax</code>
expressions must be within <em>n</em> <em>unsyntax</em> or
<code>unsyntax-splicing</code> expressions to be evaluated.
</p>
<p>As noted in <a href="#meta_002dabbreviation"><var>abbreviation</var></a>, <code>#`<var>template</var></code> is equivalent to
<code>(quasisyntax <var>template</var>)</code>, <code>#,<var>template</var></code> is
equivalent to <code>(unsyntax <var>template</var>)</code>, and
<code>#,@<var>template</var></code> is equivalent to <code>(unsyntax-splicing
<var>template</var>)</code>.  <em>Note</em> that for backwards compatibility,
you should only use <code>#,<var>template</var></code> inside a literal <code>#`<var>template</var></code> form.
</p>
<p>The <code>quasisyntax</code> keyword can be used in place of
<code>with-syntax</code> in many cases.  For example, the definition of
<code>case</code> shown under the description of <code>with-syntax</code> above can
be rewritten using <code>quasisyntax</code> as follows.
</p>
<div class="example">
<pre class="example">(define-syntax case
  (lambda (x)
    (syntax-case x ()
      ((_ e c1 c2 ...)
       #`(let ((t e))
           #,(let f ((c1 #'c1) (cmore #'(c2 ...)))
               (if (null? cmore)
                   (syntax-case c1 (else)
                     ((else e1 e2 ...)
                      #'(begin e1 e2 ...))
                     (((k ...) e1 e2 ...)
                      #'(if (memv t '(k ...))
                            (begin e1 e2 ...))])
                   (syntax-case c1 ()
                     (((k ...) e1 e2 ...)
                      #`(if (memv t '(k ...))
                            (begin e1 e2 ...)
                            #,(f (car cmore)
                                  (cdr cmore))))))))))))
</pre></div>
                          
</dd></dl>

<blockquote>
<p><em>Note:</em> Any <code>syntax-rules</code> form can be expressed with
<code>syntax-case</code> by making the <code>lambda</code> expression and
<code>syntax</code> expressions explicit, and <code>syntax-rules</code> may be
defined in terms of <code>syntax-case</code> as follows.
</p>
<div class="example">
<pre class="example">(define-syntax syntax-rules
  (lambda (x)
    (syntax-case x ()
      ((_ (lit ...) ((k . p) t) ...)
       (for-all identifier? #'(lit ... k ...))
       #'(lambda (x)
           (syntax-case x (lit ...)
             ((_ . p) #'t) ...))))))
</pre></div>
</blockquote>

<hr>
</div>
</div>
<div class="section" id="Named-quasi_002dliterals">
<div class="header">
<p>
Previous: <a href="#Macros" accesskey="p" rel="prev">Macros</a>, Up: <a href="#Syntax" accesskey="u" rel="up">Syntax</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Named-quasi_002dliterals-1"></span><h3 class="section">7.11 Named quasi-literals</h3>

<p>Traditional Scheme has only a few kinds of values,
and thus only a few builtin kinds of literals.
Modern Scheme allows defining new types,
so it is desirable to have a mechanism for defining literal values
for the new types.
</p>
<p>Consider the <code><a href="#URI_002dtype">URI</a></code> type.
You can create a new instance of a <code>URI</code> using a
constructor function:
</p><div class="example">
<pre class="example">(URI &quot;http://example.com/&quot;)
</pre></div>
<p>This isn&rsquo;t too bad, though the double-quote characters are an ugly distraction.
However, if you need to construct the string it gets messy:
</p><div class="example">
<pre class="example">(URI (string-append base-uri &quot;icon.png&quot;))
</pre></div>

<p>Instead use can write:
</p><div class="example">
<pre class="example">&amp;URI{http://example.com/}
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">&amp;URI{&amp;[base-uri]icon.png}
</pre></div>

<p>This syntax is translated by the Scheme reader
to the more familiar but more verbose equivalent forms:
</p><div class="example">
<pre class="example">($construct$:URI &quot;http://example.com/&quot;)
($construct$:URI $&lt;&lt;$ base-uri $&gt;&gt;$ &quot;icon.png&quot;)
</pre></div>
<p>So for this to work there just needs to be a definition
of <code>$construct$:URI</code>, usually a macro.
Normal scope rules apply; typically you&rsquo;d define <code>$construct$:URI</code> in
a module.
</p>
<p>The names <code>$&lt;&lt;$</code> and <code>$&gt;&gt;$</code> are bound to unique zero-length strings.
They are used to allow the implementation of <code>$construct$:URI</code>
to determine which arguments are literal and which come from
escaped expressions.
</p>
<p>If you want to define your own <code>$construct$:<var>tag</var></code>,
or to read motivation and details, see the
<a href="http://srfi.schemers.org/srfi-108/srfi-108.html">SRFI 108</a> specification.
</p>
<div class="display">
<pre class="display"><span id="index-extended_002ddatum_002dliteral"></span><span id="meta_002dextended_002ddatum_002dliteral"></span><var>extended-datum-literal</var> <tt>::=</tt>
    <code><b>&amp;</b></code> <a href="#meta_002dcname"><var>cname</var></a> <code><b>{</b></code> [<a href="#meta_002dinitial_002dignored"><var>initial-ignored</var></a>] <a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a><sup>*</sup> <code><b>}</b></code>
  | <code><b>&amp;</b></code> <a href="#meta_002dcname"><var>cname</var></a> <code><b>[</b></code> <a href="#meta_002dexpression"><var>expression</var></a><sup>*</sup> <code><b>]{</b></code> [<a href="#meta_002dinitial_002dignored"><var>initial-ignored</var></a>] <a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a><sup>*</sup> <code><b>}</b></code>
<span id="index-cname"></span><span id="meta_002dcname"></span><var>cname</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-named_002dliteral_002dpart"></span><span id="meta_002dnamed_002dliteral_002dpart"></span><var>named-literal-part</var> <tt>::=</tt>
    <i>any character except</i> <code><b>&amp;</b></code><i>,</i> <code><b>{</b></code> <i>or</i> <code><b>}</b></code>
  | <code><b>{</b></code> <a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a><sup>+</sup> <code><b>}</b></code>
  | <a href="#meta_002dchar_002dref"><var>char-ref</var></a>
  | <a href="#meta_002dentity_002dref"><var>entity-ref</var></a>
  | <a href="#meta_002dspecial_002descape"><var>special-escape</var></a>
  | <a href="#meta_002denclosed_002dpart"><var>enclosed-part</var></a>
  | <a href="#meta_002dextended_002ddatum_002dliteral"><var>extended-datum-literal</var></a>
</pre></div>

<hr>
</div>
</div>
<div class="chapter" id="Program-structure">
<div class="header">
<p>
Next: <a href="#Control-features" accesskey="n" rel="next">Control features</a>, Previous: <a href="#Syntax" accesskey="p" rel="prev">Syntax</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Program-structure-1"></span><h2 class="chapter">8 Program structure</h2>

<p>See <a href="#program-units">program units</a> for some notes on
structure of an entire source file.
</p>

<ul class="section-toc">
<li><a href="#Boolean-values" accesskey="1">Boolean values</a></li>
<li><a href="#Conditionals" accesskey="2">Conditionals</a></li>
<li><a href="#Variables-and-Patterns" accesskey="3">Variables and Patterns</a></li>
<li><a href="#Definitions" accesskey="4">Definitions</a></li>
<li><a href="#Local-binding-constructs" accesskey="5">Local binding constructs</a></li>
<li><a href="#Lazy-evaluation" accesskey="6">Lazy evaluation</a></li>
<li><a href="#Threads" accesskey="7">Threads</a></li>
<li><a href="#Exceptions" accesskey="8">Exception handling</a></li>
</ul>
<hr>
<div class="section" id="Boolean-values">
<div class="header">
<p>
Next: <a href="#Conditionals" accesskey="n" rel="next">Conditionals</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Boolean-values-1"></span><h3 class="section">8.1 Boolean values</h3>

<p>The standard boolean objects for true and false are written as <code>#t</code> and <code>#f</code>.
Alternatively, they may be written <code>#true</code> and <code>#false</code>,
respectively.
</p>
<div class="display">
<pre class="display"><span id="index-boolean"></span><span id="meta_002dboolean"></span><var>boolean</var> <tt>::=</tt> <code><b>#t</b></code> | <code><b>#f</b></code> | <code><b>#true</b></code> | <code><b>#false</b></code>
</pre></div>

<p>What really matters,
though, are the objects that the Scheme conditional expressions (<code>if</code>,
<code>cond</code>, <code>and</code>, <code>or</code>, <code>when</code>, <code>unless</code>, <code>do</code>)
treat as true or
false. The phrase &ldquo;a true value&rdquo; (or sometimes just &ldquo;true&rdquo;)
means any object treated as true by the conditional expressions, and the phrase &ldquo;a false value&rdquo; (or &ldquo;false&rdquo;) means any
object treated as false by the conditional expressions.
</p>
<p>Of all the &ldquo;proper Scheme&rdquo; values, only <code>#f</code> counts as false in
conditional expressions. All other Scheme values, including <code>#t</code>,
count as true.  A <var>test-expression</var> is an expression evaluated
in this manner for whether it is true or false.
</p>
<p>In addition the null value <code>#!null</code> (in Java written as <code>null</code>)
is also considered false.  Also, if you for some strange reason create a
fresh <code>java.lang.Boolean</code> object whose <code>booleanValue()</code>
returns <code>false</code>, that is also considered false.
</p>
<p><em>Note:</em> Unlike some other dialects of Lisp, Scheme distinguishes
<code>#f</code> and the empty list from each other and from the symbol
<code>nil</code>.
</p>
<p>Boolean constants evaluate to themselves, so they do not
need to be quoted in programs.
</p>
<div class="example">
<pre class="example">#t       &rArr;  #t
#true    &rArr;  #t
#f       &rArr;  #f
#false   &rArr;  #f
'#f      &rArr;  #f
</pre></div>

<dl class="def">
<dt id="index-boolean-1"><span class="category">Type: </span><span><strong>boolean</strong><a href='#index-boolean-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of boolean values.
As a type conversion, a true value is converted to <code>#t</code>,
while a false value is converted to <code>#f</code>.
Represented as a primitive Java <code>boolean</code>
or <code>kawa.lang.Boolean</code> when converted to an object.
</p></dd></dl>

<dl class="def">
<dt id="index-boolean_003f"><span class="category">Procedure: </span><span><strong>boolean?</strong> <em>obj</em><a href='#index-boolean_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>boolean?</code> predicate returns <code>#t</code> if <var>obj</var>
is either <code>#t</code> or <code>#f</code>, and returns <code>#f</code> otherwise.
</p><div class="example">
<pre class="example">(boolean? #f)   &rArr;  #t
(boolean? 0)    &rArr;  #f
(boolean? '())  &rArr;  #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-not"><span class="category">Procedure: </span><span><strong>not</strong> <em>obj</em><a href='#index-not' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>not</code> procedure returns <code>#t</code> if <var>obj</var> is false,
and returns <code>#f</code> otherwise.
</p>
<div class="example">
<pre class="example">(not #t)         &rArr;  #f
(not 3)          &rArr;  #f
(not (list 3))   &rArr;  #f
(not #f)         &rArr;  #t
(not ’())        &rArr;  #f
(not (list))     &rArr;  #f
(not ’nil)       &rArr;  #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-boolean_003d_003f"><span class="category">Procedure: </span><span><strong>boolean=?</strong> <em>boolean1 boolean2 boolean3 ...</em><a href='#index-boolean_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if all the arguments are booleans and all are <code>#t</code>
or all are <code>#f</code>.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Conditionals">
<div class="header">
<p>
Next: <a href="#Variables-and-Patterns" accesskey="n" rel="next">Variables and Patterns</a>, Previous: <a href="#Boolean-values" accesskey="p" rel="prev">Boolean values</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Conditionals-1"></span><h3 class="section">8.2 Conditionals</h3>

<div class="display">
<pre class="display"><span id="index-test_002dexpression"></span><span id="meta_002dtest_002dexpression"></span><var>test-expression</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-consequent"></span><span id="meta_002dconsequent"></span><var>consequent</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-alternate"></span><span id="meta_002dalternate"></span><var>alternate</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<dl class="def">
<dt id="index-if"><span class="category">Syntax: </span><span><strong>if</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> <a href="#meta_002dconsequent"><var>consequent</var></a> <a href="#meta_002dalternate"><var>alternate</var></a></em><a href='#index-if' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-if-1"><span class="category">Syntax: </span><span><strong>if</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> <a href="#meta_002dconsequent"><var>consequent</var></a></em><a href='#index-if-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>An <code>if</code> expression is evaluated as follows:
first, <var>test-expression</var> is
evaluated.  If it yields a true value, then <var>consequent</var> is
evaluated and its values are returned.  Otherwise <var>alternate</var> is
evaluated and its values are returned.  If <var>test</var> yields <code>#f</code>
and no <var>alternate</var> is specified, then the result of the expression
is unspecified.
</p>
<div class="example">
<pre class="example">(if (&gt; 3 2) 'yes 'no)          &rArr; yes
(if (&gt; 2 3) 'yes 'no)          &rArr; no
(if (&gt; 3 2)
    (- 3 2)
    (+ 3 2))                   &rArr; 1
(if #f #f)                     &rArr; unspecified
</pre></div>

<p>The <var>consequent</var> and <var>alternate</var> expressions are in tail
context if the <code>if</code> expression itself is.
</p></dd></dl>

<dl class="def">
<dt id="index-cond"><span class="category">Syntax: </span><span><strong>cond</strong> <em><a href="#meta_002dcond_002dclause"><var>cond-clause</var></a><sup>+</sup></em><a href='#index-cond' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-cond-1"><span class="category">Syntax: </span><span><strong>cond</strong> <em><a href="#meta_002dcond_002dclause"><var>cond-clause</var></a><sup>*</sup> <code><b>(else</b></code> <var>expression</var>&hellip;<code><b>)</b></code></em><a href='#index-cond-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<div class="display">
<pre class="display"><span id="index-cond_002dclause"></span><span id="meta_002dcond_002dclause"></span><var>cond-clause</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> <a href="#meta_002dbody"><var>body</var></a><code><b>)</b></code>
    | <code><b>(</b></code><var>test</var> <code><b>=&gt;</b></code> <var>expression</var><code><b>)</b></code>
</pre></div>

<p>A <code>cond</code> expression is evaluated by evaluating the <var>test-expression</var>s
of successive <var>cond-clause</var>s in order until one of them
evaluates to a true value.  When a <var>test-expression</var> evaluates to a true
value, then the remaining <var>expression</var>s in its <var>cond-clause</var>
are evaluated in order, and the results of the last <var>expression</var> in
the <var>cond-clause</var> are returned as the results of the entire
<code>cond</code> expression.
If the selected <var>cond-clause</var> contains only the <var>test-expression</var> and no
<var>expression</var>s, then the value of the <var>test-expression</var> is returned as the
result.  If the selected <var>cond-clause</var> uses the <code>=&gt;</code> alternate
form, then the <var>expression</var> is evaluated.  Its value must be a
procedure.  This procedure should accept one argument; it is called on
the value of the <var>test-expression</var> and the values returned by this procedure
are returned by the <code>cond</code> expression.
</p>
<p>If all <var>test-expression</var>s evaluate to <code>#f</code>, and there is no <code>else</code>
clause, then the conditional expression returns unspecified values; if
there is an <code>else</code> clause, then its <var>expression</var>s are
evaluated, and the values of the last one are returned.
</p>
<div class="example">
<pre class="example">(cond ((&gt; 3 2) 'greater)
      ((&lt; 3 2) 'less))         &rArr; greater

(cond ((&gt; 3 3) 'greater)
      ((&lt; 3 3) 'less)
      (else 'equal))           &rArr; equal

(cond ('(1 2 3) =&gt; cadr)
      (else #f))               &rArr; 2
</pre></div>

<p>For a <var>cond-clause</var> of one of the following forms:
</p><div class="example">
<pre class="example">(<var>test</var> <a href="#meta_002dexpression"><var>expression</var></a><sup>*</sup>)
(else <a href="#meta_002dexpression"><var>expression</var></a> <a href="#meta_002dexpression"><var>expression</var></a><sup>*</sup>)
</pre></div>

<p>the last <var>expression</var> is in tail context if the <code>cond</code> form
itself is.  For a <var>cond clause</var> of the form:
</p>
<div class="example">
<pre class="example">(<var>test</var> =&gt; <var>expression</var>)
</pre></div>

<p>the (implied) call to the procedure that results from the evaluation of
<var>expression</var> is in tail context if the <code>cond</code> form itself
is.
</p></dd></dl>

<dl class="def">
<dt id="index-case"><span class="category">Syntax: </span><span><strong>case</strong> <em><a href="#meta_002dcase_002dkey"><var>case-key</var></a> <a href="#meta_002dcase_002dclause"><var>case-clause</var></a><sup>+</sup></em><a href='#index-case' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-case-1"><span class="category">Syntax: </span><span><strong>case</strong> <em><a href="#meta_002dcase_002dkey"><var>case-key</var></a> <a href="#meta_002dcase_002dclause"><var>case-clause</var></a><sup>*</sup> <a href="#meta_002dcase_002delse_002dclause"><var>case-else-clause</var></a></em><a href='#index-case-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<div class="display">
<pre class="display"><span id="index-case_002dkey"></span><span id="meta_002dcase_002dkey"></span><var>case-key</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-case_002dclause"></span><span id="meta_002dcase_002dclause"></span><var>case-clause</var> <tt>::=</tt> <code><b>((</b></code><a href="#meta_002ddatum"><var>datum</var></a><sup>*</sup><code><b>)</b></code> <a href="#meta_002dexpression"><var>expression</var></a><sup>+</sup><code><b>)</b></code>
    | <code><b>((</b></code><a href="#meta_002ddatum"><var>datum</var></a><sup>*</sup><code><b>)</b></code> <code><b>=&gt;</b></code> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code>
<span id="index-case_002delse_002dclause"></span><span id="meta_002dcase_002delse_002dclause"></span><var>case-else-clause</var> <tt>::=</tt> <code><b>(else</b></code>  <a href="#meta_002dexpression"><var>expression</var></a><sup>+</sup><code><b>)</b></code>
    | <code><b>(else =&gt;</b></code> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code>
</pre></div>

<p>Each <var>datum</var> is an external representation of some object.
Each <var>datum</var> in the entire <code>case</code> expression should be distinct.
</p>
<p>A <code>case</code> expression is evaluated as follows.
</p>
<ol>
<li> The <var>case-key</var> is evaluated and its result is compared using
<code>eqv?</code> against the data represented by the <var>datum</var>s of
each <var>case-clause</var> in turn, proceeding in order from left to
right through the set of clauses.

</li><li> If the result of evaluating <var>case-key</var> is equivalent to a datum of a
<var>case-clause</var>, the corresponding <var>expression</var>s are evaluated
from left to right and the results of the last expression in the
<var>case-clause</var> are returned as the results of the <code>case</code>
expression.  Otherwise, the comparison process continues.
</li><li> If the result of evaluating <var>key</var> is different from every datum in
each set, then if there is an <var>case-else-clause</var> its expressions are
evaluated and the results of the last are the results of the <code>case</code>
expression; otherwise the result of <code>case</code> expression is unspecified.
</li></ol>

<p>If the selected <var>case-clause</var> or <var>case-else-clause</var>
uses the <code>=&gt;</code> alternate
form, then the <var>expression</var> is evaluated. It is an error if
its value is not a procedure accepting one argument. This
procedure is then called on the value of the <var>key</var> and the
values returned by this procedure are returned by the <code>case</code>
expression.
</p>
<div class="example">
<pre class="example">(case (* 2 3)
  ((2 3 5 7) 'prime)
  ((1 4 6 8 9) 'composite))    &rArr; composite
(case (car '(c d))
  ((a) 'a)
  ((b) 'b))                    &rArr; unspecified
(case (car '(c d))
  ((a e i o u) 'vowel)
  ((w y) 'semivowel)
  (else =&gt; (lambda (x) x)))    &rArr; c
</pre></div>

<p>The last <var>expression</var> of a <var>case clause</var> is in tail context if
the <code>case</code> expression itself is.
</p></dd></dl>

<span id="def_002dmatch"></span><dl class="def">
<dt id="index-match"><span class="category">Syntax: </span><span><strong>match</strong> <em><a href="#meta_002dmatch_002dkey"><var>match-key</var></a> <a href="#meta_002dexpression"><var>expression</var></a> <a href="#meta_002dmatch_002dclause"><var>match-clause</var></a><sup>+</sup></em><a href='#index-match' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>match</code> form is a generalization of <code>case</code> using <a href="#meta_002dpattern"><var>pattern</var></a>s,
</p><div class="display">
<pre class="display"><span id="index-match_002dkey"></span><span id="meta_002dmatch_002dkey"></span><var>match-key</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-match_002dclause"></span><span id="meta_002dmatch_002dclause"></span><var>match-clause</var> <tt>::=</tt>
  <code><b>(</b></code> <a href="#meta_002dpattern"><var>pattern</var></a> [<a href="#meta_002dguard"><var>guard</var></a>] <a href="#meta_002dbody"><var>body</var></a> <code><b>)</b></code>
</pre></div>
<p>The <var>match-key</var> is evaluated,
Then the <var>match-clause</var>s are tried in order.
The first <var>match-clause</var> whose <var>pattern</var> matches (and
the <var>guard</var>, if any, is true), is selected,
and the corresponding <var>body</var> evaluated.
It is an error if no <var>match-clause</var> matches.
</p><div class="example">
<pre class="example">(match value
  (0 (found-zero))
  (x #!if (&gt; x 0) (found-positive x))
  (x #!if (&lt; x 0) (found-negative x))
  (x::symbol (found-symbol x))
  (_ (found-other)))
</pre></div>

<p>One <code>case</code> feature is not (yet) directly supported by <code>match</code>:
Matching against a list of values.
However, this is easy to simulate using a guard using <code>memq</code>,
<code>memv</code>, or <code>member</code>:
</p><div class="example">
<pre class="example">;; compare similar example under case
(match (car '(c d))
  (x #!if (memv x '(a e i o u)) ’vowel)
  (x #!if (memv x '(w y)) ’semivowel)
  (x x))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-and"><span class="category">Syntax: </span><span><strong>and</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> &hellip;</em><a href='#index-and' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>If there are no <var>test-expression</var>s, <code>#t</code> is returned.  Otherwise, the
<var>test-expression</var> are evaluated from left to right until a
<var>test-expression</var> returns <code>#f</code> or the last <var>test-expression</var> is reached.  In the
former case, the <code>and</code> expression returns <code>#f</code> without
evaluating the remaining expressions.  In the latter case, the last
expression is evaluated and its values are returned.
</p>
<div class="example">
<pre class="example">(and (= 2 2) (&gt; 2 1))          &rArr;  #t
(and (= 2 2) (&lt; 2 1))          &rArr;  #f
(and 1 2 'c '(f g))            &rArr;  (f g)
(and)                          &rArr;  #t
</pre></div>

<p>The <code>and</code> keyword could be defined in terms of <code>if</code> using
<code>syntax-rules</code> as follows:
</p>
<div class="example">
<pre class="example">(define-syntax and
  (syntax-rules ()
    ((and) #t)
    ((and test) test)
    ((and test1 test2 ...)
     (if test1 (and test2 ...) #t))))
</pre></div>

<p>The last <var>test-expression</var> is in tail context if the <code>and</code>
expression itself is.
</p></dd></dl>

<dl class="def">
<dt id="index-or"><span class="category">Syntax: </span><span><strong>or</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> &hellip;</em><a href='#index-or' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If there are no <var>test-expression</var>s, <code>#f</code> is returned.  Otherwise, the
<var>test-expression</var>s are evaluated from left to right until a
<var>test-expression</var> returns a true value <var>val</var> or the last
<var>test-expression</var> is
reached.  In the former case, the <code>or</code> expression returns <var>val</var>
without evaluating the remaining expressions.  In the latter case, the
last expression is evaluated and its values are returned.
</p>
<div class="example">
<pre class="example">(or (= 2 2) (&gt; 2 1))           &rArr; #t
(or (= 2 2) (&lt; 2 1))           &rArr; #t
(or #f #f #f)                  &rArr; #f
(or '(b c) (/ 3 0))            &rArr; (b c)
</pre></div>

<p>The <code>or</code> keyword could be defined in terms of <code>if</code> using
<code>syntax-rules</code> as follows:
</p>
<div class="example">
<pre class="example">(define-syntax or
  (syntax-rules ()
    ((or) #f)
    ((or test) test)
    ((or test1 test2 ...)
     (let ((x test1))
       (if x x (or test2 ...))))))
</pre></div>

<p>The last <var>test-expression</var> is in tail context if the <code>or</code>
expression itself is.
</p></dd></dl>


<dl class="def">
<dt id="index-when"><span class="category">Syntax: </span><span><strong>when</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> form...</em><a href='#index-when' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>test-expression</var> is true, evaluate each <var>form</var> in order,
returning the value of the last one.
</p></dd></dl>

<dl class="def">
<dt id="index-unless"><span class="category">Syntax: </span><span><strong>unless</strong> <em><a href="#meta_002dtest_002dexpression"><var>test-expression</var></a> form...</em><a href='#index-unless' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>test-expression</var> is false, evaluate each <var>form</var> in order,
returning the value of the last one.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Variables-and-Patterns">
<div class="header">
<p>
Next: <a href="#Definitions" accesskey="n" rel="next">Definitions</a>, Previous: <a href="#Conditionals" accesskey="p" rel="prev">Conditionals</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Variables-and-Patterns-1"></span><h3 class="section">8.3 Variables and Patterns</h3>

<p>An identifier can name either a type of syntax or a location
where a value can be stored. An identifier that names a
type of syntax is called a <em>syntactic keyword</em>
(informally called a <em>macro</em>), and is said to be
<em>bound</em> to a transformer for that syntax. An identifier that
names a location is called a <em>variable</em> and is said to be <em>bound</em>
to that location. The set of all visible bindings in effect at
some point in a program is known as the <em>environment</em> in
effect at that point. The value stored in the location to
which a variable is bound is called the variable’s value.
By abuse of terminology, the variable is sometimes said
to name the value or to be bound to the value. This is
not quite accurate, but confusion rarely results from this
practice.
</p>
<p>Certain expression types are used to create new kinds of
syntax and to bind syntactic keywords to those new syntaxes,
while other expression types create new locations
and bind variables to those locations. These expression
types are called <em>binding constructs</em>.
Those that bind syntactic keywords are discussed in <a href="#Macros">Macros</a>.
The most fundamental of the variable binding constructs is the
<a href="#meta_002dlambda_002dexpression"><code>lambda</code> expression</a>,
because all other variable binding constructs
can be explained in terms of <code>lambda</code> expressions.
Other binding constructs include the <a href="#Definitions"><code>define</code> family</a>,
and the <a href="#Local-binding-constructs"><code>let</code> family</a>.
</p>
<p>Scheme is a language with block structure. To each place
where an identifier is bound in a program there corresponds
a <em>region</em> of the program text within which the binding is visible.
The region is determined by the particular binding construct that
establishes the binding; if the binding is
established by a <code>lambda</code> expression, for example, then its
region is the entire <code>lambda</code> expression. Every mention of
an identifier refers to the binding of the identifier that established
the innermost of the regions containing the use.
</p>
<p>If there is no binding of the identifier whose region contains the use,
then the use refers to the binding for the
variable in the global environment, if any;
if there is no binding for the identifier, it is said to be <em>unbound</em>.
</p>
<ul class="section-toc">
<li><a href="#Patterns" accesskey="1">Patterns</a></li>
</ul>
<div class="subsection" id="Patterns">
<h4 class="subsection">8.3.1 Patterns</h4>

<p>The usual way to bind variables is to match an incoming
value against a <em>pattern</em>.  The pattern contains variables
that are bound to some value derived from the value.
</p><div class="example">
<pre class="example">(! [x::double y::double] (some-expression))
</pre></div>
<p>In the above example, the pattern <code>[x::double y::double]</code>
is matched against the incoming value that results from
evaluating <code>(some-expression)</code>.
That value is required to be a two-element sequence.
Then the sub-pattern <code>x::double</code> is matched against
element 0 of the sequence, which means it is coerced to a <code>double</code>
and then the coerced value is matched against the sub-pattern <code>x</code>
(which trivially succeeds).  Similarly, <code>y::double</code> is matched
against element 1.
</p>
<p>The syntax of patterns is a work-in-progress. (The focus until now
has been in designing and implementing how patterns work in general,
rather than the details of the pattern syntax.)
</p>
<div class="display">
<pre class="display"><span id="index-pattern"></span><span id="meta_002dpattern"></span><var>pattern</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
  | <code><b>_</b></code>
  | <a href="#meta_002dpattern_002dliteral"><var>pattern-literal</var></a>
  | <code><b>&rsquo;</b></code><a href="#meta_002ddatum"><var>datum</var></a>
  | <a href="#meta_002dpattern"><var>pattern</var></a> <code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>
  | <code><b>[</b></code> <a href="#meta_002dlpattern"><var>lpattern</var></a><sup>*</sup> <code><b>]</b></code>
<span id="index-lpattern"></span><span id="meta_002dlpattern"></span><var>lpattern</var> <tt>::=</tt> <a href="#meta_002dpattern"><var>pattern</var></a>
  | <code><b>@</b></code> <a href="#meta_002dpattern"><var>pattern</var></a>
  | <a href="#meta_002dpattern"><var>pattern</var></a> <code><b>...</b></code>
  | <a href="#meta_002dguard"><var>guard</var></a>
<span id="index-pattern_002dliteral"></span><span id="meta_002dpattern_002dliteral"></span><var>pattern-literal</var> <tt>::=</tt>
    <a href="#meta_002dboolean"><var>boolean</var></a> | number | <a href="#meta_002dcharacter"><var>character</var></a> | <a href="#meta_002dstring"><var>string</var></a>
<span id="index-guard"></span><span id="meta_002dguard"></span><var>guard</var> <tt>::=</tt> <code><b>#!if</b></code> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>This is how the specific patterns work:
</p>
<dl compact="compact">
<dt><span><a href="#meta_002didentifier"><var>identifier</var></a></span></dt>
<dd><p>This is the simplest and most common form of pattern.
The <var>identifier</var> is bound to a new variable
that is initialized to the incoming value.
</p>
</dd>
<dt><span><code><b>_</b></code></span></dt>
<dd><p>This pattern just discards the incoming value.
It is equivalent to a unique otherwise-unused <var>identifier</var>.
</p>
</dd>
<dt><span><a href="#meta_002dpattern_002dliteral"><var>pattern-literal</var></a></span></dt>
<dd><p>Matches if the value is <code>equal?</code> to the <var>pattern-literal</var>.
</p>
</dd>
<dt><span><code><b>&rsquo;</b></code><a href="#meta_002ddatum"><var>datum</var></a></span></dt>
<dd><p>Matches if the value is <code>equal?</code> to the quoted <var>datum</var>.
</p>
</dd>
<dt><span><a href="#meta_002dpattern"><var>pattern</var></a> <code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a></span></dt>
<dd><p>The incoming value is coerced to a value of the specified <var>type</var>,
and then the coerced value is matched against the sub-<var>pattern</var>.
Most commonly the sub-<var>pattern</var> is a plain <var>identifier</var>,
so the latter match is trivial.
</p>
</dd>
<dt><span><code><b>[</b></code> <a href="#meta_002dlpattern"><var>lpattern</var></a><sup>*</sup> <code><b>]</b></code></span></dt>
<dd><p>The incoming value must be a sequence (a list, vector or similar).
In the case where each sub-pattern is a plain <var>pattern</var>,
then the number of sub-patterns must match the size of the sequence, and
each sub-pattern is matched against the corresponding element of the sequence.
More generally, each sub-pattern may match zero or more consequtive
elements of the incoming sequence.
</p>
</dd>
<dt><span><code><b>#!if</b></code> <a href="#meta_002dexpression"><var>expression</var></a></span></dt>
<dd><p>No incoming value is used.  Instead the <var>expression</var> is evaluated.
If the result is true, matching succeeds (so far);
otherwise the match fails.
This form is called a <a href="https://en.wikipedia.org/wiki/Guard_(computer_science)"><em>guard</em></a>.
</p></dd>
</dl>

<hr>
</div>
</div>
<div class="section" id="Definitions">
<div class="header">
<p>
Next: <a href="#Local-binding-constructs" accesskey="n" rel="next">Local binding constructs</a>, Previous: <a href="#Variables-and-Patterns" accesskey="p" rel="prev">Variables and Patterns</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Definitions-1"></span><h3 class="section">8.4 Definitions</h3>

<p>A variable definition binds one or more identifiers and specifies
an initial value for each of them. The simplest kind of
variable definition takes one of the following forms:
</p>
<dl class="def">
<dt id="index-_0021"><span class="category">Syntax: </span><span><strong>!</strong> <em><a href="#meta_002dpattern"><var>pattern</var></a> <a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluate <a href="#meta_002dexpression"><var>expression</var></a>, and match the result against <var>pattern</var>.
Defining variables in <a href="#meta_002dpattern"><var>pattern</var></a> becomes bound in the
current (surrounding) scope.
</p>
<p>This is similar to <code>define-constant</code> except generalized to a <var>pattern</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-define"><span class="category">Syntax: </span><span><strong>define</strong> <em>name [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] <a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-define' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluate the <var>expression</var>, optionally converting it to <var>type</var>,
and bind the <var>name</var> to the result.
</p></dd></dl>

<dl class="def">
<dt id="index-define-1"><span class="category">Syntax: </span><span><strong>define</strong> <em>(name <a href="#meta_002dformal_002darguments"><var>formal-arguments</var></a>) (<a href="#meta_002dannotation"><var>annotation</var></a> | <a href="#meta_002doption_002dpair"><var>option-pair</var></a>)<sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-define-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-define-2"><span class="category">Syntax: </span><span><strong>define</strong> <em>(name <code><b>.</b></code> <a href="#meta_002drest_002darg"><var>rest-arg</var></a>) (<a href="#meta_002dannotation"><var>annotation</var></a> | <a href="#meta_002doption_002dpair"><var>option-pair</var></a>)<sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-define-2' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Bind the <var>name</var> to a function definition.  The form:
</p><div class="example">
<pre class="example">(define (<var>name</var> <a href="#meta_002dformal_002darguments"><var>formal-arguments</var></a>) <a href="#meta_002doption_002dpair"><var>option-pair</var></a><sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a>)
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(define <var>name</var> (lambda <a href="#meta_002dformal_002darguments"><var>formal-arguments</var></a>) name: <var>name</var> <a href="#meta_002doption_002dpair"><var>option-pair</var></a><sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a>))
</pre></div>
<p>while the form:
</p><div class="example">
<pre class="example">(define (<var>name</var> . <a href="#meta_002drest_002darg"><var>rest-arg</var></a>) <a href="#meta_002doption_002dpair"><var>option-pair</var></a><sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a>)
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(define <var>name</var> (lambda <a href="#meta_002drest_002darg"><var>rest-arg</var></a>) name: <var>name</var> <a href="#meta_002doption_002dpair"><var>option-pair</var></a><sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a>))
</pre></div>

<p>You can associate <a href="#Annotations">annotations</a> with <var>name</var>.
A field annotation will be associated with the generated field;
a method annotation will be associated with the generated method(s).
</p></dd></dl>

<p>In addition to <code>define</code> (which can take an optional type specifier),
Kawa has some extra definition forms.
</p>
<dl class="def">
<dt id="index-define_002dprivate"><span class="category">Syntax: </span><span><strong>define-private</strong> <em>name [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] value</em><a href='#index-define_002dprivate' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-define_002dprivate-1"><span class="category">Syntax: </span><span><strong>define-private</strong> <em>(name formals) body</em><a href='#index-define_002dprivate-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Same as <code>define</code>, except that <code>name</code> is not exported.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dconstant"><span class="category">Syntax: </span><span><strong>define-constant</strong> <em>name [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] value</em><a href='#index-define_002dconstant' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-define_002dearly_002dconstant"><span class="category">Syntax: </span><span><strong>define-early-constant</strong> <em>name [:: type] value</em><a href='#index-define_002dearly_002dconstant' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Defines <var>name</var> to have the given <var>value</var>.
The value is readonly, and you cannot assign to it.
(This is not fully enforced.)
</p>
<p>If <code>define-early-constant</code> is used
<em>or</em> the <var>value</var> is a compile-time constant,
then the compiler will create a <code>final</code> field with
the given name and type, and evaluate <var>value</var>
in the module&rsquo;s class initializer (if the definition
is static) or constructor (if the definition is non-static),
before other definitions and expressions.
Otherwise, the <var>value</var> is evaluated in the module body
where it appears.
</p>
<p>If the <var>value</var> is a compile-time constant,
then the definition defaults to being static.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dvariable"><span class="category">Syntax: </span><span><strong>define-variable</strong> <em>name [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] [init]</em><a href='#index-define_002dvariable' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>init</var> is specified and <var>name</var> does not have a global variable
binding, then <var>init</var> is evaluated, and <var>name</var> bound to the result.
Otherwise, the value bound to <var>name</var> does not change.
(Note that <var>init</var> is not evaluated
if <var>name</var> does have a global variable binding.)
</p>
<p>Also, declares to the compiler that <var>name</var> will be looked up
in the per-thread dynamic environment. This can be useful for shutting up
warnings from <code>--warn-undefined-variable</code>.
</p>
<p>This is similar to the Common Lisp <code>defvar</code> form.
However, the Kawa version is (currently) only allowed at module level.
</p></dd></dl>

<p>For <code>define-namespace</code> and <code>define-private-namespace</code>
see <a href="#Namespaces">Namespaces and compound symbols</a>.
</p>
<hr>
</div>
<div class="section" id="Local-binding-constructs">
<div class="header">
<p>
Next: <a href="#Lazy-evaluation" accesskey="n" rel="next">Lazy evaluation</a>, Previous: <a href="#Definitions" accesskey="p" rel="prev">Definitions</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Local-binding-constructs-1"></span><h3 class="section">8.5 Local binding constructs</h3>

<p>The binding constructs <code>let</code>, <code>let*</code>, <code>letrec</code>,
and <code>letrec*</code> give Scheme a block structure, like Algol 60.
The syntax of these four constructs
is identical, but they differ in the regions they establish
for their variable bindings. In a <code>let</code> expression, the initial
values are computed before any of the variables become
bound; in a <code>let*</code> expression, the bindings and evaluations
are performed sequentially; while in <code>letrec</code> and <code>letrec*</code>
expressions, all the bindings are in effect while their initial
values are being computed, thus allowing mutually recursive definitions.
</p>
<dl class="def">
<dt id="index-let"><span class="category">Syntax: </span><span><strong>let</strong> <em><code><b>((</b></code><a href="#meta_002dpattern"><var>pattern</var></a> <var>init</var><code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-let' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Declare new local variables as found in the <var>pattern</var>s.
Each <var>pattern</var> is matched against the corresponding <var>init</var>.
The <var>init</var>s are evaluated in the current environment (in left-to-right
onder), the <var>variable</var>s in the <var>patterns</var>s are bound to fresh
locations holding the matched results,
the <var>body</var> is evaluated in the extended environment, and the values of
the last expression of body are returned.
Each binding of a variable has <var>body</var> as its region.
</p>
<div class="example">
<pre class="example">(let ((x 2) (y 3))
  (* x y)) &rArr; 6
</pre></div>

<div class="example">
<pre class="example">(let ((x 2) (y 3))
  (let ((x 7)
        (z (+ x y)))
    (* z x)))   &rArr; 35
</pre></div>

<p>An example with a non-trivial pattern:
</p>
<div class="example">
<pre class="example">(let (([a::double b::integer] (vector 4 5)))
  (cons b a))  &rArr; (5 . 4.0)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-let_002a"><span class="category">Syntax: </span><span><strong>let*</strong> <em><code><b>((</b></code><a href="#meta_002dpattern"><var>pattern</var></a> init<code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-let_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The <code>let*</code> binding construct is similar to <code>let</code>,
but the bindings are performed sequentially from left to
right, and the region of a <var>variable</var>s in a <var>pattern</var>
is that part of the <code>let*</code> expression to the right of
the <var>pattern</var>. Thus the second pattern is matched in an environment
in which the bindings from the first pattern are visible, and so on.
</p>
<div class="example">
<pre class="example">(let ((x 2) (y 3))
  (let* ((x 7)
         (z (+ x y)))
    (* z x)))  &rArr; 70
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-letrec"><span class="category">Syntax: </span><span><strong>letrec</strong> <em><code><b>((</b></code>variable [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] init<code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-letrec' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-letrec_002a"><span class="category">Syntax: </span><span><strong>letrec*</strong> <em><code><b>((</b></code>variable [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] init<code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-letrec_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>variable</var>s are bound to fresh locations,
each <var>variable</var> is assigned in left-to-right order
to the result of the corresponding <var>init</var>,
the <var>body</var> is evaluated in the resulting environment,
and the values of the last expression in body are returned.
Despite the left-to-right evaluation and assignment order, each binding of a
<var>variable</var> has the entire <code>letrec</code> or <code>letrec*</code>
expression as its region,
making it possible to define mutually recursive procedures.
</p>
<p>In Kawa <code>letrec</code> is defined as the same as <code>letrec*</code>.
In standard Scheme the order of evaluation of the <var>init</var>s
is undefined, as is the order of assignments.
If the order matters, you should use <code>letrec*</code>.
</p>
<p>If it is not possible to evaluate each <var>init</var> without assigning
or referring to the value of the corresponding <var>variable</var>
or the variables that follow it, it is an error.
</p><div class="example">
<pre class="example">(letrec ((even?
          (lambda (n)
            (if (zero? n)
                #t
                (odd? (- n 1)))))
         (odd?
          (lambda (n)
            (if (zero? n)
                #f
                (even? (- n 1))))))
  (even? 88))
     &rArr; #t
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Lazy-evaluation">
<div class="header">
<p>
Next: <a href="#Threads" accesskey="n" rel="next">Threads</a>, Previous: <a href="#Local-binding-constructs" accesskey="p" rel="prev">Local binding constructs</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Lazy-evaluation-1"></span><h3 class="section">8.6 Lazy evaluation</h3>

<p><em>Lazy evaluation</em> (or call-by-need) delays evaluating an expression until it
is actually needed; when it is evaluated, the result is saved so
repeated evaluation is not needed.
<a href="http://en.wikipedia.org/wiki/Lazy_evaluation">Lazy evaluation</a>
is a technique that can make some algorithms easier to express compactly
or much more efficiently, or both.  It is the normal evaluation mechanism
for strict functional (side-effect-free) languages such as
<a href="http://www.haskell.org">Haskell</a>.
However, automatic lazy evaluation is awkward to combine with side-effects
such as input-output.  It can also be difficult to implement
lazy evaluation efficiently, as it requires more book-keeping.
</p>
<p>Kawa, like other Schemes, uses &ldquo;eager evaluation&rdquo; - an expression
is normally evaluated immediately, unless it is wrapped in a special form.
Standard Scheme has some basic building blocks for &ldquo;manual&rdquo;
lazy evaluation, using an explicit <code>delay</code> operator to
indicate that an expression is to be evaluated lazily,
yielding a <em>promise</em>,
and a <code>force</code> function to force evaluation of a promise.
This functionality is enhanced in
<a href="http://srfi.schemers.org/srfi-45/srfi-45.html">SRFI 45</a>,
in R7RS-draft (based on SRFI 45),
and <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI 41</a> (lazy lists aka streams).
</p>
<p>Kawa makes lazy evaluation easier to use, by <em>implicit forcing</em>:
The promise is automatically evaluated (forced) when used in a
context that requires a normal value, such as arithmetic needing a number.
Kawa enhances lazy evaluation in other ways, including
support for safe multi-threaded programming.
</p>
<ul class="section-toc">
<li><a href="#Delayed-evaluation" accesskey="1">Delayed evaluation</a></li>
<li><a href="#Implicit-forcing" accesskey="2">Implicit forcing</a></li>
<li><a href="#Blank-promises" accesskey="3">Blank promises</a></li>
<li><a href="#Lazy-and-eager-types" accesskey="4">Lazy and eager types</a></li>
</ul>
<div class="subsection" id="Delayed-evaluation">
<h4 class="subsection">8.6.1 Delayed evaluation</h4>

<dl class="def">
<dt id="index-delay"><span class="category">Syntax: </span><span><strong>delay</strong> <em><a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-delay' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>delay</code> construct is used together with the procedure
<code>force</code> to implement <em>lazy evaluation</em> or <em>call by need</em>.
</p>
<p>The result of <code>(delay <var>expression</var>)</code> is a
<em>promise</em> which at some point in the future may be asked (by the
<code>force</code> procedure) to evaluate <var>expression</var>, and deliver the
resulting value.  The effect of <var>expression</var> returning multiple
values is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-delay_002dforce"><span class="category">Syntax: </span><span><strong>delay-force</strong> <em><a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-delay_002dforce' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-lazy"><span class="category">Syntax: </span><span><strong>lazy</strong> <em><a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-lazy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>delay-force</code> construct is similar to <code>delay</code>, but it is expected
that its argument evaluates to a promise.
(Kawa treats a non-promise value as if it were a forced promise.)
The returned
promise, when forced, will evaluate to whatever the original
promise would have evaluated to if it had been forced.
</p>
<p>The expression <code>(delay-force <var>expression</var>)</code> is
conceptually similar to <code>(delay (force <var>expression</var>))</code>, with
the difference that forcing the result of <code>delay-force</code> will
in effect result in a tail call to <code>(force <var>expression</var>)</code>, while
forcing the result of <code>(delay (force <var>expression</var>))</code> might
not. Thus iterative lazy algorithms that might result in a
long series of chains of <code>delay</code> and <code>force</code> can be rewritten
using delay-force to prevent consuming unbounded space
during evaluation.
</p>
<p>Using <code>delay-force</code> or <code>lazy</code> is equivalent.
The name <code>delay-force</code> is from R7RS; the name <code>lazy</code>
is from the older SRFI-45.
</p></dd></dl>

<dl class="def">
<dt id="index-eager"><span class="category">Procedure: </span><span><strong>eager</strong> <em>obj</em><a href='#index-eager' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a promise that when forced will return <var>obj</var>.
It is similar to <code>delay</code>, but does not delay its argument;
it is a procedure rather than syntax.
</p>
<p>The Kawa implementation just returns <var>obj</var> as-is.
This is because Kawa treats as equivalent
a value and forced promise evaluating to the value.
</p></dd></dl>

<dl class="def">
<dt id="index-force"><span class="category">Procedure: </span><span><strong>force</strong> <em>promise</em><a href='#index-force' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>force</code> procedure forces the value of <var>promise</var>.
As a Kawa extension, if the <var>promise</var> is not a promise (a value that
does not implement <code>gnu.mapping.Lazy</code>) then the argument is returned unchanged.
If no value has been computed for the promise, then a value is computed and
returned.  The value of the promise is cached (or &ldquo;memoized&rdquo;) so that
if it is forced a second time, the previously computed value is
returned.
</p><div class="example">
<pre class="example">(force (delay (+ 1 2)))                &rArr;  3

(let ((p (delay (+ 1 2))))
  (list (force p) (force p)))          &rArr;  (3 3)

(define integers
  (letrec ((next
            (lambda (n)
              (cons n (delay (next (+ n 1)))))))
    (next 0)))
(define head 
  (lambda (stream) (car (force stream)))) 
(define tail 
  (lambda (stream) (cdr (force stream)))) 

(head (tail (tail integers)))          &rArr;  2
</pre></div>

<p>The following example is a mechanical transformation of
a lazy stream-filtering algorithm into Scheme. Each call
to a constructor is wrapped in <code>delay</code>, and each argument
passed to a deconstructor is wrapped in <code>force</code>. The use
of <code>(lazy ...)</code> instead of <code>(delay (force ...))</code> around
the body of the procedure ensures that an ever-growing
sequence of pending promises does not exhaust the heap.
</p>
<div class="example">
<pre class="example">(define (stream-filter p? s)
  (lazy
   (if (null? (force s))
       (delay ’())
       (let ((h (car (force s)))
             (t (cdr (force s))))
         (if (p? h)
             (delay (cons h (stream-filter p? t)))
             (stream-filter p? t))))))

(head (tail (tail (stream-filter odd? integers))))
    &rArr; 5
</pre></div>

</dd></dl>

<dl class="def">
<dt id="index-force_002a"><span class="category">Procedure: </span><span><strong>force*</strong> <em>promise</em><a href='#index-force_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Does <code>force</code> as many times as necessary to produce a non-promise.
(A non-promise is a value that does not implement <code>gnu.mapping.Lazy</code>,
or if it does implement <code>gnu.mapping.Lazy</code> then forcing the value
using the <code>getValue</code> method yields the receiver.)
</p>
<p>The <code>force*</code> function is a Kawa extension.
Kawa will add implicit calls to <code>force*</code>
in most contexts that need it, but you can also call it explicitly.
</p></dd></dl>

<p>The following examples are not intended to illustrate good
programming style, as <code>delay</code>, <code>lazy</code>, and <code>force</code> are mainly
intended for programs written in the functional style.
However, they do illustrate the property that only one value is
computed for a promise, no matter how many times it is
forced.
</p>
<div class="example">
<pre class="example">(define count 0)
(define p
  (delay (begin (set! count (+ count 1))
                (if (&gt; count x)
                    count
                    (force p)))))
(define x 5)
p                  &rArr; <em>a promise</em>
(force p)          &rArr; 6
p                  &rArr; <em>a promise, still</em>
(begin (set! x 10)
       (force p))  &rArr; 6
</pre></div>

</div>
<div class="subsection" id="Implicit-forcing">
<h4 class="subsection">8.6.2 Implicit forcing</h4>

<p>If you pass a promise as an argument to a function like <code>sqrt</code>
if must first be forced to a number.  In general, Kawa does this
automatically (implicitly) as needed, depending on the context.
For example:
</p><div class="example">
<pre class="example">(+ (delay (* 3 7)) 13)   &rArr; 34
</pre></div>

<p>Other functions,
like <code>cons</code> have no problems with promises, and automatic forcing
would be undesirable.
</p>
<p>Generally, implicit forcing happens for arguments that require a
specific type, and does not happen for arguments that work on
<em>any</em> type (or <code>Object</code>).
</p>
<p>Implicit forcing happens for:
</p><ul>
<li> arguments to arithmetic functions;
</li><li> the sequence and the index in indexing operations, like <code>string-ref</code>;
</li><li> the operands to <code>eqv?</code> and <code>equal?</code> are forced,
though the operands to <code>eq?</code> are not;
</li><li> port operands to port functions;
</li><li> the value to be emitted by a <code>display</code> but <em>not</em> the
value to be emitted by a <code>write</code>;
</li><li> the function in an application.
</li></ul>

<p>Type membership tests, such as the <code>instance?</code> operation,
generally do not force their values.
</p>
<p>The exact behavior for when implicit forcing happens is a work-in-progress:
There are certainly places where implicit forcing doesn&rsquo;t happen while
it should; there are also likely to be places where implicit forcing
happens while it is undesirable.
</p>
<p>Most Scheme implementations are such that a forced promise behaves differently
from its forced value, but some Scheme implementions are such that there is no
means by which a promise can be operationally distinguished
from its forced value.
Kawa is a hybrid: Kawa tries to minimize the difference between
a forced promise and its forced value, and may freely optimize
and replace a forced promise with its value.
</p>
</div>
<div class="subsection" id="Blank-promises">
<h4 class="subsection">8.6.3 Blank promises</h4>

<p>A <em>blank promise</em> is a promise that doesn&rsquo;t (yet) have
a value <em>or</em> a rule for calculating the value.
Forcing a blank promise will wait forever, until some
other thread makes the promise non-blank.
</p>
<p>Blank promises are useful as a synchronization mechanism -
you can use it to safely pass data from one thread (the producer)
to another thread (the consumer).  Note that you can only
pass one value for a given promise: To pass multiple values, you
need multiple promises.
</p>
<div class="example">
<pre class="example">(define p (promise))
(future ;; Consumer thread
  (begin
    (do-stuff)
    (define v (force promise)) ; waits until promise-set-value!
    (do-stuff-with v)))
;; Producer thread
... do stuff ...
(promise-set-value! p (calculate-value))
</pre></div>

<dl class="def">
<dt id="index-promise"><span class="category">Constructor: </span><span><strong>promise</strong><a href='#index-promise' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Calling <code>promise</code> as a zero-argument constructor
creates a new blank promise.
</p>
<p>This calls the constructor for <code>gnu.mapping.Promise</code>.
You can also create a non-blank promise, by setting one
of the <code>value</code>, <code>alias</code>, <code>thunk</code>, or <code>exception</code> properties.
Doing so is equivalent to calling <code>promise-set-value!</code>,
<code>promise-set-alias!</code>, <code>promise-set-thunk!</code>, or
<code>promise-set-exception!</code> on the resulting promise.
For example: <code>(delay exp)</code> is equivalent to:
</p><div class="example">
<pre class="example">(promise thunk: (lambda() exp))
</pre></div>
</dd></dl>

<p>The following four procedures require that their first arguments
be blank promises.  When the procedure returns, the promise is
no longer blank, and cannot be changed.  This is because a
promise is conceptually a placeholder for a single &ldquo;not-yet-known&rdquo; value;
it is not a location that can be assigned multiple times.
The former enables clean and safe (&ldquo;declarative&quot;) use of multiple threads;
the latter is much trickier.
</p>
<dl class="def">
<dt id="index-promise_002dset_002dvalue_0021"><span class="category">Procedure: </span><span><strong>promise-set-value!</strong> <em>promise value</em><a href='#index-promise_002dset_002dvalue_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Sets the value of the <var>promise</var> to <var>value</var>,
which makes the <var>promise</var> forced.
</p></dd></dl>

<dl class="def">
<dt id="index-promise_002dset_002dexception_0021"><span class="category">Procedure: </span><span><strong>promise-set-exception!</strong> <em>promise exception</em><a href='#index-promise_002dset_002dexception_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Associate <var>exception</var> with the <var>promise</var>.
When the <var>promise</var> is forced the <var>exception</var> gets thrown.
</p></dd></dl>

<dl class="def">
<dt id="index-promise_002dset_002dalias_0021"><span class="category">Procedure: </span><span><strong>promise-set-alias!</strong> <em>promise other</em><a href='#index-promise_002dset_002dalias_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Bind the <var>promise</var> to be an alias of <var>other</var>.
Forcing <var>promise</var> will cause <var>other</var> to be forced.
</p></dd></dl>

<dl class="def">
<dt id="index-promise_002dset_002dthunk_0021"><span class="category">Procedure: </span><span><strong>promise-set-thunk!</strong> <em>promise thunk</em><a href='#index-promise_002dset_002dthunk_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Associate <var>thunk</var> (a zero-argument procedure) with the <var>promise</var>.
The first time the <var>promise</var> is forced will causes the
<var>thunk</var> to be called, with the result (a value or an exception)
saved for future calls.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dpromise"><span class="category">Procedure: </span><span><strong>make-promise</strong> <em>obj</em><a href='#index-make_002dpromise' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>make-promise</code> procedure returns a promise which,
when forced, will return <var>obj</var>. It is similar to <code>delay</code>, but
does not delay its argument: it is a procedure rather than
syntax. If <var>obj</var> is already a promise, it is returned.
</p>
<p>Because of Kawa&rsquo;s implicit forcing, there is seldom a
need to use <code>make-promise</code>, except for portability.
</p></dd></dl>

</div>
<div class="subsection" id="Lazy-and-eager-types">
<h4 class="subsection">8.6.4 Lazy and eager types</h4>

<dl class="def">
<dt id="index-promise_005bT_005d"><span class="category">Type: </span><span><strong>promise[T]</strong><a href='#index-promise_005bT_005d' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This parameterized type is the type of promises that evaluate to
an value of type <code>T</code>.
It is equivalent to the Java interface <code>gnu.mapping.Lazy&lt;T&gt;</code>.
The implementation class for promises is usually <code>gnu.mapping.Promise</code>,
though there are other classes that implement <code>Lazy</code>,
most notably <code>gnu.mapping.Future</code>, used for futures,
which are promises evaluated in a separate thread.
</p></dd></dl>

<p>Note the distinction between the types <code>integer</code>
(the type of actual (eager) integer values), and <code>promise[integer]</code>
(the type of (lazy) promises that evaluate to integer).
The two are compatible: if a <code>promise[integer]</code> value is provided
in a context requiring an <code>integer</code> then it is automatically
evaluated (forced).  If an <code>integer</code> value is provided
in context requiring a <code>promise[integer]</code>, that conversion is basically
a no-op (though the compiler may wrap the <code>integer</code>
in a pre-forced promise).
</p>
<p>In a fully-lazy language there would be no distinction, or
at least the promise type would be the default.  However, Kawa is
a mostly-eager language, so the eager type is the default.
This makes efficient code-generation easier: If an expression
has an eager type, then the compiler can generate code that
works on its values directly, without having to check for laziness.
</p>
<hr>
</div>
</div>
<div class="section" id="Threads">
<div class="header">
<p>
Next: <a href="#Exceptions" accesskey="n" rel="next">Exception handling</a>, Previous: <a href="#Lazy-evaluation" accesskey="p" rel="prev">Lazy evaluation</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Threads-1"></span><h3 class="section">8.7 Threads</h3>

<p>There is a very preliminary interface to create parallel threads.
The interface is similar to the standard <code>delay</code>/<code>force</code>,
where a thread is basically the same as a promise, except that
evaluation may be in parallel.
</p>
<dl class="def">
<dt id="index-future"><span class="category">Syntax: </span><span><strong>future</strong> <em>expression</em><a href='#index-future' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a new thread that evaluates <var>expression</var>.
</p>
<p>(The result extends <code>java.lang.Thread</code> and
implements <code>gnu.mapping.Lazy</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-force-1"><span class="category">Procedure: </span><span><strong>force</strong> <em>thread</em><a href='#index-force-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The standard <code>force</code> function is generalized to also work
on threads.  It waits for the thread&rsquo;s <var>expression</var> to finish
executing, and returns the result.
</p></dd></dl>

<dl class="def">
<dt id="index-runnable"><span class="category">Procedure: </span><span><strong>runnable</strong> <em>function</em><a href='#index-runnable' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a new <code>Runnable</code> instance from a function.
Useful for passing to Java code that expects a <code>Runnable</code>.
You can get the result (a value or a thrown exception) using the
<code>getResult</code> method.
</p></dd></dl>

<dl class="def">
<dt id="index-synchronized"><span class="category">Syntax: </span><span><strong>synchronized</strong> <em>object form ...</em><a href='#index-synchronized' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Synchronize on the given <var>object</var>.  (This means getting an
exclusive lock on the object, by acquiring its <em>monitor</em>.)
Then execute the <var>form</var>s while holding the lock.
When the <var>form</var>s finish (normally or abnormally by throwing
an exception), the lock is released.
Returns the result of the last <var>form</var>.
Equivalent to the Java <code>synchronized</code> statement,
except that it may return a result.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Exceptions">
<div class="header">
<p>
Previous: <a href="#Threads" accesskey="p" rel="prev">Threads</a>, Up: <a href="#Program-structure" accesskey="u" rel="up">Program structure</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Exception-handling"></span><h3 class="section">8.8 Exception handling</h3>
<p>An <em>exception</em> is an object used to signal an error or
other exceptional situation.  The program or run-time system
can <em>throw</em> the exception when an error is discovered.
An exception handler is a program construct that registers
an action to handle exceptions when the handler is active.
</p>
<p>If an exception is thrown and not handled then the
read-eval-print-loop will print a stack trace, and bring
you back to the top level prompt.
When not running interactively, an unhandled exception
will normally cause Kawa to be exited.
</p>
<p>In the Scheme exception model (as of R6RS and R7RS),
exception handlers are one-argument procedures that determine
the action the program takes when an exceptional situation is signaled.
The system implicitly maintains a
current exception handler in the dynamic environment.
The program raises an exception by invoking the current
exception handler, passing it an object encapsulating information
about the exception. Any procedure accepting
one argument can serve as an exception handler and any
object can be used to represent an exception.
</p>
<p>The Scheme exception model is implemented on top of the Java VM&rsquo;s
native exception model where the only objects that
can be thrown are instances of <code>java.lang.Throwable</code>.
Kawa also provides direct access to this native model,
as well as older Scheme exception models.
</p>
<dl class="def">
<dt id="index-with_002dexception_002dhandler"><span class="category">Procedure: </span><span><strong>with-exception-handler</strong> <em>handler thunk</em><a href='#index-with_002dexception_002dhandler' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if <var>handler</var> does not accept one argument.
It is also an error if <var>thunk</var> does not accept zero arguments.
The <code>with-exception-handler</code> procedure returns the results
of invoking <var>thunk</var>. The <var>handler</var> is installed as the current
exception handler in the dynamic environment used for the
invocation of <var>thunk</var>.
</p>
<div class="example">
<pre class="example">(call-with-current-continuation
  (lambda (k)
   (with-exception-handler
    (lambda (x)
     (display &quot;condition: &quot;)
     (write x)
     (newline)
     (k 'exception))
    (lambda ()
     (+ 1 (raise ’an-error))))))
       &rArr; exception
       <i>and prints</i> condition: an-error
</pre></div>

<div class="example">
<pre class="example">(with-exception-handler
 (lambda (x)
  (display &quot;something went wrong\n&quot;))
 (lambda ()
  (+ 1 (raise ’an-error))))
    <i>prints</i> something went wrong
</pre></div>

<p>After printing, the second example then raises another exception.
</p>
<p><em>Performance note:</em> The <var>thunk</var> is inlined if it is a
lambda expression.  However, the <var>handler</var> cannot be inlined
even if it is a lambda expression, because it could be called by
<code>raise-continuable</code>.  Using the <code>guard</code> form is
usually more efficient.
</p></dd></dl>

<dl class="def">
<dt id="index-raise"><span class="category">Procedure: </span><span><strong>raise</strong> <em>obj</em><a href='#index-raise' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Raises an exception by invoking the current exception handler on <var>obj</var>.
The handler is called with the same dynamic
environment as that of the call to raise, except that the
current exception handler is the one that was in place when
the handler being called was installed. If the handler returns,
then <var>obj</var> is re-raised in the same dynamic environment as the handler.
</p>
<p>If <var>obj</var> is an instance of <code>java.lang.Throwable</code>,
then <code>raise</code> has the same effect as <code>primitive-throw</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-raise_002dcontinuable"><span class="category">Procedure: </span><span><strong>raise-continuable</strong> <em>obj</em><a href='#index-raise_002dcontinuable' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Raises an exception by invoking the current exception handler on <var>obj</var>.
The handler is called with the same dynamic
environment as the call to <code>raise-continuable</code>, except
that: (1) the current exception handler is the one that was
in place when the handler being called was installed, and
(2) if the handler being called returns, then it will again
become the current exception handler.
If the handler returns, the values it returns become the values
returned by the call to <code>raise-continuable</code>.
</p>
<div class="example">
<pre class="example">(with-exception-handler
  (lambda (con)
    (cond
      ((string? con)
       (display con))
      (else
       (display &quot;a warning has been issued&quot;)))
    42)
  (lambda ()
    (+ (raise-continuable &quot;should be a number&quot;)
       23)))
      <i>prints:</i> should be a number
      &rArr; 65
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-guard-1"><span class="category">Syntax: </span><span><strong>guard</strong> <em><var>variable</var> <a href="#meta_002dcond_002dclause"><var>cond-clause</var></a><sup>+</sup> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-guard-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>body</var> is evaluated with an exception handler that binds
the raised object to <var>variable</var> and, within the scope of that binding,
evaluates the clauses as if they were the clauses of a <code>cond</code> expression.
That implicit <code>cond</code> expression is evaluated with
the continuation and dynamic environment of the <code>guard</code>
expression. If every cond-clause’s test evaluates to <code>#f</code>
and there is no <code>else</code> clause, then <code>raise-continuable</code> is
invoked on the raised object within the dynamic environment of the
original call to <code>raise</code> or <code>raise-continuable</code>,
except that the current exception handler is that of the
<code>guard</code> expression.
</p>
<div class="example">
<pre class="example">(guard (condition
         ((assq 'a condition) =&gt; cdr)
         ((assq 'b condition)))
  (raise (list (cons 'a 42))))
      &rArr; 42
</pre></div>

<div class="example">
<pre class="example">(guard (condition
         ((assq 'a condition) =&gt; cdr)
         ((assq 'b condition)))
  (raise (list (cons 'b 23))))
      &rArr; (b . 23)
</pre></div>

<p><em>Performance note:</em> Using <code>guard</code> is moderately efficient:
there is some overhead compared to using native exception handling,
but both the <var>body</var> and the handlers in the <var>cond-clause</var>
are inlined.
</p></dd></dl>

<dl class="def">
<dt id="index-dynamic_002dwind"><span class="category">Procedure: </span><span><strong>dynamic-wind</strong> <em>in-guard thunk out-guard</em><a href='#index-dynamic_002dwind' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>All three arguments must be 0-argument procedures.
First calls <var>in-guard</var>, then <var>thunk</var>, then <var>out-guard</var>.
The result of the expression is that of <var>thunk</var>.
If <var>thunk</var> is exited abnormally (by throwing an exception or
invoking a continuation), <var>out-guard</var> is called.
</p>
<p>If the continuation of the dynamic-wind is re-entered (which
is not yet possible in Kawa), the <var>in-guard</var> is called again.
</p>
<p>This function was added in R5RS.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002derror_003f"><span class="category">Procedure: </span><span><strong>read-error?</strong> <em>obj</em><a href='#index-read_002derror_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns #t if <var>obj</var> is an object raised by the <code>read</code> procedure.
(That is if <var>obj</var> is a <code>gnu.text.SyntaxException</code>.)
</p>
</dd></dl>
<dl class="def">
<dt id="index-file_002derror_003f"><span class="category">Procedure: </span><span><strong>file-error?</strong> <em>obj</em><a href='#index-file_002derror_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns #t if <var>obj</var> is an object raised by inability to open an input
or output port on a file.
(This includes <code>java.io.FileNotFoundException</code> as well
as certain other exceptions.)
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Simple-error-objects" accesskey="1">Simple error objects</a></li>
<li><a href="#Named-exceptions" accesskey="2">Named exceptions</a></li>
<li><a href="#Native-exception-handling" accesskey="3">Native exception handling</a></li>
</ul>
<div class="subsection" id="Simple-error-objects">
<h4 class="subsection">8.8.1 Simple error objects</h4>

<dl class="def">
<dt id="index-error"><span class="category">Procedure: </span><span><strong>error</strong> <em>message obj ...</em><a href='#index-error' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Raises an exception as if by calling <code>raise</code>
on a newly allocated <em>simple error object</em>,
which encapsulates the information provided by <var>message</var>
(which should a string), as well as any <var>obj</var> arguments,
known as the irritants.
</p>
<p>The string representation of a simple error object is as if calling
<code>(format &quot;#&lt;ERROR ~a~{ ~w~}&gt;&quot; <var>message</var> <var>irritants</var>)</code>.
(That is the <var>message</var> is formatted as if with <code>display</code>
while each irritant <var>obj</var> is formatted as if with <code>write</code>.)
</p>
<p>This procedure is part of SRFI-23, and R7RS.
It differs from (and is incompatible with) R6RS&rsquo;s <code>error</code> procedure.
</p></dd></dl>

<dl class="def">
<dt id="index-error_002dobject_003f"><span class="category">Procedure: </span><span><strong>error-object?</strong> <em>obj</em><a href='#index-error_002dobject_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>obj</var> is a simple error object.
Specifically, that <var>obj</var> is an instance of <code>kawa.lang.NamedException</code>.
Otherwise, it returns <code>#f</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-error_002dobject_002dmessage"><span class="category">Procedure: </span><span><strong>error-object-message</strong> <em>error-object</em><a href='#index-error_002dobject_002dmessage' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the message encapsulated by error-object,
which must be a simple error object.
</p></dd></dl>

<dl class="def">
<dt id="index-error_002dobject_002dirritants"><span class="category">Procedure: </span><span><strong>error-object-irritants</strong> <em>error-object</em><a href='#index-error_002dobject_002dirritants' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of the irritants (other arguments)
encapsulated by error-object, which must be a simple error object.
</p></dd></dl>

</div>
<div class="subsection" id="Named-exceptions">
<h4 class="subsection">8.8.2 Named exceptions</h4>

<p>These functions associate a symbol with exceptions
and handlers: A handler catches an exception if the symbol matches.
</p>
<dl class="def">
<dt id="index-catch"><span class="category">Procedure: </span><span><strong>catch</strong> <em>key thunk handler</em><a href='#index-catch' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Invoke <var>thunk</var> in the dynamic context of <var>handler</var> for
exceptions matching <var>key</var>.  If thunk throws to the symbol <var>key</var>,
then <var>handler</var> is invoked this way:
</p>
<div class="example">
<pre class="example">(handler key args ...)
</pre></div>

<p><var>key</var> may be a symbol.  The <var>thunk</var> takes no
arguments.  If <var>thunk</var> returns normally, that is the return value of
<code>catch</code>.
</p>
<p>Handler is invoked outside the scope of its own <code>catch</code>.  If
<var>handler</var> again throws to the same key, a new handler from further
up the call chain is invoked.
</p>
<p>If the key is <code>#t</code>, then a throw to <em>any</em> symbol will match
this call to <code>catch</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-throw"><span class="category">Procedure: </span><span><strong>throw</strong> <em>key arg ...</em><a href='#index-throw' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Invoke the catch form matching <var>key</var>, passing the <var>arg</var>s to the
current <var>handler</var>.  
</p>
<p>If the key is a symbol it will match catches of the same
symbol or of <code>#t</code>.
</p>
<p>If there is no handler at all, an error is signaled.
</p></dd></dl>

</div>
<div class="subsection" id="Native-exception-handling">
<h4 class="subsection">8.8.3 Native exception handling</h4>

<dl class="def">
<dt id="index-primitive_002dthrow"><span class="category">Procedure: </span><span><strong>primitive-throw</strong> <em>exception</em><a href='#index-primitive_002dthrow' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Throws the <var>exception</var>, which must be an instance of a sub-class
of <code>java.lang.Throwable</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-try_002dfinally"><span class="category">Syntax: </span><span><strong>try-finally</strong> <em>body handler</em><a href='#index-try_002dfinally' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluate <var>body</var>, and return its result.
However, before it returns, evaluate <var>handler</var>.
Even if <var>body</var> returns abnormally (by throwing an exception),
<var>handler</var> is evaluated.
</p>
<p>(This is implemented just like Java&rsquo;s <code>try</code>-<code>finally</code>.
However, the current implementation does not duplicate the <var>handler</var>.)
</p></dd></dl>

<dl class="def">
<dt id="index-try_002dcatch"><span class="category">Syntax: </span><span><strong>try-catch</strong> <em>body handler ...</em><a href='#index-try_002dcatch' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluate <var>body</var>, in the context of the given <var>handler</var> specifications.
Each <var>handler</var> has the form:
</p><div class="example">
<pre class="example"><var>var</var> <var>type</var> <var>exp</var> ...
</pre></div>
<p>If an exception is thrown in <var>body</var>, the first <var>handler</var>
is selected such that the thrown exception is an instance of
the <var>handler</var>&rsquo;s <var>type</var>. If no <var>handler</var> is selected,
the exception is propagated through the dynamic execution context
until a matching <var>handler</var> is found.  (If no matching <var>handler</var>
is found, then an error message is printed, and the computation terminated.)
</p>
<p>Once a <var>handler</var> is selected,
the <var>var</var> is bound to the thrown exception, and the <var>exp</var> in
the <var>handler</var> are executed.  The result of the <code>try-catch</code>
is the result of <var>body</var> if no exception is thrown, or the
value of the last <var>exp</var> in the selected <var>handler</var> if an
exception is thrown.
</p>
<p>(This is implemented just like Java&rsquo;s <code>try</code>-<code>catch</code>.)
</p></dd></dl>

<hr>
</div>
</div>
</div>
<div class="chapter" id="Control-features">
<div class="header">
<p>
Next: <a href="#Symbols-and-namespaces" accesskey="n" rel="next">Symbols and namespaces</a>, Previous: <a href="#Program-structure" accesskey="p" rel="prev">Program structure</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Control-features-1"></span><h2 class="chapter">9 Control features</h2>


<ul class="section-toc">
<li><a href="#Mapping-functions" accesskey="1">Mapping functions</a></li>
<li><a href="#Multiple-values" accesskey="2">Multiple values</a></li>
</ul>
<hr>
<div class="section" id="Mapping-functions">
<div class="header">
<p>
Next: <a href="#Multiple-values" accesskey="n" rel="next">Multiple values</a>, Up: <a href="#Control-features" accesskey="u" rel="up">Control features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Mapping-functions-1"></span><h3 class="section">9.1 Mapping functions</h3>

<p>The procedures <code>string-for-each</code> and <code>string-map</code>
are documented under <a href="#Strings">Strings</a>.
</p>
<p>The procedure <code>string-cursor-for-each</code> is documented under <a href="#String-Cursor-API">String Cursor API</a>.
</p>
<dl class="def">
<dt id="index-map"><span class="category">Procedure: </span><span><strong>map</strong> <em><var>proc</var> sequence<sub>1</sub> sequence<sub>2</sub> ...</em><a href='#index-map' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-for_002deach"><span class="category">Procedure: </span><span><strong>for-each</strong> <em><var>proc</var> sequence<sub>1</sub> sequence<sub>2</sub> ...</em><a href='#index-for_002deach' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>map</code> procedure applies <var>proc</var> element-wise to the elements
of the <var>sequence</var>s and returns a list of the results, in order.
The dynamic order in which <var>proc</var> is applied to
the elements of the <var>sequence</var>s is unspecified.
</p>
<p>The <code>for-each</code> procedure does the same,
but is executed for the side-effects of <var>proc</var>, whose result (if any)
is discarded.
Unlike <code>map</code>, <code>for-each</code> is guaranteed to call <var>proc</var>
on the elements of the <var>sequences</var>s in order from the first element(s)
to the last.
The value returned by <code>for-each</code> is the void value.
</p>
<p>Each <var>sequence</var> must be a generalized sequence.
(Traditionally, these arguments were restricted to lists,
but Kawa allows sequences, including vectors, Java arrays, and strings.)
If more than one <var>sequence</var> is given and not all
<var>sequence</var>s have the same length, the procedure terminates when the
shortest <var>sequence</var> runs out.
The <var>sequence</var>s can be infinite (for example circular lists),
but it is an error if all of them are infinite.
</p>
<p>The <var>proc</var> must be a procedure that accepts as many arguments
as there are <var>sequence</var> arguments.
It is an error for <var>proc</var> to mutate any of the <var>sequence</var>s.
In the case of <code>map</code>, <var>proc</var> must return a single value.
</p>
<div class="example">
<pre class="example">(map cadr '((a b) (d e) (g h)))
    &rArr; (b e h)

(map (lambda (n) (expt n n))
     '(1 2 3 4 5))
    &rArr; (1 4 27 256 3125)

(map + ’(1 2 3) ’(4 5 6 7))  &rArr; (5 7 9)

(let ((count 0))
  (map (lambda (ignored)
         (set! count (+ count 1))
         count)
       '(a b)))
    &rArr; (1 2) <i>or</i> (2 1)
</pre></div>

<p>The result of <code>map</code> is a list, even if the arguments are non-lists:
</p><div class="example">
<pre class="example">(map +
     #(3 4 5)
     (float[] 0.5 1.5))
    &rArr; (3.5 5.5)
</pre></div>

<p>To get a vector result, use <code>vector-map</code>.
</p>
<div class="example">
<pre class="example">(let ((v (make-vector 5)))
  (for-each (lambda (i)
              (vector-set! v i (* i i)))
            '(0 1 2 3 4))
  v)
    &rArr;  #(0 1 4 9 16)
</pre></div>

<p>A string is considered a sequence of <code>character</code> values
(not 16-bit <code>char</code> values):
</p>
<div class="example">
<pre class="example">(let ((v (make-vector 10 #\-)))
  (for-each (lambda (i ch)
              (vector-set! v i ch))
            [0 &lt;: ]
            &quot;Smile 😃!&quot;)
   v)
    &rArr; #(#\S #\m #\i #\l #\e #\space #\x1f603 #\! #\- #\-)
</pre></div>

<p><em>Performance note:</em> These procedures are pretty well optimized.
For each <var>sequence</var> the compiler will by default create an
iterator.
However, if the type of the <var>sequence</var> is known, the compiler will
inline the iteration code.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_002dmap"><span class="category">Procedure: </span><span><strong>vector-map</strong> <em><var>proc</var> <var>sequence</var><sub>1</sub> <var>sequence</var><sub>2</sub> &hellip;</em><a href='#index-vector_002dmap' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Same as the <code>map</code> procedure, except the result is a vector.
(Traditionally, these arguments were restricted to vectors,
but Kawa allows sequences, including lists, Java arrays, and strings.)
</p>
<div class="example">
<pre class="example">(vector-map cadr '#((a b) (d e) (g h)))
    &rArr; #(b e h)

(vector-map (lambda (n) (expt n n))
            '#(1 2 3 4 5))
    &rArr; #(1 4 27 256 3125)

(vector-map + '#(1 2 3) ’#(4 5 6 7))
    &rArr; #(5 7 9)

(let ((count 0))
  (vector-map
    (lambda (ignored)
      (set! count (+ count 1))
      count)
    '#(a b)))
    &rArr; #(1 2) <i>or</i> #(2 1)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dfor_002deach"><span class="category">Procedure: </span><span><strong>vector-for-each</strong> <em><var>proc</var> <var>vector</var><sub>1</sub> <var>vector</var><sub>2</sub> &hellip;</em><a href='#index-vector_002dfor_002deach' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Mostly the same as <code>for-each</code>,
however the arguments should be generalized vectors.
Specifically, they should implement <code>java.util.List</code>
(which both regular vectors and uniform vectors do).
The <var>vectors</var> should also be efficiently indexable.
</p>
<p>(Traditionally, these arguments were restricted to vectors,
but Kawa allows sequences, including lists, Java arrays, and strings.)
</p>
<div class="example">
<pre class="example">(let ((v (make-list 5)))
  (vector-for-each
    (lambda (i) (list-set! v i (* i i)))
    '#(0 1 2 3 4))
  v)
    &rArr; (0 1 4 9 16)
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Multiple-values">
<div class="header">
<p>
Previous: <a href="#Mapping-functions" accesskey="p" rel="prev">Mapping functions</a>, Up: <a href="#Control-features" accesskey="u" rel="up">Control features</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Multiple-values-1"></span><h3 class="section">9.2 Multiple values</h3>

<p>The multiple-value feature was added in R5RS.
</p>
<dl class="def">
<dt id="index-values"><span class="category">Procedure: </span><span><strong>values</strong> <em>object ...</em><a href='#index-values' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Delivers all of its arguments to its continuation.
</p></dd></dl>

<dl class="def">
<dt id="index-call_002dwith_002dvalues"><span class="category">Procedure: </span><span><strong>call-with-values</strong> <em>producer consumer</em><a href='#index-call_002dwith_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Calls its <var>producer</var> argument with no arguments and a
continuation that, when passed some values, calls the
<var>consumer</var> procedure with those values as arguments.
</p>
<div class="example">
<pre class="example">(call-with-values (lambda () (values 4 5))
                  (lambda (a b) b))
                         &rArr; 5

(call-with-values * -)   &rArr; -1
</pre></div>

<p><em>Performance note:</em> If either the <var>producer</var> or <var>consumer</var> is a
fixed-arity lambda expression, it is inlined.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dvalues"><span class="category">Syntax: </span><span><strong>define-values</strong> <em><a href="#meta_002dformals"><var>formals</var></a> <a href="#meta_002dexpression"><var>expression</var></a></em><a href='#index-define_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if a variable appears more than once in the
set of <var>formals</var>.
</p>
<p>The <var>expression</var> is evaluated, and the <var>formals</var>
are bound to the return values in the same way that the <var>formals</var> in
a <code>lambda</code> expression are matched to the arguments in a procedure call.
</p>
<div class="example">
<pre class="example">(define-values (x y) (integer-sqrt 17))
(list x y)    &rArr; (4 1)
(let ()
  (define-values (x y) (values 1 2))
  (+ x y))
              &rArr;  3
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-let_002dvalues"><span class="category">Syntax: </span><span><strong>let-values</strong> <em><code><b>((</b></code><a href="#meta_002dformals"><var>formals</var></a> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-let_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Each <var>formals</var> should be a formal arguments list, as for a <code>lambda</code>.
</p>
<p>The <var>expression</var>s are evaluated in the current environment, the
variables of the <var>formals</var> are bound to fresh locations, the return
values of the <var>expression</var>s are stored in the variables, the
<var>body</var> is evaluated in the extended environment, and the values of
the last expression of <var>body</var> are returned. The <var>body</var> is a
&quot;tail body&quot;, cf section 3.5 of the R5RS.
</p>
<p>The matching of each <var>formals</var> to values is as for the matching of
<var>formals</var> to arguments in a <code>lambda</code> expression, and it is an
error for an <var>expression</var> to return a number of values that does not
match its corresponding <var>formals</var>.
</p><div class="example">
<pre class="example">(let-values (((a b . c) (values 1 2 3 4)))
  (list a b c))            &rArr; (1 2 (3 4)) 

(let ((a 'a) (b 'b) (x 'x) (y 'y))
  (let-values (((a b) (values x y))
               ((x y) (values a b)))
    (list a b x y)))       &rArr; (x y a b)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-let_002a_002dvalues"><span class="category">Syntax: </span><span><strong>let*-values</strong> <em><code><b>((</b></code><a href="#meta_002dformals"><var>formals</var></a> <a href="#meta_002dexpression"><var>expression</var></a><code><b>)</b></code> ...<code><b>)</b></code> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-let_002a_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Each <var>formals</var> should be a formal arguments list as for a
<code>lambda</code> expression.
</p>
<p><code>let*-values</code> is similar to <code>let-values</code>, but the bindings are
performed sequentially from left to right, and the region of a binding
indicated by (<var>formals</var> <var>expression</var>) is that part of the
<code>let*-values</code> expression to the right of the binding. Thus the
second binding is done in an environment in which the first binding is
visible, and so on.
</p><div class="example">
<pre class="example">(let ((a 'a) (b 'b) (x 'x) (y 'y))
  (let*-values (((a b) (values x y))
                ((x y) (values a b)))
    (list a b x y)))       &rArr; (x y x y)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-receive"><span class="category">Syntax: </span><span><strong>receive</strong> <em><a href="#meta_002dformals"><var>formals</var></a> <a href="#meta_002dexpression"><var>expression</var></a> <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-receive' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This convenience
form (from <a href="http://srfi.schemers.org/srfi-8/srfi-8.html">SRFI-8</a>)
is equivalent to:
</p><div class="example">
<pre class="example">(let-values ((<var>formals</var> <var>expression</var>)) <var>body</var>)
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(receive a (values 1 2 3 4)
  (reverse a)) &rArr; (4 3 2 1)

(receive (a b . c) (values 1 2 3 4)
  (list a b c))            &rArr; (1 2 (3 4)) 

(let ((a 'a) (b 'b) (x 'x) (y 'y))
  (receive (a b) (values x y)
    (receive (x y) (values a b)
      (list a b x y))))    &rArr; (x y x y)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-values_002dappend"><span class="category">Procedure: </span><span><strong>values-append</strong> <em>arg1 ...</em><a href='#index-values_002dappend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The values resulting from evaluating each argument are appended
together.
</p></dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Symbols-and-namespaces">
<div class="header">
<p>
Next: <a href="#Procedures" accesskey="n" rel="next">Procedures</a>, Previous: <a href="#Control-features" accesskey="p" rel="prev">Control features</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Symbols-and-namespaces-1"></span><h2 class="chapter">10 Symbols and namespaces</h2>

<p>An identifier is a name that appears in a program.
</p>
<p>A symbol is an object representing a string that cannot be
modified. This string is called the symbol&rsquo;s name. Unlike strings, two
symbols whose names are spelled the same way are indistinguishable.
A symbol is immutable (unmodifiable) and normally viewed as atomic.
Symbols are useful for many applications; for instance, they may be
used the way enumerated values are used in other languages.
</p>
<p>In addition to the simple symbols of standard Scheme, Kawa
also has compound (two-part) symbols.
</p>

<ul class="section-toc">
<li><a href="#Simple-symbols" accesskey="1">Simple symbols</a></li>
<li><a href="#Namespaces" accesskey="2">Namespaces and compound symbols</a></li>
<li><a href="#Keywords" accesskey="3">Keywords</a></li>
<li><a href="#Special-named-constants" accesskey="4">Special named constants</a></li>
</ul>
<hr>
<div class="section" id="Simple-symbols">
<div class="header">
<p>
Next: <a href="#Namespaces" accesskey="n" rel="next">Namespaces and compound symbols</a>, Up: <a href="#Symbols-and-namespaces" accesskey="u" rel="up">Symbols and namespaces</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Simple-symbols-1"></span><h3 class="section">10.1 Simple symbols</h3>

<p>Simple symbols have no properties other than their name, an immutable string.
They have the useful property that two simple symbols
are identical (in the sense of <code>eq?</code>, <code>eqv?</code> and
<code>equal?</code>) if and only if their names are spelled the same way.  A
symbol literal is formed using <code>quote</code>.
</p>
<dl class="def">
<dt id="index-symbol_003f"><span class="category">Procedure: </span><span><strong>symbol?</strong> <em><var>obj</var></em><a href='#index-symbol_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a symbol, <code>#f</code> otherwise.
</p>
<div class="example">
<pre class="example">(symbol? 'foo)          &rArr; #t
(symbol? (car '(a b)))  &rArr; #t
(symbol? &quot;bar&quot;)         &rArr; #f
(symbol? 'nil)          &rArr; #t
(symbol? '())           &rArr; #f
(symbol? #f)            &rArr; #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-symbol_002d_003estring"><span class="category">Procedure: </span><span><strong>symbol-&gt;string</strong> <em><var>symbol</var></em><a href='#index-symbol_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the name of <var>symbol</var> as an immutable string.
</p>
<div class="example">
<pre class="example">(symbol-&gt;string 'flying-fish)                   &rArr;  &quot;flying-fish&quot;
(symbol-&gt;string 'Martin)                        &rArr;  &quot;Martin&quot;
(symbol-&gt;string (string-&gt;symbol &quot;Malvina&quot;))     &rArr;  &quot;Malvina&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002d_003esymbol"><span class="category">Procedure: </span><span><strong>string-&gt;symbol</strong> <em><var>string</var></em><a href='#index-string_002d_003esymbol' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the symbol whose name is <var>string</var>.
</p>
<div class="example">
<pre class="example">(eq? 'mISSISSIppi 'mississippi)
&rArr; #f

(string-&gt;symbol &quot;mISSISSIppi&quot;)
&rArr; the symbol with name &quot;mISSISSIppi&quot;

(eq? 'bitBlt (string-&gt;symbol &quot;bitBlt&quot;))
&rArr; #t

(eq? 'JollyWog (string-&gt;symbol (symbol-&gt;string 'JollyWog)))
&rArr; #t

(string=? &quot;K. Harper, M.D.&quot;
          (symbol-&gt;string (string-&gt;symbol &quot;K. Harper, M.D.&quot;)))
&rArr; #t
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Namespaces">
<div class="header">
<p>
Next: <a href="#Keywords" accesskey="n" rel="next">Keywords</a>, Previous: <a href="#Simple-symbols" accesskey="p" rel="prev">Simple symbols</a>, Up: <a href="#Symbols-and-namespaces" accesskey="u" rel="up">Symbols and namespaces</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Namespaces-and-compound-symbols"></span><h3 class="section">10.2 Namespaces and compound symbols</h3>

<p>Different applications may want to use the same symbol
to mean different things.  To avoid such <em>name clashes</em>
we can use <em>compound symbols</em>, which have two string parts:
a <em>local name</em> and a <em>namespace URI</em>.
The namespace-uri can be any string, but it is
recommended that it have the form of an absolute
<a href="http://en.wikipedia.org/wiki/Uniform_Resource_Identifier">URI</a>.
It would be too verbose to write the full URI all the
time, so one usually uses a <em>namespace prefix</em>
(namespace alias) as a short local alias to refer to a
namespace URI.
</p>
<p>Compound symbols are usually written using the infix colon operator:
</p><div class="example">
<pre class="example"><var>prefix</var><code><b>:</b></code><var>local-name</var>
</pre></div>
<p>where <var>prefix</var> is a namespace alias bound
to some (lexically-known) namespace URI.
</p>
<p>Compound symbols are used for namespace-aware XML processing.
</p>
<ul class="section-toc">
<li><a href="#Namespace-objects" accesskey="1">Namespace objects</a></li>
<li><a href="#Compound-symbols" accesskey="2">Compound symbols</a></li>
<li><a href="#Namespace-aliases" accesskey="3">Namespace aliases</a></li>
</ul>
<div class="subsection" id="Namespace-objects">
<h4 class="subsection">10.2.1 Namespace objects</h4>

<p>A <em>namespace</em> is a mapping from strings to symbols.
The string is the local-name of the resulting symbol.
A namespace is similar to a Common Lisp <em>package</em>.
</p>
<p>A namespace has a namespace-uri, which a string;
it is recommended that it have the form of an absolute URI.
A namespace may optionally have a prefix, which is a string used
when printing out symbols belonging to the namespace.
(If you want &ldquo;equivalent symbols&rdquo; (i.e. those that have the same
local-name and same uri) to be the identical symbol object, then
you should use namespaces whose prefix is the empty string.)
</p>
<dl class="def">
<dt id="index-namespace"><span class="category">Constructor: </span><span><strong>namespace</strong> <em>name [prefix]</em><a href='#index-namespace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a namespace with the given <var>name</var> and <var>prefix</var>.
If no such namespace exists, create it.
The <var>namespace-name</var> is commonly a URI, especially when working with XML,
in which case it is called a <var>namespace-uri</var>.  However, any non-empty
string is allowed.
The prefix can be a string or a simple symbol.
(If a symbol is used, then the symbol&rsquo;s local-name is used.)
The default for <var>prefix</var> is the empty string.
Multiple calls with the same arguments will yield the same namespace object.
</p></dd></dl>

<p>The reader macro <code>#,namespace</code> is equivalent to the
<code>namespace</code> function, but it is invoked at read-time:
</p><div class="example">
<pre class="example">#,(namespace &quot;http://www.w3.org/1999/XSL/Transform&quot; xsl)
(eq? #,(namespace &quot;foo&quot;) (namespace &quot;foo&quot;)) &rArr; #t
</pre></div>

<p>The form <code>(,#namespace &quot;&quot; &quot;&quot;)</code> returns the default <em>empty namespace</em>,
which is used for simple symbols.
</p>
<dl class="def">
<dt id="index-namespace_002duri"><span class="category">Procedure: </span><span><strong>namespace-uri</strong> <em>namespace</em><a href='#index-namespace_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the namespace-uri of the argument <var>namespace</var>, as a string.
</p></dd></dl>

<dl class="def">
<dt id="index-namespace_002dprefix"><span class="category">Procedure: </span><span><strong>namespace-prefix</strong> <em>namespace</em><a href='#index-namespace_002dprefix' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the namespace prefix of the argument <var>namespace</var>, as a string.
</p></dd></dl>

</div>
<div class="subsection" id="Compound-symbols">
<h4 class="subsection">10.2.2 Compound symbols</h4>

<p>A compound symbol is one that belongs to a namespace other than the
default empty namespace, and (normally) has a non-empty namespace uri.
(It is possible for a symbol to belong to a non-default namespace
and have an empty namespace uri, but that is not recommended.)
</p>
<dl class="def">
<dt id="index-symbol-1"><span class="category">Constructor: </span><span><strong>symbol</strong> <em>local-name namespace-spec</em><a href='#index-symbol-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-symbol-2"><span class="category">Constructor: </span><span><strong>symbol</strong> <em>local-name [uri [prefix]]</em><a href='#index-symbol-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Construct a symbol with the given <var>local-name</var> and namespace.
If <var>namespace-spec</var> is a namespace object, then find (or, if needed,
construct) a symbol with the given <var>local-name</var> belonging to the
namespace.  Multiple calls to <code>symbol</code> with the same namespace
and <var>local-name</var> will yield the same symbol object.
</p>
<p>If uri is a string (optionally followed by a prefix),
then:
</p><div class="example">
<pre class="example">(symbol lname uri [prefix])
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(symbol lname (namespace uri [prefix]))
</pre></div>

<p>Using <code>#t</code> for the <var>namespace-spec</var> is equivalent to
using the empty namespace <code>#,(namespace &quot;&quot;)</code>.
</p>
<p>Using <code>#!null</code> or <code>#f</code> for the <var>namespace-spec</var>
creates an <var>uninterned</var> symbol, which does not belong to
any namespace.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dlocal_002dname"><span class="category">Procedure: </span><span><strong>symbol-local-name</strong> <em>symbol</em><a href='#index-symbol_002dlocal_002dname' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the local name of the argument symbol, as an immutable string.
(The string is interned, except in the case of an uninterned symbol.)
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dprefix"><span class="category">Procedure: </span><span><strong>symbol-prefix</strong> <em>symbol</em><a href='#index-symbol_002dprefix' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the prefix of the argument symbol, as an immutable
(and interned) string.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dnamespace_002duri"><span class="category">Procedure: </span><span><strong>symbol-namespace-uri</strong> <em>symbol</em><a href='#index-symbol_002dnamespace_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the namespace uri of the argument symbol, as an immutable
(and interned) string.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dnamespace"><span class="category">Procedure: </span><span><strong>symbol-namespace</strong> <em>symbol</em><a href='#index-symbol_002dnamespace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the namespace object (if any) of the argument symbol.
Returns <code>#!null</code> if the symbol is uninterned.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_003d_003f"><span class="category">Procedure: </span><span><strong>symbol=?</strong> <em><var>symbol</var><sub>1</sub> <var>symbol</var><sub>2</sub> <var>symbol</var><sub>3</sub> &hellip;</em><a href='#index-symbol_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if the symbols are equivalent as symbols,
i.e., if their local-names and namespace-uris are the same.
They may have different values of <code>symbol-prefix</code> and <code>symbol-namespace</code>.
If a symbol is uninterned (or is <code>#!null</code>) then <code>symbol=?</code>
returns the same result as <code>eq?</code>.
</p></dd></dl>

<p>Two symbols are <code>equal?</code> or <code>eqv?</code> if they&rsquo;re <code>symbol=?</code>.
</p>
</div>
<div class="subsection" id="Namespace-aliases">
<h4 class="subsection">10.2.3 Namespace aliases</h4>

<p>A namespace is usually referenced using a shorter <em>namespace alias</em>,
which is is a lexical definition that binds a namespace prefix
to a namespace object (and thus a namespace uri).
This allows using compound symbols as identifiers in Scheme programs.
</p>
<dl class="def">
<dt id="index-define_002dnamespace"><span class="category">Syntax: </span><span><strong>define-namespace</strong> <em>name namespace-name</em><a href='#index-define_002dnamespace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Defines <var>name</var> as a <em>namespace prefix</em> - a lexically scoped
&quot;nickname&quot; for the namespace
whose full name is <var>namespace-name</var>, which should be a non-empty
string literal.
It is customary for the string have syntactic form of
an absolute <a href="http://en.wikipedia.org/wiki/Uniform_Resource_Identifier">URI</a>,
but any non-empty string is acceptable and is used without
further interpretation.
</p>
<p>Any symbols in the scope of this definitions that contain a colon, and
where the part before the colon matches the <var>name</var> will be
treated as being in the package/namespace whose global unique name
is the <var>namespace-name</var>.
</p>
<p>Has mostly the same effect as:
</p><div class="example">
<pre class="example">(define-constant <var>name</var> #,(namespace <var>namespace-name</var>)
</pre></div>

<p>However, using <code>define-namespace</code> (rather than <code>define-constant</code>)
is recommended if you want to use compound symbols as names of
variables, especially local variables, or if you want to quote
compound symbols.
</p>
<p>Note that the prefix is only visible lexically: it is not
part of the namespace, or thus indirectly the symbols, and
so is not available when printing the symbol.
You might consider using <code>define-xml-namespace</code> as an alternative.
</p>
<p>A namespace is similar to a Common Lisp package,
and the <var>namespace-name</var> is like the name of the package.
However, a namespace alias belongs to the lexical scope,
while a Common Lisp package nickname is global
and belongs to the package itself.
</p>
<p>If the namespace-name starts with the string <code>&quot;class:&quot;</code>, then the
<var>name</var> can be used for invoking Java methods
(see <a href="#Method-operations">Calling Java methods from Scheme</a>) and accessing fields (see <a href="#Field-operations">Accessing object fields</a>).
</p>
<p>You can use a namespace as an abbreviation or renaming of a
class name, but as a matter of style <code>define-alias</code> is preferred.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dprivate_002dnamespace"><span class="category">Syntax: </span><span><strong>define-private-namespace</strong> <em>name namespace-name</em><a href='#index-define_002dprivate_002dnamespace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Same as <code>define-namespace</code>, but the prefix <var>name</var>
is local to the current module.
</p></dd></dl>

<p>For example, you might have a set of a geometry definitions
defined under the namespace-uri <code>&quot;http://foo.org/lib/geometry&quot;</code>:
</p>
<div class="example">
<pre class="example">(define-namespace geom &quot;http://foo.org/lib/geometry&quot;)
(define (geom:translate x y)
  (java.awt.geom.AffineTransform:getTranslateInstance x y))
(define geom:zero (geom:translate 0 0))
geom:zero
  &rArr; AffineTransform[[1.0, 0.0, 0.0], [0.0, 1.0, 0.0]]
</pre></div>

<p>You could have some other definitions for complex math:
</p><div class="example">
<pre class="example">(define-namespace complex &quot;http://foo.org/lib/math/complex&quot;)
(define complex:zero +0+0i)
</pre></div>

<p>You can use a namespace-value directly in a compound name:
</p><div class="example">
<pre class="example">(namespace &quot;http://foo.org/lib/geometry&quot;):zero
  &rArr; AffineTransform[[1.0, 0.0, 0.0], [0.0, 1.0, 0.0]]
</pre></div>

<p>The variation <code>define-xml-namespace</code> is used for <a href="#Creating-XML-nodes">Creating XML nodes</a>.
</p>
<dl class="def">
<dt id="index-define_002dxml_002dnamespace"><span class="category">Syntax: </span><span><strong>define-xml-namespace</strong> <em>prefix &quot;namespace-uri&quot;</em><a href='#index-define_002dxml_002dnamespace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Defines a namespace with prefix <var>prefix</var> and URI <var>namespace-uri</var>.
This is similar to <code>define-namespace</code> but with two important differences:
</p><ul>
<li> Every symbol in the namespace automatically maps to
an element-constructor-type, as with  the <code>html</code> namespace.
</li><li> The <var>prefix</var> is a component of the namespace object, and
hence indirectly of any symbols belongining to the namespace.
</li></ul>

<p>Thus the definition is roughly equivalent to:
</p><div class="example">
<pre class="example">(define-constant <var>name</var> #,(namespace <var>namespace-name name</var>)
</pre></div>
<p>along with an infinite set of definitions, for every possible <var>tag</var>:
</p><div class="example">
<pre class="example">(define (name:<var>tag</var> . rest) (apply make-element 'name:<var>tag</var> rest))
</pre></div>

</dd></dl>

<div class="example">
<pre class="example">$ kawa --output-format xml
#|kawa:1|# <kbd>(define-xml-namespace na &quot;Namespace1&quot;)</kbd>
#|kawa:2|# <kbd>(define-xml-namespace nb &quot;Namespace1&quot;)</kbd>
#|kawa:3|# <kbd>(define xa (na:em &quot;Info&quot;))</kbd>
#|kawa:4|# <kbd>xa</kbd>
&lt;na:em xmlns:na=&quot;Namespace1&quot;&gt;Info&lt;/na:em&gt;
#|kawa:5|# <kbd>(define xb (nb:em &quot;Info&quot;))</kbd>
#|kawa:6|# <kbd>xa</kbd>
&lt;nb:em xmlns:nb=&quot;Namespace1&quot;&gt;Info&lt;/nb:em&gt;
</pre></div>

<p>Note that the prefix is part of the qualified name
(it is actually part of the namespace object),
and it is used when printing the tag.
Two qualified names (symbols) that have the same
local-name and the same namespace-name are considered
equal, even if they have different prefix.  You can think of
the prefix as annotation used when printing, but not
otherwise part of the &ldquo;meaning&rdquo; of a compound symbol.
They are the same object if they also have the same prefix.
This is an important difference from traditional Lisp/Scheme symbols,
but it is how XML QNames work.
</p><div class="example">
<pre class="example">#|kawa:7|# (instance? xb na:em)
true
#|kawa:8|# (eq? 'na:em 'nb:em)
false
#|kawa:9|# (equal? 'na:em 'nb:em)
true
#|kawa:10|# (eqv? 'na:em 'nb:em)
true
</pre></div>
<p>(Note that <code>#t</code> is printed as <code>true</code> when using XML formatting.)
</p>
<p>The predefined <code>html</code> prefix could be defined thus:
</p><div class="example">
<pre class="example">(define-xml-namespace html &quot;http://www.w3.org/1999/xhtml&quot;)
</pre></div>

<hr>
</div>
</div>
<div class="section" id="Keywords">
<div class="header">
<p>
Next: <a href="#Special-named-constants" accesskey="n" rel="next">Special named constants</a>, Previous: <a href="#Namespaces" accesskey="p" rel="prev">Namespaces and compound symbols</a>, Up: <a href="#Symbols-and-namespaces" accesskey="u" rel="up">Symbols and namespaces</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Keywords-1"></span><h3 class="section">10.3 Keywords</h3>

<p>Keywords are similar to symbols.
They are used mainly for specifying keyword arguments.
</p>
<p>Historically keywords have been self-evaluating (you did not need to
quote them).  This has changed: you must quote a keyword if you
want a literal keyword value, and not quote it if it is used
as a keyword argument.
</p>
<div class="display">
<pre class="display"><span id="index-keyword"></span><span id="meta_002dkeyword"></span><var>keyword</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a><code><b>:</b></code>
  | <code><b>#:</b></code><a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>

<p>The two syntaxes have the same meaning: The former is nicer-looking;
the latter is more portable (and required if you use the
<code>--r7rs</code> command-line flag).
</p>
<blockquote>
<p><em>Details:</em>
In r7rs and other Scheme standards the colon character
does not have any special meaning, so <code>foo:</code> or <code>foo:bar</code>
are just regular identifiers.  Therefore some other Scheme variants
that have keywords (including Guile and Racket) use the <code>#:</code> syntax.
Kawa has some hacks so that <em>most</em>
standard Scheme programs that have colons in identifiers will work.
However, for best compatibility, use the <code>--r7rs</code> command-line flag
(which turns colon into a regular character in a symbol), and the
<code>#:</code> syntax.
</p></blockquote>

<p>A keyword is a single token; therefore no whitespace is allowed between
the <var>identifier</var> and the colon or after the <code>#:</code>;
these characters are not considered part of the name of the keyword.
</p>
<dl class="def">
<dt id="index-keyword_003f"><span class="category">Procedure: </span><span><strong>keyword?</strong> <em>obj</em><a href='#index-keyword_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a keyword, and otherwise returns <code>#f</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-keyword_002d_003estring"><span class="category">Procedure: </span><span><strong>keyword-&gt;string</strong> <em>keyword</em><a href='#index-keyword_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the name of <var>keyword</var> as a string.
The name does not include the final <code>#\:</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002d_003ekeyword"><span class="category">Procedure: </span><span><strong>string-&gt;keyword</strong> <em>string</em><a href='#index-string_002d_003ekeyword' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the keyword whose name is <var>string</var>.
(The <var>string</var> does not include a final <code>#\:</code>.)
</p></dd></dl>

<hr>
</div>
<div class="section" id="Special-named-constants">
<div class="header">
<p>
Previous: <a href="#Keywords" accesskey="p" rel="prev">Keywords</a>, Up: <a href="#Symbols-and-namespaces" accesskey="u" rel="up">Symbols and namespaces</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Special-named-constants-1"></span><h3 class="section">10.4 Special named constants</h3>

<dl class="def">
<dt id="index-_0023_0021optional"><span class="category">Constant: </span><span><strong>#!optional</strong><a href='#index-_0023_0021optional' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Special self-evaluating literal used in lambda parameter lists
before optional parameters.
</p></dd></dl>

<dl class="def">
<dt id="index-_0023_0021rest"><span class="category">Constant: </span><span><strong>#!rest</strong><a href='#index-_0023_0021rest' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Special self-evaluating literal used in lambda parameter lists
before the rest parameter.
</p></dd></dl>

<dl class="def">
<dt id="index-_0023_0021key"><span class="category">Constant: </span><span><strong>#!key</strong><a href='#index-_0023_0021key' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Special self-evaluating literal used in lambda parameter lists
before keyword parameters.
</p></dd></dl>

<dl class="def">
<dt id="index-_0023_0021eof"><span class="category">Constant: </span><span><strong>#!eof</strong><a href='#index-_0023_0021eof' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The end-of-file object.
</p>
<p>Note that if the Scheme reader sees this literal at top-level,
it is returned literally.  This is indistinguishable from
coming to the end of the input file.  If you do not want to end reading,
but want the actual value of <code>#!eof</code>, you should quote it.
</p></dd></dl>

<dl class="def">
<dt id="index-_0023_0021void"><span class="category">Constant: </span><span><strong>#!void</strong><a href='#index-_0023_0021void' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The void value.  Same as <code>(values)</code>.
If this is the value of an expression in a read-eval-print loop,
nothing is printed.
</p></dd></dl>

<dl class="def">
<dt id="index-_0023_0021null"><span class="category">Constant: </span><span><strong>#!null</strong><a href='#index-_0023_0021null' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The Java <code>null</code> value.  This is not really a Scheme value,
but is useful when interfacing to low-level Java code.
</p></dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Procedures">
<div class="header">
<p>
Next: <a href="#Numbers" accesskey="n" rel="next">Quantities and Numbers</a>, Previous: <a href="#Symbols-and-namespaces" accesskey="p" rel="prev">Symbols and namespaces</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Procedures-1"></span><h2 class="chapter">11 Procedures</h2>


<ul class="section-toc">
<li><a href="#Application-and-Arguments-Lists" accesskey="1">Application and Arguments Lists</a></li>
<li><a href="#Procedure-properties" accesskey="2">Procedure properties</a></li>
<li><a href="#Generic-procedures" accesskey="3">Generic (dynamically overloaded) procedures</a></li>
<li><a href="#Extended-formals" accesskey="4">Extended Formal Arguments List</a></li>
<li><a href="#Partial-application" accesskey="5">Partial application</a></li>
</ul>
<hr>
<div class="section" id="Application-and-Arguments-Lists">
<div class="header">
<p>
Next: <a href="#Procedure-properties" accesskey="n" rel="next">Procedure properties</a>, Up: <a href="#Procedures" accesskey="u" rel="up">Procedures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Application-and-Arguments-Lists-1"></span><h3 class="section">11.1 Application and Arguments Lists</h3>

<p>When a procedure is called, the actual argument expression are evaluated,
and the resulting values becomes the actual argument list.
This is then matched against the formal parameter list
(in the procedure definition), and assuming they match,
the procedure body is called.
</p>
<ul class="section-toc">
<li><a href="#Arguments-lists" accesskey="1">Arguments lists</a></li>
<li><a href="#Explicit-argument-list-objects" accesskey="2">Explicit argument list objects</a></li>
<li><a href="#Argument-list-library" accesskey="3">Argument list library</a></li>
<li><a href="#Apply-procedures" accesskey="4">Apply procedures</a></li>
</ul>
<div class="subsection" id="Arguments-lists">
<h4 class="subsection">11.1.1 Arguments lists</h4>

<p>An argument list has three parts:
</p><ul>
<li> Zero or more <em>prefix arguments</em>, each of which is a value.
These typically get bound to named required or optional formal parameters,
but can also get bound to patterns.
</li><li> Zero or more <em>keyword arguments</em>, each of which is a keyword
(an identifier specified with keyword syntax) combined with a value.
These are bound to either named keyword formal parameters, or
bundled in with a rest parameter.
</li><li> Zero or more <em>postfix arguments</em>, each of which is a value.
These are usually bound to a &ldquo;rest&rdquo; formal parameter, which
receives any remaining arguments.

<p>If there are no keyword arguments, then it ambiguous where
prefix arguments and and where postfix arguments start.
This is normally not a problem: the called procedure can
split them up however it wishes.
</p></li></ul>

<p>Note that all keyword arguments have to be grouped together:
It is not allowed to have a keyword argument followed by a plain
argument followed by a keyword argument.
</p>
<p>The argument list is constructed by evaluating the each <a href="#meta_002doperand"><var>operand</var></a>
of the <a href="#meta_002dprocedure_002dcall"><var>procedure-call</var></a> in order:
</p><dl compact="compact">
<dt><span><var>expression</var></span></dt>
<dd><p>The <var>expression</var> is evaluated, yielding a single value
that becomes a prefix or postfix argument.
</p></dd>
<dt><span><var>keyword</var> <var>expression</var></span></dt>
<dd><p>The <var>expression</var> is evaluated.  The resulting value combined
with the <var>keyword</var> becomes a keyword argument.
</p></dd>
<dt><span><code><b>@</b></code><var>expression</var></span></dt>
<dd><p>The <var>expression</var> is evaluated.
The result must be a sequence - a list, vector, or primitive array.
The values of the sequence are appended to the resulting argument list.
Keyword arguments are not allowed.
</p></dd>
<dt><span><code><b>@:</b></code><var>expression</var></span></dt>
<dd><p>The <var>expression</var> is evaluted.
The result can be a sequence;
a hash table (viewed as a collection of (keyword,value) pairs);
or an <em>explicit argument list</em> object, which is a sequence of values
<em>or</em> keyword arguments.
The values and keyword arguments
are appended to the resulting argument list, though subject to the restriction
that keyword arguments must be adjacent in the resulting argument list.
</p></dd>
</dl>

</div>
<div class="subsection" id="Explicit-argument-list-objects">
<h4 class="subsection">11.1.2 Explicit argument list objects</h4>

<p>Sometimes it is useful to create an argument list out of
pieces, take argument lists apart, iterate over them,
and generally treat an argument list as an actual first-class value.
</p>
<p>Explicit argument list objects can take multiple forms.
The simplest is a sequence: a list, vector, or primitive array.
Each element of the list becomes a value in the resulting argument list.
</p>
<div class="example">
<pre class="example">(define v1 '(a b c))
(define v2 (int[] 10 11 12 13))
(list &quot;X&quot; @v1 &quot;Y&quot; @v2 &quot;Z&quot;)
  &rArr; (&quot;X&quot; a b c &quot;Y&quot; 10 11 12 13 &quot;Z&quot;)
</pre></div>

<p>Things get more complicated once keywords are involved.
An explicit argument list with keywords is only allowed
when using the <code>@:</code> splicing form,
not the <code>@</code> form.  It can be either
a hash table (anything the implement <code>java.util.Map</code>
or the types <code>arglist</code> or <code>argvector</code>.
</p>
<blockquote>
<p><em>Design note:</em> An argument list with keywords is straightforward
in Common Lisp and some Scheme implementations (including order versions of
Kawa): It&rsquo;s just a list some of whose <code>car</code> cells are keyword objects.
The problem with this model is neither a human or the compiler can
reliably tell when an argument is a keyword, since any variable
might have been assigned a keyword.  This limits performance and
error checking.
</p></blockquote>

<p>A hash table (anything the implement <code>java.util.Map</code>)
whose keys are strings or keyword objects is
interpreted as a sequence of keyword arguments,
using the hash-table keys and values.
</p>
<dl class="def">
<dt id="index-argvector"><span class="category">Type: </span><span><strong>argvector</strong><a href='#index-argvector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-argvector-1"><span class="category">Constructor: </span><span><strong>argvector</strong> <em><a href="#meta_002doperand"><var>operand</var></a><sup>*</sup></em><a href='#index-argvector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>List of arguments represented as an immutable vector.
A keyword argument takes two elements in this vector:
A keyword object, followed by the value.
</p>
<div class="example">
<pre class="example">(define v1 (argvector 1 2 k1: 10 k2: 11 98 99))
(v1 4) &rArr; 'k2
(v1 5) &rArr; 11
</pre></div>
<p>When <code>v1</code> is viewed as a vector it
is equivalent to <code>(vector 1 2 'k1: 10 'k2: 11 98 99)</code>.
(Note in this case the keywords need to be quoted, since
the <code>vector</code> constructor does not take keyword arguments.)
However, the <code>argvector</code> &ldquo;knows&rdquo; which arguments
are actually keyword arguments, and can be examined using the
<code>(kawa arglist)</code> library discussed below:
</p>
<div class="example">
<pre class="example">(arglist-key-count (argvector 1 x: 2 3)) &rArr; 1
(arglist-key-count (argvector 1 'x: 2 3)) &rArr; 0
(arglist-key-count (vector 1 'x: 2 3)) &rArr; 0
</pre></div>

<p>In this case:
</p><div class="example">
<pre class="example">(fun 'a @:v1)
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(fun 'a 1 2 k1: 10 k2: 11 98 99)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-arglist"><span class="category">Type: </span><span><strong>arglist</strong><a href='#index-arglist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-arglist-1"><span class="category">Constructor: </span><span><strong>arglist</strong> <em><a href="#meta_002doperand"><var>operand</var></a><sup>*</sup></em><a href='#index-arglist-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Similar to <code>argvector</code>, but compatible with <code>list</code>.
If there are no keyword arguments, returns a plain list.
If there is at least one keyword argument creates a special
<code>gnu.mapping.ArgListPair</code> object that implements the
usual <code>list</code> properties but internally wraps a <code>argvector</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Argument-list-library">
<h4 class="subsection">11.1.3 Argument list library</h4>

<div class="example">
<pre class="example">(import (kawa arglist))
</pre></div>

<p>In the following, <var>args</var> is an <code>arglist</code> or <code>argvector</code>
(or in general any object that implement <code>gnu.mapping.ArgList</code>).
Also, <var>args</var> can be a generalized list, in which case it
behaves like an <code>argvector</code> that has no keyword arguments.
</p>
<dl class="def">
<dt id="index-arglist_002dwalk"><span class="category">Procedure: </span><span><strong>arglist-walk</strong> <em>args proc</em><a href='#index-arglist_002dwalk' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Call <var>proc</var> once, in order, for each argument in <var>args</var>.
The <var>proc</var> is called with two arguments,
corresponding to <code>(arglist-key-ref <var>args</var> <var>i</var>)</code>
and <code>(arglist-arg-ref <var>args</var> <var>i</var>)</code> for each <var>i</var> from 0
up to <code>(arglist-arg-count <var>args</var>)</code> (exclusive).
I.e. the first argument is either <code>#!null</code> or the keyword (as a string);
the second argument is the corresponding argument value.
</p>
<div class="example">
<pre class="example">(define (print-arguments args #!optional (out (current-output-port)))
  (arglist-walk args
                (lambda (key value)
                  (if key (format out &quot;key: ~a value: ~w~%&quot; key value)
                      (format out &quot;value: ~w~%&quot; value)))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-arglist_002dkey_002dcount"><span class="category">Procedure: </span><span><strong>arglist-key-count</strong> <em>args</em><a href='#index-arglist_002dkey_002dcount' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the number of keyword arguments.
</p></dd></dl>

<dl class="def">
<dt id="index-arglist_002dkey_002dstart"><span class="category">Procedure: </span><span><strong>arglist-key-start</strong> <em>args</em><a href='#index-arglist_002dkey_002dstart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Number of prefix arguments, which is the number of arguments before
the first keyword argument.
</p></dd></dl>

<dl class="def">
<dt id="index-arglist_002darg_002dcount"><span class="category">Procedure: </span><span><strong>arglist-arg-count</strong> <em>args</em><a href='#index-arglist_002darg_002dcount' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the number of non-keyword arguments.
(The count includes neither the keywords nor the corresponding values.)
</p></dd></dl>

<dl class="def">
<dt id="index-arglist_002darg_002dref"><span class="category">Procedure: </span><span><strong>arglist-arg-ref</strong> <em>args index</em><a href='#index-arglist_002darg_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the <var>index</var>&rsquo;th argument value.
The <var>index</var> counts keyword argument values, but not the keywords themselves.
</p><div class="example">
<pre class="example">(arglist-arg-ref (arglist 10 11 k1: -1 19) 2) &rArr; -1
(arglist-arg-ref (arglist 10 11 k1: -1 19) 3) &rArr; 19
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-arglist_002dkey_002dref"><span class="category">Procedure: </span><span><strong>arglist-key-ref</strong> <em>args index</em><a href='#index-arglist_002dkey_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>index</var> counts arguments like <code>arglist-arg-ref</code> does.
If this is a keyword argument, return the corresponding keyword
(as a string); otherwise, return <code>#!null</code> (which counts are false).
</p><div class="example">
<pre class="example">(arglist-key-ref (argvector 10 11 k1: -1 k2: -2 19) 3) &rArr; &quot;k2&quot;
(arglist-key-ref (argvector 10 11 k1: -1 k2: -2 19) 4) &rArr; #!null
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-arglist_002dkey_002dindex"><span class="category">Procedure: </span><span><strong>arglist-key-index</strong> <em>args key</em><a href='#index-arglist_002dkey_002dindex' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Search for a keyword matching <var>key</var> (which must be an interned string).
If there is no such keyword, return -1.
Otherwise return the keyword&rsquo;s index as as argument to <code>arglist-key-ref</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-arglist_002dkey_002dvalue"><span class="category">Procedure: </span><span><strong>arglist-key-value</strong> <em>args key default</em><a href='#index-arglist_002dkey_002dvalue' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Search for a keyword matching <var>key</var> (which must be an interned string).
If there is no such keyword, return the <var>default</var>.
Otherwise return the corresponding keyword argument&rsquo;s value.
</p></dd></dl>

</div>
<div class="subsection" id="Apply-procedures">
<h4 class="subsection">11.1.4 Apply procedures</h4>

<dl class="def">
<dt id="index-apply"><span class="category">Procedure: </span><span><strong>apply</strong> <em>proc argi<sup>*</sup> argrest</em><a href='#index-apply' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>Argrest</var> must be a sequence (list, vector, or string) or a
primitive Java array.
(This is an extension over standard Scheme, which requires that
<var>args</var> be a list.)
Calls the <var>proc</var> (which must be a procedure), using as arguments
the <var>argi</var>... values plus all the elements of <var>argrest</var>.
</p>
<p>Equivalent to: <code>(</code><var>proc</var> <var>argi</var><sup>*</sup> <code>@</code><var>argrest</var><code>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-constant_002dfold"><span class="category">Syntax: </span><span><strong>constant-fold</strong> <em>proc arg1 ...</em><a href='#index-constant_002dfold' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Same as <code>(<var>proc</var> <var>arg1</var> ...)</code>, unless <var>proc</var> and
all the following arguments are compile-time constants.
(That is:  They are either constant, or symbols that have a global
binding and no lexical binding.)  In that case, <var>proc</var>
is applied to the arguments at compile-time, and the result replaces
the <code>constant-fold</code> form.  If the application raises an exception,
a compile-time error is reported.
For example:
</p><div class="example">
<pre class="example">(constant-fold vector 'a 'b 'c)
</pre></div>
<p>is equivalent to <code>(quote #(a b c))</code>, assuming <code>vector</code>
has not been re-bound.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Procedure-properties">
<div class="header">
<p>
Next: <a href="#Generic-procedures" accesskey="n" rel="next">Generic (dynamically overloaded) procedures</a>, Up: <a href="#Procedures" accesskey="u" rel="up">Procedures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Procedure-properties-1"></span><h3 class="section">11.2 Procedure properties</h3>

<p>You can associate arbitrary <em>properties</em> with any procedure.
Each property is a (<var>key</var>, <var>value</var>)-pair.  Usually the
<var>key</var> is a symbol, but it can be any object.
</p>
<p>The system uses certain internal properties:
<code>'name</code> refers to the name used when a procedure is printed;
<code>'emacs-interactive</code> is used to implement Emacs <code>interactive</code>
specification;
<code>'setter</code> is used to associate a <code>setter</code> procedure.
</p>
<dl class="def">
<dt id="index-procedure_002dproperty"><span class="category">Procedure: </span><span><strong>procedure-property</strong> <em>proc key [default]</em><a href='#index-procedure_002dproperty' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the property value corresponding to the given <var>key</var>.
If <var>proc</var> has no property with the given <var>key</var>,
return <var>default</var> (which defaults to <code>#f</code>) instead.
</p></dd></dl>

<dl class="def">
<dt id="index-set_002dprocedure_002dproperty_0021"><span class="category">Procedure: </span><span><strong>set-procedure-property!</strong> <em>proc key value</em><a href='#index-set_002dprocedure_002dproperty_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Associate the given <var>value</var> with the <var>key</var> property of <var>proc</var>.
</p></dd></dl>

<p>To change the print name of the standard <code>+</code> procedure (probably
not a good idea!), you could do:
</p><div class="example">
<pre class="example">(set-procedure-property! + 'name 'PLUS)
</pre></div>
<p>Note this <em>only</em> changes the name property used for printing:
</p><div class="example">
<pre class="example">+ &rArr; #&lt;procedure PLUS&gt;
(+ 2 3) &rArr; 5
(PLUS 3 4) &rArr; ERROR
</pre></div>

<p>As a matter of style, it is cleaner to use the <code>define-procedure</code>
form, as it is a more declarative interface.
</p>
<dl class="def">
<dt id="index-define_002dprocedure"><span class="category">Syntax: </span><span><strong>define-procedure</strong> <em>name [propname: propvalue] ... method ...</em><a href='#index-define_002dprocedure' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Defines <var>name</var> as a compound procedure consisting of the
specified <var>method</var>s, with the associated properties.
Applying <var>name</var> select the &quot;best&quot; <var>method</var>, and applies that.
See the following section on generic procedures.
</p>
<p>For example, the standard <code>vector-ref</code> procedure specifies
one method, as well as the <code>setter</code> property:
</p><div class="example">
<pre class="example">(define-procedure vector-ref
  setter: vector-set!
  (lambda (vector::vector k ::int)
    (invoke vector 'get k)))
</pre></div>
</dd></dl>

<p>You can also specify properties in the lambda body:
</p>
<div class="example">
<pre class="example">(define (vector-ref vector::vector k ::int)
    setter: vector-set!
    (invoke vector 'get k))
</pre></div>

<ul class="section-toc">
<li><a href="#Standard-properties" accesskey="1">Standard properties</a></li>
</ul>
<div class="subsection" id="Standard-properties">
<h4 class="subsection">11.2.1 Standard properties</h4>

<dl compact="compact">
<dt><span><code>name</code></span></dt>
<dd><p>The name of a procedure (as a symbol), which is used
when the procedure is printed.
</p></dd>
<dt><span><code>setter</code></span></dt>
<dd><p>Set the setter procedure associated with the procedure.
</p></dd>
<dt><span><code>validate-apply</code></span></dt>
<dt><span><code>validate-xapply</code></span></dt>
<dd><p>Used during the validation phase of the compiler.
</p></dd>
<dt><span><code>compile-apply</code></span></dt>
<dd><p>Used during the bytecode-generation phase of the compiler:
If we see a call to a known function with this property,
we can emit custom bytecode for the call.
</p></dd>
</dl>

<hr>
</div>
</div>
<div class="section" id="Generic-procedures">
<div class="header">
<p>
Next: <a href="#Extended-formals" accesskey="n" rel="next">Extended Formal Arguments List</a>, Previous: <a href="#Procedure-properties" accesskey="p" rel="prev">Procedure properties</a>, Up: <a href="#Procedures" accesskey="u" rel="up">Procedures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Generic-_0028dynamically-overloaded_0029-procedures"></span><h3 class="section">11.3 Generic (dynamically overloaded) procedures</h3>

<p>A <em>generic procedure</em> is a collection of <em>method procedures</em>.
(A &quot;method procedure&quot; is not the same as a Java method, but
the terms are related.)
You can call a generic procedure, which selects the &quot;closest
match&quot; among the component method procedures:  I.e. the most specific
method procedure that is applicable given the actual arguments.
</p>
<blockquote>
<p><strong>Warning:</strong> The current implementation of selecting the &quot;best&quot; method
is not reliable if there is more than one method.
It can select depending on argument count, and it can select between
primitive Java methods.  However, selecting between different Scheme
procedures based on parameter types should be considered experimental.
The main problem is we can&rsquo;t determine the most specific
method, so Kawa just tries the methods in order.
</p></blockquote>

<dl class="def">
<dt id="index-make_002dprocedure"><span class="category">Procedure: </span><span><strong>make-procedure</strong> <em>[keyword: value]... method...</em><a href='#index-make_002dprocedure' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a generic procedure given the specific methods.
You can also specify property values for the result.
</p>
<p>The <var>keyword</var>s specify how the arguments are used.
A <code>method:</code> keyword is optional and specifies that the following
argument is a method.
A <code>name:</code> keyword specifies the name of the resulting procedure,
when used for printing.
Unrecognized keywords are used to set the procedure properties of the result.
</p><div class="example">
<pre class="example">(define plus10 (make-procedure foo: 33 name: 'Plus10
                            method: (lambda (x y) (+ x y 10))
                            method: (lambda () 10)))
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Extended-formals">
<div class="header">
<p>
Next: <a href="#Partial-application" accesskey="n" rel="next">Partial application</a>, Previous: <a href="#Generic-procedures" accesskey="p" rel="prev">Generic (dynamically overloaded) procedures</a>, Up: <a href="#Procedures" accesskey="u" rel="up">Procedures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Extended-Formal-Arguments-List"></span><h3 class="section">11.4 Extended Formal Arguments List</h3>

<p>The formal arguments list of a lambda expression has some
extensions over standard Scheme:
Kawa borrows the extended formal argument list of DSSSL,
and Kawa allows you to declare the type of the parameter.
More generally, you can use <a href="#Variables-and-Patterns">patterns</a>.
</p>
<div class="display">
<pre class="display"><span id="index-lambda_002dexpression"></span><span id="meta_002dlambda_002dexpression"></span><var>lambda-expression</var> <tt>::=</tt> <code><b>(lambda</b></code> <a href="#meta_002dformals"><var>formals</var></a> <a href="#meta_002doption_002dpair"><var>option-pair</var></a><sup>*</sup> <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> <a href="#meta_002dbody"><var>body</var></a><code><b>)</b></code>
<span id="index-return_002dtype"></span><span id="meta_002dreturn_002dtype"></span><var>return-type</var> <tt>::=</tt> <a href="#meta_002dtype"><var>type</var></a>
<span id="index-opt_002dreturn_002dtype"></span><span id="meta_002dopt_002dreturn_002dtype"></span><var>opt-return-type</var> <tt>::=</tt> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>]
</pre></div>
<p>where
</p><div class="display">
<pre class="display"><span id="index-formals"></span><span id="meta_002dformals"></span><var>formals</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002dformal_002darguments"><var>formal-arguments</var></a><code><b>)</b></code> | <a href="#meta_002drest_002darg"><var>rest-arg</var></a>
</pre></div>
<p>You can of course also use the extended format in a <a href="#Definitions"><code>define</code></a>:
</p><div class="example">
<pre class="example"><b>(define (</b><var>name</var> <var>formal-arguments</var><b>)</b> [<var>rtype</var>] <var>body</var><b>)</b>
</pre></div>
<div class="display">
<pre class="display"><span id="index-formal_002darguments"></span><span id="meta_002dformal_002darguments"></span><var>formal-arguments</var> <tt>::=</tt>
    <a href="#meta_002drequired_002dor_002dguard"><var>required-or-guard</var></a><sup>*</sup> [<code><b>#!optional</b></code> <a href="#meta_002doptional_002darg"><var>optional-arg</var></a> ...] (<a href="#meta_002drest_002dkey_002dargs"><var>rest-key-args</var></a> | <code><b>.</b></code> <a href="#meta_002drest_002darg"><var>rest-arg</var></a>)
</pre></div>
<div class="display">
<pre class="display"><span id="index-required_002dor_002dguard"></span><span id="meta_002drequired_002dor_002dguard"></span><var>required-or-guard</var> <tt>::=</tt> <a href="#meta_002drequired_002darg"><var>required-arg</var></a> |<a href="#meta_002dguard"><var>guard</var></a>
<span id="index-rest_002dkey_002dargs"></span><span id="meta_002drest_002dkey_002dargs"></span><var>rest-key-args</var> <tt>::=</tt> [<code><b>#!rest</b></code> <a href="#meta_002drest_002darg"><var>rest-arg</var></a>] [<code><b>#!key</b></code> <a href="#meta_002dkey_002darg"><var>key-arg</var></a> ...]
  | [<code><b>#!key</b></code> <a href="#meta_002dkey_002darg"><var>key-arg</var></a> ...] [<code><b>#!rest</b></code> <a href="#meta_002drest_002darg"><var>rest-arg</var></a>]
<span id="index-required_002darg"></span><span id="meta_002drequired_002darg"></span><var>required-arg</var> <tt>::=</tt> <a href="#meta_002dpattern"><var>pattern</var></a> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>]
  | <code><b>(</b></code> <a href="#meta_002dpattern"><var>pattern</var></a> <code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a><code><b>)</b></code>
<span id="index-optional_002darg"></span><span id="meta_002doptional_002darg"></span><var>optional-arg</var> <tt>::=</tt> <var>variable</var> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>]
  | <code><b>(</b></code> <a href="#meta_002dpattern"><var>pattern</var></a> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] [<var>initializer</var> [<a href="#meta_002dsupplied_002dvar"><var>supplied-var</var></a>]]<code><b>)</b></code>
<span id="index-supplied_002dvar"></span><span id="meta_002dsupplied_002dvar"></span><var>supplied-var</var> <tt>::=</tt> <var>variable</var>
<span id="index-key_002darg"></span><span id="meta_002dkey_002darg"></span><var>key-arg</var> <tt>::=</tt> <var>variable</var> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>]
    | <code><b>(</b></code> <var>variable</var> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>] [<var>initializer</var> [<a href="#meta_002dsupplied_002dvar"><var>supplied-var</var></a>]] <code><b>)</b></code>
<span id="index-rest_002darg"></span><span id="meta_002drest_002darg"></span><var>rest-arg</var> <tt>::=</tt> <var>variable</var>
</pre></div>

<p>When the procedure is applied to a list of actual arguments, the formal and
actual arguments are processed from left to right as follows:
</p>
<ul>
<li> The <var>required-arg</var>s are matched against actual (pre-keyword) arguments
in order, starting with the first actual argument.
A <var>guard</var> is evaluated when it appears:
If it evaluates to false, then matching fails.
It shall be an error if there are fewer pre-keyword
arguments then there are <var>req-arg</var>s.
</li><li> Next the <var>optional-arg</var>s are bound to remaining pre-keyword arguments.
If there are fewer remaining pre-keyword arguments than there are
<var>optional-arg</var>s, then the remaining <var>variable</var>s are bound
to the corresponding <var>initializer</var>.
If no <var>initializer</var> was specified, it defaults to <code>#f</code>.
(TODO: If a <var>type</var> is specified the default for <var>initializer</var>
is the default value of the <var>type</var>.)
The <var>initializer</var> is evaluated in an
environment in which all the previous formal parameters have been bound.
If a <var>supplied-var</var> is specified, it has type boolean,
and is set to true if there was an actual corresponding argument,
and false if the initializer was evaluated.
</li><li> If there is a <var>rest-arg</var>, it is bound to a list of all the
remaining actual arguments.  These remaining actual arguments are also
eligible to be bound to keyword arguments.   If there is no
<var>rest-arg</var> and there are no <var>key-arg</var>s, then it shall
be an error if there are any remaining actual arguments.
</li><li> If <code>#!key</code> was specified, then there shall be an even number of
remaining actual arguments.  These are interpreted as a series of pairs,
where the first member of each pair is a keyword specifying the argument name,
and the second is the corresponding value.  It shall be an error if the first
member of a pair is not a keyword.  It shall be an error if the argument name
is not the same as a variable in a <var>key-arg</var>s, unless there
is a <var>rest-arg</var>.  If the same argument name occurs more than once
in the list of actual arguments, then the first value is used.
If there is no actual argument for a particular <var>key-arg</var>,
then the variable is bound
to the corresponding <var>initializer</var>, if one was specified, and
otherwise to <code>#f</code>.  The <var>initializer</var> is evaluated in an
environment in which all the previous formal parameters have been bound.
</li></ul>

<p>If a <var>type</var> is specified, the corresponding actual argument (or
the <var>initializer</var> default value) is coerced to the specified <var>type</var>.
In the function body, the parameter has the specified type.
</p>
<p>If <var>rtype</var> (the first form of the function body) is an unbound
identifier of the form <code>&lt;TYPE&gt;</code> (that is the first character
is &lsquo;<samp>&lt;</samp>&rsquo; and the last is &lsquo;<samp>&gt;</samp>&rsquo;), then that specifies the
function&rsquo;s return type.  It is syntactic sugar for
<code>(as &lt;TYPE&gt; (begin BODY))</code>.
</p>
<p>You can set the <a href="#Procedure-properties">properties</a>
of the resulting procedure using an <var>option-pair</var>.  For example,
to set the <code>setter</code> property of a procedure
to <code>my-set-car</code> do the following:
</p><div class="example">
<pre class="example">(define my-car
  (lambda (arg) setter: my-set-car (primitive-car arg)))
</pre></div>

<hr>
</div>
<div class="section" id="Partial-application">
<div class="header">
<p>
Previous: <a href="#Extended-formals" accesskey="p" rel="prev">Extended Formal Arguments List</a>, Up: <a href="#Procedures" accesskey="u" rel="up">Procedures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Partial-application-1"></span><h3 class="section">11.5 Partial application</h3>

<dl class="def">
<dt id="index-cut"><span class="category">Syntax: </span><span><strong>cut</strong> <em>slot-or-expr slot-or-expr* [<code>&lt;...&gt;</code>]</em><a href='#index-cut' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>where each <var>slot-or-expr</var> is either an <var>expression</var> or
the literal symbol <code>&lt;&gt;</code>.
</p>
<p>It is frequently necessary to specialize some of the parameters of a
multi-parameter procedure. For example, from the binary operation <code>cons</code>
one might want to obtain the unary operation
<code>(lambda (x) (cons 1 x))</code>.
This specialization of parameters is also known
as <em>partial application</em>, <em>operator section</em>, or <em>projection</em>.
The macro <code>cut</code> specializes some of the parameters of its first
argument. The parameters that are to show up as formal variables of the
result are indicated by the symbol <code>&lt;&gt;</code>, pronouced as &quot;slot&quot;.
In addition, the symbol <code>&lt;...&gt;</code>, pronounced as &quot;rest-slot&quot;, matches all
residual arguments of a variable argument procedure.
</p>
<p>A <code>cut</code>-expression is transformed into
a <var>lambda expression</var> with as many formal variables as there are
slots in the list <var>slot-or-expr</var>*.
The body of the resulting <var>lambda expression</var> calls
the first <var>slot-or-expr</var> with arguments from the <var>slot-or-expr</var>* list
in the order they appear. In case there is a rest-slot symbol, the resulting
procedure is also of variable arity, and the body calls the first
<var>slot-or-expr</var> with remaining arguments provided to the actual call of the
specialized procedure.
</p>
<p>Here are some examples:
</p>
<p><code>(cut cons (+ a 1) &lt;&gt;)</code> is the same as <code>(lambda&nbsp;(x2)&nbsp;(cons&nbsp;(+&nbsp;a&nbsp;1)&nbsp;x2))</code><!-- /@w -->
</p>
<p><code>(cut list 1 &lt;&gt; 3 &lt;&gt; 5)</code> is the same as <code>(lambda&nbsp;(x2&nbsp;x4)&nbsp;(list&nbsp;1&nbsp;x2&nbsp;3&nbsp;x4&nbsp;5))</code><!-- /@w -->
</p>
<p><code>(cut list)</code> is the same as <code>(lambda&nbsp;()&nbsp;(list))</code><!-- /@w -->
</p>
<p><code>(cut list 1 &lt;&gt; 3 &lt;...&gt;)</code> is the same as <code>(lambda&nbsp;(x2&nbsp;.&nbsp;xs)&nbsp;(apply&nbsp;list&nbsp;1&nbsp;x2&nbsp;3&nbsp;xs))</code><!-- /@w -->
</p>
<p>The first argument can also be a slot, as one should expect in Scheme:
<code>(cut &lt;&gt; a b)</code> is the same as <code>(lambda&nbsp;(f)&nbsp;(f&nbsp;a&nbsp;b))</code><!-- /@w -->
</p></dd></dl>

<dl class="def">
<dt id="index-cute"><span class="category">Syntax: </span><span><strong>cute</strong> <em>slot-or-expr slot-or-expr* [<code>&lt;...&gt;</code>]</em><a href='#index-cute' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The macro <code>cute</code> (a mnemonic for &quot;cut with evaluated non-slots&quot;) is
similar to <code>cut</code>, but it evaluates the non-slot expressions at the
time the procedure is specialized, not at the time the specialized
procedure is called.
</p>
<p>For example
<code>(cute cons (+ a 1) &lt;&gt;)</code> is the same as
<code>(let&nbsp;((a1&nbsp;(+&nbsp;a&nbsp;1)))&nbsp;(lambda&nbsp;(x2)&nbsp;(cons&nbsp;a1&nbsp;x2)))</code><!-- /@w -->
</p>
<p>As you see from comparing this example with the first example above, the
<code>cute</code>-variant will evaluate <code>(+ a 1)</code> once,
while the <code>cut</code>-variant will
evaluate it during every invocation of the resulting procedure.
</p>
</dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Numbers">
<div class="header">
<p>
Next: <a href="#Characters-and-text" accesskey="n" rel="next">Characters and text</a>, Previous: <a href="#Procedures" accesskey="p" rel="prev">Procedures</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Quantities-and-Numbers"></span><h2 class="chapter">12 Quantities and Numbers</h2>

<p>Kawa supports the full Scheme set of number operations with some extensions.
</p>
<p>Kawa converts between Scheme number types
and Java number types as appropriate.
</p>

<ul class="section-toc">
<li><a href="#Numerical-types" accesskey="1">Numerical types</a></li>
<li><a href="#Arithmetic-operations" accesskey="2">Arithmetic operations</a></li>
<li><a href="#Numerical-input-and-output" accesskey="3">Numerical input and output</a></li>
<li><a href="#Quaternions" accesskey="4">Quaternions</a></li>
<li><a href="#Quantities" accesskey="5">Quantities and Units</a></li>
<li><a href="#Logical-Number-Operations" accesskey="6">Logical Number Operations</a></li>
<li><a href="#Performance-of-numeric-operations" accesskey="7">Performance of numeric operations</a></li>
</ul>
<hr>
<div class="section" id="Numerical-types">
<div class="header">
<p>
Next: <a href="#Arithmetic-operations" accesskey="n" rel="next">Arithmetic operations</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Numerical-types-1"></span><h3 class="section">12.1 Numerical types</h3>

<p>Mathematically, numbers are arranged into a tower of subtypes
in which each level is a subset of the level before it:
number; complex number; real number; rational number; integer.
</p>
<p>For example, <code>3</code> is an integer. Therefore <code>3</code> is also a rational,
a real, and a complex number. The same is true of the
Scheme numbers that model 3. For Scheme numbers, these
types are defined by the predicates <code>number?</code>, <code>complex?</code>,
<code>real?</code>, <code>rational?</code>, and <code>integer?</code>.
</p>
<p>There is no simple relationship between a number’s type
and its representation inside a computer. Although most
implementations of Scheme will offer at least two different
representations of 3, these different representations denote
the same integer.
</p>
<p>Scheme’s numerical operations treat numbers as abstract
data, as independent of their representation as possible.
Although an implementation of Scheme may use multiple
internal representations of numbers, this ought not to be
apparent to a casual programmer writing simple programs.
</p>
<dl class="def">
<dt id="index-number-1"><span class="category">Type: </span><span><strong>number</strong><a href='#index-number-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme numbers.
</p></dd></dl>

<dl class="def">
<dt id="index-quantity"><span class="category">Type: </span><span><strong>quantity</strong><a href='#index-quantity' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of quantities optionally with units.
This is a sub-type of <code>number</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-complex"><span class="category">Type: </span><span><strong>complex</strong><a href='#index-complex' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of complex numbers.
This is a sub-type of <code>quantity</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-real"><span class="category">Type: </span><span><strong>real</strong><a href='#index-real' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of real numbers.
This is a sub-type of <code>complex</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-rational"><span class="category">Type: </span><span><strong>rational</strong><a href='#index-rational' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of exact rational numbers.
This is a sub-type of <code>real</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-integer"><span class="category">Type: </span><span><strong>integer</strong><a href='#index-integer' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of exact Scheme integers.
This is a sub-type of <code>rational</code>.
</p></dd></dl>

<p>Kawa allows working with expressions of &ldquo;primitive&rdquo; types,
which are supported by the JVM without object allocation,
and using builtin arithmetic.  Using these types may be much
faster, assuming the compiler is able to infer
that the variable or expression has primitive type.
</p>
<dl class="def">
<dt id="index-long"><span class="category">Type: </span><span><strong>long</strong><a href='#index-long' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-int"><span class="category">Type: </span><span><strong>int</strong><a href='#index-int' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-short"><span class="category">Type: </span><span><strong>short</strong><a href='#index-short' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-byte"><span class="category">Type: </span><span><strong>byte</strong><a href='#index-byte' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are fixed-sized primitive signed exact integer types,
of respectively 64, 32, 18, and 8 bits.
If a value of one of these types needs to be converted to an
object, the standard classes <code>java.lang.Long</code>, <code>java.lang.Integer</code>,
<code>java.lang.Short</code>, or <code>java.lang.Byte</code>, respectively, are used.
</p></dd></dl>

<dl class="def">
<dt id="index-ulong"><span class="category">Type: </span><span><strong>ulong</strong><a href='#index-ulong' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-uint"><span class="category">Type: </span><span><strong>uint</strong><a href='#index-uint' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-ushort"><span class="category">Type: </span><span><strong>ushort</strong><a href='#index-ushort' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-ubyte"><span class="category">Type: </span><span><strong>ubyte</strong><a href='#index-ubyte' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are fixed-sized primitive unsigned exact integer types,
of respectively 64, 32, 18, and 8 bits.
These are presented at runtime using the corresponding
signed types (<code>long</code>, <code>int</code>, <code>short</code>, or <code>byte</code>).
However, for arithmetic the Kawa compiler generates code to perform the
&ldquo;mathematically correct&rdquo; result, truncated to an unsigned result
rather than signed.
If a value of one of these types needs to be converted to an
object, the classes <code>gnu.math.ULong</code>, <code>gnu.math.UInt</code>,
<code>gnu.math.UShort</code>, or  <code>gnu.math.UByte</code> is used.
</p></dd></dl>

<dl class="def">
<dt id="index-double"><span class="category">Type: </span><span><strong>double</strong><a href='#index-double' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-float"><span class="category">Type: </span><span><strong>float</strong><a href='#index-float' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are fixed-size primitive inexact floating-point real types,
using the standard 64-bit or 32-bit IEEE representation.
If a value of one of these types needs to be converted to an
object, the standard classes <code>java.lang.Double</code>,
or <code>java.lang.Float</code> is used.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Exactness" accesskey="1">Exactness</a></li>
<li><a href="#Numerical-promotion-and-conversion" accesskey="2">Numerical promotion and conversion</a></li>
</ul>
<div class="subsection" id="Exactness">
<h4 class="subsection">12.1.1 Exactness</h4>
<span id="index-exactness"></span>
<p>It is useful to distinguish between numbers that are represented
exactly and those that might not be. For example,
indexes into data structures must be known exactly, as
must some polynomial coefficients in a symbolic algebra
system. On the other hand, the results of measurements
are inherently inexact, and irrational numbers may be approximated
by rational and therefore inexact approximations.
In order to catch uses of inexact numbers where exact numbers
are required, Scheme explicitly distinguishes
exact from inexact numbers. This distinction is orthogonal
to the dimension of type.
</p>
<span id="index-exact-complex-number"></span>
<span id="index-inexact-complex-number"></span>
<p>A Scheme number is <em>exact</em> if it was written as an exact
constant or was derived from exact numbers using only exact operations.
A number is <em>inexact</em> if it was written as
an inexact constant, if it was derived using inexact ingredients,
or if it was derived using inexact operations. Thus
inexactness is a contagious property of a number.
In particular, an <em>exact complex number</em> has an exact real part
and an exact imaginary part; all other complex numbers
are <em>inexact complex numbers</em>.
</p>
<p>If two implementations produce exact results for a computation
that did not involve inexact intermediate results, the
two ultimate results will be mathematically equal. This
is generally not true of computations involving inexact
numbers since approximate methods such as floating-point
arithmetic may be used, but it is the duty of the implementation
to make the result as close as practical to the
mathematically ideal result.
</p>
<p>Rational operations such as <code>+</code> should always produce exact
results when given exact arguments. If the operation
is unable to produce an exact result, then it may either
report the violation of an implementation restriction or it
may silently coerce its result to an inexact value.
</p>
<p>Except for <code>exact</code>, the operations described in this section
must generally return inexact results when given any inexact arguments.
An operation may, however, return an
exact result if it can prove that the value of the result is
unaffected by the inexactness of its arguments. For example,
multiplication of any number by an exact zero may
produce an exact zero result, even if the other argument is inexact.
</p>
<p>Specifically, the expression <code>(* 0 +inf.0)</code> may return <code>0</code>,
or <code>+nan.0</code>, or report that inexact numbers are not supported,
or report that non-rational real numbers are not supported,
or fail silently or noisily in other implementation-specific ways.
</p>
<p>The procedures listed below will always return exact integer
results provided all their arguments are exact integers
and the mathematically expected results are representable
as exact integers within the implementation:
<code>-</code>,
<code>*</code>,
<code>+</code>,
<code>abs</code>,
<code>ceiling</code>,
<code>denominator</code>,
<code>exact-integer-sqrt</code>,
<code>expt</code>,
<code>floor</code>,
<code>floor/</code>,
<code>floor-quotient</code>,
<code>floor-remainder</code>,
<code>gcd</code>,
<code>lcm</code>,
<code>max</code>,
<code>min</code>,
<code>modulo</code>,
<code>numerator</code>,
<code>quotient</code>,
<code>rationalize</code>,
<code>remainder</code>,
<code>square</code>,
<code>truncate</code>,
<code>truncate/</code>,
<code>truncate-quotient</code>,
<code>truncate-remainder</code>.
</p>
</div>
<div class="subsection" id="Numerical-promotion-and-conversion">
<h4 class="subsection">12.1.2 Numerical promotion and conversion</h4>

<p>When combining two values of different numeric types,
the values are converted to the first line in the following
that subsumes (follows) both types.  The computation is done using
values of that type, and so is the result.
For example adding a <code>long</code> and a <code>float</code> converts the former
to the latter, yielding a <code>float</code>.
</p>
<p>Note that <code>short</code>, <code>byte</code>, <code>ushort</code>, <code>ubyte</code>
are converted to <code>int</code> regardless, even in the case of
a single-operand operation, such as unary negation.
Another exception is trancendental functions (such as <code>cos</code>),
where integer operands are converted to <code>double</code>.
</p>
<ul>
<li> <code>int</code> subsumes <code>short</code>, <code>byte</code>, <code>ushort</code>, <code>ubyte</code>.
</li><li> <code>uint</code>
</li><li> <code>long</code>
</li><li> <code>ulong</code>
</li><li> <code>java.lang.BigInteger</code>
</li><li> <code>integer</code> (i.e. <code>gnu.math.IntNum</code>)
</li><li> <code>rational</code> (i.e. <code>gnu.math.RatNum</code>)
</li><li> <code>float</code>
</li><li> <code>double</code>
</li><li> <code>gnu.math.FloNum</code>
</li><li> <code>real</code> (i.e. <code>gnu.math.RealNum</code>)
</li><li> <code>number</code>
</li><li> <code>complex</code>
</li><li> <code>quantity</code>
</li></ul>

<p>When comparing a primitive signed integer value with a primitive unsigned
integer (for example <code>&lt;</code> applied to a <code>int</code> and a <code>ulong</code>)
the mathemically correct result is computed, as it converting both
operands to <code>integer</code>.
</p>
<hr>
</div>
</div>
<div class="section" id="Arithmetic-operations">
<div class="header">
<p>
Next: <a href="#Numerical-input-and-output" accesskey="n" rel="next">Numerical input and output</a>, Previous: <a href="#Numerical-types" accesskey="p" rel="prev">Numerical types</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Arithmetic-operations-1"></span><h3 class="section">12.2 Arithmetic operations</h3>

<dl class="def">
<dt id="index-real_002dvalued_003f"><span class="category">Procedure: </span><span><strong>real-valued?</strong> <em><var>obj</var></em><a href='#index-real_002dvalued_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rational_002dvalued_003f"><span class="category">Procedure: </span><span><strong>rational-valued?</strong> <em><var>obj</var></em><a href='#index-rational_002dvalued_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-integer_002dvalued_003f"><span class="category">Procedure: </span><span><strong>integer-valued?</strong> <em><var>obj</var></em><a href='#index-integer_002dvalued_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These numerical type predicates can be applied to any kind of argument.
The <code>real-valued?</code> procedure returns <code>#t</code> if the object is a
number object and is equal in the sense of <code>=</code> to some real number
object, or if the object is a NaN, or a complex number object whose real
part is a NaN and whose imaginary part is zero in the sense of
<code>zero?</code>.  The <code>rational-valued?</code> and <code>integer-valued?</code>
procedures return <code>#t</code> if the object is a number object and is equal
in the sense of <code>=</code> to some object of the named type, and otherwise
they return <code>#f</code>.
</p>
<div class="example">
<pre class="example">(real-valued? +nan.0)                  &rArr; #t
(real-valued? +nan.0+0i)               &rArr; #t
(real-valued? -inf.0)                  &rArr; #t
(real-valued? 3)                       &rArr; #t
(real-valued? -2.5+0.0i)               &rArr; #t

(real-valued? -2.5+0i)                 &rArr; #t
(real-valued? -2.5)                    &rArr; #t
(real-valued? #e1e10)                  &rArr; #t

(rational-valued? +nan.0)              &rArr; #f
(rational-valued? -inf.0)              &rArr; #f
(rational-valued? 6/10)                &rArr; #t
(rational-valued? 6/10+0.0i)           &rArr; #t
(rational-valued? 6/10+0i)             &rArr; #t
(rational-valued? 6/3)                 &rArr; #t

(integer-valued? 3+0i)                 &rArr; #t
(integer-valued? 3+0.0i)               &rArr; #t
(integer-valued? 3.0)                  &rArr; #t
(integer-valued? 3.0+0.0i)             &rArr; #t
(integer-valued? 8/4)                  &rArr; #t
</pre></div>

<blockquote>
<p><em>Note:</em> These procedures test whether a given number object can be
coerced to the specified type without loss of numerical accuracy.
Specifically, the behavior of these predicates differs from the behavior
of <code>real?</code>, <code>rational?</code>, and <code>integer?</code> on complex number
objects whose imaginary part is inexact zero.
</p></blockquote>

<blockquote>
<p><em>Note:</em> The behavior of these type predicates on inexact number
objects is unreliable, because any inaccuracy may affect the result.
</p></blockquote>
</dd></dl>

<dl class="def">
<dt id="index-exact_002dinteger_003f"><span class="category">Procedure: </span><span><strong>exact-integer?</strong> <em>z</em><a href='#index-exact_002dinteger_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>z</var> is both exact and an integer; otherwise
returns <code>#f</code>.
</p><div class="example">
<pre class="example">(exact-integer? 32)                    &rArr; #t
(exact-integer? 32.0)                  &rArr; #t
(exact-integer? 32/5)                  &rArr; #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-finite_003f"><span class="category">Procedure: </span><span><strong>finite?</strong> <em><var>z</var></em><a href='#index-finite_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>z</var> is finite real number
(i.e. an infinity and not a NaN),
or if <var>z</var> is a complex number
whose real and imaginary parts are both finite.
</p><div class="example">
<pre class="example">(finite? 3)             &rArr; #t
(finite? +inf.0)        &rArr; #f
(finite? 3.0+inf.0i)    &rArr; #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-infinite_003f"><span class="category">Procedure: </span><span><strong>infinite?</strong> <em><var>z</var></em><a href='#index-infinite_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>z</var> is
an infinite real number (<code>+int.0</code> or <code>-inf.0</code>),
or if <var>z</var> is a complex number where either
real or imaginary parts or both are infinite.
</p><div class="example">
<pre class="example">(infinite? 5.0)         &rArr; #f
(infinite? +inf.0)      &rArr; #t
(infinite? +nan.0)      &rArr; #f
(infinite? 3.0+inf.0i)  &rArr; #t
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-nan_003f"><span class="category">Procedure: </span><span><strong>nan?</strong> <em><var>z</var></em><a href='#index-nan_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>For a real numer returns whether its is a NaN;
for a complex number if the real or imaginary parts or both is a NaN.
</p><div class="example">
<pre class="example">(nan? +nan.0)           &rArr; #t
(nan? 32)               &rArr; #f
(nan? +nan.0+5.0i)      &rArr; #t
(nan? 1+2i)             &rArr; #f
</pre></div>
</dd></dl>


<dl class="def">
<dt id="index-_002b"><span class="category">Procedure: </span><span><strong>+</strong> <em><var>z</var> &hellip;</em><a href='#index-_002b' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002a"><span class="category">Procedure: </span><span><strong>*</strong> <em><var>z</var> &hellip;</em><a href='#index-_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the sum or product of their arguments.
</p>
<div class="example">
<pre class="example">(+ 3 4)                          &rArr;  7
(+ 3)                            &rArr;  3
(+)                              &rArr;  0
(+ +inf.0 +inf.0)                &rArr;  +inf.0
(+ +inf.0 -inf.0)                &rArr;  +nan.0

(* 4)                            &rArr;  4
(*)                              &rArr;  1
(* 5 +inf.0)                     &rArr;  +inf.0
(* -5 +inf.0)                    &rArr;  -inf.0
(* +inf.0 +inf.0)                &rArr;  +inf.0
(* +inf.0 -inf.0)                &rArr;  -inf.0
(* 0 +inf.0)                     &rArr;  +nan.0
(* 0 +nan.0)                     &rArr;  +nan.0
(* 1.0 0)                        &rArr;  0.0
</pre></div>

<p>For any real number object <var>x</var> that is neither infinite nor NaN:
</p>
<div class="example">
<pre class="example">(+ +inf.0 <var>x</var>)                   &rArr;  +inf.0
(+ -inf.0 <var>x</var>)                   &rArr;  -inf.0
</pre></div>

<p>For any real number object <var>x</var>:
</p>
<div class="example">
<pre class="example">(+ +nan.0 <var>x</var>)                   &rArr;  +nan.0
</pre></div>

<p>For any real number object <var>x</var> that is not an exact 0:
</p>
<div class="example">
<pre class="example">(* +nan.0 <var>x</var>)                   &rArr;  +nan.0
</pre></div>


<p>The behavior of <code>-0.0</code> is illustrated by the following examples:
</p>
<div class="example">
<pre class="example">(+  0.0 -0.0)  &rArr;  0.0
(+ -0.0  0.0)  &rArr;  0.0
(+  0.0  0.0)  &rArr;  0.0
(+ -0.0 -0.0)  &rArr; -0.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-_002d"><span class="category">Procedure: </span><span><strong>-</strong> <em><var>z</var></em><a href='#index-_002d' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002d-1"><span class="category">Procedure: </span><span><strong>-</strong> <em><var>z</var><sub>1</sub> <var>z</var><sub>2</sub> <var>z</var><sub>3</sub> &hellip;</em><a href='#index-_002d-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>With two or more arguments, this procedures returns the difference of
its arguments, associating to the left.  With one argument, however, it
returns the negation (additive inverse) of its argument.
</p>
<div class="example">
<pre class="example">(- 3 4)                               &rArr;  -1
(- 3 4 5)                             &rArr;  -6
(- 3)                                 &rArr;  -3
(- +inf.0 +inf.0)                     &rArr;  +nan.0
</pre></div>


<p>The behavior of <code>-0.0</code> is illustrated by the following examples:
</p>
<div class="example">
<pre class="example">(-  0.0)       &rArr; -0.0
(- -0.0)       &rArr;  0.0
(-  0.0 -0.0)  &rArr;  0.0
(- -0.0  0.0)  &rArr; -0.0
(-  0.0  0.0)  &rArr;  0.0
(- -0.0 -0.0)  &rArr;  0.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-_002f"><span class="category">Procedure: </span><span><strong>/</strong> <em><var>z</var></em><a href='#index-_002f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002f-1"><span class="category">Procedure: </span><span><strong>/</strong> <em><var>z</var><sub>1</sub> <var>z</var><sub>2</sub> <var>z</var><sub>3</sub> &hellip;</em><a href='#index-_002f-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If all of the arguments are exact, then the divisors must all be
nonzero.  With two or more arguments, this procedure returns the
quotient of its arguments, associating to the left.  With one argument,
however, it returns the multiplicative inverse of its argument.
</p>
<div class="example">
<pre class="example">(/ 3 4 5)                         &rArr;  3/20
(/ 3)                             &rArr;  1/3
(/ 0.0)                           &rArr;  +inf.0
(/ 1.0 0)                         &rArr;  +inf.0
(/ -1 0.0)                        &rArr;  -inf.0
(/ +inf.0)                        &rArr;  0.0
(/ 0 0)                           &rArr;  exception &amp;assertion
(/ 3 0)                           &rArr;  exception &amp;assertion
(/ 0 3.5)                         &rArr;  0.0
(/ 0 0.0)                         &rArr;  +nan.0
(/ 0.0 0)                         &rArr;  +nan.0
(/ 0.0 0.0)                       &rArr;  +nan.0
</pre></div>

<p>If this procedure is applied to mixed non&ndash;rational real and non&ndash;real
complex arguments, it either raises an exception with condition type
<code>&amp;implementation-restriction</code> or returns an unspecified number
object.
</p></dd></dl>

<dl class="def">
<dt id="index-floor_002f"><span class="category">Procedure: </span><span><strong>floor/</strong> <em>x y</em><a href='#index-floor_002f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-truncate_002f"><span class="category">Procedure: </span><span><strong>truncate/</strong> <em>x y</em><a href='#index-truncate_002f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-div_002dand_002dmod"><span class="category">Procedure: </span><span><strong>div-and-mod</strong> <em>x y</em><a href='#index-div_002dand_002dmod' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-div0_002dand_002dmod0"><span class="category">Procedure: </span><span><strong>div0-and-mod0</strong> <em>x y</em><a href='#index-div0_002dand_002dmod0' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures implement number&ndash;theoretic integer division.
They accept two real numbers <var>x</var> and <var>y</var> as operands,
where <var>y</var> must be nonzero.
In all cases the result is two values <var>q</var> (an integer) and <var>r</var> (a real)
that satisfy the equations:
</p><div class="example">
<pre class="example"><var>x</var> = <var>q</var> * <var>y</var> + <var>r</var>
<var>q</var> = <var>rounding-op</var>(<var>x</var>/<var>y</var>)
</pre></div>
<p>The result is inexact if either argument is inexact.
</p>
<p>For <code>floor/</code> the <var>rounding-op</var> is the <code>floor</code> function (below).
</p><div class="example">
<pre class="example">(floor/ 123 10)         &rArr;  12 3
(floor/ 123 -10)        &rArr;  -13 -7
(floor/ -123 10)        &rArr;  -13 7
(floor/ -123 -10)       &rArr;  12 -3
</pre></div>

<p>For <code>truncate/</code> the <var>rounding-op</var> is the <code>truncate</code> function.
</p><div class="example">
<pre class="example">(truncate/ 123 10)      &rArr;  12 3
(truncate/ 123 -10)     &rArr;  -12 3
(truncate/ -123 10)     &rArr;  -12 -3
(truncate/ -123 -10)    &rArr;  12 -3
</pre></div>

<p>For <code>div-and-mod</code> the <var>rounding-op</var> is either <code>floor</code>
(if <var>y</var> is positive) or <code>ceiling</code> (if <var>y</var> is negative).
We have:
</p><div class="example">
<pre class="example">0  &lt;= <var>r</var> &lt; |<var>y</var>|
</pre></div>
<div class="example">
<pre class="example">(div-and-mod 123 10)    &rArr;  12 3
(div-and-mod 123 -10)   &rArr;  -12 3
(div-and-mod -123 10)   &rArr;  -13 7
(div-and-mod -123 -10)  &rArr;  13 7
</pre></div>

<p>For <code>div0-and-mod0</code> the <var>rounding-op</var> is the <code>round</code> function,
and <code>r</code> lies within a half&ndash;open interval centered on zero.
</p><div class="example">
<pre class="example">-|<var>y</var>/2| &lt;= <var>r</var> &lt; |<var>y</var>/2|
</pre></div>

<div class="example">
<pre class="example">(div0-and-mod0 123 10)   &rArr;  12 3
(div0-and-mod0 123 -10)  &rArr;  -12 3
(div0-and-mod0 -123 10)  &rArr;  -12 -3
(div0-and-mod0 -123 -10) &rArr;  12 -3
(div0-and-mod0 127 10)   &rArr;  13 -3
(div0-and-mod0 127 -10)  &rArr;  -13 -3
(div0-and-mod0 -127 10)  &rArr;  -13 3
(div0-and-mod0 -127 -10) &rArr;  13 3
</pre></div>

<p>The inconsistent naming is for historical reasons: <code>div-and-mod</code>
and <code>div0-and-mod0</code> are from R6RS, while <code>floor/</code> and
<code>truncate/</code> are from R7RS.
</p></dd></dl>

<dl class="def">
<dt id="index-floor_002dquotient"><span class="category">Procedure: </span><span><strong>floor-quotient</strong> <em>x y</em><a href='#index-floor_002dquotient' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-truncate_002dquotient"><span class="category">Procedure: </span><span><strong>truncate-quotient</strong> <em>x y</em><a href='#index-truncate_002dquotient' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-div"><span class="category">Procedure: </span><span><strong>div</strong> <em>x y</em><a href='#index-div' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-div0"><span class="category">Procedure: </span><span><strong>div0</strong> <em>x y</em><a href='#index-div0' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the quotient part (first value)
of respectively <code>floor/</code>, <code>truncate/</code>,
<code>div-and-mod</code>, and <code>div0-and-mod0</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-floor_002dremainder"><span class="category">Procedure: </span><span><strong>floor-remainder</strong> <em>x y</em><a href='#index-floor_002dremainder' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-truncate_002dremainder"><span class="category">Procedure: </span><span><strong>truncate-remainder</strong> <em>x y</em><a href='#index-truncate_002dremainder' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-mod"><span class="category">Procedure: </span><span><strong>mod</strong> <em>x y</em><a href='#index-mod' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-mod0"><span class="category">Procedure: </span><span><strong>mod0</strong> <em>x y</em><a href='#index-mod0' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the remainder part (second value)
of respectively <code>floor/</code>, <code>truncate/</code>,
<code>div-and-mod</code>, and <code>div0-and-mod0</code>.
</p>
<p>As a Kawa extension <var>y</var> may be zero, in which case the result is <var>x</var>:
</p><div class="example">
<pre class="example">(mod 123 0)     &rArr;  123 ;; Kawa extension
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-quotient"><span class="category">Procedure: </span><span><strong>quotient</strong> <em>x y</em><a href='#index-quotient' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-remainder"><span class="category">Procedure: </span><span><strong>remainder</strong> <em>x y</em><a href='#index-remainder' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-modulo"><span class="category">Procedure: </span><span><strong>modulo</strong> <em>x y</em><a href='#index-modulo' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are equivalent to <code>truncate-quotient</code>,
<code>truncate-remainder</code>, and <code>floor-remainder</code>, respectively.
These are provided for backward compatibility.
</p><div class="example">
<pre class="example">(remainder 13 4)     &rArr; 1
(remainder -13 4)    &rArr; -1
(remainder 13 -4)    &rArr; 1
(remainder -13 -4)   &rArr; -1
(remainder -13 -4.0) &rArr; -1.0
(modulo 13 4)   &rArr; 1
(modulo -13 4)  &rArr; 3
(modulo 13 -4)  &rArr; -4
(modulo -13 -4) &rArr; -1
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-abs"><span class="category">Procedure: </span><span><strong>abs</strong> <em><var>x</var></em><a href='#index-abs' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the absolute value of its argument.
</p>
<div class="example">
<pre class="example">(abs -7)                         &rArr;  7
(abs -inf.0)                     &rArr;  +inf.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-gcd"><span class="category">Procedure: </span><span><strong>gcd</strong> <em><var>n</var><sub>1</sub> &hellip;</em><a href='#index-gcd' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-lcm"><span class="category">Procedure: </span><span><strong>lcm</strong> <em><var>n</var><sub>1</sub> &hellip;</em><a href='#index-lcm' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the greatest common divisor or least common
multiple of their arguments.  The result is always non&ndash;negative.
The arguments must be integers; if an argument is inexact, so is the result.
</p>
<div class="example">
<pre class="example">(gcd 32 -36)                     &rArr;  4
(gcd)                            &rArr;  0
(lcm 32 -36)                     &rArr;  288
(lcm 32.0 -36)                   &rArr;  288.0 ; inexact
(lcm)                            &rArr;  1
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-numerator"><span class="category">Procedure: </span><span><strong>numerator</strong> <em><var>q</var></em><a href='#index-numerator' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-denominator"><span class="category">Procedure: </span><span><strong>denominator</strong> <em><var>q</var></em><a href='#index-denominator' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the numerator or denominator of their argument;
the result is computed as if the argument was represented as a fraction
in lowest terms.  The denominator is always positive.  The denominator
of <code>0</code> is defined to be <code>1</code>.
The arguments must be integers; if an argument is inexact, so is the result.
</p>
<div class="example">
<pre class="example">(numerator   (/ 6 4))            &rArr;  3
(denominator (/ 6 4))            &rArr;  2
(denominator (inexact (/ 6 4)))        &rArr;  2.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-floor"><span class="category">Procedure: </span><span><strong>floor</strong> <em><var>x</var></em><a href='#index-floor' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-ceiling"><span class="category">Procedure: </span><span><strong>ceiling</strong> <em><var>x</var></em><a href='#index-ceiling' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-truncate"><span class="category">Procedure: </span><span><strong>truncate</strong> <em><var>x</var></em><a href='#index-truncate' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-round"><span class="category">Procedure: </span><span><strong>round</strong> <em><var>x</var></em><a href='#index-round' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return inexact integer objects for inexact arguments
that are not infinities or NaNs, and exact integer objects for exact
rational arguments.
</p>
<dl compact="compact">
<dt><span><code>floor</code></span></dt>
<dd><p>Returns the largest integer object not larger than <var>x</var>.
</p>
</dd>
<dt><span><code>ceiling</code></span></dt>
<dd><p>Returns the smallest integer object not smaller than <var>x</var>.
</p></dd>
<dt><span><code>truncate</code></span></dt>
<dd><p>Returns the integer object closest to <var>x</var> whose absolute value is
not larger than the absolute value of <var>x</var>.
</p>
</dd>
<dt><span><code>round</code></span></dt>
<dd><p>Returns the closest integer object to <var>x</var>, rounding to even when
<var>x</var> represents a number halfway between two integers.
</p></dd>
</dl>

<p>If the argument to one of these procedures is inexact, then the result
is also inexact.  If an exact value is needed, the result should be
passed to the <code>exact</code> procedure.
</p>
<p>Although infinities and NaNs are not integer objects, these procedures
return an infinity when given an infinity as an argument, and a NaN when
given a NaN.
</p>
<div class="example">
<pre class="example">(floor -4.3)                     &rArr;  -5.0
(ceiling -4.3)                   &rArr;  -4.0
(truncate -4.3)                  &rArr;  -4.0
(round -4.3)                     &rArr;  -4.0

(floor 3.5)                      &rArr;  3.0
(ceiling 3.5)                    &rArr;  4.0
(truncate 3.5)                   &rArr;  3.0
(round 3.5)                      &rArr;  4.0

(round 7/2)                      &rArr;  4
(round 7)                        &rArr;  7

(floor +inf.0)                   &rArr;  +inf.0
(ceiling -inf.0)                 &rArr;  -inf.0
(round +nan.0)                   &rArr;  +nan.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-rationalize"><span class="category">Procedure: </span><span><strong>rationalize</strong> <em><var>x</var><sub>1</sub> <var>x</var><sub>2</sub></em><a href='#index-rationalize' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>rationalize</code> procedure returns a number object representing
the <em>simplest</em> rational number differing from <var>x</var><sub>1</sub> by no more
than <var>x</var><sub>2</sub>.
</p>
<p>A rational number <em>r_1</em> is <em>simpler</em> than another rational
number <em>r_2</em> if <code>r_1 = p_1/q_1</code> and <code>r_2 = p_2/q_2</code> (in
lowest terms) and <code>|p_1| &lt;= |p_2|</code> and <code>|q_1| &lt;= |q_2|</code>.  Thus
<code>3/5</code> is simpler than <code>4/7</code>.
</p>
<p>Although not all rationals are comparable in this ordering (consider
<code>2/7</code> and <code>3/5</code>) any interval contains a rational number that
is simpler than every other rational number in that interval (the
simpler <code>2/5</code> lies between <code>2/7</code> and <code>3/5</code>).
</p>
<p>Note that <code>0 = 0/1</code> is the simplest rational of all.
</p><div class="example">
<pre class="example">(rationalize (exact .3) 1/10)          &rArr; 1/3
(rationalize .3 1/10)                  &rArr; #i1/3  ; approximately

(rationalize +inf.0 3)                 &rArr;  +inf.0
(rationalize +inf.0 +inf.0)            &rArr;  +nan.0
</pre></div>

<p>The first two examples hold only in implementations whose inexact real
number objects have sufficient precision.
</p></dd></dl>

<dl class="def">
<dt id="index-exp"><span class="category">Procedure: </span><span><strong>exp</strong> <em><var>z</var></em><a href='#index-exp' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-log"><span class="category">Procedure: </span><span><strong>log</strong> <em><var>z</var></em><a href='#index-log' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-log-1"><span class="category">Procedure: </span><span><strong>log</strong> <em><var>z</var><sub>1</sub> <var>z</var><sub>2</sub></em><a href='#index-log-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-sin"><span class="category">Procedure: </span><span><strong>sin</strong> <em><var>z</var></em><a href='#index-sin' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-cos"><span class="category">Procedure: </span><span><strong>cos</strong> <em><var>z</var></em><a href='#index-cos' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tan"><span class="category">Procedure: </span><span><strong>tan</strong> <em><var>z</var></em><a href='#index-tan' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-asin"><span class="category">Procedure: </span><span><strong>asin</strong> <em><var>z</var></em><a href='#index-asin' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-acos"><span class="category">Procedure: </span><span><strong>acos</strong> <em><var>z</var></em><a href='#index-acos' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-atan"><span class="category">Procedure: </span><span><strong>atan</strong> <em><var>z</var></em><a href='#index-atan' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-atan-1"><span class="category">Procedure: </span><span><strong>atan</strong> <em><var>x</var><sub>1</sub> <var>x</var><sub>2</sub></em><a href='#index-atan-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures compute the usual transcendental functions.
</p>
<p>The <code>exp</code> procedure computes the base&ndash;<var>e</var> exponential of
<var>z</var>.
The <code>log</code> procedure with a single argument computes the natural
logarithm of <var>z</var> (<strong>not</strong> the base&ndash;10 logarithm); <code>(log
<var>z</var><sub>1</sub> <var>z</var><sub>2</sub>)</code> computes the base&ndash;<var>z</var><sub>2</sub> logarithm of <var>z</var><sub>1</sub>.
</p>
<p>The <code>asin</code>, <code>acos</code>, and <code>atan</code> procedures compute
arcsine, arccosine, and arctangent, respectively.  The two&ndash;argument
variant of <code>atan</code> computes:
</p>
<div class="example">
<pre class="example">(angle (make-rectangular <var>x</var><sub>2</sub> <var>x</var><sub>1</sub>))
</pre></div>

<p>These procedures may return inexact results even when given exact
arguments.
</p><div class="example">
<pre class="example">(exp +inf.0)    &rArr; +inf.0
(exp -inf.0)    &rArr; 0.0
(log +inf.0)    &rArr; +inf.0
(log 0.0)       &rArr; -inf.0
(log 0)         &rArr; exception &amp;assertion
(log -inf.0)    &rArr; +inf.0+3.141592653589793i    ; approximately
(atan -inf.0)   &rArr; -1.5707963267948965          ; approximately
(atan +inf.0)   &rArr; 1.5707963267948965           ; approximately
(log -1.0+0.0i) &rArr; 0.0+3.141592653589793i       ; approximately
(log -1.0-0.0i) &rArr; 0.0-3.141592653589793i       ; approximately
                                                ; if -0.0 is distinguished
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-sinh"><span class="category">Procedure: </span><span><strong>sinh</strong> <em>z</em><a href='#index-sinh' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-cosh"><span class="category">Procedure: </span><span><strong>cosh</strong> <em>z</em><a href='#index-cosh' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tanh"><span class="category">Procedure: </span><span><strong>tanh</strong> <em>z</em><a href='#index-tanh' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-asinh"><span class="category">Procedure: </span><span><strong>asinh</strong> <em>z</em><a href='#index-asinh' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-acosh"><span class="category">Procedure: </span><span><strong>acosh</strong> <em>z</em><a href='#index-acosh' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-atanh"><span class="category">Procedure: </span><span><strong>atanh</strong> <em>z</em><a href='#index-atanh' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The hyperbolic functions.
</p></dd></dl>

<dl class="def">
<dt id="index-square"><span class="category">Procedure: </span><span><strong>square</strong> <em>z</em><a href='#index-square' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the square of <var>z</var>.
This is equivalent to <code>(* <var>z</var> <var>z</var>)</code>.
</p><div class="example">
<pre class="example">(square 42)    &rArr; 1764
(square 2.0)   &rArr; 4.0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-sqrt"><span class="category">Procedure: </span><span><strong>sqrt</strong> <em><var>z</var></em><a href='#index-sqrt' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the principal square root of <var>z</var>.  For rational <var>z</var>, the
result has either positive real part, or zero real part and
non&ndash;negative imaginary part.  The value of <code>(sqrt <var>z</var>)</code> could be
expressed as:
</p>
<div class="example">
<pre class="example">e^((log z)/2)
</pre></div>

<p>The <code>sqrt</code> procedure may return an inexact result even when given
an exact argument.
</p>
<div class="example">
<pre class="example">(sqrt -5)                   &rArr;  0.0+2.23606797749979i ; approximately
(sqrt +inf.0)               &rArr;  +inf.0
(sqrt -inf.0)               &rArr;  +inf.0i
</pre></div>

<p>Note that if the argument is a primitive number (such as <code>double</code>) or an
instance of the corresponding boxed class (such as <code>java.lang.Double</code>)
then we use the real-number version of <code>sqrt</code>:
</p><div class="example">
<pre class="example">(sqrt (-&gt;double -5))        &rArr;  NaN
</pre></div>
<p>That is, we get different a result for <code>java.lang.Double</code>
and <code>gnu.math.DFloNum</code>, even for arguments that are numerically equal
in the sense of <code>=</code>.
This is so that the compiler can use the <code>java.lang.Math.sqrt</code>
method without object allocation when the argument is a <code>double</code>
(and because we want <code>double</code> and <code>java.lang.Double</code> to behave
consistently).
</p></dd></dl>

<dl class="def">
<dt id="index-exact_002dinteger_002dsqrt"><span class="category">Procedure: </span><span><strong>exact-integer-sqrt</strong> <em><var>k</var></em><a href='#index-exact_002dinteger_002dsqrt' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>exact-integer-sqrt</code> procedure returns two non&ndash;negative exact
integer objects <em>s</em> and <em>r</em> where <code><var>k</var> = s^2 + r</code> and
<code><var>k</var> &lt; (s+1)^2</code>.
</p>
<div class="example">
<pre class="example">(exact-integer-sqrt 4)  &rArr; 2 0 ; two return values
(exact-integer-sqrt 5)  &rArr; 2 1 ; two return values
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Numerical-input-and-output">
<div class="header">
<p>
Next: <a href="#Quaternions" accesskey="n" rel="next">Quaternions</a>, Previous: <a href="#Arithmetic-operations" accesskey="p" rel="prev">Arithmetic operations</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Numerical-input-and-output-1"></span><h3 class="section">12.3 Numerical input and output</h3>

<dl class="def">
<dt id="index-number_002d_003estring"><span class="category">Procedure: </span><span><strong>number-&gt;string</strong> <em>z [radix]</em><a href='#index-number_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The procedure <code>number-&gt;string</code> takes a number and a
radix and returns as a string an external representation
of the given number in the given radix such that
</p><div class="example">
<pre class="example">(let ((number number)
      (radix radix))
  (eqv? number
        (string-&gt;number (number-&gt;string number radix)
                        radix)))
</pre></div>
<p>is true. It is an error if no possible result makes this expression true.
</p>
<p>If present, <var>radix</var> must be an exact integer
in the range 2 to 36, inclusive.
If omitted, <var>radix</var> defaults to 10.
</p>
<p>If <var>z</var> is inexact, the <var>radix</var> is 10, and the above expression
can be satisfied by a result that contains a decimal point,
then the result contains a decimal point and is expressed
using the minimum number of digits (exclusive of exponent
and trailing zeroes) needed to make the above expression;
otherwise the format of the result is unspecified.
</p>
<p>The result returned by <code>number-&gt;string</code> never contains an
explicit radix prefix.
</p>
<p><em>Note:</em>
The error case can occur only when <var>z</var> is not a complex
number or is a complex number with a non-rational real or
imaginary part.
</p>
<p><em>Rationale:</em> If <var>z</var> is an inexact number and the <var>radix</var> is 10,
then the above expression is normally satisfied by a result containing
a decimal point. The unspecified case allows for infinities, NaNs,
and unusual representations.
</p>
</dd></dl>

<dl class="def">
<dt id="index-string_002d_003enumber"><span class="category">Procedure: </span><span><strong>string-&gt;number</strong> <em>string [radix]</em><a href='#index-string_002d_003enumber' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a number of the maximally precise representation
expressed by the given <var>string</var>. It is an error if <var>radix</var> is not
an exact integer in the range 2 to 26, inclusive.
</p>
<p>If supplied, <var>radix</var> is a default radix that will be overridden
 if an explicit radix prefix is present in the string (e.g.
<code>&quot;#o177&quot;</code>). If <var>radix</var> is not supplied, then the default <var>radix</var>
is 10. If <var>string</var> is not a syntactically valid notation for a
number, or would result in a number that the implementation cannot represent,
then <code>string-&gt;number</code> returns <code>#f</code>.
An error is never signaled due to the content of <var>string</var>.
</p>
<div class="example">
<pre class="example">(string-&gt;number &quot;100&quot;)      &rArr;  100
(string-&gt;number &quot;100&quot; 16)   &rArr;  256
(string-&gt;number &quot;1e2&quot;)      &rArr;  100.0
(string-&gt;number &quot;#x100&quot; 10) &rArr;  256
</pre></div>

</dd></dl>


<hr>
</div>
<div class="section" id="Quaternions">
<div class="header">
<p>
Next: <a href="#Quantities" accesskey="n" rel="next">Quantities and Units</a>, Previous: <a href="#Numerical-input-and-output" accesskey="p" rel="prev">Numerical input and output</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Quaternions-1"></span><h3 class="section">12.4 Quaternions</h3>

<p>Kawa extends the Scheme numeric tower to include
<a href="http://en.wikipedia.org/wiki/Quaternion">quaternions</a> as a proper
superset of the complex numbers.  Quaternions provide a convenient
notation to represent
<a href="http://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation">rotations in three-dimensional space</a>,
and are therefore commonly found in applications such as computer
graphics, robotics, and spacecraft engineering.  The Kawa quaternion API
is modeled after
<a href="http://www.ccs.neu.edu/home/dorai/squat/squat.html">this</a> with some
additions.
</p>
<p>A quaternion is a number that can be expressed in the form
&lsquo;<samp>w+xi+yj+zk</samp>&rsquo;, where <code>w</code>, <code>x</code>, <code>y</code>, and <code>z</code> are
real, and <code>i</code>, <code>j</code>, and <code>k</code> are imaginary units
satisfying <em class='math'>i<sup>2</sup> = j<sup>2</sup> = k<sup>2</sup> = ijk = -1</em>.  The magnitude of a
quaternion is defined to be its Euclidean norm when viewed as a point in
<em class='math'>R<sup>4</sup></em>.
</p>
<p>The real&ndash;part of a quaternion is also called its &lsquo;<samp>scalar</samp>&rsquo;, while
the i&ndash;part, j&ndash;part, and k&ndash;part taken together are also called its
&lsquo;<samp>vector</samp>&rsquo;.  A quaternion with zero j&ndash;part and k&ndash;part is an
ordinary complex number. (If the i&ndash;part is also zero, then it is a
real).  A quaternion with zero real&ndash;part is called a
&lsquo;<samp>vector quaternion</samp>&rsquo;.
</p>
<p>The reader syntax for number literals has been extended to support both
rectangular and polar (hyperspherical) notation for quaternions.  The
rectangular notation is as above, i.e. <code>w+xi+yj+zk</code>.  The polar
notation takes the form <code>r@t%u&amp;v</code>, where <code>r</code> is the
magnitude, <code>t</code> is the first angle, and <code>u</code> and <code>v</code> are
two other angles called the &ldquo;colatitude&rdquo; and &ldquo;longitude&rdquo;.
</p>
<p>The rectangular coordinates and polar coordinates are related by the
equations:
</p><div class="example">
<pre class="example"><var>w</var> = <var>r</var> * cos <var>t</var>
<var>x</var> = <var>r</var> * sin <var>t</var> * cos <var>u</var>
<var>y</var> = <var>r</var> * sin <var>t</var> * sin <var>u</var> * cos <var>v</var>
<var>z</var> = <var>r</var> * sin <var>t</var> * sin <var>u</var> * sin <var>v</var>
</pre></div>
<p>With either notation, zero elements may be omitted.
</p>
<dl class="def">
<dt id="index-make_002drectangular"><span class="category">Procedure: </span><span><strong>make-rectangular</strong> <em><var>w</var> <var>x</var></em><a href='#index-make_002drectangular' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002drectangular-1"><span class="category">Procedure: </span><span><strong>make-rectangular</strong> <em><var>w</var> <var>x</var> <var>y</var> <var>z</var></em><a href='#index-make_002drectangular-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures construct quaternions from Cartesian coordinates.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dpolar"><span class="category">Procedure: </span><span><strong>make-polar</strong> <em><var>r</var> <var>t</var></em><a href='#index-make_002dpolar' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dpolar-1"><span class="category">Procedure: </span><span><strong>make-polar</strong> <em><var>r</var> <var>t</var> <var>u</var> <var>v</var></em><a href='#index-make_002dpolar-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures construct quaternions from polar coordinates.
</p></dd></dl>

<dl class="def">
<dt id="index-_002b-1"><span class="category">Procedure: </span><span><strong>+</strong> <em><var>q</var> &hellip;</em><a href='#index-_002b-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002d-2"><span class="category">Procedure: </span><span><strong>-</strong> <em><var>q</var> &hellip;</em><a href='#index-_002d-2' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002a-1"><span class="category">Procedure: </span><span><strong>*</strong> <em><var>q</var> &hellip;</em><a href='#index-_002a-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002f-2"><span class="category">Procedure: </span><span><strong>/</strong> <em><var>q</var></em><a href='#index-_002f-2' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-_002f-3"><span class="category">Procedure: </span><span><strong>/</strong> <em><var>q</var><sub>1</sub> <var>q</var><sub>2</sub> <var>q</var><sub>3</sub> &hellip;</em><a href='#index-_002f-3' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-expt"><span class="category">Procedure: </span><span><strong>expt</strong> <em><var>q</var><sub>1</sub> <var>q</var><sub>2</sub></em><a href='#index-expt' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-exp-1"><span class="category">Procedure: </span><span><strong>exp</strong> <em><var>q</var></em><a href='#index-exp-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-log-2"><span class="category">Procedure: </span><span><strong>log</strong> <em><var>q</var></em><a href='#index-log-2' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-sqrt-1"><span class="category">Procedure: </span><span><strong>sqrt</strong> <em><var>q</var></em><a href='#index-sqrt-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-sin-1"><span class="category">Procedure: </span><span><strong>sin</strong> <em><var>q</var></em><a href='#index-sin-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-cos-1"><span class="category">Procedure: </span><span><strong>cos</strong> <em><var>q</var></em><a href='#index-cos-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tan-1"><span class="category">Procedure: </span><span><strong>tan</strong> <em><var>q</var></em><a href='#index-tan-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-asin-1"><span class="category">Procedure: </span><span><strong>asin</strong> <em><var>q</var></em><a href='#index-asin-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-acos-1"><span class="category">Procedure: </span><span><strong>acos</strong> <em><var>q</var></em><a href='#index-acos-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-atan-2"><span class="category">Procedure: </span><span><strong>atan</strong> <em><var>q</var></em><a href='#index-atan-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>All of the arithmetic and transcendental functions defined for complex
arguments have been extended to support quaternions.
</p>
<p>Quaternion multiplication is not commutative, so there are two possible
interpretations of <code>(/ q1 q2)</code> which would yield different results:
either <code>(* q1 (/ q2))</code>, or <code>(* (/ q2) q1)</code>.  Division in this
implementation has been defined such that <code>(/ q1 q2 ...)</code> is
equivalent to <code>(* q1 (/ q2) ...)</code>, but it is recommended to
use reciprocals (unary <code>/</code>) and multiplication.
</p></dd></dl>

<dl class="def">
<dt id="index-real_002dpart"><span class="category">Procedure: </span><span><strong>real-part</strong> <em><var>q</var></em><a href='#index-real_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the real&ndash;part of <var>q</var>.
</p>
<div class="example">
<pre class="example">(real-part 0)          &rArr;  0
(real-part -i)         &rArr;  0
(real-part 1+2i-3j+4k) &rArr;  1
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-imag_002dpart"><span class="category">Procedure: </span><span><strong>imag-part</strong> <em><var>q</var></em><a href='#index-imag_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the i&ndash;part of <var>q</var>.
</p>
<div class="example">
<pre class="example">(imag-part 0)          &rArr;  0
(imag-part -i)         &rArr;  -1
(imag-part 1+2i-3j+4k) &rArr;  2
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-magnitude"><span class="category">Procedure: </span><span><strong>magnitude</strong> <em><var>q</var></em><a href='#index-magnitude' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the Euclidean norm of <var>q</var>.  If <var>q</var> is <code>a+bi+cj+dk</code>,
then <code>(magnitude q)</code> is
<code>(sqrt (apply + (map square (list a b c d))))</code>
</p></dd></dl>

<dl class="def">
<dt id="index-angle"><span class="category">Procedure: </span><span><strong>angle</strong> <em><var>q</var></em><a href='#index-angle' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the angle of <var>q</var>.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#The-_0028kawa-quaternions_0029-module" accesskey="1">The <code>(kawa quaternions)</code> module</a></li>
<li><a href="#The-_0028kawa-rotations_0029-module" accesskey="2">The <code>(kawa rotations)</code> module</a></li>
</ul>
<div class="subsection" id="The-_0028kawa-quaternions_0029-module">
<h4 class="subsection">12.4.1 The <code>(kawa quaternions)</code> module</h4>

<p>The following additional functionality is made available by doing one
of:
</p><div class="example">
<pre class="example">(require 'quaternions) ;; or
(import (kawa quaternions))
</pre></div>

<dl class="def">
<dt id="index-quaternion"><span class="category">Alias: </span><span><strong>quaternion</strong><a href='#index-quaternion' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An alias for <code>gnu.math.Quaternion</code>, useful for type declarations.
</p></dd></dl>
<dl class="def">
<dt id="index-quaternion_003f"><span class="category">Procedure: </span><span><strong>quaternion?</strong> <em><var>x</var></em><a href='#index-quaternion_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>x</var> is a quaternion, i.e. an ordinary number, and
<code>#f</code> otherwise.
</p>
<div class="example">
<pre class="example">(quaternion? 0)          &rArr;  #t
(quaternion? -i)         &rArr;  #t
(quaternion? 1+2i-3j+4k) &rArr;  #t
(quaternion? 10.0m)      &rArr;  #f
(quaternion? &quot;x&quot;)        &rArr;  #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-jmag_002dpart"><span class="category">Procedure: </span><span><strong>jmag-part</strong> <em><var>q</var></em><a href='#index-jmag_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the j&ndash;part of <var>q</var>.
</p>
<div class="example">
<pre class="example">(jmag-part 0)          &rArr;  0
(jmag-part -i)         &rArr;  0
(jmag-part 1+2i-3j+4k) &rArr;  -3
</pre></div>
</dd></dl>
<dl class="def">
<dt id="index-kmag_002dpart"><span class="category">Procedure: </span><span><strong>kmag-part</strong> <em><var>q</var></em><a href='#index-kmag_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<div class="example">
<pre class="example">(kmag-part 0)          &rArr;  0
(kmag-part -i)         &rArr;  0
(kmag-part 1+2i-3j+4k) &rArr;  4
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-complex_002dpart"><span class="category">Procedure: </span><span><strong>complex-part</strong> <em><var>q</var></em><a href='#index-complex_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the projection of <var>q</var> into the complex plane:
<code>(+ (real-part q) (* +i (imag-part q)))</code>
</p>
<div class="example">
<pre class="example">(complex-part 0)          &rArr;  0
(complex-part -i)         &rArr;  -1i
(complex-part 1+2i-3j+4k) &rArr;  1+2i
</pre></div>
</dd></dl>
<dl class="def">
<dt id="index-vector_002dpart"><span class="category">Procedure: </span><span><strong>vector-part</strong> <em><var>q</var></em><a href='#index-vector_002dpart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the vector&ndash;part of <var>q</var>.
</p>
<div class="example">
<pre class="example">(vector-part 0)          &rArr;  0
(vector-part -i)         &rArr;  -1i
(vector-part 1+2i-3j+4k) &rArr;  +2i-3j+4k
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-unit_002dquaternion"><span class="category">Procedure: </span><span><strong>unit-quaternion</strong> <em><var>q</var></em><a href='#index-unit_002dquaternion' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a quaternion of unit magnitude with the same direction as
<var>q</var>.  If <var>q</var> is zero, return zero.  This is like a 4D version of
a signum function.
</p>
<div class="example">
<pre class="example">(unit-quaternion 0)          &rArr;  0
(unit-quaternion -i)         &rArr;  -1i
(unit-quaternion 1+2i-3j+4k) &rArr;  0.18257418583505536+0.3651483716701107i-0.5477225575051661j+0.7302967433402214k
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-unit_002dvector"><span class="category">Procedure: </span><span><strong>unit-vector</strong> <em><var>q</var></em><a href='#index-unit_002dvector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the vector&ndash;part of <var>q</var>, scaled to have magnitude 1.  If the
vector&ndash;part is zero, then return zero.
</p>
<div class="example">
<pre class="example">(unit-vector 0)          &rArr;  0
(unit-vector -i)         &rArr;  -1i
(unit-vector 1+2i-3j+4k) &rArr;  +0.3713906763541037i-0.5570860145311556j+0.7427813527082074k
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-colatitude"><span class="category">Procedure: </span><span><strong>colatitude</strong> <em><var>q</var></em><a href='#index-colatitude' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the colatitude of <var>q</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-longitude"><span class="category">Procedure: </span><span><strong>longitude</strong> <em><var>q</var></em><a href='#index-longitude' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the longitude of <var>q</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_002dquaternion_003f"><span class="category">Procedure: </span><span><strong>vector-quaternion?</strong> <em><var>obj</var></em><a href='#index-vector_002dquaternion_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a vector quaternion, i.e. a quaternion
with zero real&ndash;part.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dvector_002dquaternion"><span class="category">Procedure: </span><span><strong>make-vector-quaternion</strong> <em><var>x</var> <var>y</var> <var>z</var></em><a href='#index-make_002dvector_002dquaternion' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Construct vector quaternion <code>xi+yj+zk</code>.  This is equivalent to
<code>(make-rectangular 0 x y z)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_002dquaternion_002d_003elist"><span class="category">Procedure: </span><span><strong>vector-quaternion-&gt;list</strong> <em><var>vq</var></em><a href='#index-vector_002dquaternion_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated list of the x, y, and z components of
<var>vq</var>.  This is equivalent to
<code>(list (imag-part vq) (jmag-part vq) (kmag-part vq))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-dot_002dproduct"><span class="category">Procedure: </span><span><strong>dot-product</strong> <em><var>q</var><sub>1</sub> <var>q</var><sub>2</sub></em><a href='#index-dot_002dproduct' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>For two vector quaternions <var>q</var><sub>1</sub> = <code>ai+bj+ck</code> and <var>q</var><sub>2</sub> =
<code>di+ej+fk</code>, return <code>ad + be + cf</code>.  This is equal to the
<em class='tex2jax_process'>\(R^3\)</em> dot product for vectors <em class='tex2jax_process'>\((a,b,c)\)</em> and <em class='tex2jax_process'>\((d,e,f)\)</em>,
and is also equal to <code>(- (real-part (* q1 q2)))</code>.  It is an error
if either <var>q</var><sub>1</sub> or <var>q</var><sub>2</sub> has a non-zero real&ndash;part.
</p></dd></dl>

<dl class="def">
<dt id="index-cross_002dproduct"><span class="category">Procedure: </span><span><strong>cross-product</strong> <em><var>q</var><sub>1</sub> <var>q</var><sub>2</sub></em><a href='#index-cross_002dproduct' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>For two vector quaternions <var>q</var><sub>1</sub> = <code>ai+bj+ck</code> and <var>q</var><sub>2</sub> =
<code>di+ej+fk</code>, return the <em class='tex2jax_process'>\(R^3\)</em> cross product for vectors
<em class='tex2jax_process'>\((a,b,c)\)</em> and <em class='tex2jax_process'>\((d,e,f)\)</em>, which is equal to
<code>(vector-part (* q1 q2))</code>.  It is an error
if either <var>q</var><sub>1</sub> or <var>q</var><sub>2</sub> has a non-zero real&ndash;part.
</p></dd></dl>

<dl class="def">
<dt id="index-conjugate"><span class="category">Procedure: </span><span><strong>conjugate</strong> <em><var>q</var></em><a href='#index-conjugate' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>(+ (real-part q) (* -1 (vector-part q)))</code>.
</p>
<div class="example">
<pre class="example">(conjugate 0)          &rArr;  0
(conjugate -i)         &rArr;  +1i
(conjugate 1+2i-3j+4k) &rArr;  1-2i+3j-4k
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="The-_0028kawa-rotations_0029-module">
<h4 class="subsection">12.4.2 The <code>(kawa rotations)</code> module</h4>

<p>The <code>(kawa rotations)</code> library provides a set of functions which
use unit quaternions to represent 3D spatial rotations.  To use these
functions, the library must be imported:
</p><div class="example">
<pre class="example">(import (kawa rotations))
</pre></div>

<p>These functions normalize their quaternion inputs as needed to be of
length 1.
</p>
<ul class="section-toc">
<li><a href="#Rotation-Representation-Conversions" accesskey="1">Rotation Representation Conversions</a></li>
<li><a href="#Rotation-Operations" accesskey="2">Rotation Operations</a></li>
</ul>
<div class="subsubsection" id="Rotation-Representation-Conversions">
<h4 class="subsubsection">12.4.2.1 Rotation Representation Conversions</h4>

<p>Conversions to and from several alternate representations of rotations
are supported.
</p>
<p>The set of unit quaternions provides a double covering of all
possible 3D rotations: <code>q</code> and <code>-q</code> represent the same
rotation.  Most other representations also have multiple numerical
values which map to the same rotation (for example, the rotation about
<code>axis-vec</code> by <code>angle</code> is the same as the rotation about
<code>-axis-vec</code> by <code>-angle+2pi</code>).  Therefore, these functions do
not necessarily act as inverses in the sense of <code>equal?</code>.
Furthermore, rotations involve trigonometric functions, so there will
typically be some floating point error: <code>(acos (cos 0.1))</code> returns
0.09999999999999945, which is very close to 0.1 but not exact.
</p>
<span id="Rotation-Matrices"></span><h4 class="subsubheading">Rotation Matrices</h4>

<dl class="def">
<dt id="index-quaternion_002d_003erotation_002dmatrix"><span class="category">Procedure: </span><span><strong>quaternion-&gt;rotation-matrix</strong> <em><var>q</var></em><a href='#index-quaternion_002d_003erotation_002dmatrix' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rotation_002dmatrix_002d_003equaternion"><span class="category">Procedure: </span><span><strong>rotation-matrix-&gt;quaternion</strong> <em><var>m</var></em><a href='#index-rotation_002dmatrix_002d_003equaternion' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The <code>quaternion-&gt;rotation-matrix</code> procedure returns a 3x3 rotation
matrix representing the same rotation as <var>q</var>.  The rotation matrix
is instantiated as a <a href="#Arrays">SRFI-25 multi-dimensional array</a> backed
by an <a href="#Uniform-vectors">f64vector</a>.
</p>
<p>The <code>rotation-matrix-&gt;quaternion</code> procedure performs the reverse
operation, producing an equivalent unit quaternion for the rotation
matrix (multi-dimensional array) <var>m</var>.
</p>
<div class="example">
<pre class="example">(rotation-matrix-&gt;quaternion (quaternion-&gt;rotation-matrix -1)) &rArr; 1.0
</pre></div>
</dd></dl>

<span id="Axis_002dAngle-Representation"></span><h4 class="subsubheading">Axis-Angle Representation</h4>

<dl class="def">
<dt id="index-rotation_002daxis"><span class="category">Procedure: </span><span><strong>rotation-axis</strong> <em><var>q</var></em><a href='#index-rotation_002daxis' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rotation_002dangle"><span class="category">Procedure: </span><span><strong>rotation-angle</strong> <em><var>q</var></em><a href='#index-rotation_002dangle' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rotation_002daxis_002fangle"><span class="category">Procedure: </span><span><strong>rotation-axis/angle</strong> <em><var>q</var></em><a href='#index-rotation_002daxis_002fangle' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The <code>rotation-axis</code> procedure returns the axis of rotation of the
quaternion <var>q</var> as a unit-length vector quaternion.  If the axis of
rotation is not well-defined (the angle of rotation is 0), then
<code>+i</code> is arbitrarily chosen as the axis.
</p>
<p>The <code>rotation-angle</code> procedure returns the corresponding angle of
rotation.  Note that this is not the same as the result of the
<code>angle</code> procedure.
</p>
<p>The <code>rotation-axis/angle</code> procedure returns the rotation axis and
angle as multiple values.
</p>
<div class="example">
<pre class="example">(let* ((q 1/2+1/2i+1/2j+1/2k)
       (ar (rotation-angle q))
       (ad (java.lang.Math:toDegrees ar))
       (exact-ad (exact ad)))
  (rationalize exact-ad 1/10)) &rArr; 120
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-make_002daxis_002fangle"><span class="category">Procedure: </span><span><strong>make-axis/angle</strong> <em><var>axis-vec</var> <var>angle</var></em><a href='#index-make_002daxis_002fangle' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002daxis_002fangle-1"><span class="category">Procedure: </span><span><strong>make-axis/angle</strong> <em><var>axis-x</var> <var>axis-y</var> <var>axis-z</var> <var>angle</var></em><a href='#index-make_002daxis_002fangle-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The <code>make-axis/angle</code> procedure returns a quaternion representing
the given axis/angle rotation.  The axis is specified as either a single
vector quaternion argument <var>axis-vec</var>, or as three reals
<var>axis-x</var>, <var>axis-y</var>, and <var>axis-z</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-rotx"><span class="category">Procedure: </span><span><strong>rotx</strong> <em><var>angle</var></em><a href='#index-rotx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-roty"><span class="category">Procedure: </span><span><strong>roty</strong> <em><var>angle</var></em><a href='#index-roty' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rotz"><span class="category">Procedure: </span><span><strong>rotz</strong> <em><var>angle</var></em><a href='#index-rotz' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The procedures <code>rotx</code>, <code>roty</code>, and <code>rotz</code> return
quaternions representing rotations about the X-, Y-, and Z-axes.
</p></dd></dl>

<span id="Intrinsic-Angle-Sets"></span><h4 class="subsubheading">Intrinsic Angle Sets</h4>

<p>The intrinsic angle sets represent arbitrary rotations as a sequence of
three rotations about coordinate frame axes attached to the rotating
body (i.e. the axes rotate with the body).
</p>
<p>There are twelve possible angle sets which neatly divide into two groups
of six.  The six with same first and third axes are also known as
&ldquo;Euler angles&rdquo;.  The six with different first and third axes are also
known as &ldquo;Tait-Bryan angles&rdquo;.
</p>
<dl class="def">
<dt id="index-intrinsic_002dxyx"><span class="category">Procedure: </span><span><strong>intrinsic-xyx</strong> <em><var>q</var></em><a href='#index-intrinsic_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dxzx"><span class="category">Procedure: </span><span><strong>intrinsic-xzx</strong> <em><var>q</var></em><a href='#index-intrinsic_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dyxy"><span class="category">Procedure: </span><span><strong>intrinsic-yxy</strong> <em><var>q</var></em><a href='#index-intrinsic_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dyzy"><span class="category">Procedure: </span><span><strong>intrinsic-yzy</strong> <em><var>q</var></em><a href='#index-intrinsic_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dzxz"><span class="category">Procedure: </span><span><strong>intrinsic-zxz</strong> <em><var>q</var></em><a href='#index-intrinsic_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dzyz"><span class="category">Procedure: </span><span><strong>intrinsic-zyz</strong> <em><var>q</var></em><a href='#index-intrinsic_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions decompose the rotation represented by <var>q</var> into Euler
angles of the given set (XYX, XZX, YXY, YZY, ZXZ, or ZYZ) and returns
the three angles as multiple values.  The middle angle will be in the
range [0,pi].  If it is on the edges of that range (within 1.0E-12 of 0
or pi), such that the first and third axes are colinear, then the first
angle will be set to 0.
</p>
<div class="example">
<pre class="example">(intrinsic-zyz (* (rotz 0.3) (roty 0.8) (rotz -0.6))) &rArr; 0.3000000000000001 0.7999999999999999 -0.5999999999999999
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-euler_002dxyx"><span class="category">Alias: </span><span><strong>euler-xyx</strong><a href='#index-euler_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-euler_002dxzx"><span class="category">Alias: </span><span><strong>euler-xzx</strong><a href='#index-euler_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-euler_002dyxy"><span class="category">Alias: </span><span><strong>euler-yxy</strong><a href='#index-euler_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-euler_002dyzy"><span class="category">Alias: </span><span><strong>euler-yzy</strong><a href='#index-euler_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-euler_002dzxz"><span class="category">Alias: </span><span><strong>euler-zxz</strong><a href='#index-euler_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-euler_002dzyz"><span class="category">Alias: </span><span><strong>euler-zyz</strong><a href='#index-euler_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Aliases for the corresponding <code>intrinsic-</code> procedures.
</p></dd></dl>

<dl class="def">
<dt id="index-intrinsic_002dxyz"><span class="category">Procedure: </span><span><strong>intrinsic-xyz</strong> <em><var>q</var></em><a href='#index-intrinsic_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dxzy"><span class="category">Procedure: </span><span><strong>intrinsic-xzy</strong> <em><var>q</var></em><a href='#index-intrinsic_002dxzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dyxz"><span class="category">Procedure: </span><span><strong>intrinsic-yxz</strong> <em><var>q</var></em><a href='#index-intrinsic_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dyzx"><span class="category">Procedure: </span><span><strong>intrinsic-yzx</strong> <em><var>q</var></em><a href='#index-intrinsic_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dzxy"><span class="category">Procedure: </span><span><strong>intrinsic-zxy</strong> <em><var>q</var></em><a href='#index-intrinsic_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-intrinsic_002dzyx"><span class="category">Procedure: </span><span><strong>intrinsic-zyx</strong> <em><var>q</var></em><a href='#index-intrinsic_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions decompose the rotation represented by <var>q</var> into
Tait-Bryan angles of the given set (XYZ, XZY, YXZ, YZX, ZXY, or ZYX) and
returns the three angles as multiple values.  The middle angle will be
in the range [-pi/2,pi/2].  If it is on the edges of that range, such
that the first and third axes are colinear, then the first angle will be
set to 0.
</p></dd></dl>

<dl class="def">
<dt id="index-tait_002dbryan_002dxyz"><span class="category">Alias: </span><span><strong>tait-bryan-xyz</strong><a href='#index-tait_002dbryan_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tait_002dbryan_002dxzy"><span class="category">Alias: </span><span><strong>tait-bryan-xzy</strong><a href='#index-tait_002dbryan_002dxzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tait_002dbryan_002dyxz"><span class="category">Alias: </span><span><strong>tait-bryan-yxz</strong><a href='#index-tait_002dbryan_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tait_002dbryan_002dyzx"><span class="category">Alias: </span><span><strong>tait-bryan-yzx</strong><a href='#index-tait_002dbryan_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tait_002dbryan_002dzxy"><span class="category">Alias: </span><span><strong>tait-bryan-zxy</strong><a href='#index-tait_002dbryan_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-tait_002dbryan_002dzyx"><span class="category">Alias: </span><span><strong>tait-bryan-zyx</strong><a href='#index-tait_002dbryan_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Aliases for the corresponding <code>intrinsic-</code> procedures.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dintrinsic_002dxyx"><span class="category">Procedure: </span><span><strong>make-intrinsic-xyx</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dxzx"><span class="category">Procedure: </span><span><strong>make-intrinsic-xzx</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dyxy"><span class="category">Procedure: </span><span><strong>make-intrinsic-yxy</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dyzy"><span class="category">Procedure: </span><span><strong>make-intrinsic-yzy</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dzxz"><span class="category">Procedure: </span><span><strong>make-intrinsic-zxz</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dzyz"><span class="category">Procedure: </span><span><strong>make-intrinsic-zyz</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions return quaternions representing the given Euler angle
rotations.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002deuler_002dxyx"><span class="category">Alias: </span><span><strong>make-euler-xyx</strong><a href='#index-make_002deuler_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deuler_002dxzx"><span class="category">Alias: </span><span><strong>make-euler-xzx</strong><a href='#index-make_002deuler_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deuler_002dyxy"><span class="category">Alias: </span><span><strong>make-euler-yxy</strong><a href='#index-make_002deuler_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deuler_002dyzy"><span class="category">Alias: </span><span><strong>make-euler-yzy</strong><a href='#index-make_002deuler_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deuler_002dzxz"><span class="category">Alias: </span><span><strong>make-euler-zxz</strong><a href='#index-make_002deuler_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deuler_002dzyz"><span class="category">Alias: </span><span><strong>make-euler-zyz</strong><a href='#index-make_002deuler_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Aliases for the corresponding <code>make-intrinsic-</code> procedures.
</p>
<div class="example">
<pre class="example">(let-values (((a b c) (euler-xyx (make-euler-xyx 1.0 0.0 2.0))))
  (list a b c)) &rArr; (0.0 0.0 3.0)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-make_002dintrinsic_002dxyz"><span class="category">Procedure: </span><span><strong>make-intrinsic-xyz</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dxzy"><span class="category">Procedure: </span><span><strong>make-intrinsic-xzy</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dxzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dyxz"><span class="category">Procedure: </span><span><strong>make-intrinsic-yxz</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dyzx"><span class="category">Procedure: </span><span><strong>make-intrinsic-yzx</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dzxy"><span class="category">Procedure: </span><span><strong>make-intrinsic-zxy</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dintrinsic_002dzyx"><span class="category">Procedure: </span><span><strong>make-intrinsic-zyx</strong> <em><var>alpha</var> <var>beta</var> <var>gamma</var></em><a href='#index-make_002dintrinsic_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions return quaternions representing the given Tait-Bryan
angle rotations.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dtait_002dbryan_002dxyz"><span class="category">Alias: </span><span><strong>make-tait-bryan-xyz</strong><a href='#index-make_002dtait_002dbryan_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dtait_002dbryan_002dxzy"><span class="category">Alias: </span><span><strong>make-tait-bryan-xzy</strong><a href='#index-make_002dtait_002dbryan_002dxzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dtait_002dbryan_002dyxz"><span class="category">Alias: </span><span><strong>make-tait-bryan-yxz</strong><a href='#index-make_002dtait_002dbryan_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dtait_002dbryan_002dyzx"><span class="category">Alias: </span><span><strong>make-tait-bryan-yzx</strong><a href='#index-make_002dtait_002dbryan_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dtait_002dbryan_002dzxy"><span class="category">Alias: </span><span><strong>make-tait-bryan-zxy</strong><a href='#index-make_002dtait_002dbryan_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dtait_002dbryan_002dzyx"><span class="category">Alias: </span><span><strong>make-tait-bryan-zyx</strong><a href='#index-make_002dtait_002dbryan_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Aliases for the corresponding <code>make-intrinsic-</code> procedures.
</p></dd></dl>

<span id="Extrinsic-Angle-Sets"></span><h4 class="subsubheading">Extrinsic Angle Sets</h4>

<p>The extrinsic angle sets represent arbitrary rotations as a sequence of
three rotations about fixed-frame axes (i.e. the axes do not rotate with
the body).
</p>
<p>There are twelve possible extrinsic angle sets, and each is the dual of
an intrinsic set.  The extrinsic rotation about axes <code>A</code>, <code>B</code>,
and <code>C</code> by angles <code>a</code>, <code>b</code>, and <code>c</code> is the same as
the intrinsic rotation about axes <code>C</code>, <code>B</code>, and <code>A</code> by
angles <code>c</code>, <code>b</code>, and <code>a</code>, with the order of the three
axes reversed.
</p>
<dl class="def">
<dt id="index-extrinsic_002dxyx"><span class="category">Procedure: </span><span><strong>extrinsic-xyx</strong> <em><var>q</var></em><a href='#index-extrinsic_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dxyz"><span class="category">Procedure: </span><span><strong>extrinsic-xyz</strong> <em><var>q</var></em><a href='#index-extrinsic_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dxzx"><span class="category">Procedure: </span><span><strong>extrinsic-xzx</strong> <em><var>q</var></em><a href='#index-extrinsic_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dzxy"><span class="category">Procedure: </span><span><strong>extrinsic-zxy</strong> <em><var>q</var></em><a href='#index-extrinsic_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dyxy"><span class="category">Procedure: </span><span><strong>extrinsic-yxy</strong> <em><var>q</var></em><a href='#index-extrinsic_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dyxz"><span class="category">Procedure: </span><span><strong>extrinsic-yxz</strong> <em><var>q</var></em><a href='#index-extrinsic_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dyzx"><span class="category">Procedure: </span><span><strong>extrinsic-yzx</strong> <em><var>q</var></em><a href='#index-extrinsic_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dyzy"><span class="category">Procedure: </span><span><strong>extrinsic-yzy</strong> <em><var>q</var></em><a href='#index-extrinsic_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dzxy-1"><span class="category">Procedure: </span><span><strong>extrinsic-zxy</strong> <em><var>q</var></em><a href='#index-extrinsic_002dzxy-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dzxz"><span class="category">Procedure: </span><span><strong>extrinsic-zxz</strong> <em><var>q</var></em><a href='#index-extrinsic_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dzyx"><span class="category">Procedure: </span><span><strong>extrinsic-zyx</strong> <em><var>q</var></em><a href='#index-extrinsic_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-extrinsic_002dzyz"><span class="category">Procedure: </span><span><strong>extrinsic-zyz</strong> <em><var>q</var></em><a href='#index-extrinsic_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions decompose the rotation represented by <var>q</var> into
extrinsic angles of the given set and returns the three angles as
multiple values.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dextrinsic_002dxyx"><span class="category">Procedure: </span><span><strong>make-extrinsic-xyx</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dxyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dxyz"><span class="category">Procedure: </span><span><strong>make-extrinsic-xyz</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dxyz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dxzx"><span class="category">Procedure: </span><span><strong>make-extrinsic-xzx</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dxzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dxzy"><span class="category">Procedure: </span><span><strong>make-extrinsic-xzy</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dxzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dyxy"><span class="category">Procedure: </span><span><strong>make-extrinsic-yxy</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dyxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dyxz"><span class="category">Procedure: </span><span><strong>make-extrinsic-yxz</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dyxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dyzx"><span class="category">Procedure: </span><span><strong>make-extrinsic-yzx</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dyzx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dyzy"><span class="category">Procedure: </span><span><strong>make-extrinsic-yzy</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dyzy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dzxy"><span class="category">Procedure: </span><span><strong>make-extrinsic-zxy</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dzxy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dzxz"><span class="category">Procedure: </span><span><strong>make-extrinsic-zxz</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dzxz' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dzyx"><span class="category">Procedure: </span><span><strong>make-extrinsic-zyx</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dzyx' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dextrinsic_002dzyz"><span class="category">Procedure: </span><span><strong>make-extrinsic-zyz</strong> <em><var>gamma</var> <var>beta</var> <var>alpha</var></em><a href='#index-make_002dextrinsic_002dzyz' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>These functions return quaternions representing the given extrinsic
angle rotations.
</p></dd></dl>

<dl class="def">
<dt id="index-rpy"><span class="category">Alias: </span><span><strong>rpy</strong><a href='#index-rpy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002drpy"><span class="category">Alias: </span><span><strong>make-rpy</strong><a href='#index-make_002drpy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Aliases for <code>extrinsic-xyz</code> and <code>make-extrinsic-xyz</code>.
</p>
<div class="example">
<pre class="example">(let ((r (make-rpy 0.12 -0.23 0.34)))
  (let-values (((a b c) (tait-bryan-zyx r)))
    (list a b c))) &rArr; (0.3400000000000001 -0.2300000000000001 0.12000000000000002)
</pre></div>
</dd></dl>

</div>
<div class="subsubsection" id="Rotation-Operations">
<h4 class="subsubsection">12.4.2.2 Rotation Operations</h4>

<dl class="def">
<dt id="index-rotate_002dvector"><span class="category">Procedure: </span><span><strong>rotate-vector</strong> <em><var>rq</var> <var>vq</var></em><a href='#index-rotate_002dvector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Applies the rotation represented by quaternion <var>rq</var> to the vector
represented by vector quaternion <var>vq</var>, and returns the rotated
vector.  This is equivalent to <code>(* rq vq (conjugate rq))</code> for
normalized <var>rq</var>.
</p>
<div class="example">
<pre class="example">(rotate-vector +k +2i)                      &rArr; -2i
(rotate-vector 1/2+1/2i+1/2j+1/2k +i+2j+3k) &rArr; +3.0i+1.0j+2.0k
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-make_002drotation_002dprocedure"><span class="category">Procedure: </span><span><strong>make-rotation-procedure</strong> <em><var>rq</var></em><a href='#index-make_002drotation_002dprocedure' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A partial application of <code>rotate-vector</code>.  Returns a
single-argument procedure which will take a vector quaternion argument
and rotate it by <var>rq</var>.  The returned procedure closes over both
<var>rq</var> and its conjugate, so this will likely be more efficient than
<code>rotate-vector</code> at rotating many vectors by the same rotation.
</p></dd></dl>

<hr>
</div>
</div>
</div>
<div class="section" id="Quantities">
<div class="header">
<p>
Next: <a href="#Logical-Number-Operations" accesskey="n" rel="next">Logical Number Operations</a>, Previous: <a href="#Quaternions" accesskey="p" rel="prev">Quaternions</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Quantities-and-Units"></span><h3 class="section">12.5 Quantities and Units</h3>

<p>As a super-class of numbers, Kawa also provides quantities.
A <em>quantity</em> is a product of a <em>unit</em> and a pure number.
The number part can be an arbitrary complex number.
The unit is a product of integer powers of base units,
such as meter or second.
</p>
<p>Quantity literals have the following syntax:
</p><div class="display">
<pre class="display"><span id="index-quantity-1"></span><span id="meta_002dquantity"></span><var>quantity</var> <tt>::=</tt> <a href="#meta_002doptional_002dsign"><var>optional-sign</var></a> <a href="#meta_002ddecimal"><var>decimal</var></a> <a href="#meta_002dunit_002dterm"><var>unit-term</var></a> [<code><b>*</b></code> <a href="#meta_002dunit_002dterm"><var>unit-term</var></a>]... [<code><b>/</b></code> <a href="#meta_002dunit_002dterm"><var>unit-term</var></a>]
<span id="index-unit_002dterm"></span><span id="meta_002dunit_002dterm"></span><var>unit-term</var> <tt>::=</tt> <a href="#meta_002dunit_002dname"><var>unit-name</var></a> [<code><b>^</b></code> <a href="#meta_002ddigit"><var>digit</var></a>+]
<span id="index-unit_002dname"></span><span id="meta_002dunit_002dname"></span><var>unit-name</var> <tt>::=</tt> <a href="#meta_002dletter"><var>letter</var></a>+
</pre></div>
<p>Some examples are <code>10pt</code> (10 points), <code>5s</code> (5 seconds),
and <code>4cm^2</code> (4 square centimeters).
</p>
<p>Note the <var>quantity</var> syntax is not recognized by the reader.
Instead these are read as symbols.
Assuming there is no lexical binding the for the symbol, it will be
rewritten at compile-time into an expression.  For example <code>4cm^2</code>
is transformed into:
</p><div class="example">
<pre class="example">(* 4.0 (expt unit:cm 2))
</pre></div>

<dl class="def">
<dt id="index-quantity_003f"><span class="category">Procedure: </span><span><strong>quantity?</strong> <em>object</em><a href='#index-quantity_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>True iff <var>object</var> is a quantity.  Note that all numbers are
quantities, but not the other way round.
Currently, there are no quantities that are not numbers.
To distinguish a plain unit-less number from a quantity,
you can use <code>complex?</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-quantity_002d_003enumber"><span class="category">Procedure: </span><span><strong>quantity-&gt;number</strong> <em>q</em><a href='#index-quantity_002d_003enumber' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the pure number part of the quantity <var>q</var>, relative to
primitive (base) units.
If <var>q</var> is a number, returns <var>q</var>.
If <var>q</var> is a unit, yields the magitude of <var>q</var> relative to base units.
</p></dd></dl>

<dl class="def">
<dt id="index-quantity_002d_003eunit"><span class="category">Procedure: </span><span><strong>quantity-&gt;unit</strong> <em>q</em><a href='#index-quantity_002d_003eunit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the unit of the quantity <var>q</var>.
If <var>q</var> is a number, returns the empty unit.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dquantity"><span class="category">Procedure: </span><span><strong>make-quantity</strong> <em>x unit</em><a href='#index-make_002dquantity' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the product of <var>x</var> (a pure number) and <var>unit</var>.
You can specify a string instead of <var>unit</var>, such as <code>&quot;cm&quot;</code>
or <code>&quot;s&quot;</code> (seconds).
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dbase_002dunit"><span class="category">Syntax: </span><span><strong>define-base-unit</strong> <em>unit-name dimension</em><a href='#index-define_002dbase_002dunit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Define <var>unit-name</var> as a base (primitive) unit,
which is used to measure along the specified <var>dimension</var>.
</p><div class="example">
<pre class="example">(define-base-unit dollar &quot;Money&quot;)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-define_002dunit"><span class="category">Syntax: </span><span><strong>define-unit</strong> <em>unit-name expression</em><a href='#index-define_002dunit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Define <var>unit-name</var> as a unit (that can be used in literals)
equal to the quantity <var>expression</var>.
</p><div class="example">
<pre class="example">(define-unit cent 0.01dollar)
</pre></div>
<p>The <var>unit-name</var> is declared in the <code>unit</code> namespace,
so the above is equivalent to:
</p><div class="example">
<pre class="example">(define-constant unit:cent (* 0.01 unit:dollar))
</pre></div>
</dd></dl>

<span id="Angles"></span><h4 class="subheading">Angles</h4>

<p>The following angle units are dimensionless, with no base unit.
</p>
<p>Some procedures treat a unit-less real number as if it were in radians
(which mathematicians prefer);
some procedures (such as <code>rotate</code>) treat a unit-less real number
as if it were in degrees
(which is common in Web and other standards).
</p>
<dl class="def">
<dt id="index-rad"><span class="category">Unit: </span><span><strong>rad</strong><a href='#index-rad' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A unit for angles specified in radians.
A full circle is 2*pi radians.
Note that <code>(= 1.5 1.5rad)</code> is true,
while <code>(eqv? 1.5 1.5rad)</code> is false.
</p></dd></dl>

<dl class="def">
<dt id="index-deg"><span class="category">Unit: </span><span><strong>deg</strong><a href='#index-deg' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A unit for angles specified in degrees.
A full circle is 360 degrees.
</p></dd></dl>

<dl class="def">
<dt id="index-grad"><span class="category">Unit: </span><span><strong>grad</strong><a href='#index-grad' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A unit for angles specified in gradians.
A full circle is 400 gradians.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Logical-Number-Operations">
<div class="header">
<p>
Next: <a href="#Performance-of-numeric-operations" accesskey="n" rel="next">Performance of numeric operations</a>, Previous: <a href="#Quantities" accesskey="p" rel="prev">Quantities and Units</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Logical-Number-Operations-1"></span><h3 class="section">12.6 Logical Number Operations</h3>

<p>These functions operate on the 2&rsquo;s complement binary representation
of an exact integer.
</p>
<dl class="def">
<dt id="index-bitwise_002dnot"><span class="category">Procedure: </span><span><strong>bitwise-not</strong> <em>i</em><a href='#index-bitwise_002dnot' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the bit-wise logical inverse of the argument.
More formally, returns the exact integer whose two&rsquo;s
complement representation is the one&rsquo;s complement of the two&rsquo;s
complement representation of <var>i</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-bitwise_002dand"><span class="category">Procedure: </span><span><strong>bitwise-and</strong> <em>i ...</em><a href='#index-bitwise_002dand' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-bitwise_002dior"><span class="category">Procedure: </span><span><strong>bitwise-ior</strong> <em>i ...</em><a href='#index-bitwise_002dior' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-bitwise_002dxor"><span class="category">Procedure: </span><span><strong>bitwise-xor</strong> <em>i ...</em><a href='#index-bitwise_002dxor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return the exact integer that is the bit-wise
&ldquo;and&rdquo;, &ldquo;inclusive or&rdquo;, or &ldquo;exclusive or&rdquo; of the two&rsquo;s
complement representations of their arguments.
If they are passed only one argument, they return that argument.
If they are passed no arguments, they return the integer
that acts as identity for the operation: -1, 0, or 0, respectively. 
</p></dd></dl>

<dl class="def">
<dt id="index-bitwise_002dif"><span class="category">Procedure: </span><span><strong>bitwise-if</strong> <em>i1 i2 i3</em><a href='#index-bitwise_002dif' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Returns the exact integer that is the bit-wise &ldquo;if&rdquo; of the twos
complement representations of its arguments, i.e. for each bit, if it
is 1 in i1, the corresponding bit in i2 becomes the value of the
corresponding bit in the result, and if it is 0, the corresponding bit
in i3 becomes the corresponding bit in the value of the result. This
is equivaent to the following computation:
</p><div class="example">
<pre class="example">(bitwise-ior (bitwise-and i1 i2)
             (bitwise-and (bitwise-not i1) i3))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dbit_002dcount"><span class="category">Procedure: </span><span><strong>bitwise-bit-count</strong> <em>i</em><a href='#index-bitwise_002dbit_002dcount' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If i is non-negative, returns the number of 1 bits in the twos complement
representation of i. Otherwise it returns the result of the following
computation:
</p><div class="example">
<pre class="example">(bitwise-not (bitwise-bit-count (bitwise-not i)))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dlength"><span class="category">Procedure: </span><span><strong>bitwise-length</strong> <em>i</em><a href='#index-bitwise_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the number of bits needed to represent i if it is positive,
and the number of bits needed to represent <code>(bitwise-not <var>i</var>)</code>
if it is negative, which is the exact integer that is the result of the
following computation:
</p><div class="example">
<pre class="example">(do ((result 0 (+ result 1))
     (bits (if (negative? i)
               (bitwise-not i)
               ei)
           (bitwise-arithmetic-shift bits -1)))
    ((zero? bits)
     result))
</pre></div>
<p>This is the number of bits needed to represent <var>i</var> in an unsigned field.
</p></dd></dl>

<dl class="def">
<dt id="index-bitwise_002dfirst_002dbit_002dset"><span class="category">Procedure: </span><span><strong>bitwise-first-bit-set</strong> <em>i</em><a href='#index-bitwise_002dfirst_002dbit_002dset' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the index of the least significant 1 bit in the twos complement
representation of i. If i is 0, then - 1 is returned.
</p><div class="example">
<pre class="example">(bitwise-first-bit-set 0) &rArr; -1
(bitwise-first-bit-set 1) &rArr; 0
(bitwise-first-bit-set -4) &rArr; 2
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dbit_002dset_003f"><span class="category">Procedure: </span><span><strong>bitwise-bit-set?</strong> <em>i1 i2</em><a href='#index-bitwise_002dbit_002dset_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if the i2&rsquo;th bit (where <var>i2</var> must be non-negative)
is 1 in the two&rsquo;s complement representation of <var>i1</var>, and <code>#f</code>
otherwise. This is the result of the following computation:
</p><div class="example">
<pre class="example">(not (zero?
       (bitwise-and
         (bitwise-arithmetic-shift-left 1 i2)
         i1)))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dcopy_002dbit"><span class="category">Procedure: </span><span><strong>bitwise-copy-bit</strong> <em>i bitno replacement-bit</em><a href='#index-bitwise_002dcopy_002dbit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the result of replacing the <var>bitno</var>&rsquo;th bit of <var>i</var>
by <var>replacement-bit</var>, where <var>bitno</var> must be non-negative,
and <var>replacement-bit</var> must be either 0 or 1.
This is the result of the following computation:
</p><div class="example">
<pre class="example">(let* ((mask (bitwise-arithmetic-shift-left 1 bitno)))
  (bitwise-if mask
            (bitwise-arithmetic-shift-left replacement-bit bitno)
            i))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>bitwise-bit-field</strong> <em>n start end</em><a href='#index-bitwise_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the integer formed from the (unsigned) bit-field
starting at <var>start</var> and ending just before <var>end</var>.
Same as:
</p><div class="example">
<pre class="example">(let ((mask
       (bitwise-not
        (bitwise-arithmetic-shift-left -1 <var>end</var>))))
  (bitwise-arithmetic-shift-right
    (bitwise-and <var>n</var> mask)
    <var>start</var>))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dcopy_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>bitwise-copy-bit-field</strong> <em>to start end from</em><a href='#index-bitwise_002dcopy_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the result of replacing in <var>to</var> the bits at positions from <var>start</var> (inclusive) to <var>end</var> (exclusive) by the bits in <var>from</var> from position 0 (inclusive) to position <var>end</var> - <var>start</var> (exclusive).
Both <var>start</var> and <var>start</var> must be non-negative,
and <var>start</var> must be less than or equal to <var>start</var>.
</p>
<p>This is the result of the following computation:
</p><div class="example">
<pre class="example">(let* ((mask1
         (bitwise-arithmetic-shift-left -1 start))
       (mask2
         (bitwise-not
           (bitwise-arithmetic-shift-left -1 end)))
       (mask (bitwise-and mask1 mask2)))
  (bitwise-if mask
              (bitwise-arithmetic-shift-left from
                                             start)
              to))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002darithmetic_002dshift"><span class="category">Procedure: </span><span><strong>bitwise-arithmetic-shift</strong> <em>i j</em><a href='#index-bitwise_002darithmetic_002dshift' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Shifts <var>i</var> by <var>j</var>.
It is a &ldquo;left&rdquo; shift if <code><var>j</var>&gt;0</code>, and
a &ldquo;right&rdquo; shift if <code><var>j</var>&lt;0</code>.
The result is equal to <code>(floor (* <var>i</var> (expt 2 <var>j</var>)))</code>.
</p>
<p>Examples:
</p><div class="example">
<pre class="example">(bitwise-arithmetic-shift -6 -1) &rArr;-3
(bitwise-arithmetic-shift -5 -1) &rArr; -3
(bitwise-arithmetic-shift -4 -1) &rArr; -2
(bitwise-arithmetic-shift -3 -1) &rArr; -2
(bitwise-arithmetic-shift -2 -1) &rArr; -1
(bitwise-arithmetic-shift -1 -1) &rArr; -1
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002darithmetic_002dshift_002dleft"><span class="category">Procedure: </span><span><strong>bitwise-arithmetic-shift-left</strong> <em>i amount</em><a href='#index-bitwise_002darithmetic_002dshift_002dleft' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-bitwise_002darithmetic_002dshift_002dright"><span class="category">Procedure: </span><span><strong>bitwise-arithmetic-shift-right</strong> <em>i amount</em><a href='#index-bitwise_002darithmetic_002dshift_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>amount</var> must be non-negative
The <code>bitwise-arithmetic-shift-left</code> procedure returns the same
result as <code>bitwise-arithmetic-shift</code>,
and <code>(bitwise-arithmetic-shift-right <var>i</var> <var>amount</var>)</code> returns the
same result as <code>(bitwise-arithmetic-shift <var>i</var> (- <var>amount</var>))</code>.
</p>
<p>If <var>i</var> is a primitive integer type,
then <var>amount</var> must be less than the number of bits in the
promoted type of <var>i</var> (32 or 64).
If the type is unsigned, an unsigned (logic) shift is
done for <code>bitwise-arithmetic-shift-right</code>,
rather than a signed (arithmetic) shift.
</p></dd></dl>

<dl class="def">
<dt id="index-bitwise_002drotate_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>bitwise-rotate-bit-field</strong> <em>n start end count</em><a href='#index-bitwise_002drotate_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the result of cyclically permuting in <var>n</var> the bits at positions
from <var>start</var> (inclusive) to <var>end</var> (exclusive) by
<var>count</var> bits towards the more significant bits,
<var>start</var> and <var>end</var> must be non-negative,
and <var>start</var> must be less than or equal to <var>end</var>.
This is the result of the following computation:
</p><div class="example">
<pre class="example">(let* ((n     ei1)
       (width (- end start)))
  (if (positive? width)
      (let* ((count (mod count width))
             (field0
               (bitwise-bit-field n start end))
             (field1 (bitwise-arithmetic-shift-left
                       field0 count))
             (field2 (bitwise-arithmetic-shift-right
                       field0
                       (- width count)))
             (field (bitwise-ior field1 field2)))
        (bitwise-copy-bit-field n start end field))
      n))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bitwise_002dreverse_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>bitwise-reverse-bit-field</strong> <em>i start end</em><a href='#index-bitwise_002dreverse_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the result obtained from <var>i</var> by reversing the order of the bits at positions from <var>start</var> (inclusive) to <var>end</var> (exclusive),
where <var>start</var> and <var>end</var> must be non-negative,
and <var>start</var> must be less than or equal to <var>end</var>.
</p><div class="example">
<pre class="example">(bitwise-reverse-bit-field #b1010010 1 4) &rArr;  88 ; #b1011000
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-logop"><span class="category">Procedure: </span><span><strong>logop</strong> <em>op x y</em><a href='#index-logop' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Perform one of the 16 bitwise operations of <var>x</var> and <var>y</var>,
depending on <var>op</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-logtest"><span class="category">Procedure: </span><span><strong>logtest</strong> <em>i j</em><a href='#index-logtest' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns true if the arguments have any bits in common.
Same as <code>(not (zero? (bitwise-and <var>i</var> <var>j</var>)))</code>,
but is more efficient.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#SRFI_002d60-Logical-Number-Operations" accesskey="1">SRFI-60 Logical Number Operations</a></li>
<li><a href="#Deprecated-Logical-Number-Operations" accesskey="2">Deprecated Logical Number Operations</a></li>
</ul>
<div class="subsection" id="SRFI_002d60-Logical-Number-Operations">
<h4 class="subsection">12.6.1 SRFI-60 Logical Number Operations</h4>

<p>Kawa supports SRFI-60 &ldquo;Integers as Bits&rdquo; as well, although we
generally recommend using the R6RS-compatible functions instead when
possible.  Unless noted as being a builtin function, to use these you
must first <code>(require 'srfi-60)</code> or <code>(import (srfi :60))</code>
(or <code>(import (srfi :60 integer-bits))</code>).
</p>
<dl class="def">
<dt id="index-logand"><span class="category">Procedure: </span><span><strong>logand</strong> <em>i ...</em><a href='#index-logand' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-and <var>i</var> ...)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-logior"><span class="category">Procedure: </span><span><strong>logior</strong> <em>i ...</em><a href='#index-logior' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-ior <var>i</var> ...)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-logxor"><span class="category">Procedure: </span><span><strong>logxor</strong> <em>i ...</em><a href='#index-logxor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-xor <var>i</var> ...)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-lognot"><span class="category">Procedure: </span><span><strong>lognot</strong> <em>i</em><a href='#index-lognot' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-not <var>i</var>)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-bitwise_002dmerge"><span class="category">Procedure: </span><span><strong>bitwise-merge</strong> <em>mask i j</em><a href='#index-bitwise_002dmerge' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-if <var>mask</var> <var>i</var> <var>j</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-any_002dbits_002dset_003f"><span class="category">Procedure: </span><span><strong>any-bits-set?</strong> <em>i j</em><a href='#index-any_002dbits_002dset_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(logtest <var>i</var> <var>j</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-logcount"><span class="category">Procedure: </span><span><strong>logcount</strong> <em>i</em><a href='#index-logcount' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-bit_002dcount"><span class="category">Procedure: </span><span><strong>bit-count</strong> <em>i</em><a href='#index-bit_002dcount' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Count the number of 1-bits in <var>i</var>, if it is non-negative.
If <var>i</var> is negative, count number of 0-bits.
Same as <code>(bitwise-bit-count <var>i</var>)</code> if <var>i</var> is non-negative.
Builtin as <code>logcount</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-integer_002dlength"><span class="category">Procedure: </span><span><strong>integer-length</strong> <em>i</em><a href='#index-integer_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-length <var>i</var>)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-log2_002dbinary_002dfactors"><span class="category">Procedure: </span><span><strong>log2-binary-factors</strong> <em>i</em><a href='#index-log2_002dbinary_002dfactors' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-first_002dset_002dbit"><span class="category">Procedure: </span><span><strong>first-set-bit</strong> <em>i</em><a href='#index-first_002dset_002dbit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-first-bit-set <var>i</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-logbit_003f"><span class="category">Procedure: </span><span><strong>logbit?</strong> <em>pos i</em><a href='#index-logbit_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-bit_002dset_003f"><span class="category">Procedure: </span><span><strong>bit-set?</strong> <em>pos i</em><a href='#index-bit_002dset_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-bit-set? <var>i</var> <var>pos</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-copy_002dbit"><span class="category">Procedure: </span><span><strong>copy-bit</strong> <em>bitno i bool</em><a href='#index-copy_002dbit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-copy-bit <var>i</var> <var>bitno</var> (if <var>bool</var> 1 0))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-bit_002dfield"><span class="category">Procedure: </span><span><strong>bit-field</strong> <em>n start end</em><a href='#index-bit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-bit-field <var>n</var> <var>start</var> <var>end</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-copy_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>copy-bit-field</strong> <em>to from start end</em><a href='#index-copy_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-copy-bit-field <var>to</var> <var>start</var> <var>end</var> <var>from</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-arithmetic_002dshift"><span class="category">Procedure: </span><span><strong>arithmetic-shift</strong> <em>i j</em><a href='#index-arithmetic_002dshift' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-arithmetic-shift <var>i</var> <var>j</var>)</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-ash"><span class="category">Procedure: </span><span><strong>ash</strong> <em>i j</em><a href='#index-ash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Alias for <code>arithmetic-shift</code>.  Builtin.
</p></dd></dl>

<dl class="def">
<dt id="index-rotate_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>rotate-bit-field</strong> <em>n count start end</em><a href='#index-rotate_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-rotate-bit-field <var>n</var> <var>start</var> <var>end</var> <var>count</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-reverse_002dbit_002dfield"><span class="category">Procedure: </span><span><strong>reverse-bit-field</strong> <em>i start end</em><a href='#index-reverse_002dbit_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-reverse-bit-field <var>i</var> <var>start</var> <var>end</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-integer_002d_003elist"><span class="category">Procedure: </span><span><strong>integer-&gt;list</strong> <em><var>k</var> [<var>length</var>]</em><a href='#index-integer_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003einteger"><span class="category">Procedure: </span><span><strong>list-&gt;integer</strong> <em><var>list</var></em><a href='#index-list_002d_003einteger' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>integer-&gt;list</code> procedure returns a list of <var>length</var>
booleans corresponding to the bits of the non-negative integer <var>k</var>,
with <code>#t</code> for <code>1</code> and <code>#f</code> for <code>0</code>.  <var>length</var>
defaults to <code>(bitwise-length <var>k</var>)</code>.  The list will be in order
from MSB to LSB, with the value of <code>(odd? <var>k</var>)</code> in the last
car.
</p>
<p>The <code>list-&gt;integer</code> procedure returns the integer corresponding to
the booleans in the list <var>list</var>.
The <code>integer-&gt;list</code> and <code>list-&gt;integer</code> procedures are
inverses so far as <code>equal?</code> is concerned.
</p></dd></dl>

<dl class="def">
<dt id="index-booleans_002d_003einteger"><span class="category">Procedure: </span><span><strong>booleans-&gt;integer</strong> <em>bool1 ...</em><a href='#index-booleans_002d_003einteger' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the integer coded by the <var>bool1</var> ... arguments.
Equivalent to <code>(list-&gt;integer (list <var>bool1</var> ...))</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Deprecated-Logical-Number-Operations">
<h4 class="subsection">12.6.2 Deprecated Logical Number Operations</h4>

<p>This older function is still available, but we
recommend using the R6RS-compatible function.
</p>
<dl class="def">
<dt id="index-bit_002dextract"><span class="category">Procedure: </span><span><strong>bit-extract</strong> <em>n start end</em><a href='#index-bit_002dextract' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Equivalent to <code>(bitwise-bit-field <var>n</var> <var>start</var> <var>end</var>)</code>.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Performance-of-numeric-operations">
<div class="header">
<p>
Previous: <a href="#Logical-Number-Operations" accesskey="p" rel="prev">Logical Number Operations</a>, Up: <a href="#Numbers" accesskey="u" rel="up">Quantities and Numbers</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Performance-of-numeric-operations-1"></span><h3 class="section">12.7 Performance of numeric operations</h3>

<p>Kawa can generally do a pretty good job of generating
efficient code for numeric operations, at least when
it knows or can figure out the types of the operands.
</p>
<p>The basic operations <code>+</code>, <code>-</code>, and <code>*</code>
are compiled to single-instruction bytecode if both
operands are <code>int</code> or <code>long</code>.
Likewise, if both operands are floating-point (or
one is floating-point and the other is rational),
then single-instruction <code>double</code> or <code>float</code>
instructions are emitted.
</p>
<p>A binary operation involving an infinite-precision <code>integer</code>
and a fixed-size <code>int</code> or <code>long</code> is normally
evaluated by expanding the latter to <code>integer</code>
and using <code>integer</code> arithmetic.  An exception is
an integer literal whose
value fits in an <code>int</code> or <code>long</code> - in that case
the operation is done using <code>int</code> or <code>long</code>
arithmetic.
</p>
<p>In general, integer literals have amorphous type.
When used to infer the type of a variable, they have <code>integer</code> type:
</p><div class="example">
<pre class="example">(let ((v1 0))
  ... v1 has type integer ... )
</pre></div>
<p>However, a literal whose value fits in the <code>int</code> or <code>long</code> range
is implicitly viewed <code>int</code> or <code>long</code> in certain contexts,
primarily method overload resolution and binary arithmetic
(as mentioned above).
</p>
<p>The comparison functions <code>&lt;</code>, <code>&lt;=</code>, <code>=</code>,
<code>&gt;</code>, and <code>=&gt;</code> are also optimized to single instriction
operations if the operands have appropriate type.
However, the functions <code>zero?</code>, <code>positive?</code>, and <code>negative?</code>
have not yet been optimized.
Instead of <code>(positive? x)</code> write <code>(&gt; x 0)</code>.
</p>
<p>There are a number of integer division and modulo operations.
If the operands are <code>int</code> or <code>long</code>, it is faster
to use <code>quotient</code> and <code>remainder</code> rather
than <code>div</code> and <code>mod</code> (or <code>modulo</code>).
If you know the first operand is non-negative and the second is positive,
then use <code>quotient</code> and <code>remainder</code>.
(If an operand is an arbitrary-precision <code>integer</code>,
then it dosn&rsquo;t really matter.)
</p>
<p>The logical operations <code>bitwise-and</code>, <code>bitwise-ior</code>,
<code>bitwise-xor</code>, <code>bitwise-not</code>, <code>bitwise-arithmetic-shift-left</code>,
<code>bitwise-arithmetic-shift-right</code> are compiled
to single bitcode instructions if the operands are <code>int</code> or <code>long</code>.
Avoid <code>bitwise-arithmetic-shift</code> if the sign of the shift is known.
If the operands are arbitrary-precision <code>integer</code>,
a library call is needed, but run-time type dispatch is avoided.
</p>
<hr>
</div>
</div>
<div class="chapter" id="Characters-and-text">
<div class="header">
<p>
Next: <a href="#Data-structures" accesskey="n" rel="next">Data structures</a>, Previous: <a href="#Numbers" accesskey="p" rel="prev">Quantities and Numbers</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Characters-and-text-1"></span><h2 class="chapter">13 Characters and text</h2>


<ul class="section-toc">
<li><a href="#Characters" accesskey="1">Characters</a></li>
<li><a href="#Character-sets" accesskey="2">Character sets</a></li>
<li><a href="#Strings" accesskey="3">Strings</a></li>
<li><a href="#String-literals" accesskey="4">String literals</a></li>
<li><a href="#Unicode" accesskey="5">Unicode character classes and conversions</a></li>
<li><a href="#Regular-expressions" accesskey="6">Regular expressions</a></li>
</ul>
<hr>
<div class="section" id="Characters">
<div class="header">
<p>
Next: <a href="#Character-sets" accesskey="n" rel="next">Character sets</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Characters-1"></span><h3 class="section">13.1 Characters</h3>

<p>Characters are objects that represent human-readable characters
such as letters and digits.  More precisely, a character
represents a <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode scalar value</a>. Each character has an integer value
in the range <code>0</code> to <code>#x10FFFF</code>
(excluding the range <code>#xD800</code> to <code>#xDFFF</code>
used for <a href="http://www.unicode.org/glossary/#surrogate_code_point">Surrogate Code Points</a>).
</p>
<blockquote>
<p><em>Note:</em>
Unicode distinguishes
between glyphs, which are printed for humans to read, and characters,
which are abstract entities that map to glyphs (sometimes in a way
that’s sensitive to surrounding characters). Furthermore, different
sequences of scalar values sometimes correspond to the same
character. The relationships among scalar, characters, and glyphs are
subtle and complex.
</p>
<p>Despite this complexity, most things that a literate human would call
a &ldquo;character&rdquo; can be represented by a single Unicode scalar value
(although several sequences of Unicode scalar values may represent
that same character). For example, Roman letters, Cyrillic letters,
Hebrew consonants, and most Chinese characters fall into this
category.
</p>
<p>Unicode scalar values exclude the range <code>#xD800</code> to <code>#xDFFF</code>,
which are part of the range of Unicode <em>code points</em>.
However, the Unicode code points in this range, the so-called
<em>surrogates</em>, are an artifact of the UTF-16 encoding, and can only
appear in specific Unicode encodings, and even then only in pairs that
encode scalar values.  Consequently, all characters represent code
points, but the surrogate code points do not have representations as
characters.
</p></blockquote>

<dl class="def">
<dt id="index-character"><span class="category">Type: </span><span><strong>character</strong><a href='#index-character' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A Unicode code point - normally a Unicode scalar value,
but could be a surrogate.
This is implemented using a 32-bit <code>int</code>.
When an object is needed (i.e. the <em>boxed</em> representation),
it is implemented an instance of <code>gnu.text.Char</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-character_002dor_002deof"><span class="category">Type: </span><span><strong>character-or-eof</strong><a href='#index-character_002dor_002deof' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A <code>character</code> or the specical <code>#!eof</code> value (used to indicate
end-of-file when reading from a port).
This is implemented using a 32-bit <code>int</code>,
where the value -1 indicates end-of-file.
When an object is needed, it is implemented an instance of
<code>gnu.text.Char</code> or the special <code>#!eof</code> object.
</p></dd></dl>

<dl class="def">
<dt id="index-char"><span class="category">Type: </span><span><strong>char</strong><a href='#index-char' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A UTF-16 code unit.  Same as Java primitive <code>char</code> type.
Considered to be a sub-type of <code>character</code>.
When an object is needed, it is implemented as an instance
of <code>java.lang.Character</code>.  Note the unfortunate inconsistency
(for historical reasons) of <code>char</code> boxed as <code>Character</code>
vs <code>character</code> boxed as <code>Char</code>.
</p></dd></dl>

<p>Characters are written using the notation
<code>#\</code><var>character</var> (which stands for the given <var>character</var>;
<code>#\x</code><var>hex-scalar-value</var> (the character whose scalar value
is the given hex integer);
or <code>#\</code><var>character-name</var> (a character with a given name):
</p>
<div class="display">
<pre class="display"><span id="index-character-1"></span><span id="meta_002dcharacter"></span><var>character</var> <tt>::=</tt> <code><b>#\</b></code><var>any-character</var>
        | <code><b>#\</b></code> <var>character-name</var>
        | <code><b>#\x</b></code> <a href="#meta_002dhex_002dscalar_002dvalue"><var>hex-scalar-value</var></a>
        | <code><b>#\X</b></code> <a href="#meta_002dhex_002dscalar_002dvalue"><var>hex-scalar-value</var></a>
</pre></div>

<p>The following <var>character-name</var> forms are recognized:
</p><dl compact="compact">
<dt><span><code><b>#\alarm</b></code></span></dt>
<dd><p><code>#\x0007</code> - the alarm (bell) character
</p></dd>
<dt><span><code><b>#\backspace</b></code></span></dt>
<dd><p><code>#\x0008</code>
</p></dd>
<dt><span><code><b>#\delete</b></code></span></dt>
<dt><span><code><b>#\del</b></code></span></dt>
<dt><span><code><b>#\rubout</b></code></span></dt>
<dd><p><code>#\x007f</code> - the delete or rubout character
</p></dd>
<dt><span><code><b>#\escape</b></code></span></dt>
<dt><span><code><b>#\esc</b></code></span></dt>
<dd><p><code>#\x001b</code>
</p></dd>
<dt><span><code><b>#\newline</b></code></span></dt>
<dt><span><code><b>#\linefeed</b></code></span></dt>
<dd><p><code>#\x001a</code> - the linefeed character
</p></dd>
<dt><span><code><b>#\null</b></code></span></dt>
<dt><span><code><b>#\nul</b></code></span></dt>
<dd><p><code>#\x0000</code> - the null character
</p></dd>
<dt><span><code><b>#\page</b></code></span></dt>
<dd><p><code>#\000c</code> - the formfeed character
</p></dd>
<dt><span><code><b>#\return</b></code></span></dt>
<dd><p><code>#\000d</code> - the carriage return character
</p></dd>
<dt><span><code><b>#\space</b></code></span></dt>
<dd><p><code>#\x0020</code> - the preferred way to write a space
</p></dd>
<dt><span><code><b>#\tab</b></code></span></dt>
<dd><p><code>#\x0009</code> - the tab character
</p></dd>
<dt><span><code><b>#\vtab</b></code></span></dt>
<dd><p><code>#\x000b</code> - the vertical tabulation character
</p></dd>
<dt><span><code><b>#\ignorable-char</b></code></span></dt>
<dd><p>A special <code>character</code> value, but it is not a Unicode code point.
It is a special value returned when an index refers to the second
<code>char</code> (code point) of a surrogate pair, and which should be ignored.
(When writing a <code>character</code> to a string or file,
it will be written as one or two <code>char</code> values.
The exception is <code>#\ignorable-char</code>, for which zero 
<code>char</code> values are written.)
</p></dd>
</dl>

<dl class="def">
<dt id="index-char_003f"><span class="category">Procedure: </span><span><strong>char?</strong> <em><var>obj</var></em><a href='#index-char_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a character, <code>#f</code> otherwise.
(The <var>obj</var> can be any character, not just a 16-bit <code>char</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-char_002d_003einteger"><span class="category">Procedure: </span><span><strong>char-&gt;integer</strong> <em><var>char</var></em><a href='#index-char_002d_003einteger' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-integer_002d_003echar"><span class="category">Procedure: </span><span><strong>integer-&gt;char</strong> <em><var>sv</var></em><a href='#index-integer_002d_003echar' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>sv</var> should be a Unicode scalar value, i.e., a non&ndash;negative exact
integer object in <code>[0, #xD7FF] union [#xE000, #x10FFFF]</code>.
(Kawa also allows values in the surrogate range.)
</p>
<p>Given a character, <code>char-&gt;integer</code> returns its Unicode scalar value
as an exact integer object.  For a Unicode scalar value <var>sv</var>,
<code>integer-&gt;char</code> returns its associated character.
</p>
<div class="example">
<pre class="example">(integer-&gt;char 32)                     &rArr; #\space
(char-&gt;integer (integer-&gt;char 5000))   &rArr; 5000
(integer-&gt;char #\xD800)                &rArr; throws ClassCastException
</pre></div>

<p><em>Performance note:</em> A call to <code>char-&gt;integer</code> is compiled as
casting the argument to a <code>character</code>, and then re-interpreting
that value as an <code>int</code>.
A call to <code>integer-&gt;char</code> is compiled as
casting the argument to an <code>int</code>, and then re-interpreting
that value as an <code>character</code>.
If the argument is the right type, no code is emitted: the value is
just re-interpreted as the result type.
</p></dd></dl>

<dl class="def">
<dt id="index-char_003d_003f"><span class="category">Procedure: </span><span><strong>char=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_003c_003f"><span class="category">Procedure: </span><span><strong>char&lt;?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_003c_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_003e_003f"><span class="category">Procedure: </span><span><strong>char&gt;?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_003e_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_003c_003d_003f"><span class="category">Procedure: </span><span><strong>char&lt;=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_003c_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_003e_003d_003f"><span class="category">Procedure: </span><span><strong>char&gt;=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_003e_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures impose a total ordering on the set of characters
according to their Unicode scalar values.
</p>
<div class="example">
<pre class="example">(char&lt;? #\z #\ß)      &rArr; #t
(char&lt;? #\z #\Z)      &rArr; #f
</pre></div>

<p><em>Performance note:</em>  This is compiled as if converting each
argument using <code>char-&gt;integer</code> (which requires no code)
and the using the corresponing <code>int</code> comparison.
</p></dd></dl>

<dl class="def">
<dt id="index-digit_002dvalue"><span class="category">Procedure: </span><span><strong>digit-value</strong> <em>char</em><a href='#index-digit_002dvalue' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure returns the numeric value (0 to 9) of its
argument if it is a numeric digit (that is, if <code>char-numeric?</code>
returns <code>#t</code>), or <code>#f</code> on any other character.
</p>
<div class="example">
<pre class="example">(digit-value #\3)        &rArr; 3
(digit-value #\x0664)    &rArr; 4
(digit-value #\x0AE6)    &rArr; 0
(digit-value #\x0EA6)    &rArr; #f
</pre></div>

</dd></dl>

<hr>
</div>
<div class="section" id="Character-sets">
<div class="header">
<p>
Next: <a href="#Strings" accesskey="n" rel="next">Strings</a>, Previous: <a href="#Characters" accesskey="p" rel="prev">Characters</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Character-sets-1"></span><h3 class="section">13.2 Character sets</h3>

<p>Sets of characters are useful for text-processing code,
including parsing, lexing, and pattern-matching.
<a href="http://srfi.schemers.org/srfi-14/srfi-14.html">SRFI 14</a> specifies
a <code>char-set</code> type for such uses.  Some examples:
</p>
<div class="example">
<pre class="example">(import (srfi :14 char-sets))
(define vowel (char-set #\a #\e #\i #\o #\u))
(define vowely (char-set-adjoin vowel #\y))
(char-set-contains? vowel #\y) &rArr;  #f
(char-set-contains? vowely #\y) &rArr;  #t
</pre></div>

<p>See the <a href="http://srfi.schemers.org/srfi-14/srfi-14.html">SRFI 14 specification</a> for details.
</p>
<dl class="def">
<dt id="index-char_002dset"><span class="category">Type: </span><span><strong>char-set</strong><a href='#index-char_002dset' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of character sets.
In Kawa <code>char-set</code> is a type that can be used in type specifiers:
</p><div class="example">
<pre class="example">(define vowely ::char-set (char-set-adjoin vowel #\y))
</pre></div>
</dd></dl>

<p>Kawa uses <a href="https://en.wikipedia.org/wiki/Inversion_list">inversion lists</a> for an efficient implementation, using Java <code>int</code> arrays
to represents character ranges (inversions).
The <code>char-set-contains?</code> function uses binary search,
so it takes time proportional to the logarithm of the number of inversions.
Other operations may take time proportional to the number of inversions.
</p>
<hr>
</div>
<div class="section" id="Strings">
<div class="header">
<p>
Next: <a href="#String-literals" accesskey="n" rel="next">String literals</a>, Previous: <a href="#Character-sets" accesskey="p" rel="prev">Character sets</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Strings-1"></span><h3 class="section">13.3 Strings</h3>

<p>Strings are sequences of characters.  The <em>length</em> of a string is
the number of characters that it contains, as an exact non-negative integer.
The <em>valid indices</em> of a string are the
exact non-negative integers less than the length of the string.
The first character of a
string has index 0, the second has index 1, and so on.
</p>
<p>Strings are <em>implemented</em> as a sequence of 16-bit <code>char</code> values,
even though they&rsquo;re semantically a sequence of 32-bit Unicode code points.
A character whose value is greater than <code>#xffff</code>
is represented using two surrogate characters.
The implementation allows for natural interoperability with Java APIs.
However it does make certain operations (indexing or counting based on
character counts) difficult to implement efficiently.  Luckily one
rarely needs to index or count based on character counts;
alternatives are discussed below.
</p>
<span id="index-istring"></span>
<span id="index-mstring"></span>
<p>There are different kinds of strings:
</p><ul>
<li> An <em>istring</em> is <em>immutable</em>:
It is fixed, and cannot be modified.
On the other hand, indexing (e.g. <code>string-ref</code>) is efficient (constant-time),
while indexing of other string implementations takes time proportional
to the index.

<p>String literals are istrings, as are the return values of
most of the procedures in this chapter.
</p>
<p>An <em>istring</em> is an instance of the <code>gnu.lists.IString</code> class.
</p>
</li><li> An <em>mstring</em> is <em>mutable</em>:
You can replace individual characters (using <code>string-set!</code>).
You can also change the <var>mstring</var>&rsquo;s length by inserting
or removing characters (using <code>string-append!</code> or <code>string-replace!</code>).

<p>An <em>mstring</em> is an instance of the <code>gnu.lists.FString</code> class.
</p>
</li><li> Any other object that implements the <code>java.lang.CharSequence</code> interface
is also a string.
This includes standard Java <code>java.lang.String</code>
and <code>java.lang.StringBuilder</code> objects.
</li></ul>

<p>Some of the procedures that operate on strings ignore the
difference between upper and lower case. The names of
the versions that ignore case end with “<code>-ci</code>” (for “case
insensitive”).
</p>
<p><em>Compatibility:</em>
Many of the following procedures (for example <code>string-append</code>)
return an immutable istring in Kawa,
but return a &ldquo;freshly allocated&rdquo; mutable string in
standard Scheme (include R7RS) as well as most Scheme implementations
(including previous versions of Kawa).
To get the  &ldquo;compatibility mode&rdquo; versions of those procedures
(which return mstrings),
invoke Kawa with one the <code>--r5rs</code>, <code>--r6rs</code>, or <code>--r7rs</code>
options, or you can <code>import</code> a standard library like <code>(scheme base)</code>.
</p>
<dl class="def">
<dt id="index-string"><span class="category">Type: </span><span><strong>string</strong><a href='#index-string' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of string objects.
The underlying type is the interface <code>java.lang.CharSequence</code>.
Immultable strings are <code>gnu.lists.IString</code> or <code>java.lang.String</code>,
while mutable strings are <code>gnu.lists.FString</code>.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Basic-string-procedures" accesskey="1">Basic string procedures</a></li>
<li><a href="#Immutable-String-Constructors" accesskey="2">Immutable String Constructors</a></li>
<li><a href="#Selection" accesskey="3">Selection</a></li>
<li><a href="#String-Comparisons" accesskey="4">String Comparisons</a></li>
<li><a href="#Conversions" accesskey="5">Conversions</a></li>
<li><a href="#Searching-and-matching" accesskey="6">Searching and matching</a></li>
<li><a href="#Concatenation-and-replacing" accesskey="7">Concatenation and replacing</a></li>
<li><a href="#Mapping-and-folding" accesskey="8">Mapping and folding</a></li>
<li><a href="#Replication-_0026-splitting" accesskey="9">Replication &amp; splitting</a></li>
<li><a href="#String-mutation">String mutation</a></li>
<li><a href="#Strings-as-sequences">Strings as sequences</a></li>
<li><a href="#String-Cursor-API-1">String Cursor API</a></li>
</ul>
<div class="subsection" id="Basic-string-procedures">
<h4 class="subsection">13.3.1 Basic string procedures</h4>

<dl class="def">
<dt id="index-string_003f"><span class="category">Procedure: </span><span><strong>string?</strong> <em><var>obj</var></em><a href='#index-string_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a string, <code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-istring_003f"><span class="category">Procedure: </span><span><strong>istring?</strong> <em><var>obj</var></em><a href='#index-istring_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a istring (a immutable, constant-time-indexable string); <code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-string-1"><span class="category">Constructor: </span><span><strong>string</strong> <em><var>char</var> &hellip;</em><a href='#index-string-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a string composed of the arguments.
This is analogous to <var>list</var>.
</p>
<p><em>Compatibility:</em> The result is an istring,
except in compatibility mode, when it is a new allocated mstring.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dlength"><span class="category">Procedure: </span><span><strong>string-length</strong> <em><var>string</var></em><a href='#index-string_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the number of characters in the given <var>string</var> as an exact
integer object.
</p>
<p><em>Performance note:</em> If the <var>string</var> is not an istring,
the calling <code>string-length</code> may take time proportional
to the length of the <var>string</var>,
because of the need to scan for surrogate pairs.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dref"><span class="category">Procedure: </span><span><strong>string-ref</strong> <em><var>string</var> <var>k</var></em><a href='#index-string_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>k</var> must be a valid index of <var>string</var>.  The <code>string-ref</code>
procedure returns character <var>k</var> of <var>string</var> using zero&ndash;origin
indexing.
</p>
<p><em>Performance note:</em> If the <var>string</var> is not an istring,
then calling <code>string-ref</code> may take time proportional
to <var>k</var> because of the need to check for surrogate pairs.
An alternative is to use <code>string-cursor-ref</code>.
If iterating through a string, use <code>string-for-each</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dnull_003f"><span class="category">Procedure: </span><span><strong>string-null?</strong> <em><var>string</var></em><a href='#index-string_002dnull_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Is <var>string</var> the empty string?
Same result as <code>(= (string-length <var>string</var>) 0)</code> but
executes in O(1) time.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002devery"><span class="category">Procedure: </span><span><strong>string-every</strong> <em>pred string [start end])</em><a href='#index-string_002devery' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dany"><span class="category">Procedure: </span><span><strong>string-any</strong> <em>pred string [start end])</em><a href='#index-string_002dany' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Checks to see if every/any character in <var>string</var> satisfies <var>pred</var>,
proceeding from left (index <var>start</var>) to right (index <var>end</var>). These
procedures are short-circuiting: if <var>pred</var> returns false,
<code>string-every</code> does not call <var>pred</var> on subsequent characters;
if <var>pred</var> returns true, <code>string-any</code> does not call <var>pred</var>
on subsequent characters. Both procedures are &ldquo;witness-generating&rdquo;:
</p><ul>
<li> If <code>string-every</code> is given an empty interval (with <var>start</var> = <var>end</var>),
it returns <code>#t</code>.
</li><li> If <code>string-every</code> returns true for a non-empty interval
(with <var>start</var> &lt; <var>end</var>), the returned true value is the one returned by the final call to the predicate on
<code>(string-ref <var>string</var> (- <var>end</var> 1))</code>.
</li><li> If <code>string-any</code> returns true, the returned true value is the one
returned by the predicate.
</li></ul>

<p><em>Note:</em> The names of these procedures do not end with a question
mark. This indicates a general value is returned instead of a simple
boolean (<code>#t</code> or <code>#f</code>).
</p></dd></dl>

</div>
<div class="subsection" id="Immutable-String-Constructors">
<h4 class="subsection">13.3.2 Immutable String Constructors</h4>

<dl class="def">
<dt id="index-string_002dtabulate"><span class="category">Procedure: </span><span><strong>string-tabulate</strong> <em>proc len</em><a href='#index-string_002dtabulate' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Constructs a string of size <var>len</var> by calling <var>proc</var> on
each value from 0 (inclusive) to <var>len</var> (exclusive) to produce
the corresponding element of the string.
The procedure <var>proc</var> accepts an exact integer as its argument and returns a character.
The order in which <var>proc</var> is called on those indexes is not specifified.
</p>
<p><em>Rationale:</em> Although <code>string-unfold</code> is more general,
<code>string-tabulate</code> is likely to run faster for the common special
case it implements.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dunfold"><span class="category">Procedure: </span><span><strong>string-unfold</strong> <em>stop? mapper successor seed [base make-final]</em><a href='#index-string_002dunfold' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dunfold_002dright"><span class="category">Procedure: </span><span><strong>string-unfold-right</strong> <em>stop? mapper successor seed [base make-final]</em><a href='#index-string_002dunfold_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This is a fundamental and powerful constructor for strings.
</p><ul>
<li> <var>successor</var> is used to generate a series of &ldquo;seed&rdquo; values from the initial seed:
<var>seed</var>, <code>(</code><var>successor</var> <var>seed</var><code>)</code>, <code>(</code><var>successor</var><sup>2</sup> <var>seed</var><code>)</code>, <code>(</code><var>successor</var><sup>3</sup> <var>seed</var><code>)</code>, ...
</li><li> <var>stop?</var> tells us when to stop — when it returns true when applied to one of these seed values.
</li><li> <var>mapper</var> maps each seed value to the corresponding character(s) in the result string, which are assembled into that string in left-to-right order. It is an error for <var>mapper</var> to return anything other than a character or string.
</li><li> <var>base</var> is the optional initial/leftmost portion of the constructed string, which defaults to the empty string <code>&quot;&quot;</code>.
It is an error if <var>base</var> is anything other than a character or string.
</li><li> <var>make-final</var> is applied to the terminal seed value (on which <var>stop?</var> returns true) to produce the final/rightmost portion of the constructed string. It defaults to <code>(lambda (x) &quot;&quot;)</code>.
It is an error for <var>make-final</var> to return anything other than
a character or string.
</li></ul>

<p><code>string-unfold-right</code> is the same as <code>string-unfold</code> except the
results of <var>mapper</var> are assembled into the string in right-to-left order,
<var>base</var> is the optional rightmost portion of the constructed string, and
<var>make-final</var> produces the leftmost portion of the constructed string.
</p>
<p>You can use it <code>string-unfold</code> to convert a list to a string,
read a port into a string, reverse a string, copy a string, and so forth.
Examples:
</p><div class="example">
<pre class="example">(define (port-&gt;string p)
  (string-unfold eof-object? values
                 (lambda (x) (read-char p))
                 (read-char p)))

(define (list-&gt;string lis)
  (string-unfold null? car cdr lis))

(define (string-tabulate f size)
  (string-unfold (lambda (i) (= i size)) f add1 0))
</pre></div>
<p>To map <var>f</var> over a list <var>lis</var>, producing a string:
</p><div class="example">
<pre class="example">(string-unfold null? (compose <var>f</var> car) cdr <var>lis</var>)
</pre></div>

<p>Interested functional programmers may enjoy noting that <code>string-fold-right</code>
and <code>string-unfold</code> are in some sense inverses.
That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying
</p><div class="example">
<pre class="example">(<var>kons</var> (<var>kar</var> x) (<var>kdr</var> x)) = x  and  (<var>knull?</var> <var>knil</var>) = #t
</pre></div>
<p>then
</p><div class="example">
<pre class="example">(string-fold-right <var>kons</var> <var>knil</var> (string-unfold <var>knull?</var> <var>kar</var> <var>kdr</var> <var>x</var>)) = <var>x</var>
</pre></div>
<p>and
</p><div class="example">
<pre class="example">(string-unfold <var>knull?</var> <var>kar</var> <var>kdr</var> (string-fold-right <var>kons</var> <var>knil</var> <var>string</var>)) = <var>string</var>.
</pre></div>

<p>This combinator pattern is sometimes called an &ldquo;anamorphism.&rdquo;
</p>
</dd></dl>

</div>
<div class="subsection" id="Selection">
<h4 class="subsection">13.3.3 Selection</h4>

<dl class="def">
<dt id="index-substring"><span class="category">Procedure: </span><span><strong>substring</strong> <em><var>string</var> <var>start</var> <var>end</var></em><a href='#index-substring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>string</var> must be a string, and <var>start</var> and <var>end</var> must be
exact integer objects satisfying:
</p>
<div class="example">
<pre class="example">0 &lt;= <var>start</var> &lt;= <var>end</var> &lt;= (string-length <var>string</var>)
</pre></div>

<p>The <code>substring</code> procedure returns a newly allocated string formed
from the characters of <var>string</var> beginning with index <var>start</var>
(inclusive) and ending with index <var>end</var> (exclusive).
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dtake"><span class="category">Procedure: </span><span><strong>string-take</strong> <em>string nchars</em><a href='#index-string_002dtake' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002ddrop"><span class="category">Procedure: </span><span><strong>string-drop</strong> <em>string nchars</em><a href='#index-string_002ddrop' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dtake_002dright"><span class="category">Procedure: </span><span><strong>string-take-right</strong> <em>string nchars</em><a href='#index-string_002dtake_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002ddrop_002dright"><span class="category">Procedure: </span><span><strong>string-drop-right</strong> <em>string nchars</em><a href='#index-string_002ddrop_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><code>string-take</code> returns an immutable string containing the
first <var>nchars</var> of <var>string</var>;
<code>string-drop</code> returns a string containing all but the first <var>nchars</var>
of <var>string</var>.
<code>string-take-right</code> returns a string containing the last <var>nchars</var>
of <var>string</var>; <code>string-drop-right</code> returns a string containing all
but the last <var>nchars</var> of <var>string</var>.
</p>
<div class="example">
<pre class="example">(string-take &quot;Pete Szilagyi&quot; 6) &rArr; &quot;Pete S&quot;
(string-drop &quot;Pete Szilagyi&quot; 6) &rArr; &quot;zilagyi&quot;

(string-take-right &quot;Beta rules&quot; 5) &rArr; &quot;rules&quot;
(string-drop-right &quot;Beta rules&quot; 5) &rArr; &quot;Beta &quot;
</pre></div>
<p>It is an error to take or drop more characters than are in the string:
</p><div class="example">
<pre class="example">(string-take &quot;foo&quot; 37) &rArr; <i>error</i>
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dpad"><span class="category">Procedure: </span><span><strong>string-pad</strong> <em>string len [char start end]</em><a href='#index-string_002dpad' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dpad_002dright"><span class="category">Procedure: </span><span><strong>string-pad-right</strong> <em>string len [char start end]</em><a href='#index-string_002dpad_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an istring of length <var>len</var> comprised of the characters
drawn from the given subrange of <var>string</var>,
padded on the left (right) by as many occurrences of the
character <var>char</var> as needed.
If <var>string</var> has more than <var>len</var> chars, it is truncated on the
left (right) to length <var>len</var>.
The <var>char</var> defaults to <code>#\space</code>
</p><div class="example .">
<pre class="example">(string-pad     &quot;325&quot; 5) &rArr; &quot;  325&quot;
(string-pad   &quot;71325&quot; 5) &rArr; &quot;71325&quot;
(string-pad &quot;8871325&quot; 5) &rArr; &quot;71325&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dtrim"><span class="category">Procedure: </span><span><strong>string-trim</strong> <em>string [pred start end]</em><a href='#index-string_002dtrim' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dtrim_002dright"><span class="category">Procedure: </span><span><strong>string-trim-right</strong> <em>string [pred start end]</em><a href='#index-string_002dtrim_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dtrim_002dboth"><span class="category">Procedure: </span><span><strong>string-trim-both</strong> <em>string [pred start end]</em><a href='#index-string_002dtrim_002dboth' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an istring obtained from the given subrange of <var>string</var>
by skipping over all characters on the left / on the right / on both sides that satisfy the second argument <var>pred</var>:
<var>pred</var> defaults to <code>char-whitespace?</code>.
</p><div class="example">
<pre class="example">(string-trim-both &quot;  The outlook wasn't brilliant,  \n\r&quot;)
    &rArr; &quot;The outlook wasn't brilliant,&quot;
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="String-Comparisons">
<h4 class="subsection">13.3.4 String Comparisons</h4>

<dl class="def">
<dt id="index-string_003d_003f"><span class="category">Procedure: </span><span><strong>string=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if the strings are the same length and contain the same
characters in the same positions.  Otherwise, the <code>string=?</code>
procedure returns <code>#f</code>.
</p>
<div class="example">
<pre class="example">(string=? &quot;Straße&quot; &quot;Strasse&quot;)    &rArr; #f
</pre></div>
</dd></dl>


<dl class="def">
<dt id="index-string_003c_003f"><span class="category">Procedure: </span><span><strong>string&lt;?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_003c_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_003e_003f"><span class="category">Procedure: </span><span><strong>string&gt;?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_003e_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_003c_003d_003f"><span class="category">Procedure: </span><span><strong>string&lt;=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_003c_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_003e_003d_003f"><span class="category">Procedure: </span><span><strong>string&gt;=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_003e_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return <code>#t</code> if their arguments are (respectively):
monotonically increasing, monotonically decreasing,
monotonically non-decreasing, or monotonically nonincreasing.
These predicates are required to be transitive.
</p>
<p>These procedures are the lexicographic extensions to strings of the
corresponding orderings on characters.  For example, <code>string&lt;?</code> is
the lexicographic ordering on strings induced by the ordering
<code>char&lt;?</code> on characters.  If two strings differ in length but are
the same up to the length of the shorter string, the shorter string is
considered to be lexicographically less than the longer string.
</p>
<div class="example">
<pre class="example">(string&lt;? &quot;z&quot; &quot;ß&quot;)      &rArr; #t
(string&lt;? &quot;z&quot; &quot;zz&quot;)     &rArr; #t
(string&lt;? &quot;z&quot; &quot;Z&quot;)      &rArr; #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dci_003d_003f"><span class="category">Procedure: </span><span><strong>string-ci=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_002dci_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dci_003c_003f"><span class="category">Procedure: </span><span><strong>string-ci&lt;?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_002dci_003c_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dci_003e_003f"><span class="category">Procedure: </span><span><strong>string-ci&gt;?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_002dci_003e_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dci_003c_003d_003f"><span class="category">Procedure: </span><span><strong>string-ci&lt;=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_002dci_003c_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dci_003e_003d_003f"><span class="category">Procedure: </span><span><strong>string-ci&gt;=?</strong> <em><var>string</var><sub>1</sub> <var>string</var><sub>2</sub> <var>string</var><sub>3</sub> &hellip;</em><a href='#index-string_002dci_003e_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures are similar to <code>string=?</code>, etc.,
but behave as if they applied <code>string-foldcase</code> to their arguments
before invoking the corresponding procedures without <code>-ci</code>.
</p>
<div class="example">
<pre class="example">(string-ci&lt;? &quot;z&quot; &quot;Z&quot;)                   &rArr; #f
(string-ci=? &quot;z&quot; &quot;Z&quot;)                   &rArr; #t
(string-ci=? &quot;Straße&quot; &quot;Strasse&quot;)        &rArr; #t
(string-ci=? &quot;Straße&quot; &quot;STRASSE&quot;)        &rArr; #t
(string-ci=? &quot;ΧΑΟΣ&quot; &quot;χαοσ&quot;)             &rArr; #t
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Conversions">
<h4 class="subsection">13.3.5 Conversions</h4>

<dl class="def">
<dt id="index-list_002d_003estring"><span class="category">Procedure: </span><span><strong>list-&gt;string</strong> <em><var>list</var></em><a href='#index-list_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>list-&gt;string</code> procedure returns an istring
formed from the characters in <var>list</var>, in order.
It is an error if any element of <var>list</var> is not a character.
</p>
<p><em>Compatibility:</em> The result is an istring,
except in compatibility mode, when it is an mstring.
</p></dd></dl>

<dl class="def">
<dt id="index-reverse_002dlist_002d_003estring"><span class="category">Procedure: </span><span><strong>reverse-list-&gt;string</strong> <em><var>list</var></em><a href='#index-reverse_002dlist_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An efficient implementation of <code>(compose list-&gt;text reverse)</code>:
</p><div class="example">
<pre class="example">(reverse-list-&gt;text '(#\a #\B #\c))  &rArr; &quot;cBa&quot;
</pre></div>
<p>This is a common idiom in the epilogue of string-processing loops
that accumulate their result using a list in reverse order.
(See also <code>string-concatenate-reverse</code> for the &ldquo;chunked&rdquo; variant.)
</p></dd></dl>

<dl class="def">
<dt id="index-string_002d_003elist"><span class="category">Procedure: </span><span><strong>string-&gt;list</strong> <em><var>string</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-string_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>string-&gt;list</code> procedure returns a newly allocated list of the
characters of <var>string</var> between <var>start</var> and <var>end</var>, in order.
The <code>string-&gt;list</code> and <code>list-&gt;string</code> procedures are inverses
so far as <code>equal?</code> is concerned.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_002d_003estring"><span class="category">Procedure: </span><span><strong>vector-&gt;string</strong> <em>vector [start [end]]</em><a href='#index-vector_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>vector-&gt;string</code> procedure returns a newly allocated
string of the objects contained in the elements of <var>vector</var>
between <var>start</var> and <var>end</var>.
It is an error if any element of <var>vector</var> between <var>start</var>
and <var>end</var> is not a character, or is a character forbidden in strings.
</p><div class="example">
<pre class="example">(vector-&gt;string #(#\1 #\2 #\3))             &rArr; &quot;123&quot;
(vector-&gt;string #(#\1 #\2 #\3 #\4 #\5) 2 4) &rArr; &quot;34&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002d_003evector"><span class="category">Procedure: </span><span><strong>string-&gt;vector</strong> <em>string [start [end]]</em><a href='#index-string_002d_003evector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>string-&gt;vector</code> procedure
returns a newly created vector initialized to the elements
of the string <var>string</var> between <var>start</var> and <var>end</var>.
</p><div class="example">
<pre class="example">(string-&gt;vector &quot;ABC&quot;)       &rArr; #(#\A #\B #\C)
(string-&gt;vector &quot;ABCDE&quot; 1 3) &rArr; #(#\B #\C)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dupcase"><span class="category">Procedure: </span><span><strong>string-upcase</strong> <em><var>string</var></em><a href='#index-string_002dupcase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002ddowncase"><span class="category">Procedure: </span><span><strong>string-downcase</strong> <em><var>string</var></em><a href='#index-string_002ddowncase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dtitlecase"><span class="category">Procedure: </span><span><strong>string-titlecase</strong> <em><var>string</var></em><a href='#index-string_002dtitlecase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dfoldcase"><span class="category">Procedure: </span><span><strong>string-foldcase</strong> <em><var>string</var></em><a href='#index-string_002dfoldcase' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures take a string argument and return a string result.
They are defined in terms of Unicode&rsquo;s locale&ndash;independent case mappings
from Unicode scalar&ndash;value sequences to scalar&ndash;value sequences.  In
particular, the length of the result string can be different from the
length of the input string.  When the specified result is equal in the
sense of <code>string=?</code> to the argument, these procedures may return
the argument instead of a newly allocated string.
</p>
<p>The <code>string-upcase</code> procedure converts a string to upper case;
<code>string-downcase</code> converts a string to lower case.  The
<code>string-foldcase</code> procedure converts the string to its case&ndash;folded
counterpart, using the full case&ndash;folding mapping, but without the
special mappings for Turkic languages.  The <code>string-titlecase</code>
procedure converts the first cased character of each word, and downcases
all other cased characters.
</p>
<div class="example">
<pre class="example">(string-upcase &quot;Hi&quot;)              &rArr; &quot;HI&quot;
(string-downcase &quot;Hi&quot;)            &rArr; &quot;hi&quot;
(string-foldcase &quot;Hi&quot;)            &rArr; &quot;hi&quot;

(string-upcase &quot;Straße&quot;)          &rArr; &quot;STRASSE&quot;
(string-downcase &quot;Straße&quot;)        &rArr; &quot;straße&quot;
(string-foldcase &quot;Straße&quot;)        &rArr; &quot;strasse&quot;
(string-downcase &quot;STRASSE&quot;)       &rArr; &quot;strasse&quot;

(string-downcase &quot;Σ&quot;)             &rArr; &quot;σ&quot;
; Chi Alpha Omicron Sigma:
(string-upcase &quot;ΧΑΟΣ&quot;)            &rArr; &quot;ΧΑΟΣ&quot;
(string-downcase &quot;ΧΑΟΣ&quot;)          &rArr; &quot;χαος&quot;
(string-downcase &quot;ΧΑΟΣΣ&quot;)         &rArr; &quot;χαοσς&quot;
(string-downcase &quot;ΧΑΟΣ Σ&quot;)        &rArr; &quot;χαος σ&quot;
(string-foldcase &quot;ΧΑΟΣΣ&quot;)         &rArr; &quot;χαοσσ&quot;
(string-upcase &quot;χαος&quot;)            &rArr; &quot;ΧΑΟΣ&quot;
(string-upcase &quot;χαοσ&quot;)            &rArr; &quot;ΧΑΟΣ&quot;

(string-titlecase &quot;kNock KNoCK&quot;)  &rArr; &quot;Knock Knock&quot;
(string-titlecase &quot;who's there?&quot;) &rArr; &quot;Who's There?&quot;
(string-titlecase &quot;r6rs&quot;)         &rArr; &quot;R6rs&quot;
(string-titlecase &quot;R6RS&quot;)         &rArr; &quot;R6rs&quot;
</pre></div>

<p>Since these procedures are locale&ndash;independent, they may not be
appropriate for some locales.
</p>
<p><em>Kawa Note:</em>  The implementation of <code>string-titlecase</code>
does not correctly handle the case where an initial character
needs to be converted to multiple characters, such as
&ldquo;LATIN SMALL LIGATURE FL&rdquo; which should be converted to
the two letters <code>&quot;Fl&quot;</code>.
</p>
<p><em>Compatibility:</em> The result is an istring,
except in compatibility mode, when it is an mstring.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dnormalize_002dnfd"><span class="category">Procedure: </span><span><strong>string-normalize-nfd</strong> <em><var>string</var></em><a href='#index-string_002dnormalize_002dnfd' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dnormalize_002dnfkd"><span class="category">Procedure: </span><span><strong>string-normalize-nfkd</strong> <em><var>string</var></em><a href='#index-string_002dnormalize_002dnfkd' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dnormalize_002dnfc"><span class="category">Procedure: </span><span><strong>string-normalize-nfc</strong> <em><var>string</var></em><a href='#index-string_002dnormalize_002dnfc' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dnormalize_002dnfkc"><span class="category">Procedure: </span><span><strong>string-normalize-nfkc</strong> <em><var>string</var></em><a href='#index-string_002dnormalize_002dnfkc' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures take a string argument and return a string result,
which is the input string normalized to Unicode normalization form D,
KD, C, or KC, respectively.  When the specified result is equal in the
sense of <code>string=?</code> to the argument, these procedures may return
the argument instead of a newly allocated string.
</p>
<div class="example">
<pre class="example">(string-normalize-nfd &quot;\xE9;&quot;)          &rArr; &quot;\x65;\x301;&quot;
(string-normalize-nfc &quot;\xE9;&quot;)          &rArr; &quot;\xE9;&quot;
(string-normalize-nfd &quot;\x65;\x301;&quot;)    &rArr; &quot;\x65;\x301;&quot;
(string-normalize-nfc &quot;\x65;\x301;&quot;)    &rArr; &quot;\xE9;&quot;
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Searching-and-matching">
<h4 class="subsection">13.3.6 Searching and matching</h4>

<dl class="def">
<dt id="index-string_002dprefix_002dlength"><span class="category">Procedure: </span><span><strong>string-prefix-length</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dprefix_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dsuffix_002dlength"><span class="category">Procedure: </span><span><strong>string-suffix-length</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dsuffix_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the length of the longest common prefix/suffix of <var>string<sub>1</sub></var>
and <var>string<sub>2</sub></var>.
For prefixes, this is equivalent to their &ldquo;mismatch index&rdquo;
(relative to the start indexes).
</p>
<p>The optional <var>start</var>/<var>end</var> indexes restrict the comparison
to the indicated substrings of <var>string<sub>1</sub></var> and <var>string<sub>2</sub></var>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dprefix_003f"><span class="category">Procedure: </span><span><strong>string-prefix?</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dprefix_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dsuffix_003f"><span class="category">Procedure: </span><span><strong>string-suffix?</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dsuffix_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Is <var>string<sub>1</sub></var> a prefix/suffix of <var>string<sub>2</sub></var>?
</p>
<p>The optional <var>start</var>/<var>end</var> indexes restrict the comparison
to the indicated substrings of <var>string<sub>1</sub></var> and <var>string<sub>2</sub></var>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dindex"><span class="category">Procedure: </span><span><strong>string-index</strong> <em>string pred [start end]</em><a href='#index-string_002dindex' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dindex_002dright"><span class="category">Procedure: </span><span><strong>string-index-right</strong> <em>string pred [start end]</em><a href='#index-string_002dindex_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dskip"><span class="category">Procedure: </span><span><strong>string-skip</strong> <em>string pred [start end]</em><a href='#index-string_002dskip' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dskip_002dright"><span class="category">Procedure: </span><span><strong>string-skip-right</strong> <em>string pred [start end]</em><a href='#index-string_002dskip_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p><code>string-index</code> searches through the given substring from the
left, returning the index of the leftmost character satisfying the
predicate <var>pred</var>.
<code>string-index-right</code> searches from the right, returning
the index of the rightmost character satisfying the predicate <var>pred</var>.
If no match is found, these procedures return <code>#f</code>.
</p>
<p>The <var>start</var> and <var>end</var> arguments specify the beginning and end
of the search; the valid indexes relevant to the search include <var>start</var>
but exclude <var>end</var>. Beware of &ldquo;fencepost&rdquo;&quot; errors: when searching
right-to-left, the first index considered is <code>(- <var>end</var> 1)</code>,
whereas when searching left-to-right, the first index considered is <var>start</var>.
That is, the start/end indexes describe the same half-open interval
<code>[<var>start</var>,<var>end</var>)</code>
in these procedures that they do in other string procedures.
</p>
<p>The <code>-skip</code> functions are similar, but use the complement of the
criterion: they search for the first char that <em>doesn&rsquo;t</em> satisfy
<var>pred</var>. To skip over initial whitespace, for example, say
</p>
<div class="example">
<pre class="example">(substring string
            (or (string-skip string char-whitespace?)
                (string-length string))
            (string-length string))
</pre></div>

<p>These functions can be trivially composed with <code>string-take</code> and
<code>string-drop</code> to produce <code>take-while</code>, <code>drop-while</code>,
<code>span</code>, and <code>break</code> procedures without loss of efficiency.
</p></dd></dl>


<dl class="def">
<dt id="index-string_002dcontains"><span class="category">Procedure: </span><span><strong>string-contains</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dcontains' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dcontains_002dright"><span class="category">Procedure: </span><span><strong>string-contains-right</strong> <em>string<sub>1</sub> string<sub>2</sub> [start<sub>1</sub> end<sub>1</sub> start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dcontains_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Does the substring of <var>string<sub>1</sub></var> specified by <var>start<sub>1</sub></var> and <var>end<sub>1</sub></var> contain the sequence of characters given by the substring of <var>string<sub>2</sub></var> specified by <var>start<sub>2</sub></var> and <var>end<sub>2</sub></var>?
</p>
<p>Returns <code>#f</code> if there is no match.
If <var>start<sub>2</sub></var> = <var>end<sub>2</sub></var>, <code>string-contains</code>
returns <var>start<sub>1</sub></var> but <code>string-contains-right</code>
returns <var>end<sub>1</sub></var>. Otherwise returns the index in <var>string<sub>1</sub></var> for the first character of the first/last match; that index lies within the half-open interval [<var>start<sub>1</sub></var>,<var>end<sub>1</sub></var>), and the match lies entirely within the [<var>start<sub>1</sub></var>,<var>end<sub>1</sub></var>) range of <var>string<sub>1</sub></var>.
</p>
<div class="example">
<pre class="example">(string-contains &quot;eek -- what a geek.&quot; &quot;ee&quot; 12 18) ; Searches &quot;a geek&quot;
    &rArr; 15
</pre></div>
<p>Note: The names of these procedures do not end with a question mark. This indicates a useful value is returned when there is a match.
</p>

</dd></dl>

</div>
<div class="subsection" id="Concatenation-and-replacing">
<h4 class="subsection">13.3.7 Concatenation and replacing</h4>

<dl class="def">
<dt id="index-string_002dappend"><span class="category">Procedure: </span><span><strong>string-append</strong> <em><var>string</var> &hellip;</em><a href='#index-string_002dappend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a string whose characters form the concatenation
of the given strings.
</p>
<p><em>Compatibility:</em> The result is an istring,
except in compatibility mode, when it is an mstring.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dconcatenate"><span class="category">Procedure: </span><span><strong>string-concatenate</strong> <em>string-list</em><a href='#index-string_002dconcatenate' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Concatenates the elements of <var>string-list</var> together into a single istring.
</p>
<p><em>Rationale:</em> Some implementations of Scheme limit the number of
arguments that may be passed to an n-ary procedure, so the
<code>(apply string-append <var>string-list</var>)</code> idiom,
which is otherwise equivalent to using this procedure, is not as portable.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dconcatenate_002dreverse"><span class="category">Procedure: </span><span><strong>string-concatenate-reverse</strong> <em>string-list [final-string [end]])</em><a href='#index-string_002dconcatenate_002dreverse' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>With no optional arguments, calling this procedure is equivalent to
<code>(string-concatenate (reverse <var>string-list</var>))</code>.
If the optional argument <var>final-string</var> is specified,
it is effectively consed onto the beginning of <var>string-list</var>
before performing the list-reverse and string-concatenate operations.
</p>
<p>If the optional argument <var>end</var> is given, only the characters up to but not including <var>end</var> in <var>final-string</var> are added to the result,
thus producing
</p><div class="example">
<pre class="example">(string-concatenate 
  (reverse (cons (substring final-string 0 end)
                 string-list)))
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(string-concatenate-reverse '(&quot; must be&quot; &quot;Hello, I&quot;) &quot; going.XXXX&quot; 7)
  &rArr; &quot;Hello, I must be going.&quot;
</pre></div>

<p><em>Rationale:</em> This procedure is useful when constructing
procedures that accumulate character data into lists of string
buffers, and wish to convert the accumulated data into a single string
when done. The optional end argument accommodates that use case when
<var>final-string</var> is a bob-full mutable string,
and is allowed (for uniformity) when
<var>final-string</var> is an immutable string.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002djoin"><span class="category">Procedure: </span><span><strong>string-join</strong> <em>string-list [delimiter [grammar]]</em><a href='#index-string_002djoin' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure is a simple unparser; it pastes strings together
using the <var>delimiter</var> string, returning an istring.
</p>
<p>The <var>string-list</var> is a list of strings.
The <var>delimiter</var> is the string used to delimit elements; it defaults to a single space <code>&quot; &quot;</code>.
</p>
<p>The <var>grammar</var> argument is a symbol that determines how the <var>delimiter</var>
is used, and defaults to <code>'infix</code>.
It is an error for <var>grammar</var> to be any symbol other than these four:
</p><dl compact="compact">
<dt><span><code>'infix</code></span></dt>
<dd><p>An infix or separator grammar: insert the delimiter between list elements. An empty list will produce an empty string.
</p></dd>
<dt><span><code>'strict-infix</code></span></dt>
<dd><p>Means the same as <code>'infix</code> if the string-list is non-empty,
but will signal an error if given an empty list.
(This avoids an ambiguity shown in the examples below.)
</p></dd>
<dt><span><code>'suffix</code></span></dt>
<dd><p>Means a suffix or terminator grammar: insert the <var>delimiter</var>
after every list element.
</p></dd>
<dt><span><code>'prefix</code></span></dt>
<dd><p>Means a prefix grammar: insert the <var>delimiter</var> before every list element.
</p></dd>
</dl>

<div class="example">
<pre class="example">(string-join '(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;))
         &rArr; &quot;foo bar baz&quot;
(string-join '(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;) &quot;&quot;)
         &rArr; &quot;foobarbaz&quot;
(string-join '(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;) &quot;:&quot;)
         &rArr; &quot;foo:bar:baz&quot;
(string-join '(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;) &quot;:&quot; 'suffix)
         &rArr; &quot;foo:bar:baz:&quot;

;; Infix grammar is ambiguous wrt empty list vs. empty string:
(string-join '()   &quot;:&quot;) &rArr; &quot;&quot;
(string-join '(&quot;&quot;) &quot;:&quot;) &rArr; &quot;&quot;

;; Suffix and prefix grammars are not:
(string-join '()   &quot;:&quot; 'suffix)) &rArr; &quot;&quot;
(string-join '(&quot;&quot;) &quot;:&quot; 'suffix)) &rArr; &quot;:&quot;
</pre></div>

</dd></dl>

<dl class="def">
<dt id="index-string_002dreplace"><span class="category">Procedure: </span><span><strong>string-replace</strong> <em>string<sub>1</sub> string<sub>2</sub> start<sub>1</sub> end<sub>1</sub> [start<sub>2</sub> end<sub>2</sub>]</em><a href='#index-string_002dreplace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns
</p><div class="example">
<pre class="example">(string-append (substring <var>string<sub>1</sub></var> 0 <var>start<sub>1</sub></var>)
               (substring <var>string<sub>2</sub></var> <var>start<sub>2</sub></var> <var>end<sub>2</sub></var>)
               (substring <var>string<sub>1</sub></var> <var>end<sub>1</sub></var> (string-length <var>string<sub>1</sub></var>)))
</pre></div>
<p>That is, the segment of characters in <var>string<sub>1</sub></var> from <var>start<sub>1</sub></var>
to <var>end<sub>1</sub></var> is replaced by the segment of characters in <var>string<sub>2</sub></var> from <var>start<sub>2</sub></var> to <var>end<sub>2</sub></var>.
If <var>start<sub>1</sub></var>=<var>end<sub>1</sub></var>, this simply splices the characters
drawn from <var>string<sub>2</sub></var> into <var>string<sub>1</sub></var> at that position.
</p>
<p>Examples:
</p><div class="example">
<pre class="example">(string-replace &quot;The TCL programmer endured daily ridicule.&quot;
                 &quot;another miserable perl drone&quot; 4 7 8 22)
    &rArr; &quot;The miserable perl programmer endured daily ridicule.&quot;

(string-replace &quot;It's easy to code it up in Scheme.&quot; &quot;lots of fun&quot; 5 9)
    &rArr; &quot;It's lots of fun to code it up in Scheme.&quot;

(define (string-insert s i t) (string-replace s t i i))

(string-insert &quot;It's easy to code it up in Scheme.&quot; 5 &quot;really &quot;)
    &rArr; &quot;It's really easy to code it up in Scheme.&quot;

(define (string-set s i c) (string-replace s (string c) i (+ i 1)))

(string-set &quot;String-ref runs in O(n) time.&quot; 19 #\1)
    &rArr; &quot;String-ref runs in O(1) time.&quot;
</pre></div>
</dd></dl>

<p>Also see <code>string-append!</code> and <code>string-replace!</code>
for destructive changes to a mutable string.
</p>
</div>
<div class="subsection" id="Mapping-and-folding">
<h4 class="subsection">13.3.8 Mapping and folding</h4>

<dl class="def">
<dt id="index-string_002dfold"><span class="category">Procedure: </span><span><strong>string-fold</strong> <em>kons knil string [start end]</em><a href='#index-string_002dfold' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dfold_002dright"><span class="category">Procedure: </span><span><strong>string-fold-right</strong> <em>kons knil string [start end]</em><a href='#index-string_002dfold_002dright' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are the fundamental iterators for strings.
</p>
<p>The <code>string-fold</code> procedure maps the <var>kons</var> procedure across
the given <var>string</var> from left to right:
</p><div class="example">
<pre class="example">(... (<var>kons</var> <var>string</var><sub>2</sub> (<var>kons</var> <var>string</var><sub>1</sub> (<var>kons</var> <var>string</var><sub>0</sub> <var>knil</var>))))
</pre></div>
<p>In other words, string-fold obeys the (tail) recursion
</p><div class="example">
<pre class="example">  (string-fold <var>kons</var> <var>knil</var> <var>string</var> <var>start</var> <var>end</var>)
= (string-fold <var>kons</var> (<var>kons</var> <var>string</var><sub>start</sub> <var>knil</var>) <var>start+1</var> <var>end</var>)
</pre></div>
<p>The <code>string-fold-right</code> procedure maps <var>kons</var> across the given
string <var>string</var> from right to left:
</p><div class="example">
<pre class="example">(<var>kons</var> <var>string</var><sub>0</sub>
      (... (<var>kons</var> <var>string</var><sub><var>end-3</var></sub>
                 (<var>kons</var> <var>string</var><sub><var>end-2</var></sub>
                       (<var>kons</var> <var>string</var><sub><var>end-1</var></sub>
                             <var>knil</var>)))))
</pre></div>
<p>obeying the (tail) recursion
</p><div class="example">
<pre class="example">  (string-fold-right <var>kons</var> <var>knil</var> <var>string</var> <var>start</var> <var>end</var>)
= (string-fold-right <var>kons</var> (<var>kons</var> <var>string</var><sub><var>end-1</var></sub> <var>knil</var>) <var>start</var> <var>end-1</var>)
</pre></div>
<p>Examples:
</p><div class="example">
<pre class="example">;;; Convert a string or string to a list of chars.
(string-fold-right cons '() string)

;;; Count the number of lower-case characters in a string or string.
(string-fold (lambda (c count)
                (if (char-lower-case? c)
                    (+ count 1)
                    count))
              0
              string)
</pre></div>
<p>The string-fold-right combinator is sometimes called a &quot;catamorphism.&quot;
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dfor_002deach"><span class="category">Procedure: </span><span><strong>string-for-each</strong> <em><var>proc</var> <var>string</var><sub>1</sub> <var>string</var><sub>2</sub> &hellip;</em><a href='#index-string_002dfor_002deach' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dfor_002deach-1"><span class="category">Procedure: </span><span><strong>string-for-each</strong> <em><var>proc</var> <var>string</var><sub>1</sub> [start [end]]</em><a href='#index-string_002dfor_002deach-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>string</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>string</var>s.
</p>
<p>The <var>start</var>-<var>end</var> variant is provided for compatibility
with the SRFI-13 version.  (In that case <var>start</var> and <var>end</var>
count code Unicode scalar values (<code>character</code> values),
not Java 16-bit <code>char</code> values.)
</p>
<p>The <code>string-for-each</code> procedure applies <var>proc</var> element&ndash;wise to
the characters of the <var>string</var>s for its side effects, in order from
the first characters to the last.  <var>proc</var> is always called in the
same dynamic environment as <code>string-for-each</code> itself.
</p>
<p>Analogous to <code>for-each</code>.
</p>
<div class="example">
<pre class="example">(let ((v '()))
  (string-for-each
    (lambda (c) (set! v (cons (char-&gt;integer c) v)))
    &quot;abcde&quot;)
   v)
  &rArr; (101 100 99 98 97)
</pre></div>

<p><em>Performance note:</em> The compiler generates efficient code
for <code>string-for-each</code>.
If <var>proc</var> is a lambda expression, it is inlined.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dmap"><span class="category">Procedure: </span><span><strong>string-map</strong> <em><var>proc</var> <var>string</var><sub>1</sub> <var>string</var><sub>2</sub> &hellip;</em><a href='#index-string_002dmap' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>string-map</code> procedure applies <var>proc</var> element-wise to
the elements of the strings and returns a string of the results, in order.
It is an error if <var>proc</var> does not accept as many arguments as there
are strings, or return other than a single character or a string.
If more than one string is given and not all strings have the same length,
<code>string-map</code> terminates when the shortest string runs out.
The dynamic order in
which <var>proc</var> is applied to the elements of the strings is unspecified.
</p>
<div class="example">
<pre class="example">(string-map char-foldcase &quot;AbdEgH&quot;)  &rArr; &quot;abdegh&quot;
</pre></div>
<div class="example">
<pre class="example">(string-map
  (lambda (c) (integer-&gt;char (+ 1 (char-&gt;integer c))))
  &quot;HAL&quot;)
        &rArr; &quot;IBM&quot;
</pre></div>
<div class="example">
<pre class="example">(string-map
  (lambda (c k)
    ((if (eqv? k #\u) char-upcase char-downcase) c))
  &quot;studlycaps xxx&quot;
  &quot;ululululul&quot;)
        &rArr; &quot;StUdLyCaPs&quot;
</pre></div>

<p>Traditionally the result of <var>proc</var> had to be a character,
but Kawa (and SRFI-140) allows the result to be a string.
</p>
<p><em>Performance note:</em> The <code>string-map</code> procedure has not been
optimized (mainly because it is not very useful):
The characters are boxed, and the <var>proc</var> is not inlined even if
it is a lambda expression.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dmap_002dindex"><span class="category">Procedure: </span><span><strong>string-map-index</strong> <em>proc string [start end]</em><a href='#index-string_002dmap_002dindex' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Calls <var>proc</var> on each valid index of the specified substring, converts
the results of those calls into strings, and returns the concatenation
of those strings. It is an error for <var>proc</var> to return anything other
than a character or string. The dynamic order in which proc is called
on the indexes is unspecified, as is the dynamic order in which the
coercions are performed. If any strings returned by <var>proc</var> are mutated
after they have been returned and before the call to <code>string-map-index</code>
has returned, then <code>string-map-index</code> returns a string with unspecified
contents; the <var>string-map-index</var> procedure itself does not mutate those
strings.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dfor_002deach_002dindex"><span class="category">Procedure: </span><span><strong>string-for-each-index</strong> <em>proc string [start end]</em><a href='#index-string_002dfor_002deach_002dindex' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Calls <var>proc</var> on each valid index of the specified substring, in
increasing order, discarding the results of those calls. This is
simply a safe and correct way to loop over a substring.
</p>
<p>Example:
</p><div class="example">
<pre class="example">(let ((txt (string-&gt;string &quot;abcde&quot;))
      (v '()))
  (string-for-each-index
    (lambda (cur) (set! v (cons (char-&gt;integer (string-ref txt cur)) v)))
    txt)
  v) &rArr; (101 100 99 98 97)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dcount"><span class="category">Procedure: </span><span><strong>string-count</strong> <em>string pred [start end]</em><a href='#index-string_002dcount' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a count of the number of characters in the specified substring
of <var>string</var> that satisfy the predicate <var>pred</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dfilter"><span class="category">Procedure: </span><span><strong>string-filter</strong> <em>pred string [start end]</em><a href='#index-string_002dfilter' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dremove"><span class="category">Procedure: </span><span><strong>string-remove</strong> <em>pred string [start end]</em><a href='#index-string_002dremove' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return an immutable string consisting of only selected characters, in order:
<code>string-filter</code> selects only the characters that satisfy <var>pred</var>;
<code>string-remove</code> selects only the characters that <em>not</em>
satisfy <var>pred</var>
</p></dd></dl>

</div>
<div class="subsection" id="Replication-_0026-splitting">
<h4 class="subsection">13.3.9 Replication &amp; splitting</h4>

<dl class="def">
<dt id="index-string_002drepeat"><span class="category">Procedure: </span><span><strong>string-repeat</strong> <em>string-or-character len</em><a href='#index-string_002drepeat' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create an istring by repeating the first argument <var>len</var> times.
If the first argument is a character, it is as if it were wrapped with
the <code>string</code> constructor.
We can define string-repeat in terms of the more general <code>xsubstring</code>
procedure:
</p><div class="example">
<pre class="example">(define (string-repeat S N)
   (let ((T (if (char? S) (string S) S)))
     (xsubstring T 0 (* N (string-length T))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-xsubstring"><span class="category">Procedure: </span><span><strong>xsubstring</strong> <em>string [from to [start end]]</em><a href='#index-xsubstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This is an extended substring procedure that implements replicated copying of a substring.
The <var>string</var> is a string; <var>start</var> and <var>end</var> are optional arguments that specify a substring of <var>string</var>,
defaulting to 0 and the length of <var>string</var>.
This substring is conceptually replicated both up and down the index space,
in both the positive and negative directions.
For example, if <var>string</var> is <code>&quot;abcdefg&quot;</code>, <var>start</var> is 3,
and <var>end</var> is 6, then we have the conceptual bidirectionally-infinite string
</p><div class="example">
<pre class="example">  ...  d  e  f  d  e  f  d  e  f  d  e  f  d  e  f  d  e  f  d ...
      -9 -8 -7 -6 -5 -4 -3 -2 -1  0 +1 +2 +3 +4 +5 +6 +7 +8 +9
</pre></div>
<p><code>xsubstring</code> returns the substring of the <var>string</var> beginning
at index <var>from</var>, and ending at <var>to</var>.
It is an error if <var>from</var> is greater than <var>to</var>.
</p>
<p>If <var>from</var> and <var>to</var> are missing they default to 0 and
<var>from</var>+(<var>end</var>-<var>start</var>), respectively.
This variant is a generalization of using <code>substring</code>,
but unlike <code>substring</code> never shares substructures that would
retain characters or sequences of characters that are substructures of
its first argument or previously allocated objects.
</p>
<p>You can use <code>xsubstring</code> to perform a variety of tasks:
</p><ul>
<li> To rotate a string left: <code>(xsubstring &quot;abcdef&quot; 2 8) &rArr; &quot;cdefab&quot;</code>
</li><li> To rotate a string right: <code>(xsubstring &quot;abcdef&quot; -2 4) &rArr; &quot;efabcd&quot;</code>
</li><li> To replicate a string: <code>(xsubstring &quot;abc&quot; 0 7) &rArr; &quot;abcabca&quot;</code>
</li></ul>

<p>Note that
</p><ul>
<li> The <var>from</var>/<var>to</var> arguments give a half-open range containing the
characters from index <var>from</var> up to, but not including, index <var>to</var>.
</li><li> The <var>from</var>/<var>to</var> indexes are not expressed in the index space of
<var>string</var>. They refer instead to the replicated index space of the
substring defined by <var>string</var>, <var>start</var>, and <var>end</var>.
</li></ul>

<p>It is an error if <var>start</var>=<var>end</var>, unless <var>from</var>=<var>to</var>,
which is allowed as a special case.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dsplit"><span class="category">Procedure: </span><span><strong>string-split</strong> <em>string delimiter [grammar limit start end]</em><a href='#index-string_002dsplit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of strings representing the words contained in the substring of <var>string</var> from <var>start</var> (inclusive) to <var>end</var> (exclusive).
The <var>delimiter</var> is a string to be used as the word separator.
This will often be a single character, but multiple characters are
allowed for use cases such as splitting on <code>&quot;\r\n&quot;</code>.
The returned list will have one more item than the number of non-overlapping
occurrences of the <var>delimiter</var> in the string.
If <var>delimiter</var> is an empty string, then the returned list contains a
list of strings, each of which contains a single character.
</p>
<p>The <var>grammar</var> is a symbol with the same meaning as in
the <code>string-join</code> procedure.
If it is <code>infix</code>, which is the default, processing is done as
described above, except an empty string produces the empty list;
if grammar is <code>strict-infix</code>, then an empty string signals an error.
The values <code>prefix</code> and <code>suffix</code> cause a leading/trailing empty string in the result to be suppressed.
</p>
<p>If <var>limit</var> is a non-negative exact integer, at most that many splits occur, and the remainder of string is returned as the final element of the list (so the result will have at most limit+1 elements). If limit is not specified or is #f, then as many splits as possible are made. It is an error if limit is any other value.
</p>
<p>To split on a regular expression, you can use SRFI 115&rsquo;s <code>regexp-split</code>
procedure.
</p></dd></dl>

</div>
<div class="subsection" id="String-mutation">
<h4 class="subsection">13.3.10 String mutation</h4>

<p>The following procedures create a mutable string,
i.e. one that you can modify.
</p>
<dl class="def">
<dt id="index-make_002dstring"><span class="category">Procedure: </span><span><strong>make-string</strong> <em>[<var>k</var> [<var>char</var>]]</em><a href='#index-make_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated mstring of <var>k</var> characters,
where <var>k</var> defaults to 0.  If <var>char</var> is
given, then all elements of the string are initialized to <var>char</var>,
otherwise the contents of the <var>string</var> are unspecified.
</p>
<p>The 1-argument version is deprecated as poor style, except when k is 0.
</p>
<p><em>Rationale:</em> In many languags the most common pattern for mutable strings
is to allocate an empty string and incrementally append to it.
It seems natural to initialize the string
with <code>(make-string)</code>, rather than <code>(make-string 0)</code>.
</p>
<p>To return an immutable string that repeats <var>k</var> times a character
<var>char</var> use <code>string-repeat</code>.
</p>
<p>This is as R7RS, except the result is variable-size and we allow
leaving out <var>k</var> when it is zero.
</p>
</dd></dl>

<dl class="def">
<dt id="index-string_002dcopy"><span class="category">Procedure: </span><span><strong>string-copy</strong> <em><var>string</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-string_002dcopy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated mutable (mstring) copy of the part of the given
<var>string</var> between <var>start</var> and <var>end</var>.
</p></dd></dl>

<p>The following procedures modify a mutable string.
</p>
<dl class="def">
<dt id="index-string_002dset_0021"><span class="category">Procedure: </span><span><strong>string-set!</strong> <em>string k char</em><a href='#index-string_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure stores <var>char</var> in element <var>k</var> of <var>string</var>.
</p>
<div class="example">
<pre class="example">(define s1 (make-string 3 #\*))
(define s2 &quot;***&quot;)
(string-set! s1 0 #\?) &rArr; <em>void</em>
s1 &rArr; &quot;?**&quot;
(string-set! s2 0 #\?) &rArr; <em>error</em>
(string-set! (symbol-&gt;string 'immutable) 0 #\?) &rArr; <em>error</em>
</pre></div>

<p><em>Performance note:</em> Calling <code>string-set!</code> may take time proportional
to the length of the string:  First it must scan for the right position,
like <code>string-ref</code> does. Then if the new character requires
using a surrogate pair (and the old one doesn&rsquo;t) then we have to make room
in the string, possibly re-allocating a new <code>char</code> array.
Alternatively, if the old character requires using a surrogate pair
(and the new one doesn&rsquo;t) then following characters need to be moved.
</p>
<p>The function <code>string-set!</code> is deprecated: It is inefficient,
and it very seldom does the correct thing.  Instead, you can
construct a string with <code>string-append!</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dappend_0021"><span class="category">Procedure: </span><span><strong>string-append!</strong> <em><var>string</var> <var>value</var> &hellip;</em><a href='#index-string_002dappend_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>string</var> must be a mutable string, such as one returned
by <code>make-string</code> or <code>string-copy</code>.
The <code>string-append!</code> procedure extends <var>string</var>
by appending each <var>value</var> (in order) to the end of <var>string</var>.
Each <code>value</code> should be a character or a string.
</p>
<p><em>Performance note:</em> The compiler converts a call with multiple <var>value</var>s
to multiple <code>string-append!</code> calls.
If a <var>value</var> is known to be a <code>character</code>, then
no boxing (object-allocation) is needed.
</p>
<p>The following example shows how to efficiently process a string
using <code>string-for-each</code> and incrementally &ldquo;build&rdquo; a result string
using <code>string-append!</code>.
</p>
<div class="example">
<pre class="example">(define (translate-space-to-newline str::string)::string
  (let ((result (make-string 0)))
    (string-for-each
     (lambda (ch)
       (string-append! result
                       (if (char=? ch #\Space) #\Newline ch)))
     str)
    result))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dcopy_0021"><span class="category">Procedure: </span><span><strong>string-copy!</strong> <em><var>to</var>  <var>at</var>  <var>from</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-string_002dcopy_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Copies the characters of the string <var>from</var> that are between
<var>start</var> end <var>end</var> into the string <var>to</var>,
starting at index <var>at</var>.  The order in which characters are copied
is unspecified, except that if the source and destination overlap,
copying takes place as if the source is first copied into a
temporary string and then into the destination.
(This is achieved without allocating storage by making sure to copy in
the correct direction in such circumstances.)
</p>
<p>This is equivalent to (and implemented as):
</p><div class="example">
<pre class="example">(string-replace! to at (+ at (- end start)) from start end))
</pre></div>

<div class="example">
<pre class="example">(define a &quot;12345&quot;)
(define b (string-copy &quot;abcde&quot;))
(string-copy! b 1 a 0 2)
b  &rArr;  &quot;a12de&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002dreplace_0021"><span class="category">Procedure: </span><span><strong>string-replace!</strong> <em><var>dst</var> <var>dst-start</var> <var>dst-end</var> <var>src</var> [<var>src-start</var> [<var>src-end</var>]]</em><a href='#index-string_002dreplace_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Replaces the characters of string <var>dst</var> (between <var>dst-start</var> and <var>dst-end</var>) with the characters of <var>src</var> (between <var>src-start</var> and <var>src-end</var>).
The number of characters from <var>src</var> may be different than the
number replaced in <var>dst</var>, so the string may grow or contract.
The special case where <var>dst-start</var> is equal to <var>dst-end</var> corresponds to
insertion; the case where <var>src-start</var> is equal to <var>src-end</var>
corresponds to deletion.
The order in which characters are copied
is unspecified, except that if the source and destination overlap,
copying takes place as if the source is first copied into a
temporary string and then into the destination.
(This is achieved without allocating storage by making sure to copy in
the correct direction in such circumstances.)
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dfill_0021"><span class="category">Procedure: </span><span><strong>string-fill!</strong> <em><var>string</var> <var>fill</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-string_002dfill_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>string-fill!</code> procedure stores <var>fill</var> in the elements
of <var>string</var> between <var>start</var> and <var>end</var>.
It is an error if <var>fill</var> is not a character or is forbidden in strings.
</p></dd></dl>

</div>
<div class="subsection" id="Strings-as-sequences">
<h4 class="subsection">13.3.11 Strings as sequences</h4>

<ul class="section-toc">
<li><a href="#Indexing-a-string" accesskey="1">Indexing a string</a></li>
<li><a href="#Indexing-with-a-sequence" accesskey="2">Indexing with a sequence</a></li>
</ul>
<div class="subsubsection" id="Indexing-a-string">
<h4 class="subsubsection">13.3.11.1 Indexing a string</h4>

<p>Using function-call syntax with strings is convenient
and efficient.  However, it has some &ldquo;gotchas&rdquo;.
</p>
<p>We will use the following example string:
</p><div class="example">
<pre class="example">(! str1 &quot;Smile \x1f603;!&quot;)
</pre></div>
<p>or if you&rsquo;re brave:
</p><div class="example">
<pre class="example">(! str1 &quot;Smile 😃!&quot;)
</pre></div>

<p>This is <code>&quot;Smile &quot;</code> followed by an emoticon (&ldquo;smiling face with
open mouth&rdquo;) followed by <code>&quot;!&quot;</code>.
The emoticon has scalar value <code>\x1f603</code> - it is not
in the 16-bit Basic Multi-language Plane,
and so it must be encoded by a surrogate pair
(<code>#\xd83d</code> followed by <code>#\xde03</code>).
</p>
<p>The number of scalar values (<code>character</code>s) is 8,
while the number of 16-bits code units (<code>char</code>s) is 9.
The <code>java.lang.CharSequence:length</code> method
counts <code>char</code>s. Both the <code>length</code> and the
<code>string-length</code> procedures count <code>character</code>s.  Thus:
</p>
<div class="example">
<pre class="example">(length str1)          &rArr; 8
(string-length str1)   &rArr; 8
(str1:length)          &rArr; 9
</pre></div>

<p>Counting <code>char</code>s is a constant-time operation (since it
is stored in the data structure).
Counting <code>character</code>s depends on the representation used:
In geneeral it may take time proportional to the length of
the string, since it has to subtract one for each surrogate pair;
however the <var>istring</var> type (<code>gnu.lists.IString</code> class)
uses a extra structure so it can count characters in constant-time.
</p>
<p>Similarly we can can index the string in 3 ways:
</p>
<div class="example">
<pre class="example">(str1 1)              &rArr; #\m :: character
(string-ref str1 1)   &rArr; #\m :: character
(str1:charAt 1)       &rArr; #\m :: char
</pre></div>

<p>Using function-call syntax when the &ldquo;function&rdquo; is a string
and a single integer argument is the same as using <code>string-ref</code>.
</p>
<p>Things become interesting when we reach the emoticon:
</p>
<div class="example">
<pre class="example">(str1 6)              &rArr; #\😃 :: character
(str1:charAt 6)       &rArr; #\d83d :: char
</pre></div>

<p>Both <code>string-ref</code> and the function-call syntax return the
real character, while the <code>charAt</code> methods returns a partial character.
</p>
<div class="example">
<pre class="example">(str1 7)              &rArr; #\! :: character
(str1:charAt 7)       &rArr; #\de03 :: char
(str1 8)              &rArr; <i>throws</i> StringIndexOutOfBoundsException
(str1:charAt 8)       &rArr; #\! :: char
</pre></div>

</div>
<div class="subsubsection" id="Indexing-with-a-sequence">
<h4 class="subsubsection">13.3.11.2 Indexing with a sequence</h4>

<p>You can index a string with a list of integer indexes,
most commonly a range:
</p><div class="example">
<pre class="example">(<var>str</var> [<var>i</var> ...])
</pre></div>
<p>is basically the same as:
</p><div class="example">
<pre class="example">(string (<var>str</var> <var>i</var>) ...)
</pre></div>

<p>Generally when working with strings it is best to
work with substrings rather than individual characters:
</p><div class="example">
<pre class="example">(<var>str</var> [<var>start</var> &lt;: <var>end</var>])
</pre></div>

<p>This is equivalent to invoking the <code>substring</code> procedure:
</p><div class="example">
<pre class="example">(substring <var>str</var> <var>start</var> <var>end</var>)
</pre></div>


<span id="String-Cursor-API"></span></div>
</div>
<div class="subsection" id="String-Cursor-API-1">
<h4 class="subsection">13.3.12 String Cursor API</h4>

<p>Indexing into a string (using for example <code>string-ref</code>)
is inefficient because of the possible presence of surrogate pairs.
Hence given an index <var>i</var> access normally requires linearly
scanning the string until we have seen <var>i</var> characters.
</p>
<p>The string-cursor API is defined in terms of abstract &ldquo;cursor values&rdquo;,
which point to a position in the string.  This avoids the linear scan.
</p>
<p>Typical usage is:
</p><div class="example">
<pre class="example">(let* ((str <var>whatever</var>)
       (end (string-cursor-end str)))
  (do ((sc::string-cursor (string-cursor-start str)
                          (string-cursor-next str sc)))
    ((string-cursor&gt;=? sc end))
    (let ((ch (string-cursor-ref str sc)))
      (<var>do-something-with</var> ch))))
</pre></div>
<p>Alternatively, the following may be marginally faster:
</p><div class="example">
<pre class="example">(let* ((str <var>whatever</var>)
       (end (string-cursor-end str)))
  (do ((sc::string-cursor (string-cursor-start str)
                          (string-cursor-next-quick sc)))
    ((string-cursor&gt;=? sc end))
    (let ((ch (string-cursor-ref str sc)))
      (if (not (char=? ch #\ignorable-char))
        (<var>do-something-with</var> ch)))))
</pre></div>

<p>The API is non-standard, but is based on that in Chibi Scheme.
</p>
<dl class="def">
<dt id="index-string_002dcursor"><span class="category">Type: </span><span><strong>string-cursor</strong><a href='#index-string_002dcursor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An abstract position (index) in a string.
Implemented as a primitive <code>int</code> which counts the
number of preceding code units (16-bit <code>char</code> values).
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dstart"><span class="category">Procedure: </span><span><strong>string-cursor-start</strong> <em>str</em><a href='#index-string_002dcursor_002dstart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a cursor for the start of the string.
The result is always 0, cast to a <code>string-cursor</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dend"><span class="category">Procedure: </span><span><strong>string-cursor-end</strong> <em>str</em><a href='#index-string_002dcursor_002dend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a cursor for the end of the string - one past the last valid character.
Implemented as <code>(as string-cursor (invoke <var>str</var> 'length))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dref"><span class="category">Procedure: </span><span><strong>string-cursor-ref</strong> <em>str cursor</em><a href='#index-string_002dcursor_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the <code>character</code> at the <var>cursor</var>.
If the <var>cursor</var> points to the second <code>char</code> of a surrogate pair,
returns <code>#\ignorable-char</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dnext"><span class="category">Procedure: </span><span><strong>string-cursor-next</strong> <em>string cursor [count]</em><a href='#index-string_002dcursor_002dnext' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the cursor position <var>count</var> (default 1) character
positions forwards beyond <var>cursor</var>.
For each <var>count</var> this may add either 1 or 2
(if pointing at a surrogate pair) to the <var>cursor</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dnext_002dquiet"><span class="category">Procedure: </span><span><strong>string-cursor-next-quiet</strong> <em>cursor</em><a href='#index-string_002dcursor_002dnext_002dquiet' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Increment cursor by one raw <code>char</code> position,
even if <var>cursor</var> points to the start of a surrogate pair.
(In that case the next <code>string-cursor-ref</code> will
return <code>#\ignorable-char</code>.)
Same as <code>(+ <var>cursor</var> 1)</code> but with the <code>string-cursor</code> type.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dprev"><span class="category">Procedure: </span><span><strong>string-cursor-prev</strong> <em>string cursor [count]</em><a href='#index-string_002dcursor_002dprev' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the cursor position <var>count</var> (default 1) character
positions backwards before <var>cursor</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-substring_002dcursor"><span class="category">Procedure: </span><span><strong>substring-cursor</strong> <em>string [start [end]]</em><a href='#index-substring_002dcursor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a substring of the section of <var>string</var>
between the cursors <var>start</var> and <var>end</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_003c_003f"><span class="category">Procedure: </span><span><strong>string-cursor&lt;?</strong> <em>cursor1 cursor2</em><a href='#index-string_002dcursor_003c_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dcursor_003c_003d_003f"><span class="category">Procedure: </span><span><strong>string-cursor&lt;=?</strong> <em>cursor1 cursor2</em><a href='#index-string_002dcursor_003c_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dcursor_003d_003f"><span class="category">Procedure: </span><span><strong>string-cursor=?</strong> <em>cursor1 cursor2</em><a href='#index-string_002dcursor_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dcursor_003e_003d_003f"><span class="category">Procedure: </span><span><strong>string-cursor&gt;=?</strong> <em>cursor1 cursor2</em><a href='#index-string_002dcursor_003e_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002dcursor_003e_003f"><span class="category">Procedure: </span><span><strong>string-cursor&gt;?</strong> <em>cursor1 cursor2</em><a href='#index-string_002dcursor_003e_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Is the position of <var>cursor1</var> respectively before,
before or same, same, after, or after or same, as <var>cursor2</var>.
</p>
<p><em>Performance note:</em> Implemented as the corresponding <code>int</code> comparison.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcursor_002dfor_002deach"><span class="category">Procedure: </span><span><strong>string-cursor-for-each</strong> <em>proc string [start [end]]</em><a href='#index-string_002dcursor_002dfor_002deach' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Apply the procedure <var>proc</var> to each character position in
<var>string</var> between the cursors <var>start</var> and <var>end</var>.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="String-literals">
<div class="header">
<p>
Next: <a href="#Unicode" accesskey="n" rel="next">Unicode character classes and conversions</a>, Previous: <a href="#Strings" accesskey="p" rel="prev">Strings</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="String-literals-1"></span><h3 class="section">13.4 String literals</h3>

<p>Kaw support two syntaxes of string literals:
The traditional, portable, qdouble-quoted-delimited literals
like <code>&quot;this&quot;</code>;
and extended SRFI-109 quasi-literals like <code>&amp;{this}</code>.
</p>
<ul class="section-toc">
<li><a href="#Simple-string-literals" accesskey="1">Simple string literals</a></li>
<li><a href="#String-templates" accesskey="2">String templates</a></li>
</ul>
<div class="subsection" id="Simple-string-literals">
<h4 class="subsection">13.4.1 Simple string literals</h4>

<div class="display">
<pre class="display"><span id="index-string-2"></span><span id="meta_002dstring"></span><var>string</var> <tt>::=</tt> <code><b>&quot;</b></code><a href="#meta_002dstring_002delement"><var>string-element</var></a><sup>*</sup><code><b>&quot;</b></code>
<span id="index-string_002delement"></span><span id="meta_002dstring_002delement"></span><var>string-element</var> <tt>::=</tt> <i>any character other than</i> <code><b>&quot;</b></code> <i>or</i> <code><b>\</b></code>
    | <a href="#meta_002dmnemonic_002descape"><var>mnemonic-escape</var></a> | <code><b>\&quot;</b></code> | <code><b>\\</b></code>
    | <code><b>\</b></code><a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup><a href="#meta_002dline_002dending"><var>line-ending</var></a> <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup>
    | <a href="#meta_002dinline_002dhex_002descape"><var>inline-hex-escape</var></a>
<span id="index-mnemonic_002descape"></span><span id="meta_002dmnemonic_002descape"></span><var>mnemonic-escape</var> <tt>::=</tt> <code><b>\a</b></code> | <code><b>\b</b></code> | <code><b>\t</b></code> | <code><b>\n</b></code> | <code><b>\r</b></code> | ... <i>(see below)</i>
</pre></div>

<p>A string is written as a sequence of characters enclosed
within quotation marks (<code><b>&quot;</b></code>).
Within a string literal, various escape sequence represent characters
other than themselves.
Escape sequences always start with a backslash (<code><b>\</b></code>):
</p><dl compact="compact">
<dt><span><code><b>\a</b></code></span></dt>
<dd><p>Alarm (bell), <code>#\x0007</code>.
</p></dd>
<dt><span><code><b>\b</b></code></span></dt>
<dd><p>Backspace, <code>#\x0008</code>.
</p></dd>
<dt><span><code><b>\e</b></code></span></dt>
<dd><p>Escape, <code>#\x001B</code>.
</p></dd>
<dt><span><code><b>\f</b></code></span></dt>
<dd><p>Form feed, <code>#\x000C</code>.
</p></dd>
<dt><span><code><b>\n</b></code></span></dt>
<dd><p>Linefeed (newline), <code>#\x000A</code>.
</p></dd>
<dt><span><code><b>\r</b></code></span></dt>
<dd><p>Return, <code>#\x000D</code>.
</p></dd>
<dt><span><code><b>\t</b></code></span></dt>
<dd><p>Character tabulation, <code>#\x0009</code>.
</p></dd>
<dt><span><code><b>\v</b></code></span></dt>
<dd><p>Vertical tab, <code>#\x000B</code>.
</p></dd>
<dt><span><code><b>\C-</b></code><var>x</var></span></dt>
<dt><span><code><b>\^</b></code><var>x</var></span></dt>
<dd><p>Returns the scalar value of <var>x</var> masked (anded) with <code>#x9F</code>.
An alternative way to write the Ascii control characters:
For example <code>&quot;\C-m&quot;</code> or <code>&quot;\^m&quot;</code> is
the same as <code>&quot;#\x000D&quot;</code> (which the same as <code>&quot;\r&quot;</code>).
As a special case <code>\^?</code> is rubout (delete) (<code>\x7f;</code>).
</p></dd>
<dt><span><code><b>\x</b></code> <a href="#meta_002dhex_002dscalar_002dvalue"><var>hex-scalar-value</var></a><code><b>;</b></code></span></dt>
<dt><span><code><b>\X</b></code> <a href="#meta_002dhex_002dscalar_002dvalue"><var>hex-scalar-value</var></a><code><b>;</b></code></span></dt>
<dd><p>A hex encoding that gives the scalar value of a character.
</p></dd>
<dt><span><code><b>\\</b></code> <a href="#meta_002doct_002ddigit"><var>oct-digit</var></a><sup>+</sup></span></dt>
<dd><p>At most three octal digits that give the scalar value of a character.
(Historical, for C compatibility.)
</p></dd>
<dt><span><code><b>\u</b></code> <a href="#meta_002dhex_002ddigit"><var>hex-digit</var></a><sup>+</sup></span></dt>
<dd><p>Exactly four hex digits that give the scalar value of a character.
(Historical, for Java compatibility.)
</p></dd>
<dt><span><code><b>\M-</b></code><var>x</var></span></dt>
<dd><p>(Historical, for Emacs Lisp.)
Set the meta-bit (high-bit of single byte) of the following character <var>x</var>.
</p></dd>
<dt><span><code><b>\|</b></code></span></dt>
<dd><p>Vertical line, <code>#\x007c</code>.
(Not useful for string literals, but useful for symbols.)
</p></dd>
<dt><span><code><b>\&quot;</b></code></span></dt>
<dd><p>Double quote, <code>#\x0022</code>.
</p></dd>
<dt><span><code><b>\\</b></code></span></dt>
<dd><p>Backslah, <code>#\005C</code>.
</p></dd>
<dt><span><code><b>\</b></code><a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup><a href="#meta_002dline_002dending"><var>line-ending</var></a> <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup></span></dt>
<dd><p>Nothing (ignored).  Allows you to split up a long string over multiple
lines; ignoring initial whitespace on the continuation lines allows
you to indent them.
</p></dd>
</dl>

<p>Except for a line ending, any character outside of an escape
sequence stands for itself in the string literal. A line ending
which is preceded by  <code><b>\</b></code><var>intraline-whitespace</var><sup>*</sup>
expands to nothing (along with any trailing <var>intraline-whitespace</var>),
and can be used to indent strings for improved legibility.
Any other line ending has the same effect as inserting a <code><b>\n</b></code>
character into the string.
</p>
<p>Examples:
</p><div class="example">
<pre class="example">&quot;The word \&quot;recursion\&quot; has many meanings.&quot;
&quot;Another example:\ntwo lines of text&quot;
&quot;Here’s text \
containing just one line&quot;
&quot;\x03B1; is named GREEK SMALL LETTER ALPHA.&quot;
</pre></div>

<span id="string-quasi_002dliterals"></span></div>
<div class="subsection" id="String-templates">
<h4 class="subsection">13.4.2 String templates</h4>

<p>The following syntax is a <em>string template</em> (also called
a string quasi-literal or
&ldquo;<a href="http://en.wikipedia.org/wiki/Here_document">here document</a>&rdquo;):
</p><div class="example">
<pre class="example">&amp;{Hello &amp;[name]!}
</pre></div>
<p>Assuming the variable <code>name</code> evaluates to <code>&quot;John&quot;</code>
then the example evaluates to <code>&quot;Hello John!&quot;</code>.
</p>
<p>The Kawa reader converts the above example to:
</p><div class="example">
<pre class="example">($string$ &quot;Hello &quot; $&lt;&lt;$ name $&gt;&gt;$ &quot;!&quot;)
</pre></div>
<p>See the <a href="http://srfi.schemers.org/srfi-109/srfi-109.html">SRFI-109</a>
specification for details.
</p>
<div class="display">
<pre class="display"><span id="index-extended_002dstring_002dliteral"></span><span id="meta_002dextended_002dstring_002dliteral"></span><var>extended-string-literal</var> <tt>::=</tt> <code><b>&amp;{</b></code> [<a href="#meta_002dinitial_002dignored"><var>initial-ignored</var></a>] <a href="#meta_002dstring_002dliteral_002dpart"><var>string-literal-part</var></a><sup>*</sup> <code><b>}</b></code>
<span id="index-string_002dliteral_002dpart"></span><span id="meta_002dstring_002dliteral_002dpart"></span><var>string-literal-part</var> <tt>::=</tt>  <i>any character except</i> <code><b>&amp;</b></code>, <code><b>{</b></code> <i>or</i> <code><b>}</b></code>
    | <code><b>{</b></code> <a href="#meta_002dstring_002dliteral_002dpart"><var>string-literal-part</var></a><sup>*</sup> <code><b>}</b></code>
    | <a href="#meta_002dchar_002dref"><var>char-ref</var></a>
    | <a href="#meta_002dentity_002dref"><var>entity-ref</var></a>
    | <a href="#meta_002dspecial_002descape"><var>special-escape</var></a>
    | <a href="#meta_002denclosed_002dpart"><var>enclosed-part</var></a>
</pre></div>

<p>You can use the plain <code>&quot;<var>string</var>&quot;</code> syntax for
longer multiline strings, but <code>&amp;{<var>string</var>}</code> has
various advantages.
The syntax is less error-prone because the start-delimiter is
different from the end-delimiter.  Also note that nested braces
are allowed: a right brace <code>}</code> is only an end-delimiter
if it is unbalanced, so you would seldom need to escape it:
</p><div class="example">
<pre class="example">&amp;{This has a {braced} section.}
  &rArr; &quot;This has a {braced} section.&quot;
</pre></div>

<p>The escape character used for special characters is
<code><b>&amp;</b></code>.  This is compatible with XML syntax and <a href="#XML-literals">XML literals</a>.
</p>
<ul class="section-toc">
<li><a href="#Special-characters" accesskey="1">Special characters</a></li>
<li><a href="#Multiline-string-literals" accesskey="2">Multiline string literals</a></li>
<li><a href="#Embedded-expressions" accesskey="3">Embedded expressions</a></li>
<li><a href="#Formatting" accesskey="4">Formatting</a></li>
</ul>
<div class="subsubsection" id="Special-characters">
<h4 class="subsubsection">13.4.2.1 Special characters</h4>

<div class="display">
<pre class="display"><span id="index-char_002dref"></span><span id="meta_002dchar_002dref"></span><var>char-ref</var> <tt>::=</tt>
    <code><b>&amp;#</b></code> <a href="#meta_002ddigit"><var>digit</var></a><sup>+</sup> <code><b>;</b></code>
  | <code><b>&amp;#x</b></code> <a href="#meta_002dhex_002ddigit"><var>hex-digit</var></a><sup>+</sup>  <code><b>;</b></code>
<span id="index-entity_002dref"></span><span id="meta_002dentity_002dref"></span><var>entity-ref</var> <tt>::=</tt>
    <code><b>&amp;</b></code> <a href="#meta_002dchar_002dor_002dentity_002dname"><var>char-or-entity-name</var></a> <code><b>;</b></code>
<span id="index-char_002dor_002dentity_002dname"></span><span id="meta_002dchar_002dor_002dentity_002dname"></span><var>char-or-entity-name</var> <tt>::=</tt> <var>tagname</var>
</pre></div>

<p>You can the standard XML syntax for character references, using
either decimal or hexadecimal values. The following string has two
instances of the Ascii escape character, as either decimal 27 or hex 1B:
</p><div class="example">
<pre class="example">&amp;{&amp;#27;&amp;#x1B;} &rArr; &quot;\e\e&quot;
</pre></div>

<p>You can also use the pre-defined XML entity names:
</p><div class="example">
<pre class="example">&amp;{&amp;amp; &amp;lt; &amp;gt; &amp;quot; &amp;apos;} &rArr; &quot;&amp; &lt; &gt; \&quot; '&quot;
</pre></div>
<p>In addition, <code>&amp;lbrace;</code> <code>&amp;rbrace;</code> can be used for left and
right curly brace, though you don&rsquo;t need them for balanced parentheses:
</p><div class="example">
<pre class="example">&amp;{ &amp;rbrace;_&amp;lbrace; / {_} }  &rArr; &quot; }_{ / {_} &quot;
</pre></div>

<p>You can use the <a href="http://www.w3.org/2003/entities/2007/w3centities-f.ent">standard XML entity names</a>. For example:
</p><div class="example">
<pre class="example">&amp;{L&amp;aelig;rdals&amp;oslash;yri}
  &rArr; &quot;Lærdalsøyri&quot;
</pre></div>

<p>You can also use the standard R7RS character names <code>null</code>,
<code>alarm</code>, <code>backspace</code>, <code>tab</code>, <code>newline</code>, <code>return</code>,
<code>escape</code>, <code>space</code>, and <code>delete</code>.
For example:
</p><div class="example">
<pre class="example">&amp;{&amp;escape;&amp;space;}
</pre></div>

<p>The syntax <code>&amp;<var>name</var>;</code> is actually syntactic sugar
(specifically reader syntax) to the variable reference
<code>$entity$:<var>name</var></code>.
Hence you can also define your own entity names:
</p><div class="example">
<pre class="example">(define $entity$:crnl &quot;\r\n&quot;)
&amp;{&amp;crnl;} ⟹ &quot;\r\n&quot;
</pre></div>

</div>
<div class="subsubsection" id="Multiline-string-literals">
<h4 class="subsubsection">13.4.2.2 Multiline string literals</h4>

<div class="example">
<pre class="example"><span id="index-initial_002dignored"></span><span id="meta_002dinitial_002dignored"></span><var>initial-ignored</var> <tt>::=</tt>
    <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup> <a href="#meta_002dline_002dending"><var>line-ending</var></a> <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup> <code><b>&amp;|</b></code>
<span id="index-special_002descape"></span><span id="meta_002dspecial_002descape"></span><var>special-escape</var> <tt>::=</tt>
    <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup> <code><b>&amp;|</b></code>
  | <code><b>&amp;</b></code> <a href="#meta_002dnested_002dcomment"><var>nested-comment</var></a>
  | <code><b>&amp;-</b></code> <a href="#meta_002dintraline_002dwhitespace"><var>intraline-whitespace</var></a><sup>*</sup> <a href="#meta_002dline_002dending"><var>line-ending</var></a>
</pre></div>

<p>A line-ending directly in the text is becomes a newline,
as in a simple string literal:
</p><div class="example">
<pre class="example">(string-capitalize &amp;{one two three
uno dos tres
}) &rArr; &quot;One Two Three\nUno Dos Tres\n&quot;
</pre></div>
<p>However, you have extra control over layout.
If the string is in a nested expression, it is confusing
(and ugly) if the string cannot be indented to match
the surrounding context. The indentation marker <code><b>&amp;|</b></code>
is used to mark the end of insignificant initial whitespace.
The <code>&amp;|</code> characters and all the preceding whitespace are removed.
In addition, it also suppresses an initial newline.  Specifically,
when the initial left-brace is followed by optional (invisible)
intraline-whitespace, then a newline, then optional
intraline-whitespace (the indentation), and finally the indentation
marker <code>&amp;|</code> - all of which is removed from the output.
Otherwise the <code>&amp;|</code> only removes initial intraline-whitespace
on the same line (and itself).
</p>
<div class="example">
<pre class="example">(write (string-capitalize &amp;{
     &amp;|one two three
     &amp;|uno dos tres
}) out)
    &rArr; <i>prints</i> &quot;One Two Three\nUno Dos Tres\n&quot;
</pre></div>

<p>As a matter of style, all of the indentation lines should line up.
It is an error if there are any non-whitespace characters between
the previous newline and the indentation marker.
It is also an error to write an indentation marker before the
first newline in the literal.
</p>
<p>The line-continuation marker <code><b>&amp;-</b></code> is used to suppress a newline:
</p><div class="example">
<pre class="example">&amp;{abc&amp;-
  def} &rArr; &quot;abc  def&quot;
</pre></div>

<p>You can write a <code>#|...|#</code>-style comment following a <code>&amp;</code>.
This could be useful for annotation, or line numbers:
</p><div class="example">
<pre class="example">&amp;{&amp;#|line 1|#one two
  &amp;#|line 2|# three
  &amp;#|line 3|#uno dos tres
} &rArr; &quot;one two\n three\nuno dos tres\n&quot;
</pre></div>

</div>
<div class="subsubsection" id="Embedded-expressions">
<h4 class="subsubsection">13.4.2.3 Embedded expressions</h4>

<div class="example">
<pre class="example"><span id="index-enclosed_002dpart"></span><span id="meta_002denclosed_002dpart"></span><var>enclosed-part</var> <tt>::=</tt>
    <code><b>&amp;</b></code> <a href="#meta_002denclosed_002dmodifier"><var>enclosed-modifier</var></a><sup>*</sup> <code><b>[</b></code> <a href="#meta_002dexpression"><var>expression</var></a><sup>*</sup> <code><b>]</b></code>
  | <code><b>&amp;</b></code> <a href="#meta_002denclosed_002dmodifier"><var>enclosed-modifier</var></a><sup>*</sup> <code><b>(</b></code> <a href="#meta_002dexpression"><var>expression</var></a><sup>+</sup> <code><b>)</b></code>
</pre></div>

<p>An embedded expression has the form <code>&amp;[<var>expression</var>]</code>.
It is evaluated, the result converted to a string (as by <code>display</code>),
and the result added in the result string.
(If there are multiple expressions, they are all evaluated and
the corresponding strings inserted in the result.)
</p><div class="example">
<pre class="example">&amp;{Hello &amp;[(string-capitalize name)]!}
</pre></div>

<p>You can leave out the square brackets when the expression
is a parenthesized expression:
</p><div class="example">
<pre class="example">&amp;{Hello &amp;(string-capitalize name)!}
</pre></div>

</div>
<div class="subsubsection" id="Formatting">
<h4 class="subsubsection">13.4.2.4 Formatting</h4>

<div class="example">
<pre class="example"><span id="index-enclosed_002dmodifier"></span><span id="meta_002denclosed_002dmodifier"></span><var>enclosed-modifier</var> <tt>::=</tt>
  <code><b>~</b></code> <var>format-specifier-after-tilde</var>
</pre></div>

<p>Using <a href="#Format"><code>format</code></a> allows finer-grained control over the
output, but a problem is that the association between format
specifiers and data expressions is positional, which is hard-to-read
and error-prone. A better solution places the specifier adjacant to
the data expression:
</p><div class="example">
<pre class="example">&amp;{The response was &amp;~,2f(* 100.0 (/ responses total))%.}
</pre></div>

<p>The following escape forms are equivalent to the corresponding
forms withput the <code><b>~</b></code><var>fmt-spec</var>, except the
expression(s) are formatted using <code>format</code>:
</p><div class="display">
<pre class="display"><code><b>&amp;~</b></code><var>fmt-spec</var><code><b>[</b></code><var>expression</var><sup>*</sup><code><b>]</b></code> 
</pre></div>
<p>Again using parentheses like this:
</p><div class="display">
<pre class="display"><code><b>&amp;~</b></code><var>fmt-spec</var><code><b>(</b></code><var>expression</var><sup>+</sup><code><b>)</b></code>
</pre></div>
<p>is equivalent to:
</p><div class="display">
<pre class="display"><code><b>&amp;~</b></code><var>fmt-spec</var><code><b>[(</b></code><var>expression</var><sup>+</sup><code><b>)]</b></code>
</pre></div>

<p>The syntax of <code>format</code> specifications is arcane, but it allows you
to do some pretty neat things in a compact space.
For example to include <code>&quot;_&quot;</code> between each element of
the array <code>arr</code> you can use the <code>~{...~}</code> format speciers:
</p><div class="example">
<pre class="example">(define arr [5 6 7])
&amp;{&amp;~{&amp;[arr]&amp;~^_&amp;~}} &rArr; &quot;5_6_7&quot;
</pre></div>

<p>If no format is specified for an enclosed expression,
the that is equivalent to a <code>~a</code> format specifier,
so this is equivalent to:
</p><div class="example">
<pre class="example">&amp;{&amp;~{&amp;~a[arr]&amp;~^_&amp;~}} &rArr; &quot;5_6_7&quot;
</pre></div>
<p>which is in turn equivalent to:
</p><div class="example">
<pre class="example">(format #f &quot;~{~a~^_~}&quot; arr)
</pre></div>

<p>The fine print that makes this work:
If there are multiple expressions in a <code>&amp;[...]</code> with
no format specifier then there is an implicit <code>~a</code> for
each expression.
On the other hand, if there is an explicit format specifier,
it is not repeated for each enclosed expression: it appears
exactly once in the effective format string, whether
there are zero, one, or many expressions.
</p>
<hr>
</div>
</div>
</div>
<div class="section" id="Unicode">
<div class="header">
<p>
Next: <a href="#Regular-expressions" accesskey="n" rel="next">Regular expressions</a>, Previous: <a href="#String-literals" accesskey="p" rel="prev">String literals</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Unicode-character-classes-and-conversions"></span><h3 class="section">13.5 Unicode character classes and conversions</h3>


<p>Some of the procedures that operate on characters or strings ignore the
difference between upper case and lower case.  These procedures have
<code>-ci</code> (for &ldquo;case insensitive&rdquo;) embedded in their names.
</p>

<ul class="section-toc">
<li><a href="#Characters-2" accesskey="1">Characters</a></li>
<li><a href="#Deprecated-in_002dplace-case-modification" accesskey="2">Deprecated in-place case modification</a></li>
</ul>
<div class="subsection" id="Characters-2">
<h4 class="subsection">13.5.1 Characters</h4>

<dl class="def">
<dt id="index-char_002dupcase"><span class="category">Procedure: </span><span><strong>char-upcase</strong> <em><var>char</var></em><a href='#index-char_002dupcase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002ddowncase"><span class="category">Procedure: </span><span><strong>char-downcase</strong> <em><var>char</var></em><a href='#index-char_002ddowncase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dtitlecase"><span class="category">Procedure: </span><span><strong>char-titlecase</strong> <em><var>char</var></em><a href='#index-char_002dtitlecase' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dfoldcase"><span class="category">Procedure: </span><span><strong>char-foldcase</strong> <em><var>char</var></em><a href='#index-char_002dfoldcase' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures take a character argument and return a character
result.
</p>
<p>If the argument is an upper&ndash;case or title&ndash;case character, and if there
is a single character that is its lower&ndash;case form, then
<code>char-downcase</code> returns that character.
</p>
<p>If the argument is a lower&ndash;case or title&ndash;case character, and there is
a single character that is its upper&ndash;case form, then <code>char-upcase</code>
returns that character.
</p>
<p>If the argument is a lower&ndash;case or upper&ndash;case character, and there is
a single character that is its title&ndash;case form, then
<code>char-titlecase</code> returns that character.
</p>
<p>If the argument is not a title&ndash;case character and there is no single
character that is its title&ndash;case form, then <code>char-titlecase</code>
returns the upper&ndash;case form of the argument.
</p>
<p>Finally, if the character has a case&ndash;folded character, then
<code>char-foldcase</code> returns that character.  Otherwise the character
returned is the same as the argument.
</p>
<p>For Turkic characters <code>#\x130</code> and <code>#\x131</code>,
<code>char-foldcase</code> behaves as the identity function; otherwise
<code>char-foldcase</code> is the same as <code>char-downcase</code> composed with
<code>char-upcase</code>.
</p>
<div class="example">
<pre class="example">(char-upcase #\i)               &rArr;  #\I
(char-downcase #\i)             &rArr;  #\i
(char-titlecase #\i)            &rArr;  #\I
(char-foldcase #\i)             &rArr;  #\i

(char-upcase #\ß)               &rArr;  #\ß
(char-downcase #\ß)             &rArr;  #\ß
(char-titlecase #\ß)            &rArr;  #\ß
(char-foldcase #\ß)             &rArr;  #\ß

(char-upcase #\Σ)               &rArr;  #\Σ
(char-downcase #\Σ)             &rArr;  #\σ
(char-titlecase #\Σ)            &rArr;  #\Σ
(char-foldcase #\Σ)             &rArr;  #\σ

(char-upcase #\ς)               &rArr;  #\Σ
(char-downcase #\ς)             &rArr;  #\ς
(char-titlecase #\ς)            &rArr;  #\Σ
(char-foldcase #\ς)             &rArr;  #\σ
</pre></div>

<blockquote>
<p><em>Note:</em> <code>char-titlecase</code> does not always return a title&ndash;case
character.
</p></blockquote>

<blockquote>
<p><em>Note:</em> These procedures are consistent with Unicode&rsquo;s
locale&ndash;independent mappings from scalar values to scalar values for
upcase, downcase, titlecase, and case&ndash;folding operations.  These
mappings can be extracted from <samp>UnicodeData.txt</samp> and
<samp>CaseFolding.txt</samp> from the Unicode Consortium, ignoring Turkic
mappings in the latter.
</p>
<p>Note that these character&ndash;based procedures are an incomplete
approximation to case conversion, even ignoring the user&rsquo;s locale.  In
general, case mappings require the context of a string, both in
arguments and in result.  The <code>string-upcase</code>,
<code>string-downcase</code>, <code>string-titlecase</code>, and
<code>string-foldcase</code> procedures perform more general case conversion.
</p></blockquote>
</dd></dl>

<dl class="def">
<dt id="index-char_002dci_003d_003f"><span class="category">Procedure: </span><span><strong>char-ci=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_002dci_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dci_003c_003f"><span class="category">Procedure: </span><span><strong>char-ci&lt;?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_002dci_003c_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dci_003e_003f"><span class="category">Procedure: </span><span><strong>char-ci&gt;?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_002dci_003e_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dci_003c_003d_003f"><span class="category">Procedure: </span><span><strong>char-ci&lt;=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_002dci_003c_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dci_003e_003d_003f"><span class="category">Procedure: </span><span><strong>char-ci&gt;=?</strong> <em><var>char</var><sub>1</sub> <var>char</var><sub>2</sub> <var>char</var><sub>3</sub> &hellip;</em><a href='#index-char_002dci_003e_003d_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures are similar to <code>char=?</code>, etc., but operate on the
case&ndash;folded versions of the characters.
</p>
<div class="example">
<pre class="example">(char-ci&lt;? #\z #\Z)             &rArr; #f
(char-ci=? #\z #\Z)             &rArr; #f
(char-ci=? #\ς #\σ)             &rArr; #t
</pre></div>
</dd></dl>


<dl class="def">
<dt id="index-char_002dalphabetic_003f"><span class="category">Procedure: </span><span><strong>char-alphabetic?</strong> <em><var>char</var></em><a href='#index-char_002dalphabetic_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dnumeric_003f"><span class="category">Procedure: </span><span><strong>char-numeric?</strong> <em><var>char</var></em><a href='#index-char_002dnumeric_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dwhitespace_003f"><span class="category">Procedure: </span><span><strong>char-whitespace?</strong> <em><var>char</var></em><a href='#index-char_002dwhitespace_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dupper_002dcase_003f"><span class="category">Procedure: </span><span><strong>char-upper-case?</strong> <em><var>char</var></em><a href='#index-char_002dupper_002dcase_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dlower_002dcase_003f"><span class="category">Procedure: </span><span><strong>char-lower-case?</strong> <em><var>char</var></em><a href='#index-char_002dlower_002dcase_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-char_002dtitle_002dcase_003f"><span class="category">Procedure: </span><span><strong>char-title-case?</strong> <em><var>char</var></em><a href='#index-char_002dtitle_002dcase_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return <code>#t</code> if their arguments are alphabetic,
numeric, whitespace, upper&ndash;case, lower&ndash;case, or title&ndash;case
characters, respectively; otherwise they return <code>#f</code>.
</p>
<p>A character is alphabetic if it has the Unicode &ldquo;Alphabetic&rdquo; property.
A character is numeric if it has the Unicode &ldquo;Numeric&rdquo; property.  A
character is whitespace if has the Unicode &ldquo;White_Space&rdquo; property.  A
character is upper case if it has the Unicode &ldquo;Uppercase&rdquo; property,
lower case if it has the &ldquo;Lowercase&rdquo; property, and title case if it is
in the Lt general category.
</p>
<div class="example">
<pre class="example">(char-alphabetic? #\a)          &rArr;  #t
(char-numeric? #\1)             &rArr;  #t
(char-whitespace? #\space)      &rArr;  #t
(char-whitespace? #\x00A0)      &rArr;  #t
(char-upper-case? #\Σ)          &rArr;  #t
(char-lower-case? #\σ)          &rArr;  #t
(char-lower-case? #\x00AA)      &rArr;  #t
(char-title-case? #\I)          &rArr;  #f
(char-title-case? #\x01C5)      &rArr;  #t
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-char_002dgeneral_002dcategory"><span class="category">Procedure: </span><span><strong>char-general-category</strong> <em><var>char</var></em><a href='#index-char_002dgeneral_002dcategory' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a symbol representing the Unicode general category of
<var>char</var>, one of <code>Lu</code>, <code>Ll</code>, <code>Lt</code>, <code>Lm</code>,
<code>Lo</code>, <code>Mn</code>, <code>Mc</code>, <code>Me</code>, <code>Nd</code>, <code>Nl</code>,
<code>No</code>, <code>Ps</code>, <code>Pe</code>, <code>Pi</code>, <code>Pf</code>, <code>Pd</code>,
<code>Pc</code>, <code>Po</code>, <code>Sc</code>, <code>Sm</code>, <code>Sk</code>, <code>So</code>,
<code>Zs</code>, <code>Zp</code>, <code>Zl</code>, <code>Cc</code>, <code>Cf</code>, <code>Cs</code>,
<code>Co</code>, or <code>Cn</code>.
</p>
<div class="example">
<pre class="example">(char-general-category #\a)         &rArr; Ll
(char-general-category #\space)     &rArr; Zs
(char-general-category #\x10FFFF)   &rArr; Cn  
</pre></div>
</dd></dl>


</div>
<div class="subsection" id="Deprecated-in_002dplace-case-modification">
<h4 class="subsection">13.5.2 Deprecated in-place case modification</h4>

<p>The following functions are deprecated; they really don&rsquo;t
and cannot do the right thing, because in some languages
upper and lower case can use different number of characters.
</p>
<dl class="def">
<dt id="index-string_002dupcase_0021"><span class="category">Procedure: </span><span><strong>string-upcase!</strong> <em>str</em><a href='#index-string_002dupcase_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>Deprecated:</em> Destructively modify <var>str</var>, replacing the letters
by their upper-case equivalents.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002ddowncase_0021"><span class="category">Procedure: </span><span><strong>string-downcase!</strong> <em>str</em><a href='#index-string_002ddowncase_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>Deprecated:</em> Destructively modify <var>str</var>, replacing the letters
by their upper-lower equivalents.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dcapitalize_0021"><span class="category">Procedure: </span><span><strong>string-capitalize!</strong> <em>str</em><a href='#index-string_002dcapitalize_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>Deprecated:</em> Destructively modify <var>str</var>, such that the letters that start a new word
are replaced by their title-case equivalents, while non-initial letters
are replaced by their lower-case equivalents.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Regular-expressions">
<div class="header">
<p>
Previous: <a href="#Unicode" accesskey="p" rel="prev">Unicode character classes and conversions</a>, Up: <a href="#Characters-and-text" accesskey="u" rel="up">Characters and text</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Regular-expressions-1"></span><h3 class="section">13.6 Regular expressions</h3>

<p>Kawa provides <em>regular expressions</em>, which is a convenient
mechanism for matching a string against a <em>pattern</em>
and maybe replacing matching parts.
</p>
<p>A regexp is a string that describes a pattern. A regexp matcher tries
to match this pattern against (a portion of) another string, which we
will call the text string. The text string is treated as raw text and
not as a pattern.
</p>
<p>Most of the characters in a regexp pattern are meant to match
occurrences of themselves in the text string. Thus, the pattern &ldquo;<code>abc</code>&rdquo;
matches a string that contains the characters &ldquo;<code>a</code>&rdquo;, &ldquo;<code>b</code>&rdquo;,
&ldquo;<code>c</code>&rdquo; in succession.
</p>
<p>In the regexp pattern, some characters act as <em>metacharacters</em>,
and some character sequences act as <em>metasequences</em>. That is, they
specify something other than their literal selves. For example, in the
pattern &ldquo;<code>a.c</code>&rdquo;, the characters &ldquo;<code>a</code>&rdquo; and &ldquo;<code>c</code>&rdquo; do stand
for themselves but the metacharacter &ldquo;<code>.</code>&rdquo; can match any character
(other than newline). Therefore, the pattern &ldquo;<code>a.c</code>&rdquo; matches an
&ldquo;<code>a</code>&rdquo;, followed by any character, followed by a &ldquo;<code>c</code>&rdquo;.
</p>
<p>If we needed to match the character &ldquo;<code>.</code>&rdquo; itself, we <em>escape</em>
it, ie, precede it with a backslash &ldquo;<code>\</code>&rdquo;. The character sequence
&ldquo;<code>\.</code>&rdquo; is thus a metasequence, since it doesn’t match itself but
rather just &ldquo;<code>.</code>&rdquo;.  So, to match &ldquo;<code>a</code>&rdquo; followed by a literal
&ldquo;<code>.</code>&rdquo; followed by &ldquo;<code>c</code>&rdquo; we use the regexp pattern
&ldquo;<code>a\.c</code>&rdquo;.  To write this as a Scheme string literal,
you need to quote the backslash, so you need to write <code>&quot;a\\.c&quot;</code>.
Kawa also allows the literal syntax <code>#/a\.c/</code>,
which avoids the need to double the backslashes.
</p>
<p>You can choose between two similar styles of regular expressions.
The two differ slightly in terms of which characters act as metacharacters,
and what those metacharacters mean:
</p><ul>
<li> Functions starting with <code>regex-</code> are implemented using
the <code>java.util.regex</code> package.
This is likely to be more efficient, has better Unicode support and
some other minor extra features, and literal syntax <code>#/a\.c/</code>
mentioned above.
</li><li> Functions starting with <code>pregexp-</code> are implemented in pure Scheme
using Dorai Sitaram&rsquo;s &ldquo;Portable Regular Expressions for Scheme&rdquo; library.
These will be portable to more Scheme implementations, including BRL,
and is available on older Java versions.
</li></ul>


<ul class="section-toc">
<li><a href="#Java-regular-expressions" accesskey="1">Java regular expressions</a></li>
<li><a href="#Portable-Scheme-regular-expressions" accesskey="2">Portable Scheme regular expressions</a></li>
</ul>
<div class="subsection" id="Java-regular-expressions">
<h4 class="subsection">13.6.1 Java regular expressions</h4>

<p>The syntax for regular expressions is
<a href="http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html">documented here</a>.
</p>
<dl class="def">
<dt id="index-regex"><span class="category">Type: </span><span><strong>regex</strong><a href='#index-regex' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A compiled regular expression,
implemented as <code>java.util.regex.Pattern</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-regex-1"><span class="category">Constructor: </span><span><strong>regex</strong> <em>arg</em><a href='#index-regex-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Given a regular expression pattern (as a string),
compiles it to a <code>regex</code> object.
</p>
<div class="example">
<pre class="example">(regex &quot;a\\.c&quot;)
</pre></div>
<p>This compiles into a pattern that matches an
&ldquo;<code>a</code>&rdquo;, followed by any character, followed by a &ldquo;<code>c</code>&rdquo;.
</p></dd></dl>

<p>The Scheme reader recognizes &ldquo;<code>#/</code>&rdquo; as the start of a
regular expression <em>pattern literal</em>, which ends with the next
un-escaped &ldquo;<code>/</code>&rdquo;.
This has the big advantage that you don&rsquo;t need to double the backslashes:
</p><div class="example">
<pre class="example">#/a\.c/
</pre></div>
<p>This is equivalent to <code>(regex &quot;a\\.c&quot;)</code>, except it is
compiled at read-time.
If you need a literal &ldquo;<code>/</code>&rdquo; in a pattern, just escape it
with a backslash: &ldquo;<code>#/a\/c/</code>&rdquo; matches a &ldquo;<code>a</code>&rdquo;,
followed by a &ldquo;<code>/</code>&rdquo;, followed by a &ldquo;<code>c</code>&rdquo;.
</p>
<p>You can add single-letter <em>modifiers</em> following the pattern literal.
The following modifiers are allowed:
</p><dl compact="compact">
<dt><span><code>i</code></span></dt>
<dd><p>The modifier &ldquo;<code>i</code>&rdquo; cause the matching to ignore case.
For example the following pattern matches &ldquo;<code>a</code>&rdquo; or &ldquo;<code>A</code>&rdquo;.
</p><div class="example">
<pre class="example">#/a/i
</pre></div>
</dd>
<dt><span><code>m</code></span></dt>
<dd><p>Enables &ldquo;metaline&rdquo; mode.
Normally metacharacters &ldquo;<code>^</code>&rdquo; and &ldquo;<code>$</code>&rsquo;
match at the start end end of the entire input string.
In metaline mode &ldquo;<code>^</code>&rdquo; and &ldquo;<code>$</code>&rdquo; also
match just before or after a line terminator.
</p>
<p>Multiline mode can also be enabled by the metasequence &ldquo;<code>(?m)</code>&rdquo;. 
</p></dd>
<dt><span><code>s</code></span></dt>
<dd><p>Enable &ldquo;singleline&rdquo; (aka &ldquo;dot-all&rdquo;) mode.
In this mode the matacharacter &ldquo;<code>.</code> matches any character,
including a line breaks.
This mode be enabled by the metasequence &ldquo;<code>(?s)</code>&rdquo;.
</p></dd>
</dl>

<p>The following functions accept a regex either as
a pattern string or a compiled <code>regex</code> pattern.
I.e. the following are all equivalent:
</p><div class="example">
<pre class="example">(regex-match &quot;b\\.c&quot; &quot;ab.cd&quot;)
(regex-match #/b\.c/ &quot;ab.cd&quot;)
(regex-match (regex &quot;b\\.c&quot;) &quot;ab.cd&quot;)
(regex-match (java.util.regex.Pattern:compile &quot;b\\.c&quot;) &quot;ab.cd&quot;)
</pre></div>
<p>These all evaluate to the list <code>(&quot;b.c&quot;)</code>.
</p>
<p>The following functions must be imported by doing one of:
</p><div class="example">
<pre class="example">(require 'regex) ;; or
(import (kawa regex))
</pre></div>

<dl class="def">
<dt id="index-regex_002dmatch_002dpositions"><span class="category">Procedure: </span><span><strong>regex-match-positions</strong> <em>regex string [start [end]]</em><a href='#index-regex_002dmatch_002dpositions' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The procedure <code>regex‑match‑position</code> takes pattern and a
text <var>string</var>, and returns a match if the regex matches (some part of)
the text string.
</p>
<p>Returns <code>#f</code> if the regexp did not match the string;
and a list of index pairs if it did match.
</p><div class="example">
<pre class="example">(regex-match-positions &quot;brain&quot; &quot;bird&quot;) &rArr; #f
(regex-match-positions &quot;needle&quot; &quot;hay needle stack&quot;)
  &rArr; ((4 . 10))
</pre></div>

<p>In the second example, the integers 4 and 10 identify the substring
that was matched. 4 is the starting (inclusive) index and 10 the
ending (exclusive) index of the matching substring.
</p>
<div class="example">
<pre class="example">(substring &quot;hay needle stack&quot; 4 10) &rArr; &quot;needle&quot;
</pre></div>

<p>In this case the return list contains only one index
pair, and that pair represents the entire substring matched by the
regexp. When we discuss subpatterns later, we will see how a single
match operation can yield a list of submatches.
</p>
<p><code>regex‑match‑positions</code> takes optional third and fourth arguments
that specify the indices of the text string within which the matching
should take place.
</p>
<div class="example">
<pre class="example">(regex-match-positions &quot;needle&quot;
  &quot;his hay needle stack -- my hay needle stack -- her hay needle stack&quot;
  24 43)
  &rArr; ((31 . 37))
</pre></div>

<p>Note that the returned indices are still reckoned relative to the full text string.
</p></dd></dl>

<dl class="def">
<dt id="index-regex_002dmatch"><span class="category">Procedure: </span><span><strong>regex-match</strong> <em>regex string [start [end]]</em><a href='#index-regex_002dmatch' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The procedure <code>regex‑match</code> is called like <code>regex‑match‑positions</code>
but instead of returning index pairs it returns the matching substrings:
</p><div class="example">
<pre class="example">(regex-match &quot;brain&quot; &quot;bird&quot;) &rArr; #f
(regex-match &quot;needle&quot; &quot;hay needle stack&quot;)
  &rArr; (&quot;needle&quot;)
</pre></div>

<p><code>regex‑match</code> also takes optional third and fourth arguments,
with the same meaning as does <code>regex‑match‑positions</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-regex_002dsplit"><span class="category">Procedure: </span><span><strong>regex-split</strong> <em>regex string</em><a href='#index-regex_002dsplit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes two arguments, a <var>regex</var> pattern and a text <var>string</var>,
and returns a list of substrings of the text string,
where the pattern identifies the delimiter separating the substrings.
</p><div class="example">
<pre class="example">(regex-split &quot;:&quot; &quot;/bin:/usr/bin:/usr/bin/X11:/usr/local/bin&quot;)
  &rArr; (&quot;/bin&quot; &quot;/usr/bin&quot; &quot;/usr/bin/X11&quot; &quot;/usr/local/bin&quot;)

(regex-split &quot; &quot; &quot;pea soup&quot;)
  &rArr; (&quot;pea&quot; &quot;soup&quot;)
</pre></div>

<p>If the first argument can match an empty string, then the list of all
the single-character substrings is returned, plus we get
a empty strings at each end.
</p>
<div class="example">
<pre class="example">(regex-split &quot;&quot; &quot;smithereens&quot;)
  &rArr; (&quot;&quot; &quot;s&quot; &quot;m&quot; &quot;i&quot; &quot;t&quot; &quot;h&quot; &quot;e&quot; &quot;r&quot; &quot;e&quot; &quot;e&quot; &quot;n&quot; &quot;s&quot; &quot;&quot;)
</pre></div>

<p>(Note: This behavior is different from <code>pregexp-split</code>.)
</p>
<p>To identify one-or-more spaces as the delimiter, take care to use the regexp
&ldquo;<code> +</code>&rdquo;, not &ldquo;<code> *</code>&rdquo;.
</p><div class="example">
<pre class="example">(regex-split &quot; +&quot; &quot;split pea     soup&quot;)
  &rArr; (&quot;split&quot; &quot;pea&quot; &quot;soup&quot;)
(regex-split &quot; *&quot; &quot;split pea     soup&quot;)
  &rArr; (&quot;&quot; &quot;s&quot; &quot;p&quot; &quot;l&quot; &quot;i&quot; &quot;t&quot; &quot;&quot; &quot;p&quot; &quot;e&quot; &quot;a&quot; &quot;&quot; &quot;s&quot; &quot;o&quot; &quot;u&quot; &quot;p&quot; &quot;&quot;)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-regex_002dreplace"><span class="category">Procedure: </span><span><strong>regex‑replace</strong> <em>regex string replacement</em><a href='#index-regex_002dreplace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Replaces the matched portion of the text <var>string</var> by another a
<var>replacdement</var> string.
</p><div class="example">
<pre class="example">(regex-replace &quot;te&quot; &quot;liberte&quot; &quot;ty&quot;)
  &rArr; &quot;liberty&quot;
</pre></div>

<p>Submatches can be used in the replacement string argument.
The replacement string can use &ldquo;<code>$<var>n</var></code>&rdquo;
as a <em>backreference</em> to refer back to the <var>n</var>th
submatch, ie, the substring that matched the <var>n</var>th
subpattern.   &ldquo;<code>$0</code>&rdquo; refers to the entire match.
</p><div class="example">
<pre class="example">(regex-replace #/_(.+?)_/
               &quot;the _nina_, the _pinta_, and the _santa maria_&quot;
		&quot;*$1*&quot;))
  &rArr; &quot;the *nina*, the _pinta_, and the _santa maria_&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-regex_002dreplace_002a"><span class="category">Procedure: </span><span><strong>regex‑replace*</strong> <em>regex string replacement</em><a href='#index-regex_002dreplace_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Replaces all matches in the text <var>string</var> by the <var>replacement</var> string:
</p><div class="example">
<pre class="example">(regex-replace* &quot;te&quot; &quot;liberte egalite fraternite&quot; &quot;ty&quot;)
  &rArr; &quot;liberty egality fratyrnity&quot;
(regex-replace* #/_(.+?)_/
                &quot;the _nina_, the _pinta_, and the _santa maria_&quot;
                &quot;*$1*&quot;)
  &rArr; &quot;the *nina*, the *pinta*, and the *santa maria*&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-regex_002dquote"><span class="category">Procedure: </span><span><strong>regex-quote</strong> <em>pattern</em><a href='#index-regex_002dquote' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes an arbitrary string and returns a pattern string that precisely
matches it. In particular, characters in the input string that could
serve as regex metacharacters are escaped as needed.
</p>
<div class="example">
<pre class="example">(regex-quote &quot;cons&quot;)
  &rArr; &quot;\Qcons\E&quot;
</pre></div>
<p><code>regex‑quote</code> is useful when building a composite regex
from a mix of regex strings and verbatim strings.
</p></dd></dl>

</div>
<div class="subsection" id="Portable-Scheme-regular-expressions">
<h4 class="subsection">13.6.2 Portable Scheme regular expressions</h4>

<p>This provides the procedures <code>pregexp</code>, <code>pregexp‑match‑positions</code>,
<code>pregexp‑match</code>, <code>pregexp‑split</code>, <code>pregexp‑replace</code>,
<code>pregexp‑replace*</code>, and <code>pregexp‑quote</code>.
</p>
<p>Before using them, you must require them:
</p><div class="example">
<pre class="example">(require 'pregexp)
</pre></div>

<p>These procedures have the same interface as the corresponding
<code>regex-</code> versions, but take slightly different pattern syntax.
The replace commands use &ldquo;<code>\</code>&rdquo; instead of &ldquo;<code>$</code>&rdquo;
to indicate substitutions.
Also, <code>pregexp‑split</code> behaves differently from
<code>regex‑split</code> if the pattern can match an empty string.
</p>
<p>See <a href="http://www.ccs.neu.edu/home/dorai/pregexp/index.html">here for details</a>.
</p>
<hr>
</div>
</div>
</div>
<div class="chapter" id="Data-structures">
<div class="header">
<p>
Next: <a href="#Eval-and-Environments" accesskey="n" rel="next">Eval and Environments</a>, Previous: <a href="#Characters-and-text" accesskey="p" rel="prev">Characters and text</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Data-structures-1"></span><h2 class="chapter">14 Data structures</h2>


<ul class="section-toc">
<li><a href="#Sequences" accesskey="1">Sequences</a></li>
<li><a href="#Lists" accesskey="2">Lists</a></li>
<li><a href="#Vectors" accesskey="3">Vectors</a></li>
<li><a href="#Uniform-vectors" accesskey="4">Uniform vectors</a></li>
<li><a href="#Bytevectors" accesskey="5">Bytevectors</a></li>
<li><a href="#Ranges" accesskey="6">Ranges</a></li>
<li><a href="#Streams" accesskey="7">Streams - lazy lists</a></li>
<li><a href="#Arrays" accesskey="8">Multi-dimensional Arrays</a></li>
<li><a href="#Hash-tables" accesskey="9">Hash tables</a></li>
</ul>
<hr>
<div class="section" id="Sequences">
<div class="header">
<p>
Next: <a href="#Lists" accesskey="n" rel="next">Lists</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Sequences-1"></span><h3 class="section">14.1 Sequences</h3>

<p>A <em>sequence</em> is a generalized list, consisting of zero or more values.
You can choose between a number of different kinds of sequence implementations.
Scheme traditionally has <a href="#Lists">lists</a> and <a href="#Vectors">vectors</a>.
Any Java class that implements <code>java.util.List</code> is a sequence type.
Raw Java arrays can also be viewerd as a sequence,
and strings can be viewed a sequence (or vector) of characters.
Kawa also provides <a href="#Uniform-vectors">uniform vectors</a>.
</p>
<p>Sequence types differ in their API, but given a sequence type <var>stype</var>
you can construct instances of that type using the syntax:
</p><div class="example">
<pre class="example">(<var>stype</var> <var>v0</var> <var>v1</var> .... <var>vn</var>)
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(bytevector 9 8 7 6)  &rArr; #u8(9 8 7 6)
</pre></div>

<p>For a raw Java class name <var>jname</var> you may need to use
the empty keyword <code>||:</code> to separate constructor parameters (if any)
from sequence elements, as in:
</p><div class="example">
<pre class="example">(gnu.lists.U8Vector ||: 9 8 7 6)  &rArr; #u8(9 8 7 6)
</pre></div>
<p>This syntax works with any type with a default constructor
and a 1-argument <code>add</code> method;
see <a href="#Allocating-objects">Allocating objects</a> for details.
You can use the same syntax for allocating arrays,
though array creation supports <a href="#Creating_002dnew_002dJava_002darrays">more options</a>.
</p>
<p>To extract an element from Scheme sequence of type <var>stype</var>
there is usually a function <code><var>stype</var>-ref</code>.  For example:
</p><div class="example">
<pre class="example">(define vec1 (vector 5 6 7 8))
(vector-ref vec1 2) &rArr; 7
</pre></div>

<p>More concisely, you can use (Kawa-specific) function call syntax:
</p><div class="example">
<pre class="example">(vec1 3) &rArr; 8
</pre></div>

<p>The index can be another sequence, which creates a new sequence
of the selected indexes:
</p><div class="example">
<pre class="example">(vec1 [3 0 2 1]) &rArr; #(8 5 7 6)
</pre></div>
<p>It is convenient to use a <a href="#Ranges"><em>range</em></a> to select
a sub-sequence:
</p><div class="example">
<pre class="example">(vec1 [1 &lt;=: 3]) &rArr; #(6 7 8)
(vec1 [2 &lt;:]) &rArr; #(7 8)
</pre></div>

<p>The same function call syntax also works for raw Java arrays
(though the index is restricted to an integer, not a sequence or array):
</p><div class="example">
<pre class="example">(define arr1 (long[] 4 5 6 7))
(arr1 3) &rArr; 7
</pre></div>

<p>To assign to (replace) an element from a sequence of Scheme type <var>stype</var>
there is usually a function <code><var>stype</var>-set!</code>:
</p><div class="example">
<pre class="example">(vector-set! vec1 1 9)
vec1 &rArr; #(5 9 7 8)
</pre></div>

<p>Again, you can use the function call syntax:
</p><div class="example">
<pre class="example">(set! (vec1 2) 'x)
vec1 &rArr; #(5 9 x 8)
</pre></div>

<dl class="def">
<dt id="index-length"><span class="category">Procedure: </span><span><strong>length</strong> <em>seq</em><a href='#index-length' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the number of elements of the <var>seq</var>.
</p>
<div class="example">
<pre class="example">(length '(a b c))             &rArr;  3
(length '(a (b) (c d e)))     &rArr;  3
(length '())                  &rArr;  0
(length [3 4 [] 12])          &rArr;  4
(length (vector))             &rArr;  0
(length (int[] 7 6))          &rArr;  2
</pre></div>

<p>The length of a string is the number of characters (Unicode code points).
In contrast, the <code>length</code> <em>method</em> (of the <code>CharSequence</code> interface)
returns the number of 16-bit code points:
</p><div class="example">
<pre class="example">(length &quot;Hello&quot;)              &rArr;  5
(define str1 &quot;Hello \x1f603;!&quot;)
(invoke str1 'length)         &rArr;  9
(length str1)                 &rArr;  8 ; Used to return 9 in Kawa 2.x.
(string-length str1)          &rArr;  8
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Lists">
<div class="header">
<p>
Next: <a href="#Vectors" accesskey="n" rel="next">Vectors</a>, Previous: <a href="#Sequences" accesskey="p" rel="prev">Sequences</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Lists-1"></span><h3 class="section">14.2 Lists</h3>

<p>A pair (sometimes called a <em>dotted pair</em>) is a record structure
with two fields called the car and cdr fields (for historical
reasons). Pairs are created by the procedure <code>cons</code>. The
car and cdr fields are accessed by the procedures <code>car</code> and
<code>cdr</code>. The car and cdr fields are assigned by the procedures
<code>set-car!</code> and <code>set-cdr!</code>.
</p>
<p>Pairs are used primarily to represent lists. A <em>list</em> can be
defined recursively as either the empty list or a pair whose
cdr is a list. More precisely, the set of lists is defined as
the smallest set <var>X</var> such that:
</p><ul>
<li> The empty list is in <var>X</var>.
</li><li> If <var>list</var> is in <var>X</var>, then any pair whose cdr field contains
<var>list</var> is also in <var>X</var>.
</li></ul>

<p>The objects in the car fields of successive pairs of a list are
the elements of the list. For example, a two-element list
is a pair whose car is the first element and whose cdr is a
pair whose car is the second element and whose cdr is the
empty list. The length of a list is the number of elements,
which is the same as the number of pairs.
</p>
<p>The empty list is a special object of its own type. It is not
a pair, it has no elements, and its length is zero.
</p>
<p><em>Note:</em> The above definitions imply that all lists have finite
length and are terminated by the empty list.
</p>
<p>The most general notation (external representation) for
Scheme pairs is the “dotted” notation <code>(<var>c1</var> . <var>c2</var> )</code>
where <var>c1</var> is the value of the car field and
<var>c2</var> is the value of the cdr field.
For example <code>(4 . 5)</code> is a pair whose car is 4 and
whose cdr is 5. Note that <code>(4 . 5)</code> is the external representation
of a pair, not an expression that evaluates to a pair.
</p>
<p>A more streamlined notation can be used for lists: the
elements of the list are simply enclosed in parentheses and
separated by spaces. The empty list is written <code>()</code>.
For example,
</p><div class="example">
<pre class="example">(a b c d e)
</pre></div>
<p>and
</p><div class="example">
<pre class="example">(a . (b . (c . (d . (e . ())))))
</pre></div>
<p>are equivalent notations for a list of symbols.
</p>
<p>A chain of pairs not ending in the empty list is called an
<em>improper list</em>. Note that an improper list is not a list.
The list and dotted notations can be combined to represent
improper lists:
</p><div class="example">
<pre class="example">(a b c . d)
</pre></div>
<p>is equivalent to
</p><div class="example">
<pre class="example">(a . (b . (c . d)))
</pre></div>

<p><em>Needs to finish merging from R7RS!</em>
</p>
<dl class="def">
<dt id="index-make_002dlist"><span class="category">Procedure: </span><span><strong>make-list</strong> <em>k [fill]</em><a href='#index-make_002dlist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated list of <var>k</var> elements.  If a second argument
is given, the each element is initialized to <var>fill</var>.
Otherwise the initial contents of each element is unspecified.
</p><div class="example">
<pre class="example">(make-list 2 3)   &rArr; (3 3)
</pre></div>
</dd></dl>

<span id="SRFI_002d1"></span><ul class="section-toc">
<li><a href="#SRFI_002d1-list-library" accesskey="1">SRFI-1 list library</a></li>
<li><a href="#SRFI_002d101-Purely-Functional-Random_002dAccess-Pairs-and-Lists" accesskey="2">SRFI-101 Purely Functional Random-Access Pairs and Lists</a></li>
</ul>
<div class="subsection" id="SRFI_002d1-list-library">
<h4 class="subsection">14.2.1 SRFI-1 list library</h4>

<p>The <a href="http://srfi.schemers.org/srfi-1/srfi-1.html">SRFI-1 List Library</a>
is available, though not enabled by default.  To use its functions you
must <code>(require 'list-lib)</code> or <code>(require 'srfi-1)</code>.
</p><div class="example">
<pre class="example">(require 'list-lib)
(iota 5 0 -0.5) &rArr; (0.0 -0.5 -1.0 -1.5 -2.0)
</pre></div>

<dl class="def">
<dt id="index-reverse_0021"><span class="category">Procedure: </span><span><strong>reverse!</strong> <em>list</em><a href='#index-reverse_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The result is a list consisting of the elements of <var>list</var> in reverse order.
No new pairs are allocated, instead the pairs of <var>list</var> are re-used,
with <code>cdr</code> cells of <var>list</var> reversed in place.  Note that if <var>list</var>
was pair, it becomes the last pair of the reversed result.
</p></dd></dl>

<span id="SRFI_002d101"></span></div>
<div class="subsection" id="SRFI_002d101-Purely-Functional-Random_002dAccess-Pairs-and-Lists">
<h4 class="subsection">14.2.2 SRFI-101 Purely Functional Random-Access Pairs and Lists</h4>

<p><a href="http://srfi.schemers.org/srfi-101/srfi-101.html">SRFI-101</a>
specifies immutable (read-only) lists with fast (logarithmic) indexing
and functional
update (i.e. return a modified list).
These are implemented by a <code>RAPair</code> class
which extends the generic <code>pair</code> type, which means that most
code that expects a standard list will work on these lists as well.
</p>
<hr>
</div>
</div>
<div class="section" id="Vectors">
<div class="header">
<p>
Next: <a href="#Uniform-vectors" accesskey="n" rel="next">Uniform vectors</a>, Previous: <a href="#Lists" accesskey="p" rel="prev">Lists</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Vectors-1"></span><h3 class="section">14.3 Vectors</h3>

<p>Vectors are heterogeneous structures whose elements are indexed by
integers.  A vector typically occupies less space than a list of the
same length, and the average time needed to access a randomly chosen
element is typically less for the vector than for the list.
</p>
<p>The <em>length</em> of a vector is the number of elements that it
contains.  This number is a non&ndash;negative integer that is fixed when the
vector is created.  The <em>valid indices</em> of a vector are the exact
non&ndash;negative integer objects less than the length of the vector.  The
first element in a vector is indexed by zero, and the last element is
indexed by one less than the length of the vector.
</p>
<p>Vectors are written using the notation <code>#(<var>obj</var> ...)</code>.
For example, a vector of length 3 3 containing the number zero
in element 0, the list <code>(2 2 2 2)</code> in element 1, and the
string <code>&quot;Anna&quot;</code> in element 2 can be written as following:
</p><div class="example">
<pre class="example">#(0 (2 2 2 2) &quot;Anna&quot;)
</pre></div>
<p>Note that this is the external representation of a vector.
In Kawa, a vector datum is self-evaluating,
but for style (and compatibility with R7RS) is is suggested
you quote a vector constant:
</p><div class="example">
<pre class="example">’#(0 (2 2 2 2) &quot;Anna&quot;)  &rArr; #(0 (2 2 2 2) &quot;Anna&quot;)
</pre></div>

<p>Compare these different ways of creating a vector:
</p><dl compact="compact">
<dt><span><code>(vector a b c)</code></span></dt>
<dd><p>In this case <code>a</code>, <code>b</code>, and <code>c</code> are expressions evaluated at
run-time and the results used to initialize a newly-allocated 3-element vector.
</p></dd>
<dt><span><code>[a b c]</code></span></dt>
<dd><p>Same as using vector, but more concise, and results in an immutable
(non-modifiable) vector.
</p></dd>
<dt><span><code>#(a b c)</code></span></dt>
<dd><p>This is reader syntax and creates a vector literal,
at read-time, early in compile-time.
The symbols <code>a</code>, <code>b</code>, and <code>c</code> are not evaluated
but instead used literally.
</p></dd>
<dt><span><code>`#(,a ,b ,c)</code></span></dt>
<dd><p>This is reader-syntax, using quasi-quotation,
so <code>a</code>, <code>b</code>, and <code>c</code> are expressions evaluated at run-time.
This is equivalent to <code>[a b c]</code> in that it results in an immutable vector.
</p></dd>
</dl>


<dl class="def">
<dt id="index-vector-1"><span class="category">Type: </span><span><strong>vector</strong><a href='#index-vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of vector objects.
</p></dd></dl>

<dl class="def">
<dt id="index-vector-2"><span class="category">Constructor: </span><span><strong>vector</strong> <em><var>obj</var> &hellip;</em><a href='#index-vector-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated vector whose elements contain the given
arguments.  Analogous to <code>list</code>.
</p>
<div class="example">
<pre class="example">(vector 'a 'b 'c)               &rArr;  #(a b c)
</pre></div>

<p>Alternatively, you can use square-bracket syntax,
which results in an immutable vector:
</p><div class="example">
<pre class="example">['a 'b 'c]               &rArr;  #(a b c)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-make_002dvector"><span class="category">Procedure: </span><span><strong>make-vector</strong> <em><var>k</var></em><a href='#index-make_002dvector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dvector-1"><span class="category">Procedure: </span><span><strong>make-vector</strong> <em><var>k</var> <var>fill</var></em><a href='#index-make_002dvector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated vector of <var>k</var> elements.  If a second
argument is given, then each element is initialized to <var>fill</var>.
Otherwise the initial contents of each element is <code>#!null</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_003f"><span class="category">Procedure: </span><span><strong>vector?</strong> <em><var>obj</var></em><a href='#index-vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a vector, <code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-vector_002dlength"><span class="category">Procedure: </span><span><strong>vector-length</strong> <em><var>vector</var></em><a href='#index-vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the number of elements in <var>vector</var> as an exact integer.
</p>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dref"><span class="category">Procedure: </span><span><strong>vector-ref</strong> <em><var>vector</var> <var>k</var></em><a href='#index-vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if <var>k</var> is not a valid index of <var>vector</var>.
The <code>vector-ref</code>
procedure returns the contents of element <var>k</var> of <var>vector</var>.
</p>
<div class="example">
<pre class="example">(vector-ref '#(1 1 2 3 5 8 13 21) 5)     &rArr;  8
(vector-ref '#(1 1 2 3 5 8 13 21)
  (inexact-&gt;exact (round (* 2 (acos -1)))))
&rArr; 13
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dset_0021"><span class="category">Procedure: </span><span><strong>vector-set!</strong> <em><var>vector</var> <var>k</var> <var>obj</var></em><a href='#index-vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if <var>k</var> is not a valid index of <var>vector</var>.
The <code>vector-set!</code>
procedure stores <var>obj</var> in element <var>k</var> of <var>vector</var>, and
returns no values.
</p>
<div class="example">
<pre class="example">(let ((vec (vector 0 '(2 2 2 2) &quot;Anna&quot;)))
  (vector-set! vec 1 '(&quot;Sue&quot; &quot;Sue&quot;))
  vec)
  &rArr;  #(0 (&quot;Sue&quot; &quot;Sue&quot;) &quot;Anna&quot;)

(vector-set! '#(0 1 2) 1 &quot;doe&quot;)
  &rArr;  <i>error</i>    ;; constant vector
</pre></div>
</dd></dl>

<p>A concise alternative to <code>vector-ref</code> and <code>vector-set!</code>
is to use function call syntax.  For example:
</p><div class="example">
<pre class="example">(let ((vec (vector 0 '(2 2 2 2) &quot;Anna&quot;)))
  (set! (vec 1) '(&quot;Sue&quot; &quot;Sue&quot;))
  (list (vec 2) (vec 1)))
  &rArr;  (&quot;Anna&quot; (&quot;Sue&quot; &quot;Sue&quot;))
</pre></div>

<dl class="def">
<dt id="index-vector_002d_003elist"><span class="category">Procedure: </span><span><strong>vector-&gt;list</strong> <em><var>vector</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>vector-&gt;list</code> procedure returns a newly allocated list of the
objects contained in the elements of <var>vector</var>
between <var>start</var> and <var>end</var>.
</p>
<div class="example">
<pre class="example">(vector-&gt;list '#(dah dah didah))        &rArr;  (dah dah didah)
(vector-&gt;list '#(dah dah didah) 1 2)    &rArr;  (dah)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-list_002d_003evector"><span class="category">Procedure: </span><span><strong>list-&gt;vector</strong> <em><var>list</var></em><a href='#index-list_002d_003evector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>list-&gt;vector</code> procedure returns a newly created vector
initialized to the elements of the list <var>list</var>, in order.
</p><div class="example">
<pre class="example">(list-&gt;vector '(dididit dah))           &rArr;  #(dididit dah)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dcopy"><span class="category">Procedure: </span><span><strong>vector-copy</strong> <em>vector [start [end]]</em><a href='#index-vector_002dcopy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated copy of the elements of the given
<var>vector</var> between <var>start</var> and <var>end</var> . The elements of the new
vector are the same (in the sense of <code>eqv?</code>) as the elements
of the old.
</p>
<div class="example">
<pre class="example">(define a #(1 8 2 8)) ; a may be immutable
(define b (vector-copy a))
(vector-set! b 0 3)   ; b is mutable
b                     &rArr;      #(3 8 2 8)
(define c (vector-copy b 1 3))
c                     &rArr; #(8 2)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dcopy_0021"><span class="category">Procedure: </span><span><strong>vector-copy!</strong> <em>to at from [start [end]]</em><a href='#index-vector_002dcopy_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Copies the elements of vector from between start and end
to vector to, starting at at. The order in which elements
are copied is unspecified, except that if the source and
destination overlap, copying takes place as if the source is first
copied into a temporary vector and then into the destination.
This can be achieved without allocating storage by making
sure to copy in the correct direction in such circumstances.
</p>
<p>It is an error if <var>at</var> is less than zero or greater than the length
of <var>to</var>.
It is also an error if <code>(- (vector-length <var>to</var>) <var>at</var>)</code> is less
than <code>(- <var>end</var> <var>start</var>)</code>.
</p>
<div class="example">
<pre class="example">(define a (vector 1 2 3 4 5))
(define b (vector 10 20 30 40 50))
(vector-copy! b 1 a 0 2)
b    &rArr; #(10 1 2 40 50)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dappend"><span class="category">Procedure: </span><span><strong>vector-append</strong> <em><var>arg</var>...</em><a href='#index-vector_002dappend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a newly allocated vector whose elements are the
concatenation of the elements of the given arguments.
Each <var>arg</var> may be a vector or a list.
</p><div class="example">
<pre class="example">(vector-append #(a b c) #(d e f))
    &rArr; #(a b c d e f)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-vector_002dfill_0021"><span class="category">Procedure: </span><span><strong>vector-fill!</strong> <em><var>vector fill</var> [<var>start</var> [<var>end</var>]]</em><a href='#index-vector_002dfill_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Stores <var>fill</var> in in the elements of <var>vector</var>
between <var>start</var> and <var>end</var>.
</p><div class="example">
<pre class="example">(define a (vector 1 2 3 4 5))
(vector-fill! a 'smash 2 4)
a  &rArr; #(1 2 smash smash 5)
</pre></div>
</dd></dl>

<p>The procedures <code>vector-map</code> and <code>vector-for-each</code>
are documented in <a href="#Mapping-functions">Mapping functions</a>.
</p>
<hr>
</div>
<div class="section" id="Uniform-vectors">
<div class="header">
<p>
Next: <a href="#Bytevectors" accesskey="n" rel="next">Bytevectors</a>, Previous: <a href="#Vectors" accesskey="p" rel="prev">Vectors</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Uniform-vectors-1"></span><h3 class="section">14.4 Uniform vectors</h3>

<p>Uniform vectors are vectors whose elements are of the same numeric type.
The are defined by <a href="http://srfi.schemers.org/srfi-4/srfi-4.html">SRFI-4</a>.
The type names (such as <code>s8vector</code>) are a Kawa extension.
</p>
<div class="display">
<pre class="display"><span id="index-uniform_002dvector"></span><span id="meta_002duniform_002dvector"></span><var>uniform-vector</var> <tt>::=</tt> <code><b>#</b></code> <a href="#meta_002duniform_002dtag"><var>uniform-tag</var></a> <a href="#meta_002dlist"><var>list</var></a>
<span id="index-uniform_002dtag"></span><span id="meta_002duniform_002dtag"></span><var>uniform-tag</var> <tt>::=</tt> <code><b>f32</b></code> | <code><b>f64</b></code>
    | <code><b>s8</b></code> | <code><b>s16</b></code> | <code><b>s32</b></code> | <code><b>s64</b></code>
    | <code><b>u8</b></code> | <code><b>u16</b></code> | <code><b>u32</b></code> | <code><b>u64</b></code>
</pre></div>

<p>This example is a literal for a 5-element vector of unsigned short (<code>ushort</code>) values:
</p><div class="example">
<pre class="example">(define uvec1 #u16(64000 3200 160 8 0))
</pre></div>

<p>Since a uniform vector is a sequence, you can use function-call
notation to index one.  For example:
</p><div class="example">
<pre class="example">(uvec1 1) &rArr; 3200
</pre></div>
<p>In this case the result is a primitive unsigned short (<code>ushort</code>),
which is converted to a <code>gnu.math.UShort</code> if an object is needed.
</p>
<dl class="def">
<dt id="index-s8vector"><span class="category">Type: </span><span><strong>s8vector</strong><a href='#index-s8vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a signed 8-bit integer.  Represented using an array of <code>byte</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-u8vector"><span class="category">Type: </span><span><strong>u8vector</strong><a href='#index-u8vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
an unsigned 8-bit integer.  Represented using an array of <code>&lt;byte&gt;</code>,
but each element is treated as if unsigned.
</p>
<p>This type is a synonym for <code>bytevector</code>,
which has <a href="#Bytevectors">extra functions</a>.
</p></dd></dl>

<dl class="def">
<dt id="index-s16vector"><span class="category">Type: </span><span><strong>s16vector</strong><a href='#index-s16vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a signed 16-bit integer.  Represented using an array of <code>short</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-u16vector"><span class="category">Type: </span><span><strong>u16vector</strong><a href='#index-u16vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
an unsigned 16-bit integer.  Represented using an array of <code>short</code>,
but each element is treated as if unsigned.
</p></dd></dl>

<dl class="def">
<dt id="index-s32vector"><span class="category">Type: </span><span><strong>s32vector</strong><a href='#index-s32vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a signed 32-bit integer.  Represented using an array of <code>int</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-u32vector"><span class="category">Type: </span><span><strong>u32vector</strong><a href='#index-u32vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
an unsigned 32-bit integer.  Represented using an array of <code>int</code>,
but each element is treated as if unsigned.
</p></dd></dl>

<dl class="def">
<dt id="index-s64vector"><span class="category">Type: </span><span><strong>s64vector</strong><a href='#index-s64vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a signed 64-bit integer.  Represented using an array of <code>long</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-u64vector"><span class="category">Type: </span><span><strong>u64vector</strong><a href='#index-u64vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
an unsigned 64-bit integer.  Represented using an array of <code>long</code>,
but each element is treated as if unsigned.
</p></dd></dl>

<dl class="def">
<dt id="index-f32vector"><span class="category">Type: </span><span><strong>f32vector</strong><a href='#index-f32vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a 32-bit floating-point real.  Represented using an array of <code>float</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-f64vector"><span class="category">Type: </span><span><strong>f64vector</strong><a href='#index-f64vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of uniform vectors where each element can contain
a 64-bit floating-point real.  Represented using an array of <code>double</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector_003f"><span class="category">Procedure: </span><span><strong>s8vector?</strong> <em>value</em><a href='#index-s8vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector_003f"><span class="category">Procedure: </span><span><strong>u8vector?</strong> <em>value</em><a href='#index-u8vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector_003f"><span class="category">Procedure: </span><span><strong>s16vector?</strong> <em>value</em><a href='#index-s16vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector_003f"><span class="category">Procedure: </span><span><strong>u16vector?</strong> <em>value</em><a href='#index-u16vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector_003f"><span class="category">Procedure: </span><span><strong>s32vector?</strong> <em>value</em><a href='#index-s32vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector_003f"><span class="category">Procedure: </span><span><strong>u32vector?</strong> <em>value</em><a href='#index-u32vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector_003f"><span class="category">Procedure: </span><span><strong>s64vector?</strong> <em>value</em><a href='#index-s64vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector_003f"><span class="category">Procedure: </span><span><strong>u64vector?</strong> <em>value</em><a href='#index-u64vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector_003f"><span class="category">Procedure: </span><span><strong>f32vector?</strong> <em>value</em><a href='#index-f32vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector_003f"><span class="category">Procedure: </span><span><strong>f64vector?</strong> <em>value</em><a href='#index-f64vector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return true iff <var>value</var> is a uniform vector of the specified type.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002ds8vector"><span class="category">Procedure: </span><span><strong>make-s8vector</strong> <em>n [value]</em><a href='#index-make_002ds8vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002du8vector"><span class="category">Procedure: </span><span><strong>make-u8vector</strong> <em>n [value]</em><a href='#index-make_002du8vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002ds16vector"><span class="category">Procedure: </span><span><strong>make-s16vector</strong> <em>n [value]</em><a href='#index-make_002ds16vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002du16vector"><span class="category">Procedure: </span><span><strong>make-u16vector</strong> <em>n [value]</em><a href='#index-make_002du16vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002ds32vector"><span class="category">Procedure: </span><span><strong>make-s32vector</strong> <em>n [value]</em><a href='#index-make_002ds32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002du32vector"><span class="category">Procedure: </span><span><strong>make-u32vector</strong> <em>n [value]</em><a href='#index-make_002du32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002ds64vector"><span class="category">Procedure: </span><span><strong>make-s64vector</strong> <em>n [value]</em><a href='#index-make_002ds64vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002du64vector"><span class="category">Procedure: </span><span><strong>make-u64vector</strong> <em>n [value]</em><a href='#index-make_002du64vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002df32vector"><span class="category">Procedure: </span><span><strong>make-f32vector</strong> <em>n [value]</em><a href='#index-make_002df32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002df64vector"><span class="category">Procedure: </span><span><strong>make-f64vector</strong> <em>n [value]</em><a href='#index-make_002df64vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a new uniform vector of the specified type,
having room for <var>n</var> elements.
Initialize each element to <var>value</var> if it is specified; zero otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector-1"><span class="category">Constructor: </span><span><strong>s8vector</strong> <em>value ...</em><a href='#index-s8vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector-1"><span class="category">Constructor: </span><span><strong>u8vector</strong> <em>value ...</em><a href='#index-u8vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector-1"><span class="category">Constructor: </span><span><strong>s16vector</strong> <em>value ..</em><a href='#index-s16vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector-1"><span class="category">Constructor: </span><span><strong>u16vector</strong> <em>value ...</em><a href='#index-u16vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector-1"><span class="category">Constructor: </span><span><strong>s32vector</strong> <em>value ...</em><a href='#index-s32vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector-1"><span class="category">Constructor: </span><span><strong>u32vector</strong> <em>value ...</em><a href='#index-u32vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector-1"><span class="category">Constructor: </span><span><strong>s64vector</strong> <em>value ...</em><a href='#index-s64vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector-1"><span class="category">Constructor: </span><span><strong>u64vector</strong> <em>value ...</em><a href='#index-u64vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector-1"><span class="category">Constructor: </span><span><strong>f32vector</strong> <em>value ...</em><a href='#index-f32vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector-1"><span class="category">Constructor: </span><span><strong>f64vector</strong> <em>value ...</em><a href='#index-f64vector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a new uniform vector of the specified type,
whose length is the number of <var>value</var>s specified,
and initialize it using those <var>value</var>s.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector_002dlength"><span class="category">Procedure: </span><span><strong>s8vector-length</strong> <em>v</em><a href='#index-s8vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector_002dlength"><span class="category">Procedure: </span><span><strong>u8vector-length</strong> <em>v</em><a href='#index-u8vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector_002dlength"><span class="category">Procedure: </span><span><strong>s16vector-length</strong> <em>v</em><a href='#index-s16vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector_002dlength"><span class="category">Procedure: </span><span><strong>u16vector-length</strong> <em>v</em><a href='#index-u16vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector_002dlength"><span class="category">Procedure: </span><span><strong>s32vector-length</strong> <em>v</em><a href='#index-s32vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector_002dlength"><span class="category">Procedure: </span><span><strong>u32vector-length</strong> <em>v</em><a href='#index-u32vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector_002dlength"><span class="category">Procedure: </span><span><strong>s64vector-length</strong> <em>v</em><a href='#index-s64vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector_002dlength"><span class="category">Procedure: </span><span><strong>u64vector-length</strong> <em>v</em><a href='#index-u64vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector_002dlength"><span class="category">Procedure: </span><span><strong>f32vector-length</strong> <em>v</em><a href='#index-f32vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector_002dlength"><span class="category">Procedure: </span><span><strong>f64vector-length</strong> <em>v</em><a href='#index-f64vector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the length (in number of elements) of the uniform vector <var>v</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector_002dref"><span class="category">Procedure: </span><span><strong>s8vector-ref</strong> <em>v i</em><a href='#index-s8vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector_002dref"><span class="category">Procedure: </span><span><strong>u8vector-ref</strong> <em>v i</em><a href='#index-u8vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector_002dref"><span class="category">Procedure: </span><span><strong>s16vector-ref</strong> <em>v i</em><a href='#index-s16vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector_002dref"><span class="category">Procedure: </span><span><strong>u16vector-ref</strong> <em>v i</em><a href='#index-u16vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector_002dref"><span class="category">Procedure: </span><span><strong>s32vector-ref</strong> <em>v i</em><a href='#index-s32vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector_002dref"><span class="category">Procedure: </span><span><strong>u32vector-ref</strong> <em>v i</em><a href='#index-u32vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector_002dref"><span class="category">Procedure: </span><span><strong>s64vector-ref</strong> <em>v i</em><a href='#index-s64vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector_002dref"><span class="category">Procedure: </span><span><strong>u64vector-ref</strong> <em>v i</em><a href='#index-u64vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector_002dref"><span class="category">Procedure: </span><span><strong>f32vector-ref</strong> <em>v i</em><a href='#index-f32vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector_002dref"><span class="category">Procedure: </span><span><strong>f64vector-ref</strong> <em>v i</em><a href='#index-f64vector_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the element at index <var>i</var> of the uniform vector <var>v</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector_002dset_0021"><span class="category">Procedure: </span><span><strong>s8vector-set!</strong> <em>v i x</em><a href='#index-s8vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector_002dset_0021"><span class="category">Procedure: </span><span><strong>u8vector-set!</strong> <em>v i x</em><a href='#index-u8vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector_002dset_0021"><span class="category">Procedure: </span><span><strong>s16vector-set!</strong> <em>v i x</em><a href='#index-s16vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector_002dset_0021"><span class="category">Procedure: </span><span><strong>u16vector-set!</strong> <em>v i x</em><a href='#index-u16vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector_002dset_0021"><span class="category">Procedure: </span><span><strong>s32vector-set!</strong> <em>v i x</em><a href='#index-s32vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector_002dset_0021"><span class="category">Procedure: </span><span><strong>u32vector-set!</strong> <em>v i x</em><a href='#index-u32vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector_002dset_0021"><span class="category">Procedure: </span><span><strong>s64vector-set!</strong> <em>v i x</em><a href='#index-s64vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector_002dset_0021"><span class="category">Procedure: </span><span><strong>u64vector-set!</strong> <em>v i x</em><a href='#index-u64vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector_002dset_0021"><span class="category">Procedure: </span><span><strong>f32vector-set!</strong> <em>v i x</em><a href='#index-f32vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector_002dset_0021"><span class="category">Procedure: </span><span><strong>f64vector-set!</strong> <em>v i x</em><a href='#index-f64vector_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Set the element at index <var>i</var> of uniform vector <var>v</var>
to the value <var>x</var>, which must be a number coercible
to the appropriate type.
</p></dd></dl>

<dl class="def">
<dt id="index-s8vector_002d_003elist"><span class="category">Procedure: </span><span><strong>s8vector-&gt;list</strong> <em>v</em><a href='#index-s8vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u8vector_002d_003elist"><span class="category">Procedure: </span><span><strong>u8vector-&gt;list</strong> <em>v</em><a href='#index-u8vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s16vector_002d_003elist"><span class="category">Procedure: </span><span><strong>s16vector-&gt;list</strong> <em>v</em><a href='#index-s16vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u16vector_002d_003elist"><span class="category">Procedure: </span><span><strong>u16vector-&gt;list</strong> <em>v</em><a href='#index-u16vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s32vector_002d_003elist"><span class="category">Procedure: </span><span><strong>s32vector-&gt;list</strong> <em>v</em><a href='#index-s32vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u32vector_002d_003elist"><span class="category">Procedure: </span><span><strong>u32vector-&gt;list</strong> <em>v</em><a href='#index-u32vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-s64vector_002d_003elist"><span class="category">Procedure: </span><span><strong>s64vector-&gt;list</strong> <em>v</em><a href='#index-s64vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-u64vector_002d_003elist"><span class="category">Procedure: </span><span><strong>u64vector-&gt;list</strong> <em>v</em><a href='#index-u64vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f32vector_002d_003elist"><span class="category">Procedure: </span><span><strong>f32vector-&gt;list</strong> <em>v</em><a href='#index-f32vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-f64vector_002d_003elist"><span class="category">Procedure: </span><span><strong>f64vector-&gt;list</strong> <em>v</em><a href='#index-f64vector_002d_003elist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Convert the uniform vetor <var>v</var> to a list containing the elments of <var>v</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-list_002d_003es8vector"><span class="category">Procedure: </span><span><strong>list-&gt;s8vector</strong> <em>l</em><a href='#index-list_002d_003es8vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003eu8vector"><span class="category">Procedure: </span><span><strong>list-&gt;u8vector</strong> <em>l</em><a href='#index-list_002d_003eu8vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003es16vector"><span class="category">Procedure: </span><span><strong>list-&gt;s16vector</strong> <em>l</em><a href='#index-list_002d_003es16vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003eu16vector"><span class="category">Procedure: </span><span><strong>list-&gt;u16vector</strong> <em>l</em><a href='#index-list_002d_003eu16vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003es32vector"><span class="category">Procedure: </span><span><strong>list-&gt;s32vector</strong> <em>l</em><a href='#index-list_002d_003es32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003eu32vector"><span class="category">Procedure: </span><span><strong>list-&gt;u32vector</strong> <em>l</em><a href='#index-list_002d_003eu32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003es64vector"><span class="category">Procedure: </span><span><strong>list-&gt;s64vector</strong> <em>l</em><a href='#index-list_002d_003es64vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003eu64vector"><span class="category">Procedure: </span><span><strong>list-&gt;u64vector</strong> <em>l</em><a href='#index-list_002d_003eu64vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003ef32vector"><span class="category">Procedure: </span><span><strong>list-&gt;f32vector</strong> <em>l</em><a href='#index-list_002d_003ef32vector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-list_002d_003ef64vector"><span class="category">Procedure: </span><span><strong>list-&gt;f64vector</strong> <em>l</em><a href='#index-list_002d_003ef64vector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a uniform vector of the appropriate type, initializing it
with the elements of the list <var>l</var>.  The elements of <var>l</var>
must be numbers coercible the new vector&rsquo;s element type.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Relationship-with-Java-arrays" accesskey="1">Relationship with Java arrays</a></li>
</ul>
<div class="subsection" id="Relationship-with-Java-arrays">
<h4 class="subsection">14.4.1 Relationship with Java arrays</h4>

<p>Each uniform array type is implemented as an <em>underlying Java array</em>,
and a length field.
The underlying type is
<code>byte[]</code> for <code>u8vector</code> or <code>s8vector</code>;
<code>short[]</code> for <code>u16vector</code> or <code>u16vector</code>;
<code>int[]</code> for <code>u32vector</code> or <code>s32vector</code>;
<code>long[]</code> for <code>u64vector</code> or <code>s64vector</code>;
<code>float[]</code> for <code>f32vector</code>; and
<code>double[]</code> for <code>f32vector</code>.
The length field allows a uniform array to only use the
initial part of the underlying array.  (This can be used
to support Common Lisp&rsquo;s fill pointer feature.)
This also allows resizing a uniform vector.  There is no
Scheme function for this, but you can use the <code>setSize</code> method:
</p><div class="example">
<pre class="example">(invoke some-vector 'setSize 200)
</pre></div>

<p>If you have a Java array, you can create a uniform vector
sharing with the Java array:
</p><div class="example">
<pre class="example">(define arr :: byte[] ((primitive-array-new byte) 10))
(define vec :: u8vector (make u8vector arr))
</pre></div>
<p>At this point <code>vec</code> uses <code>arr</code> for its underlying storage,
so changes to one affect the other.
It <code>vec</code> is re-sized so it needs a larger underlying array,
then it will no longer use <code>arr</code>.
</p>
<hr>
</div>
</div>
<div class="section" id="Bytevectors">
<div class="header">
<p>
Next: <a href="#Ranges" accesskey="n" rel="next">Ranges</a>, Previous: <a href="#Uniform-vectors" accesskey="p" rel="prev">Uniform vectors</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Bytevectors-1"></span><h3 class="section">14.5 Bytevectors</h3>

<p><em>Bytevectors</em> represent blocks of binary data. They are
fixed-length sequences of bytes, where a <var>byte</var> is an exact
integer in the range [0, 255]. A bytevector is typically more
space-efficient than a vector containing the same values.
</p>
<p>The length of a bytevector is the number of elements that
it contains. This number is a non-negative integer that is
fixed when the bytevector is created. The valid indexes of
a bytevector are the exact non-negative integers less than
the length of the bytevector, starting at index zero as with
vectors.
</p>
<p>The <code>bytevector</code> type is equivalent to the <code>u8vector</code>
<a href="#Uniform-vectors">uniform vector</a> type, but is specified
by the R7RS standard.
</p>
<p>Bytevectors are written using the notation <code>#u8(byte . . . )</code>.
For example, a bytevector of length 3 containing the byte
0 in element 0, the byte 10 in element 1, and the byte 5 in
element 2 can be written as following:
</p><div class="example">
<pre class="example">#u8(0 10 5)
</pre></div>
<p>Bytevector constants are self-evaluating, so they do not
need to be quoted in programs.
</p>
<dl class="def">
<dt id="index-bytevector"><span class="category">Type: </span><span><strong>bytevector</strong><a href='#index-bytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of bytevector objects.
</p></dd></dl>

<dl class="def">
<dt id="index-bytevector-1"><span class="category">Constructor: </span><span><strong>bytevector</strong> <em><var>byte</var> &hellip;</em><a href='#index-bytevector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated bytevector whose elements contain the given
arguments.  Analogous to <code>vector</code>.
</p><div class="example">
<pre class="example">(bytevector 1 3 5 1 3 5)  &rArr;  #u8(1 3 5 1 3 5)
(bytevector)  &rArr;  #u8()
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_003f"><span class="category">Procedure: </span><span><strong>bytevector?</strong> <em><var>obj</var></em><a href='#index-bytevector_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a bytevector, <code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dbytevector"><span class="category">Procedure: </span><span><strong>make-bytevector</strong> <em>k</em><a href='#index-make_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dbytevector-1"><span class="category">Procedure: </span><span><strong>make-bytevector</strong> <em>k byte</em><a href='#index-make_002dbytevector-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>make-bytevector</code> procedure returns a newly allocated
bytevector of length <var>k</var>. If <var>byte</var> is given, then all elements
of the bytevector are initialized to <var>byte</var>,
otherwise the contents of each element are unspecified.
</p><div class="example">
<pre class="example">(make-bytevector 2 12) &rArr; #u8(12 12)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_002dlength"><span class="category">Procedure: </span><span><strong>bytevector-length</strong> <em>bytevector</em><a href='#index-bytevector_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the length of <var>bytevector</var> in bytes
as an exact integer.
</p></dd></dl>

<dl class="def">
<dt id="index-bytevector_002du8_002dref"><span class="category">Procedure: </span><span><strong>bytevector-u8-ref</strong> <em>bytevector k</em><a href='#index-bytevector_002du8_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if <var>k</var> is not a valid index of <var>bytevector</var>.
Returns the <var>k</var>th byte of <var>bytevector</var>.
</p><div class="example">
<pre class="example">(bytevector-u8-ref ’#u8(1 1 2 3 5 8 13 21) 5)
  &rArr; 8
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_002du8_002dset_0021"><span class="category">Procedure: </span><span><strong>bytevector-u8-set!</strong> <em>bytevector k byte</em><a href='#index-bytevector_002du8_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>It is an error if <var>k</var> is not a valid index of <var>bytevector</var>.
Stores <var>byte</var> as the <var>k</var>th byte of <var>bytevector</var>.
</p><div class="example">
<pre class="example">(let ((bv (bytevector 1 2 3 4)
  (bytevector-u8-set! bv 1 3)
  bv)
  &rArr; #u8(1 3 3 4)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_002dcopy"><span class="category">Procedure: </span><span><strong>bytevector-copy</strong> <em>bytevector [start [end]]</em><a href='#index-bytevector_002dcopy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated bytevector containing the bytes
in <var>bytevector</var> between <var>start</var> and <var>end</var>.
</p>
<div class="example">
<pre class="example">(define a #u8(1 2 3 4 5))
(bytevector-copy a 2 4))
    &rArr; #u8(3 4)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_002dcopy_0021"><span class="category">Procedure: </span><span><strong>bytevector-copy!</strong> <em>to at from [start [end]]</em><a href='#index-bytevector_002dcopy_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Copies the bytes of bytevector<var>from</var> between <var>start</var> and <var>end</var>
to bytevector <var>to</var>, starting at <var>at</var>. The order in which bytes
are copied is unspecified, except that if the source and destination overlap,
copying takes place as if the source is first
copied into a temporary bytevector and then into the destination.
This is achieved without allocating storage
by making sure to copy in the correct direction in such
circumstances.
</p>
<p>It is an error if <var>at</var> is less than zero or greater than the length
of <var>to</var>.
It is also an error if <code>(- (bytevector-length <var>to</var>) <var>at</var>)</code>
is less than <code>(- <var>end</var> <var>start</var>)</code>.
</p>
<div class="example">
<pre class="example">(define a (bytevector 1 2 3 4 5))
(define b (bytevector 10 20 30 40 50))
(bytevector-copy! b 1 a 0 2)
b        &rArr; #u8(10 1 2 40 50)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-bytevector_002dappend"><span class="category">Procedure: </span><span><strong>bytevector-append</strong> <em>bytevector...</em><a href='#index-bytevector_002dappend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated bytevector whose elements are
the concatenation of the elements in the given bytevectors.
</p>
<div class="example">
<pre class="example">(bytevector-append #u8(0 1 2) #u8(3 4 5))
        &rArr;  #u8(0 1 2 3 4 5)
</pre></div>
</dd></dl>

<ul class="section-toc">
<li><a href="#Converting-to-or-from-strings" accesskey="1">Converting to or from strings</a></li>
</ul>
<div class="subsection" id="Converting-to-or-from-strings">
<h4 class="subsection">14.5.1 Converting to or from strings</h4>

<dl class="def">
<dt id="index-utf8_002d_003estring"><span class="category">Procedure: </span><span><strong>utf8-&gt;string</strong> <em>bytevector [start [end]]</em><a href='#index-utf8_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure decodes the bytes of a bytevector between <var>start</var>
and <var>end</var>, interpreting as a UTF-8-encoded string,
and returns the corresponding string.
It is an error for <var>bytevector</var> to contain invalid UTF-8 byte sequences.
</p><div class="example">
<pre class="example">(utf8-&gt;string #u8(#x41))  &rArr; &quot;A&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-utf16_002d_003estring"><span class="category">Procedure: </span><span><strong>utf16-&gt;string</strong> <em>bytevector [start [end]]</em><a href='#index-utf16_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-utf16be_002d_003estring"><span class="category">Procedure: </span><span><strong>utf16be-&gt;string</strong> <em>bytevector [start [end]]</em><a href='#index-utf16be_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-utf16le_002d_003estring"><span class="category">Procedure: </span><span><strong>utf16le-&gt;string</strong> <em>bytevector [start [end]]</em><a href='#index-utf16le_002d_003estring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures interpret their &lt;var&gt;bytevector&lt;/var&gt; argument as
a UTF-16 encoding of a sequence of characters,
and return an istring containing that sequence.
</p>
<p>The bytevector subrange given to <code>utf16-&gt;string</code>
may begin with a byte order mark (BOM); if so, that BOM
determines whether the rest of the subrange is to be
interpreted as big-endian or little-endian; in either case,
the BOM will not become a character in the returned string.
If the subrange does not begin with a BOM, it is decoded using
the same implementation-dependent endianness used by
<code>string-&gt;utf16</code>.
</p>
<p>The <code>utf16be-&gt;string</code> and <code>utf16le-&gt;string</code>
procedures interpret their inputs as big-endian or little-endian,
respectively.  If a BOM is present, it is treated as a normal
character and will become part of the result.
</p>
<p>It is an error if <code>(- <var>end</var> <var>start</var>)</code> is odd,
or if the bytevector subrange contains invalid UTF-16 byte sequences.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002d_003eutf8"><span class="category">Procedure: </span><span><strong>string-&gt;utf8</strong> <em>string [start [end]]</em><a href='#index-string_002d_003eutf8' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure encodes the characters of a string between
<var>start</var> and <var>end</var> and returns the corresponding bytevector,
in UTF-8 encoding.
</p><div class="example">
<pre class="example">(string-&gt;utf8 &quot;λ&quot;)     &rArr; &quot; #u8(#xCE #xBB)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-string_002d_003eutf16"><span class="category">Procedure: </span><span><strong>string-&gt;utf16</strong> <em>string [start [end]]</em><a href='#index-string_002d_003eutf16' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002d_003eutf16be"><span class="category">Procedure: </span><span><strong>string-&gt;utf16be</strong> <em>string [start [end]]</em><a href='#index-string_002d_003eutf16be' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-string_002d_003eutf16le"><span class="category">Procedure: </span><span><strong>string-&gt;utf16le</strong> <em>string [start [end]]</em><a href='#index-string_002d_003eutf16le' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return a newly allocated (unless empty)
bytevector containing a UTF-16 encoding of the given substring.
</p>
<p>The bytevectors returned by <code>string-&gt;utf16be</code>
and <code>string-&gt;utf16le</code>
do not contain a byte-order mark (BOM);
<code>string-&gt;utf16be</code>&gt; returns a big-endian encoding,
while <code>string-&gt;utf16le</code> returns a little-endian encoding.
</p>
<p>The bytevectors returned by <code>string-&gt;utf16</code>
begin with a BOM that declares an implementation-dependent
endianness, and the bytevector elements following that BOM
encode the given  substring using that endianness.
</p>
<p><em>Rationale:</em>
These procedures are consistent with the Unicode standard.
Unicode suggests UTF-16 should default to big-endian, but
Microsoft prefers little-endian.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Ranges">
<div class="header">
<p>
Next: <a href="#Streams" accesskey="n" rel="next">Streams - lazy lists</a>, Previous: <a href="#Bytevectors" accesskey="p" rel="prev">Bytevectors</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Ranges-1"></span><h3 class="section">14.6 Ranges</h3>

<p>A <em>range</em> is an immutable sequence of values
that increase &ldquo;linearly&rdquo; - i.e. by a fixed amount.
Most commonly it&rsquo;s a sequence of consequtive integers.
An example of the syntax is <code>[3 &lt;: 7]</code> which evaluates
to the sequence <code>[3 4 5 6]</code>.
You can specify an explicit increment with a <code>by:</code> option.
There are multiple ways to specify when the sequence stops.
For example <code>[3 by 2 &lt;=: 7]</code> is the even numbers from
3 up to 7 (inclusive, because of the <code>&lt;=</code>).
</p>
<p>Ranges are very useful for loop indexes, or selecting a sub-sequence.
If you have a sequence <var>q</var> and a range <var>r</var>, and you
use the syntax <code>(<var>q</var> <var>r</var>)</code> to
&ldquo;apply&rdquo;<var>q</var> with the argument <var>r</var>,
is result is to select elements of <var>q</var> with indexes in <var>r</var>.
</p><div class="example">
<pre class="example">(&quot;ABCDEFG&quot; [1 by: 2 &lt;: 7])  &rArr; &quot;BDF&quot;
</pre></div>

<p>A range can be <em>unbounded</em>, or non-finite, if you leave off
the end value.  For example <code>[3 by: 2]</code> is the odd integers starting at 3.
</p>
<div class="display">
<pre class="display"><span id="index-unbounded_002drange"></span><span id="meta_002dunbounded_002drange"></span><var>unbounded-range</var> <tt>::=</tt>
  <code><b>[</b></code> <var>start-expression</var> <code><b>by:</b></code> <var>step-expression</var> <code><b>]</b></code>
  | <code><b>[</b></code> <var>start-expression</var> <code><b>&lt;:</b></code> <code><b>]</b></code>
</pre></div>

<p>The expression <code>[<var>start</var> by: <var>step</var>]</code> evaluates to an
infinite sequence of values, starting with <var>start</var>, and followed by
<code>(+ <var>start</var> <var>step</var>)</code>,
<code>(+ <var>start</var> (* 2 <var>step</var>))</code>, and so on.
</p>
<p>The syntax <code>[<var>start-expression</var> &lt;:]</code>
is shorthand for <code>[<var>start-expression</var> by: 1]</code>.
</p>
<div class="display">
<pre class="display"><span id="index-bounded_002drange"></span><span id="meta_002dbounded_002drange"></span><var>bounded-range</var> <tt>::=</tt> <code><b>[</b></code> <var>start-expression</var> [<code><b>by:</b></code> <var>step-expression</var>] <a href="#meta_002drange_002dend"><var>range-end</var></a> <code><b>]</b></code>
<span id="index-range_002dend"></span><span id="meta_002drange_002dend"></span><var>range-end</var> <tt>::=</tt> <code><b>&lt;:</b></code> <var>end-expression</var>
  | <code><b>&lt;=:</b></code> <var>end-expression</var>
  | <code><b>&gt;:</b></code> <var>end-expression</var>
  | <code><b>&gt;=:</b></code> <var>end-expression</var>
  | <code><b>size:</b></code> <var>size-expression</var>
</pre></div>

<p>A bounded range takes an initial subsequence of the unbounded
range specified by the <var>start-expression</var> and optional <var>step-expression</var>.
The different <var>end-expression</var> variants provide different
ways to specify the initial subsequence.
</p>
<p>If <code>size: <var>size</var></code> is specified, then the resulting range
is the first <var>size</var> elements of unbounded sequence.
</p>
<p>In the <code>&lt;: <var>end</var></code> or <code>&lt;=: <var>end</var></code> cases then
the sequence counts up: The <var>step</var> must be positive, and defaults to 1.
The resulting values are those  <var>x</var> such that <code>(&lt; <var>x</var> <var>end</var>)</code>,
or  <code>(&lt;= <var>x</var> <var>end</var>)</code>, respectively.
</p>
<p>In the <code>&gt;: <var>end</var></code> or <code>&gt;=: <var>end</var></code> cases then
the sequence counts down: The <var>step</var> must be negative, and defaults to -1.
The resulting values are those  <var>x</var> such that <code>(&gt; <var>x</var> <var>end</var>)</code>,
or  <code>(&gt;= <var>x</var> <var>end</var>)</code>, respectively.
</p>
<p>The <var>start-expression</var>, <var>step-expression</var>, and <var>size-expression</var>
must evaluate to real numbers, not necessarily integers.
For example: <code>[1 by: 0.5 &lt;=: 3.0]</code> is <code>[1.0 1.5 2.0 2.5 3.0]</code>.
</p>
<p>The two pseudo-ranges <code>[&lt;:]</code> and <code>[&gt;:]</code> are useful as
array indexes. They mean &ldquo;all of the valid indexes&rdquo; of the array being indexed.
For increasing index values use <code>[&lt;:]</code>; for decreasing
index values (i.e. reversing) use <code>[&gt;:]</code>.
</p>
<hr>
</div>
<div class="section" id="Streams">
<div class="header">
<p>
Next: <a href="#Arrays" accesskey="n" rel="next">Multi-dimensional Arrays</a>, Previous: <a href="#Ranges" accesskey="p" rel="prev">Ranges</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Streams-_002d-lazy-lists"></span><h3 class="section">14.7 Streams - lazy lists</h3>

<p>Streams, sometimes called lazy lists, are a sequential data structure
containing elements computed only on demand. A stream is either null
or is a pair with a stream in its cdr. Since elements of a stream are
computed only when accessed, streams can be infinite. Once computed,
the value of a stream element is cached in case it is needed again.
</p>
<p><em>Note:</em> These are not the same as Java 8 streams.
</p>
<div class="example">
<pre class="example">(require 'srfi-41)
(define fibs
  (stream-cons 1
    (stream-cons 1
      (stream-map +
        fibs
        (stream-cdr fibs)))))
(stream-&gt;list 8 fibs) &rArr; (1 1 2 3 5 8 13 21)
</pre></div>

<p>See the <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">SRFI 41 specification</a> for details.
</p>
<p>The Kawa implementations builds on <a href="#Lazy-evaluation">promises</a>.
The <code>stream-null</code> value is a promise that evaluates to the empty list.
The result of <code>stream-cons</code> is an eager immutable pair whose
<code>car</code> and <code>cdr</code> properties return promises.
</p>
<hr>
</div>
<div class="section" id="Arrays">
<div class="header">
<p>
Next: <a href="#Hash-tables" accesskey="n" rel="next">Hash tables</a>, Previous: <a href="#Streams" accesskey="p" rel="prev">Streams - lazy lists</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Multi_002ddimensional-Arrays"></span><h3 class="section">14.8 Multi-dimensional Arrays</h3>

<p>Arrays are heterogeneous data structures that generaize vectors to multiple
indexes or dimensions.  Instead of a single integer index,
there are multiple indexes:  An index is a vector of integers;
the length of a valid index sequence
is the rank or the number of dimensions of an array.
</p>

<p>Kawa multi-dimensional arrays follows the
by <a href="http://srfi.schemers.org/srfi-25/srfi-25.html">SRFI-25 specification</a>,
with additions from Racket&rsquo;s
<a href="https://docs.racket-lang.org/math/array.html">math.array</a> package
and other sources.
</p>
<p>An array whose rank is 1, and where the (single) lower bound is 0
is a sequence.
Furthermore, if such an array is simple (not created by <code>share-array</code>)
it will be implemented using a <code>&lt;vector&gt;</code>.
Uniform vectors and strings are also arrays in Kawa.
</p>
<p>A rank-0 array has a single value.  It is essentially a box for that
value.  Functions that require arrays may treat non-arrays
as a rank-0 array containing that value.
</p>
<p>An array of rank 2 is frequently called a <em>matrix</em>.
</p>
<p>Note that Kawa arrays are distinct from Java (native) arrays.
The latter is a simpler one-dimensional vector-like data structure,
which is used to implement Kawa arrays and vectors.
</p>
<dl class="def">
<dt id="index-array_003f"><span class="category">Procedure: </span><span><strong>array?</strong> <em>obj</em><a href='#index-array_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>obj</var> is an array, otherwise returns <code>#f</code>.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Array-shape" accesskey="1">Array shape</a></li>
<li><a href="#Array-types" accesskey="2">Array types</a></li>
<li><a href="#Array-literals-and-printing" accesskey="3">Array literals and printing</a></li>
<li><a href="#Array-construction" accesskey="4">Array construction</a></li>
<li><a href="#Array-indexing" accesskey="5">Array indexing</a></li>
<li><a href="#Modifying-arrays" accesskey="6">Modifying arrays</a></li>
<li><a href="#Transformations-and-views" accesskey="7">Transformations and views</a></li>
<li><a href="#Miscellaneous-1" accesskey="8">Miscellaneous</a></li>
</ul>
<div class="subsection" id="Array-shape">
<h4 class="subsection">14.8.1 Array shape</h4>

<p>The <em>shape</em> of an array consists of bounds for each index.
</p>

<p>The lower bound <var>b</var> and the upper bound <var>e</var> of a dimension are
exact integers with <code>(&lt;= <var>b</var> <var>e</var>)</code>. A valid index along the
dimension is an exact integer <var>i</var> that satisfies both
<code>(&lt;= <var>b</var> <var>i</var>)</code> and <code>(&lt; <var>i</var> <var>e</var>)</code>.
The length of the array along the dimension is the difference
<code>(- <var>e</var> <var>b</var>)</code>.
The size of an array is the product of the lengths of its dimensions.
</p>
<p>A procedure that requires a <var>shape</var> accepts any of the following:
</p><ul>
<li> A vector of simple <a href="#Ranges">ranges</a>, one for each
dimension, all of who are
bounded (finite), consist of integer values,
and have a <var>step</var> of 1.
Each range, which is usually written as <code>[<var>b</var> &lt;: <var>e</var>]</code>,
expresses the bounds of the corresponding dimension.
For example <code>[[0 &lt;: 5] [2 &lt;=: 6]]</code> is the shape
of a rank-2 array, where the first index can be from 0 to 5 (exclusive),
while the second index can be from 2 to 6 (inclusive).
</li><li> A vector of simple integers.
Each integer <var>e</var> is an upper bound,
and is equivalent to the range <code>[0 &lt;: <var>e</var>]</code>.
</li><li> A vector consisting of a mix of integers and ranges.
</li><li> A rank-2 array <var>S</var> whose own shape is <code>[<var>r</var> 2]</code>.
For each dimension <var>k</var>
(where <code>(&lt;= <var>k</var> 0)</code> and <code>(&lt; <var>k</var> <var>r</var>)</code>),
the lower bound <var>b<sub>k</sub></var> is <code>(S <var>k</var> 0)</code>,
and the upper bound <var>e<sub>k</sub></var> is <code>(S <var>k</var> 1)</code>.
</li></ul>

<dl class="def">
<dt id="index-shape"><span class="category">Procedure: </span><span><strong>shape</strong> <em>bound ...</em><a href='#index-shape' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a shape. The sequence <var>bound</var> ... must consist of an even number
of exact integers that are pairwise not decreasing. Each pair gives the
lower and upper bound of a dimension.
If the shape is used to specify the dimensions of an array
and <var>bound</var> ... is the sequence <var>b0</var> <var>e0</var> ... <var>bk</var> <var>ek</var>
... of <var>n</var> pairs of bounds, then a valid index to the array is any
sequence <var>j0</var> ... <var>jk</var> ... of <var>n</var> exact integers where
each <var>jk</var> satisfies <code>(&lt;= <var>bk</var> <var>jk</var>)</code>
and <code>(&lt; <var>jk</var> <var>ek</var>)</code>.
</p>
<p>The shape of a <var>d</var>-dimensional array is a <var>d</var> * 2 array
where the element at <var>k 0</var> contains the lower bound for an index along
dimension <var>k</var> and the element at <var>k 1</var> contains the
corresponding upper bound, where <var>k</var> satisfies <code>(&lt;=  0 <var>k</var>)</code>
and <code>(&lt; <var>k</var> <var>d</var>)</code>.
</p>
<p><code>(shape @<var>bounds</var>)</code>
is equivalent to:
<code>(array [2 (/ (length <var>bounds</var>) 2)] @<var>bounds</var>)</code>
</p></dd></dl>

<dl class="def">
<dt id="index-array_002drank"><span class="category">Procedure: </span><span><strong>array-rank</strong> <em>array</em><a href='#index-array_002drank' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the number of dimensions of <var>array</var>.
</p><div class="example">
<pre class="example">(array-rank
  (make-array (shape 1 2 3 4)))
</pre></div>
<p>Returns 2.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dstart"><span class="category">Procedure: </span><span><strong>array-start</strong> <em>array k</em><a href='#index-array_002dstart' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the lower bound (inclusive) for the index along dimension <var>k</var>.
This is most commonly 0.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dend"><span class="category">Procedure: </span><span><strong>array-end</strong> <em>array k</em><a href='#index-array_002dend' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the upper bound for the index along dimension <var>k</var>.
The bound is exclusive - i.e. the first integer higher
than the last legal index.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dsize"><span class="category">Procedure: </span><span><strong>array-size</strong> <em>array</em><a href='#index-array_002dsize' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the total number of elements of <var>array</var>.
This is the product of <code>(- (array-end <var>array</var> <var>k</var>) (array-start <var>array</var> <var>k</var>))</code> for every valid <var>k</var>.
</p></dd></dl>

</div>
<div class="subsection" id="Array-types">
<h4 class="subsection">14.8.2 Array types</h4>

<dl class="def">
<dt id="index-array"><span class="category">Type: </span><span><strong>array</strong><a href='#index-array' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-arrayN"><span class="category">Type: </span><span><strong>array<var>N</var></strong><a href='#index-arrayN' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-array_005betype_005d"><span class="category">Type: </span><span><strong>array[<var>etype</var>]</strong><a href='#index-array_005betype_005d' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-arrayN_005betype_005d"><span class="category">Type: </span><span><strong>array<var>N</var>[<var>etype</var>]</strong><a href='#index-arrayN_005betype_005d' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The type <code>array</code> matches all array values.
The type <code>array<var>N</var></code>, where <var>N</var> is an integer
matches array of rank <var>N</var>.
For example <code>array2</code> matches rank-2 array - i.e. matrixes.
</p>
<p>You can optionally specify the element type <var>etype</var>.
This can be a primitive type.
For example a <code>array2[double]</code> is a rank-2 array
whose elements are <code>double</code> values.
</p></dd></dl>

<span id="array_002dliterals"></span></div>
<div class="subsection" id="Array-literals-and-printing">
<h4 class="subsection">14.8.3 Array literals and printing</h4>

<p>An array literal starts with <code>#</code> followed by its rank,
followed by a tag that describes the underlying vector (by default <code>a</code>),
optionally followed by information about its shape,
and finally followed by the cells, organized into dimensions using parentheses.
</p>
<p>For example, <code>#2a((11 12 13) (21 22 23))</code> is a rank-2 array (a matrix)
whose shape is <code>[2 3]</code> or equivalently <code>[[0 &lt;: 2] [0 &lt;: 3]]</code>.
It is pretty-printed as:
</p><div class="example">
<pre class="example">╔#2a:2:3═╗
║11│12│13║
╟──┼──┼──╢
║21│22│23║
╚══╧══╧══╝
</pre></div>

<div class="display">
<pre class="display"><span id="index-array_002dliteral"></span><span id="meta_002darray_002dliteral"></span><var>array-literal</var> <tt>::=</tt> <a href="#meta_002darray_002dliteral_002dheader"><var>array-literal-header</var></a> <a href="#meta_002ddatum"><var>datum</var></a>
<span id="index-array_002dliteral_002dheader"></span><span id="meta_002darray_002dliteral_002dheader"></span><var>array-literal-header</var> <tt>::=</tt> <code><b>#</b></code> <var>rank</var> <a href="#meta_002dvectag"><var>vectag</var></a> <a href="#meta_002darray_002dbound"><var>array-bound</var></a><sup>*</sup> 
<span id="index-array_002dbound"></span><span id="meta_002darray_002dbound"></span><var>array-bound</var> <tt>::=</tt> [<code><b>@</b></code><var>lower</var>]<code><b>:</b></code><var>length</var> | <code><b>@</b></code><var>lower</var>
<span id="index-vectag"></span><span id="meta_002dvectag"></span><var>vectag</var> <tt>::=</tt> <code><b>a</b></code> | <a href="#meta_002duniform_002dtag"><var>uniform-tag</var></a>
</pre></div>

<p>The <var>vectag</var> specifies the type of the elements of the array.
</p>
<p>Following the <var>vectag</var> you can optionally include information
about the shape: For each dimension you can optionally specify
the lower bounds (after the character <code>&quot;@&quot;</code>),
followed by the length of the dimension (after the character <code>&quot;:&quot;</code>).
The shape information is required if a lower bound is non-zero,
or any length is zero.
</p>
<p>The <a href="#meta_002ddatum"><var>datum</var></a> contains the elements in a nested-list format:
a rank-1 array (i.e. vector) uses a single list,
a rank-2 array uses a list-of-listrs, and so on.
The elements are in lexicographic order.
</p>
<p>A uniform u32 array of rank 2 with index ranges 2..3 and 3..4:
</p><div class="example">
<pre class="example">#2u32@2@3((1 2) (2 3))
</pre></div>

<p>This syntax follow Common Lisp with
<a href="https://www.gnu.org/software/guile/manual/html_node/Array-Syntax.html">Guile
extensions</a>.  (Note that Guile prints rank-0 arrays with an extra
set of parentheses.  Kawa follows Common Lisp in not doing so.)
</p>
<p>When an array is printed with the <code>write</code> function,
the result is an <code>array-literal</code>.
Printing with <code>display</code> formats the array in a rectangular grid
using the <code>format-array</code> procedure.
(Note that <code>format-array</code> is only used when the output is in column 0,
because Kawa has very limited support for printing rectangles.)
</p>
<dl class="def">
<dt id="index-format_002darray"><span class="category">Procedure: </span><span><strong>format-array</strong> <em>value [element-format]</em><a href='#index-format_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Produce a nice &ldquo;pretty&rdquo; display for <var>value</var>, which is usually an array.
</p>
<p>The top line includes an <code>array-literal-header</code>.
The lower bound are only printed if non-zero.
The dimension lengths are printed if there is zoom, or if one of them is zero.
</p><div class="example">
<pre class="example">#|kawa:34|# (! arr (array [[1 &lt;=: 2] [1 &lt;=: 3]]
#|.....35|#   #2a((1 2) (3 4)) 9 #2a((3 4) (5 6))
#|.....36|#   [42 43] #2a:1:3((8 7 6)) #2a((90 91) (100 101))))
#|kawa:37|# arr
╔#2a@1:2@1:3════╤═════════╗
║#2a═╗  │      9│#2a═╗    ║
║║1│2║  │       │║3│4║    ║
║╟─┼─╢  │       │╟─┼─╢    ║
║║3│4║  │       │║5│6║    ║
║╚═╧═╝  │       │╚═╧═╝    ║
╟───────┼───────┼─────────╢
║╔#1a:2╗│#2a:1:3│╔#2a:2:2╗║
║║42│43║│║8│7│6║│║ 90│ 91║║
║╚══╧══╝│╚═╧═╧═╝│╟───┼───╢║
║       │       │║100│101║║
║       │       │╚═══╧═══╝║
╚═══════╧═══════╧═════════╝
</pre></div>
<p>If <var>element-format</var> is specified, it is a format string used
for format each non-array:
</p><div class="example">
<pre class="example">#|kawa:38|# (format-array arr &quot;~4,2f&quot;)
╔#2a@1:2@1:3══╤════════════════╤═══════════════╗
║╔#2a:2:2══╗  │            9.00│╔#2a:2:2══╗    ║
║║1.00│2.00║  │                │║3.00│4.00║    ║
║╟────┼────╢  │                │╟────┼────╢    ║
║║3.00│4.00║  │                │║5.00│6.00║    ║
║╚════╧════╝  │                │╚════╧════╝    ║
╟─────────────┼────────────────┼───────────────╢
║╔#1a:2╤═════╗│╔#2a:1:3══╤════╗│╔#2a:2:2══════╗║
║║42.00│43.00║│║8.00│7.00│6.00║│║ 90.00│ 91.00║║
║╚═════╧═════╝│╚════╧════╧════╝│╟──────┼──────╢║
║             │                │║100.00│101.00║║
║             │                │╚══════╧══════╝║
╚═════════════╧════════════════╧═══════════════╝
</pre></div>
<p>If the rank is more than 2, then each &ldquo;layer&rdquo;
is printed separated by double lines.
</p><div class="example">
<pre class="example">#|kawa:42|# (array-reshape [1 &lt;=: 24] [3 2 4])
╔#3a:3:2:4══╗
║ 1│ 2│ 3│ 4║
╟──┼──┼──┼──╢
║ 5│ 6│ 7│ 8║
╠══╪══╪══╪══╣
║ 9│10│11│12║
╟──┼──┼──┼──╢
║13│14│15│16║
╠══╪══╪══╪══╣
║17│18│19│20║
╟──┼──┼──┼──╢
║21│22│23│24║
╚══╧══╧══╧══╝
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Array-construction">
<h4 class="subsection">14.8.4 Array construction</h4>

<p>See also <code>array-reshape</code>
</p>
<dl class="def">
<dt id="index-array-1"><span class="category">Procedure: </span><span><strong>array</strong> <em>shape obj ...</em><a href='#index-array-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new array whose shape is given by <var>shape</var> and the initial
contents of the elements are <var>obj</var> ... in row major order. The array does
not retain a reference to <var>shape</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002darray"><span class="category">Procedure: </span><span><strong>make-array</strong> <em>shape</em><a href='#index-make_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002darray-1"><span class="category">Procedure: </span><span><strong>make-array</strong> <em>shape value...</em><a href='#index-make_002darray-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a newly allocated array whose shape is given by <var>shape</var>.
If <var>value</var> is provided, then each element is initialized to it.
If there is more than one <var>value</var>, they are used in order, starting
over then the <var>value</var>s are exhausted.
If there is no <var>value</var>, the initial contents of each element is
unspecified.  (Actually, it is the <code>#!null</code>.)
The array does not retain a reference to <var>shape</var>.
</p>
<div class="example">
<pre class="example">#|kawa:16|# <kbd>(make-array [2 4] 1 2 3 4 5)</kbd>
╔#2a:2:4╗
║1│2│3│4║
╟─┼─┼─┼─╢
║5│1│2│3║
╚═╧═╧═╧═╝
</pre></div>

<p><em>Compatibility:</em> Guile has an incompatible <code>make-array</code> procedure.
</p></dd></dl>

<dl class="def">
<dt id="index-build_002darray"><span class="category">Procedure: </span><span><strong>build-array</strong> <em>shape procedure</em><a href='#index-build_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Construct a &ldquo;virtual array&rdquo; of the given <var>shape</var>,
which uses no storage for the elements.
Instead, elements are calculated on-demand by calling <var>procedure</var>,
which takes a single argument, an index vector.
</p>
<p>There is no caching or memoization.
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(build-array [[10 &lt;: 12] 3]</kbd>
#|....:2|# <kbd>  (lambda (ind)</kbd>
#|....:3|# <kbd>    (let ((x (ind 0)) (y (ind 1)))</kbd>
#|....:4|# <kbd>      (- x y))))</kbd>
#2a@10:2:3
║10│ 9│8║
╟──┼──┼─╢
║11│10│9║
╚══╧══╧═╝
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-index_002darray"><span class="category">Procedure: </span><span><strong>index-array</strong> <em>shape</em><a href='#index-index_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a new immutable array of the specified <var>shape</var>
where each element is the corresponding row-major index.
Same as <code>(array-reshape [0 &lt;: <var>size</var>] <var>shape</var>)</code>
where <var>size</var> is the <code>array-size</code> of the resulting array.
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(index-array [[1 &lt;: 3] [2 &lt;: 6]])</kbd>
#2a@1:2@2:4
║0│1│2│3║
╟─┼─┼─┼─╢
║4│5│6│7║
╚═╧═╧═╧═╝
</pre></div>

</dd></dl>

</div>
<div class="subsection" id="Array-indexing">
<h4 class="subsection">14.8.5 Array indexing</h4>

<p>If you &ldquo;call&rdquo; an array as it it were a function,
it is equivalent to using <code>array-index-ref</code>,
which is generalization of <code>array-ref</code>.
For example, given a rank-2 array <var>arr</var> with integer indexes <var>i</var>
and <var>j</var>, the following all get the element of <var>arr</var>
at index <code>[<var>i</var> <var>j</var>]</code>.
</p><div class="example">
<pre class="example">(<var>arr</var> <var>i</var> <var>j</var>)
(array-index-ref <var>arr</var> <var>i</var> <var>j</var>)
(array-ref <var>arr</var> <var>i</var> <var>j</var>)
(array-ref <var>arr</var> [<var>i</var> <var>j</var>])
</pre></div>

<p>Using function-call notation or <code>array-index-ref</code>
(but not plain <code>array-ref</code>) you can do generalized APL-style
slicing and indirect indexing.
See under <code>array-index-ref</code> for examples.
</p>
<dl class="def">
<dt id="index-array_002dref"><span class="category">Procedure: </span><span><strong>array-ref</strong> <em>array k ...</em><a href='#index-array_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-array_002dref-1"><span class="category">Procedure: </span><span><strong>array-ref</strong> <em>array index</em><a href='#index-array_002dref-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the contents of the element of <var>array</var> at index <var>k</var> ....
The sequence <var>k</var> ... must be a valid index to <var>array</var>.
In the second form, <var>index</var> must be either a vector
(a 0-based 1-dimensional array) containing <var>k</var> ....
</p><div class="example">
<pre class="example">(array-ref (array [2 3]
              'uno 'dos 'tres
              'cuatro 'cinco 'seis)
   1 0)
</pre></div>
<p>Returns <code>cuatro</code>.
</p><div class="example">
<pre class="example">(let ((a (array (shape 4 7 1 2) 3 1 4)))
   (list (array-ref a 4 1)
         (array-ref a (vector 5 1))
         (array-ref a (array (shape 0 2)
                         6 1))))
</pre></div>
<p>Returns <code>(3 1 4)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dindex_002dref"><span class="category">Procedure: </span><span><strong>array-index-ref</strong> <em>array index ...</em><a href='#index-array_002dindex_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Generalized APL-style array indexing, where each <var>index</var>
can be either an array or an integer.
</p>
<p>If each <var>index</var> is an integer, then the result is the same as <code>array-ref</code>.
</p>
<p>Otherwise, the result is an immutable array whose rank is the sum of the ranks of
each <var>index</var>.  An integer is treated as rank-0 array.
</p>
<p>If <var>marr</var> is the result of <code>(array-index-ref <var>arr</var> <var>M<sub>1</sub></var> <var>M<sub>2</sub></var> ...)</code> then:
</p><div class="example">
<pre class="example">(<var>marr</var> <var>i<sub>11</sub></var> <var>i<sub>12</sub></var> ... <var>i<sub>21</sub></var> <var>i<sub>22</sub></var> ...)
</pre></div>
<p>is defined as:
</p><div class="example">
<pre class="example">(<var>arr</var> (<var>M<sub>1</sub></var> <var>i<sub>11</sub></var> <var>i<sub>12</sub></var> ...) (<var>M<sub>2</sub></var> <var>i<sub>21</sub></var> <var>i<sub>22</sub></var> ...) ...)
</pre></div>
<p>Each <var>M<sub>k</sub></var> gets as many indexes as its rank.
If <var>M<sub>k</sub></var> is an integer, then it we use
it directly without any indexing.
</p>
<p>Here are some examples, starting with simple indexing.
</p><div class="example">
<pre class="example">#|kawa:1|# (define arr (array #2a((1 4) (0 4))
#|.....2|#                    10 11 12 13 20 21 22 23 30 31 32 33))
#|kawa:3|# arr
╔#2a@1:3:4══╗
║10│11│12│13║
╟──┼──┼──┼──╢
║20│21│22│23║
╟──┼──┼──┼──╢
║30│31│32│33║
╚══╧══╧══╧══╝
#|kawa:4|# (arr 2 3)
23
</pre></div>
<p>If one index is a vector and the rest are scalar integers,
then the result is a vector:
</p><div class="example">
<pre class="example">#|kawa:5|# (arr 2 [3 1])
#(23 21)
</pre></div>
<p>You can select a &ldquo;sub-matrix&rdquo; when all indexes are vectors:
</p><div class="example">
<pre class="example">#|kawa:6|# (arr [2 1] [3 1 3])
╔#2a:2:3═╗
║23│21│23║
╟──┼──┼──╢
║13│11│13║
╚══╧══╧══╝
</pre></div>
<p>Using ranges for index vectors selects a rectangular sub-matrix.
</p><div class="example">
<pre class="example">#|kawa:7|# (arr [1 &lt;: 3] [1 &lt;: 4])
╔#2a:2:3═╗
║11│12│13║
╟──┼──┼──╢
║21│22│23║
╚══╧══╧══╝
</pre></div>
<p>You can add new dimensions:
</p><div class="example">
<pre class="example">#|kawa:8|# (arr [2 1] #2a((3 1) (3 2)))
#3a╤══╗
║23│21║
╟──┼──╢
║23│22║
╠══╪══╣
║13│11║
╟──┼──╢
║13│12║
╚══╧══╝
</pre></div>
<p>The pseudo-range <code>[&lt;:]</code> can be used to select all the indexes
along a dimension.  To select row 2 (1-origin):
</p><div class="example">
<pre class="example">#|kawa:9|# (arr 2 [&lt;:])
#(20 21 22 23)
</pre></div>
<p>To reverse the order use <code>[&gt;:]</code>:
</p><div class="example">
<pre class="example">#|kawa:10|# (arr 2 [&gt;:])
#(23 22 21 20)
</pre></div>
<p>To select column 3:
</p><div class="example">
<pre class="example">#|kawa:11|# (arr [&lt;:] 3)
#(13 23 33)
</pre></div>
<p>If you actually want a column matrix (i.e. with shape <code>[3 1]</code>
you can write can place the index in a single-element vector:
</p><div class="example">
<pre class="example">#|kawa:12|# (arr [&lt;:] [3])
#2a╗
║13║
╟──╢
║23║
╟──╢
║33║
╚══╝
</pre></div>
<p>To expand that column to 5 colums you can repeat the column index:
</p><div class="example">
<pre class="example">#|kawa:13|# [3 by: 0 size: 5]
#(3 3 3 3 3)
#|kawa:14|# (arr [&lt;:] [3 by: 0 size: 5])
╔#2a:3:5═╤══╤══╗
║13│13│13│13│13║
╟──┼──┼──┼──┼──╢
║23│23│23│23│23║
╟──┼──┼──┼──┼──╢
║33│33│33│33│33║
╚══╧══╧══╧══╧══╝
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Modifying-arrays">
<h4 class="subsection">14.8.6 Modifying arrays</h4>

<p>You can use <code>set!</code> to modify one or multiple elements.
To modify a single element:
</p><div class="example">
<pre class="example">(set! (<var>arr</var> <var>index</var> ...) <var>new-value</var>)
</pre></div>
<p>is equivalent to
</p><div class="example">
<pre class="example">(array-set! <var>arr</var> <var>index</var> ... <var>new-value</var>)
</pre></div>
<p>You can set a slice (or all of the elements).
In that case:
</p><div class="example">
<pre class="example">(set! (<var>arr</var> <var>index</var> ...) <var>new-array</var>)
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(array-copy! (array-index-share <var>arr</var> <var>index</var> ...) <var>new-array</var>)
</pre></div>

<dl class="def">
<dt id="index-array_002dset_0021"><span class="category">Procedure: </span><span><strong>array-set!</strong> <em>array k ... obj</em><a href='#index-array_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-array_002dset_0021-1"><span class="category">Procedure: </span><span><strong>array-set!</strong> <em>array index obj</em><a href='#index-array_002dset_0021-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Stores <var>obj</var> in the element of <var>array</var> at index <var>k</var> ....
Returns the void value.
The sequence <var>k</var> ... must be a valid index to <var>array</var>.
In the second form, <var>index</var> must be either a vector or a
0-based 1-dimensional array containing <var>k</var> ....
</p>
<div class="example">
<pre class="example">(let ((a (make-array
            (shape 4 5 4 5 4 5))))
   (array-set! a 4 4 4 &quot;huuhkaja&quot;)
   (array-ref a 4 4 4))
</pre></div>
<p>Returns <code>&quot;huuhkaja&quot;</code>.
</p>
<p><em>Compatibility:</em> SRFI-47, Guile and Scheme-48 have <code>array-set!</code> with a
different argument order.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dcopy_0021"><span class="category">Procedure: </span><span><strong>array-copy!</strong> <em>dst src</em><a href='#index-array_002dcopy_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><em>Compatibility:</em> Guile has a <code>array-copy!</code> with the reversed
argument order.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dfill_0021"><span class="category">Procedure: </span><span><strong>array-fill!</strong> <em>array value</em><a href='#index-array_002dfill_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Set all the values <var>array</var> to <var>value</var>.
</p></dd></dl>

</div>
<div class="subsection" id="Transformations-and-views">
<h4 class="subsection">14.8.7 Transformations and views</h4>

<p>A view or transform of an array is an array <var>a<sub>2</sub></var>
whose elements come from some other array <var>a<sub>1</sub></var>,
given some transform function <var>T</var> that maps <var>a<sub>2</sub></var> indexes
to <var>a<sub>1</sub></var> indexes.
Specifically <code>(array-ref <var>a<sub>2</sub></var> <var>indexes</var>)</code>
is <code>(array-ref <var>a<sub>1</sub></var> (<var>T</var> <var>indexes</var>))</code>.
Modifying <var>a<sub>2</sub></var> causes <var>a<sub>1</sub></var> to be modified;
modifying <var>a<sub>1</sub></var> may modify <var>a<sub>2</sub></var>
(depending on the transform function).
The shape of <var>a<sub>2</sub></var> is in generally different than that of <var>a<sub>1</sub></var>.
</p>
<dl class="def">
<dt id="index-array_002dtransform"><span class="category">Procedure: </span><span><strong>array-transform</strong> <em>array shape transform</em><a href='#index-array_002dtransform' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This is a general mechanism for creating a view.
The result is a new array with the given <var>shape</var>.
Accessing this new array is implemented by calling the <var>transform</var>
function on the index vector, which must return a new index vector
valid for indexing the original <var>array</var>.
Here is an example (using the same <code>arr</code> as in
the <code>array-index-ref</code> example):
</p><div class="example">
<pre class="example">#|kawa:1|# (define arr (array #2a((1 4) (0 4))
#|.....2|#                    10 11 12 13 20 21 22 23 30 31 32 33))
#|kawa:14|# (array-transform arr #2a((0 3) (1 3) (0 2))
#|.....15|#   (lambda (ix) (let ((i (ix 0)) (j (ix 1)) (k (ix 2)))
#|.....16|#                  [(+ i 1)
#|.....17|#                   (+ (* 2 (- j 1)) k)])))
#3a:3@1:2:2
║10│11║
╟──┼──╢
║12│13║
╠══╪══╣
║20│21║
╟──┼──╢
║22│23║
╠══╪══╣
║30│31║
╟──┼──╢
║32│33║
╚══╧══╝
</pre></div>

<p>The <code>array-transform</code> is generalization of <code>share-array</code>,
in that it does not require the <var>transform</var> to be affine.
Also note the different calling conversions for the <var>tranform</var>:
<code>array-transform</code> takes a single argument (a vector of indexes),
and returns a single result (a vector of indexes);
<code>share-array</code> takes one argument for each index, and returns
one value for each index.  The difference is historical.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dindex_002dshare"><span class="category">Procedure: </span><span><strong>array-index-share</strong> <em>array index ...</em><a href='#index-array_002dindex_002dshare' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This does the same generalized APL-style indexing
as <code>array-index-ref</code>.  However, the resulting array
is a modifiable view into argument <var>array</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-array_002dreshape"><span class="category">Procedure: </span><span><strong>array-reshape</strong> <em>array shape</em><a href='#index-array_002dreshape' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a new array <var>narray</var> of the given <var>shape</var>,
such that <code>(array-&gt;vector <var>array</var>)</code> and
<code>(array-&gt;vector <var>narray</var>)</code> are equivalent.
I.e. the <var>i</var>&rsquo;th element in row-major-order of <var>narray</var>
is the <var>i</var>&rsquo;th element in row-major-order of <var>array</var>.
Hence <code>(array-size <var>narray</var>)</code> (as specied from the <var>shape</var>)
must be equal to <code>(array-size <var>array</var>)</code>.
The resulting <var>narray</var> is a view such that modifying <var>array</var>
also modifies <var>narray</var> and vice versa.
</p></dd></dl>

<dl class="def">
<dt id="index-share_002darray"><span class="category">Procedure: </span><span><strong>share-array</strong> <em>array shape proc</em><a href='#index-share_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new array of <var>shape</var> shape that shares elements of <var>array</var>
through <var>proc</var>. The procedure <var>proc</var> must implement an affine
function that returns indices of <var>array</var> when given indices of the
array returned by <code>share-array</code>.
The array does not retain a reference to <var>shape</var>.
</p><div class="example">
<pre class="example">(define i_4
   (let* ((i (make-array
                (shape 0 4 0 4)
                0))
          (d (share-array i
                (shape 0 4)
                (lambda (k)
                   (values k k)))))
      (do ((k 0 (+ k 1)))
          ((= k 4))
         (array-set! d k 1))
      i))
</pre></div>

<p>Note: the affinity requirement for <var>proc</var> means that each value must
be a sum of multiples of the arguments passed to <var>proc</var>, plus a constant.
</p>
<p>Implementation note: arrays have to maintain an internal index mapping
from indices <var>k1</var> ... <var>kd</var> to a single index into a backing vector;
the composition of this mapping and <var>proc</var> can be recognised
as <code>(<var>+ n0</var> (* <var>n1</var> <var>k1</var>) ... (* <var>nd</var> <var>kd</var>))</code>
by setting each index in turn to 1 and others to 0,
and all to 0 for the constant term; the composition can then be compiled
away, together with any complexity that the user introduced in their
procedure.
</p>
<p>Here is an example where the <var>array</var> is a uniform vector:
</p><div class="example">
<pre class="example">(share-array
  (f64vector 1.0 2.0 3.0 4.0 5.0 6.0)
  (shape 0 2 0 3)
  (lambda (i j) (+ (* 2 i) j)))
  &rArr;  #2f64((1.0 2.0 3.0) (4.0 5.0 6.0))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-array_002dflatten"><span class="category">Procedure: </span><span><strong>array-flatten</strong> <em>array</em><a href='#index-array_002dflatten' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-array_002d_003evector"><span class="category">Procedure: </span><span><strong>array-&gt;vector</strong> <em>array</em><a href='#index-array_002d_003evector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a vector consisting of the elements of the <var>array</var>
in row-major-order.
</p>
<p>The result of <code>array-flatten</code> is fresh (mutable) copy, not a view.
The result of <code>array-&gt;vector</code> is a view: If <var>array</var> is mutable,
then modifying <var>array</var> changes the flattened result and vice versa.
</p>
<p>If <var>array</var> is &ldquo;simple&rdquo;,  <code>array-&gt;vector</code> returns the original vector.
Specifically, if <var>vec</var> is a vector then:
</p><div class="example">
<pre class="example">(eq? <var>vec</var> (array-&gt;vector (array-reshape <var>vec</var> <var>shape</var>)))
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Miscellaneous-1">
<h4 class="subsection">14.8.8 Miscellaneous</h4>

<dl class="def">
<dt id="index-format_002darray-1"><span class="category">Procedure: </span><span><strong>format-array</strong> <em>value [element-format]</em><a href='#index-format_002darray-1' class='copiable-anchor'> &para;</a></span></dt>
</dl>

<hr>
</div>
</div>
<div class="section" id="Hash-tables">
<div class="header">
<p>
Previous: <a href="#Arrays" accesskey="p" rel="prev">Multi-dimensional Arrays</a>, Up: <a href="#Data-structures" accesskey="u" rel="up">Data structures</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Hash-tables-1"></span><h3 class="section">14.9 Hash tables</h3>

<p>A <em>hashtable</em> is a data structure that
associates keys with values.
The hashtable has no intrinsic order for the (key, value) associations
it contains, and
supports in-place modification as the primary means of setting the contents
of a hash table.
Any object can be used as a key, provided a <em>hash function</em> and a suitable
<em>equivalence function</em> is available.
A hash function is a procedure that
maps keys to exact integer objects.
</p>
<p>The hashtable provides key lookup and destructive update in amortised
constant time, provided that a good hash function is used. 
A hash function <var>h</var> is acceptable for an equivalence predicate <var>e</var> iff
<code>(<var>e</var> <var>obj1</var> <var>obj2</var>)</code> implies
<code>(= (<var>h</var> <var>obj1</var>) (<var>h</var> <var>obj2</var>))</code>.
A hash function <var>h</var> is good for a equivalence predicate <var>e</var> if
it distributes the resulting hash values for non-equal objects
(by <var>e</var>) as uniformly as possible over the range of hash
values, especially in the case when some (non-equal) objects resemble
each other by e.g. having common subsequences. This definition is
vague but should be enough to assert that e.g. a constant function is
not a good hash function.
</p>
<p>Kawa provides two complete sets of functions for hashtables:
</p><ul>
<li> The functions specified by R6RS have names starting with <code>hashtable-</code>
</li><li> The functions specified by the older
<a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI-69</a> specifiation
have names starting with <code>hash-table-</code>
</li></ul>

<p>Both interfaces use the same underlying datatype, so it is possible 
to mix and match from both sets.
That datatype implements <code>java.util.Map</code>.
Freshly-written code should probably use the R6RS functions.
</p>
<ul class="section-toc">
<li><a href="#R6RS-hash-tables" accesskey="1">R6RS hash tables</a></li>
<li><a href="#SRFI_002d69-hash-tables" accesskey="2">SRFI-69 hash tables</a></li>
</ul>
<div class="subsection" id="R6RS-hash-tables">
<h4 class="subsection">14.9.1 R6RS hash tables</h4>

<p>To use these hash table functions in your Kawa program you must first:
</p>
<div class="example">
<pre class="example">(import (rnrs hashtables))
</pre></div>

<p>This section uses the <var>hashtable</var> parameter name for arguments that
must be hashtables, and the <var>key</var> parameter name for arguments that
must be hashtable keys.
</p>
<dl class="def">
<dt id="index-make_002deq_002dhashtable"><span class="category">Procedure: </span><span><strong>make-eq-hashtable</strong><a href='#index-make_002deq_002dhashtable' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deq_002dhashtable-1"><span class="category">Procedure: </span><span><strong>make-eq-hashtable</strong> <em><var>k</var></em><a href='#index-make_002deq_002dhashtable-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code>eq?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements.
</p></dd></dl>


<dl class="def">
<dt id="index-make_002deqv_002dhashtable"><span class="category">Procedure: </span><span><strong>make-eqv-hashtable</strong><a href='#index-make_002deqv_002dhashtable' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002deqv_002dhashtable-1"><span class="category">Procedure: </span><span><strong>make-eqv-hashtable</strong> <em><var>k</var></em><a href='#index-make_002deqv_002dhashtable-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code>eqv?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dhashtable"><span class="category">Procedure: </span><span><strong>make-hashtable</strong> <em><var>hash-function</var> <var>equiv</var></em><a href='#index-make_002dhashtable' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-make_002dhashtable-1"><span class="category">Procedure: </span><span><strong>make-hashtable</strong> <em><var>hash-function</var> <var>equiv</var> <var>k</var></em><a href='#index-make_002dhashtable-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>hash-function</var> and <var>equiv</var> must be procedures.
<var>hash-function</var> should accept a key as an argument and should return
a non&ndash;negative exact integer object.  <var>equiv</var> should accept two
keys as arguments and return a single value.  Neither procedure should
mutate the hashtable returned by <code>make-hashtable</code>.
</p>
<p>The <code>make-hashtable</code> procedure returns a newly allocated mutable
hashtable using <var>hash-function</var> as the hash function and <var>equiv</var>
as the equivalence function used to compare keys.  If a third argument
is given, the initial capacity of the hashtable is set to approximately
<var>k</var> elements.
</p>
<p>Both <var>hash-function</var> and <var>equiv</var> should behave like pure
functions on the domain of keys.  For example, the <code>string-hash</code>
and <code>string=?</code> procedures are permissible only if all keys are
strings and the contents of those strings are never changed so long as
any of them continues to serve as a key in the hashtable.  Furthermore,
any pair of keys for which <var>equiv</var> returns true should be hashed to
the same exact integer objects by <var>hash-function</var>.
</p>
<blockquote>
<p><em>Note:</em> Hashtables are allowed to cache the results of calling the
hash function and equivalence function, so programs cannot rely on the
hash function being called for every lookup or update.  Furthermore any
hashtable operation may call the hash function more than once.
</p></blockquote>
</dd></dl>

<ul class="section-toc">
<li><a href="#Procedures-2" accesskey="1">Procedures</a></li>
<li><a href="#Inspection" accesskey="2">Inspection</a></li>
<li><a href="#Hash-functions" accesskey="3">Hash functions</a></li>
</ul>
<div class="subsubsection" id="Procedures-2">
<h4 class="subsubsection">14.9.1.1 Procedures</h4>

<dl class="def">
<dt id="index-hashtable_003f"><span class="category">Procedure: </span><span><strong>hashtable?</strong> <em><var>obj</var></em><a href='#index-hashtable_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>obj</var> is a hashtable, <code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dsize"><span class="category">Procedure: </span><span><strong>hashtable-size</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dsize' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the number of keys contained in <var>hashtable</var> as an exact
integer object.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dref"><span class="category">Procedure: </span><span><strong>hashtable-ref</strong> <em><var>hashtable</var> <var>key</var> <var>default</var></em><a href='#index-hashtable_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the value in <var>hashtable</var> associated with <var>key</var>.  If
<var>hashtable</var> does not contain an association for <var>key</var>,
<var>default</var> is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dset_0021"><span class="category">Procedure: </span><span><strong>hashtable-set!</strong> <em><var>hashtable</var> <var>key</var> <var>obj</var></em><a href='#index-hashtable_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Change <var>hashtable</var> to associate <var>key</var> with <var>obj</var>, adding a
new association or replacing any existing association for <var>key</var>, and
returns unspecified values.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002ddelete_0021"><span class="category">Procedure: </span><span><strong>hashtable-delete!</strong> <em><var>hashtable</var> <var>key</var></em><a href='#index-hashtable_002ddelete_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Remove any association for <var>key</var> within <var>hashtable</var> and returns
unspecified values.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dcontains_003f"><span class="category">Procedure: </span><span><strong>hashtable-contains?</strong> <em><var>hashtable</var> <var>key</var></em><a href='#index-hashtable_002dcontains_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>hashtable</var> contains an association for <var>key</var>,
<code>#f</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dupdate_0021"><span class="category">Procedure: </span><span><strong>hashtable-update!</strong> <em><var>hashtable</var> <var>key</var> <var>proc</var> <var>default</var></em><a href='#index-hashtable_002dupdate_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>proc</var> should accept one argument, should return a single value, and
should not mutate <var>hashtable</var>.
</p>
<p>The <code>hashtable-update!</code> procedure applies <var>proc</var> to the value
in <var>hashtable</var> associated with <var>key</var>, or to <var>default</var> if
<var>hashtable</var> does not contain an association for <var>key</var>.  The
<var>hashtable</var> is then changed to associate <var>key</var> with the value
returned by <var>proc</var>.
</p>
<p>The behavior of <code>hashtable-update!</code> is equivalent to the following
code, but is may be (and is in Kawa) implemented more efficiently in cases
where the implementation can avoid multiple lookups of the same key:
</p>
<div class="example">
<pre class="example">(hashtable-set!
  hashtable key
  (proc (hashtable-ref
         hashtable key default)))
</pre></div>
</dd></dl>


<dl class="def">
<dt id="index-hashtable_002dcopy"><span class="category">Procedure: </span><span><strong>hashtable-copy</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dcopy' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-hashtable_002dcopy-1"><span class="category">Procedure: </span><span><strong>hashtable-copy</strong> <em><var>hashtable</var> <var>mutable</var></em><a href='#index-hashtable_002dcopy-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a copy of <var>hashtable</var>.  If the <var>mutable</var> argument is
provided and is true, the returned hashtable is mutable; otherwise it is
immutable.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dclear_0021"><span class="category">Procedure: </span><span><strong>hashtable-clear!</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dclear_0021' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-hashtable_002dclear_0021-1"><span class="category">Procedure: </span><span><strong>hashtable-clear!</strong> <em><var>hashtable</var> <var>k</var></em><a href='#index-hashtable_002dclear_0021-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Remove all associations from <var>hashtable</var> and returns unspecified
values.
</p>
<p>If a second argument is given, the current capacity of the hashtable is
reset to approximately <var>k</var> elements.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dkeys"><span class="category">Procedure: </span><span><strong>hashtable-keys</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dkeys' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a vector of all keys in <var>hashtable</var>.  The order of the vector
is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dentries"><span class="category">Procedure: </span><span><strong>hashtable-entries</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dentries' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return two values, a vector of the keys in <var>hashtable</var>, and a vector
of the corresponding values.
</p>
<p>Example:
</p>
<div class="example">
<pre class="example">(let ((h (make-eqv-hashtable)))
  (hashtable-set! h 1 'one)
  (hashtable-set! h 2 'two)
  (hashtable-set! h 3 'three)
  (hashtable-entries h))
&rArr; #(1 2 3) #(one two three) ; two return values
</pre></div>

<p>the order of the entries in the result vectors is not known.
</p></dd></dl>

</div>
<div class="subsubsection" id="Inspection">
<h4 class="subsubsection">14.9.1.2 Inspection</h4>

<dl class="def">
<dt id="index-hashtable_002dequivalence_002dfunction"><span class="category">Procedure: </span><span><strong>hashtable-equivalence-function</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dequivalence_002dfunction' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the equivalence function used by <var>hashtable</var> to compare keys.
For hashtables created with <code>make-eq-hashtable</code> and
<code>make-eqv-hashtable</code>, returns <code>eq?</code> and <code>eqv?</code>
respectively.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dhash_002dfunction"><span class="category">Procedure: </span><span><strong>hashtable-hash-function</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dhash_002dfunction' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the hash function used by <var>hashtable</var>.  For hashtables
created by <code>make-eq-hashtable</code> or <code>make-eqv-hashtable</code>,
<code>#f</code> is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-hashtable_002dmutable_003f"><span class="category">Procedure: </span><span><strong>hashtable-mutable?</strong> <em><var>hashtable</var></em><a href='#index-hashtable_002dmutable_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return <code>#t</code> if <var>hashtable</var> is mutable, otherwise <code>#f</code>.
</p></dd></dl>

</div>
<div class="subsubsection" id="Hash-functions">
<h4 class="subsubsection">14.9.1.3 Hash functions</h4>

<p>The <code>equal-hash</code>, <code>string-hash</code>, and <code>string-ci-hash</code>
procedures of this section are acceptable as the hash functions of a
hashtable only if the keys on which they are called are not mutated
while they remain in use as keys in the hashtable.
</p>
<dl class="def">
<dt id="index-equal_002dhash"><span class="category">Procedure: </span><span><strong>equal-hash</strong> <em><var>obj</var></em><a href='#index-equal_002dhash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return an integer hash value for <var>obj</var>, based on its structure and
current contents.  This hash function is suitable for use with
<code>equal?</code> as an equivalence function.
</p><blockquote>
<p><em>Note:</em> Like <code>equal?</code>, the <code>equal-hash</code> procedure must
always terminate, even if its arguments contain cycles.
</p></blockquote>
</dd></dl>

<dl class="def">
<dt id="index-string_002dhash"><span class="category">Procedure: </span><span><strong>string-hash</strong> <em><var>string</var></em><a href='#index-string_002dhash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return an integer hash value for <var>string</var>, based on its current
contents.  This hash function is suitable for use with <code>string=?</code>
as an equivalence function.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dci_002dhash"><span class="category">Procedure: </span><span><strong>string-ci-hash</strong> <em><var>string</var></em><a href='#index-string_002dci_002dhash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return an integer hash value for <var>string</var> based on its current
contents, ignoring case.  This hash function is suitable for use with
<code>string-ci=?</code> as an equivalence function.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dhash"><span class="category">Procedure: </span><span><strong>symbol-hash</strong> <em><var>symbol</var></em><a href='#index-symbol_002dhash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return an integer hash value for <var>symbol</var>.
</p></dd></dl>


</div>
</div>
<div class="subsection" id="SRFI_002d69-hash-tables">
<h4 class="subsection">14.9.2 SRFI-69 hash tables</h4>

<p>To use these hash table functions in your Kawa program you must first:
</p><div class="example">
<pre class="example">(require 'srfi-69)
</pre></div>
<p>or
</p><div class="example">
<pre class="example">(require 'hash-table)
</pre></div>
<p>or
</p><div class="example">
<pre class="example">(import (srfi 69 basic-hash-tables))
</pre></div>

<ul class="section-toc">
<li><a href="#Type-constructors-and-predicate" accesskey="1">Type constructors and predicate</a></li>
<li><a href="#Reflective-queries" accesskey="2">Reflective queries</a></li>
<li><a href="#Dealing-with-single-elements" accesskey="3">Dealing with single elements</a></li>
<li><a href="#Dealing-with-the-whole-contents" accesskey="4">Dealing with the whole contents</a></li>
<li><a href="#Hash-functions-1" accesskey="5">Hash functions</a></li>
</ul>
<div class="subsubsection" id="Type-constructors-and-predicate">
<h4 class="subsubsection">14.9.2.1 Type constructors and predicate</h4>
<dl class="def">
<dt id="index-make_002dhash_002dtable"><span class="category">Procedure: </span><span><strong>make-hash-table</strong> <em>[ equal? [ hash [ size-hint]]] → hash-table</em><a href='#index-make_002dhash_002dtable' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Create a new hash table with no associations.
The <var>equal?</var> parameter is a predicate
that should accept two keys and return a boolean telling whether they
denote the same key value; it defaults to the <code>equal?</code> function.
</p>
<p>The <var>hash</var> parameter is a hash function, and defaults to an 
appropriate hash function
for the given <var>equal?</var> predicate (see the Hashing section).
However, an
acceptable default is not guaranteed to be given for any equivalence
predicate coarser than <code>equal?</code>, except for <code>string-ci=?</code>.
(The function <code>hash</code> is acceptable for <code>equal?</code>, so if you
use coarser equivalence than <code>equal?</code> other than <code>string-ci=?</code>,
you must always provide the function hash yourself.)
(An equivalence predicate <var>c1</var> is coarser than a equivalence
predicate <var>c2</var> iff there exist values <var>x</var> and <var>y</var> such
that <code>(and (<var>c1</var> <var>x</var> <var>y</var>) (not (<var>c2</var> <var>x</var> <var>y</var>)))</code>.)
</p>
<p>The <var>size-hint</var> parameter can be used to suggested an approriate
initial size.  This option is not part of the SRFI-69 specification
(though it is handled by the reference implementation), so specifying
that option might be unportable.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_003f"><span class="category">Procedure: </span><span><strong>hash-table?</strong> <em>obj → boolean</em><a href='#index-hash_002dtable_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A predicate to test whether a given object <var>obj</var> is a hash table.
</p></dd></dl>

<dl class="def">
<dt id="index-alist_002d_003ehash_002dtable"><span class="category">Procedure: </span><span><strong>alist-&gt;hash-table</strong> <em>alist [ equal? [ hash [ size-hint]]] → hash-table</em><a href='#index-alist_002d_003ehash_002dtable' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Takes an association list <var>alist</var> and creates a hash table
<var>hash-table</var> which maps the <code>car</code> of every element in
<var>alist</var> to the <code>cdr</code> of corresponding elements in
<var>alist</var>. The <var>equal?</var>, <var>hash</var>, and <var>size-hint</var>
parameters are interpreted as in <code>make-hash-table</code>. If some key
occurs multiple times in <var>alist</var>, the value in the first
association will take precedence over later ones. (Note: the choice of
using <code>cdr</code> (instead of <code>cadr</code>) for values tries to strike
balance between the two approaches: using <var>cadr</var> would render this
procedure unusable for <code>cdr</code> alists, but not vice versa.)
</p></dd></dl>

</div>
<div class="subsubsection" id="Reflective-queries">
<h4 class="subsubsection">14.9.2.2 Reflective queries</h4>
<dl class="def">
<dt id="index-hash_002dtable_002dequivalence_002dfunction"><span class="category">Procedure: </span><span><strong>hash-table-equivalence-function</strong> <em>hash-table</em><a href='#index-hash_002dtable_002dequivalence_002dfunction' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the equivalence predicate used for keys of <var>hash-table</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dhash_002dfunction"><span class="category">Procedure: </span><span><strong>hash-table-hash-function</strong> <em>hash-table</em><a href='#index-hash_002dtable_002dhash_002dfunction' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the hash function used for keys of <var>hash-table</var>.
</p></dd></dl>

</div>
<div class="subsubsection" id="Dealing-with-single-elements">
<h4 class="subsubsection">14.9.2.3 Dealing with single elements</h4>
<dl class="def">
<dt id="index-hash_002dtable_002dref"><span class="category">Procedure: </span><span><strong>hash-table-ref</strong> <em>hash-table key [ thunk ] → value</em><a href='#index-hash_002dtable_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure returns the value associated to <var>key</var> in
<var>hash-table</var>. If no value is associated to <var>key</var> and
<var>thunk</var> is given, it is called with no arguments and its value is
returned; if <var>thunk</var> is not given, an error is signalled. Given a
good hash function, this operation should have an (amortised) complexity
of O(1) with respect to the number of associations in <var>hash-table</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dref_002fdefault"><span class="category">Procedure: </span><span><strong>hash-table-ref/default</strong> <em>hash-table key default → value</em><a href='#index-hash_002dtable_002dref_002fdefault' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to the same value as <code>(hash-table-ref <var>hash-table</var>
<var>key</var> (lambda () <var>default</var>))</code>. Given a good hash function, this
operation should have an (amortised) complexity of O(1) with respect
to the number of associations in hash-table.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dset_0021"><span class="category">Procedure: </span><span><strong>hash-table-set!</strong> <em>hash-table key value → void</em><a href='#index-hash_002dtable_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure sets the value associated to <var>key</var> in
<var>hash-table</var>. The previous association (if any) is removed. Given
a good hash function, this operation should have an (amortised)
complexity of O(1) with respect to the number of associations in
hash-table.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002ddelete_0021"><span class="category">Procedure: </span><span><strong>hash-table-delete!</strong> <em>hash-table key → void</em><a href='#index-hash_002dtable_002ddelete_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure removes any association to <var>key</var> in
<var>hash-table</var>. It is not an error if no association for the
<var>key</var> exists; in this case, nothing is done. Given a good hash
function, this operation should have an (amortised) complexity of O(1)
with respect to the number of associations in hash-table.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dexists_003f"><span class="category">Procedure: </span><span><strong>hash-table-exists?</strong> <em>hash-table key → boolean</em><a href='#index-hash_002dtable_002dexists_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This predicate tells whether there is any association to <var>key</var> in
<var>hash-table</var>. Given a good hash function, this operation should
have an (amortised) complexity of O(1) with respect to the number of
associations in hash-table.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dupdate_0021"><span class="category">Procedure: </span><span><strong>hash-table-update!</strong> <em>hash-table key function [ thunk ] → void</em><a href='#index-hash_002dtable_002dupdate_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Semantically equivalent to, but may be implemented more efficiently than,
the following code:
</p><div class="example">
<pre class="example">(hash-table-set! <var>hash-table key</var>
                 (function (hash-table-ref <var>hash-table</var> <var>key</var> <var>thunk</var>)))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dupdate_0021_002fdefault"><span class="category">Procedure: </span><span><strong>hash-table-update!/default</strong> <em>hash-table key function default → void</em><a href='#index-hash_002dtable_002dupdate_0021_002fdefault' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Behaves as if it evaluates to
<code>(hash-table-update! <var>hash-table</var> <var>key</var> <var>function</var> (lambda () <var>default</var>))</code>.
</p></dd></dl>

</div>
<div class="subsubsection" id="Dealing-with-the-whole-contents">
<h4 class="subsubsection">14.9.2.4 Dealing with the whole contents</h4>

<dl class="def">
<dt id="index-hash_002dtable_002dsize"><span class="category">Procedure: </span><span><strong>hash-table-size</strong> <em>hash-table → integer</em><a href='#index-hash_002dtable_002dsize' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the number of associations in <var>hash-table</var>. This operation takes
constant time.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dkeys"><span class="category">Procedure: </span><span><strong>hash-table-keys</strong> <em>hash-table → list</em><a href='#index-hash_002dtable_002dkeys' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of keys in <var>hash-table</var>.
The order of the keys is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dvalues"><span class="category">Procedure: </span><span><strong>hash-table-values</strong> <em>hash-table → list</em><a href='#index-hash_002dtable_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of values in <var>hash-table</var>. The order of the values is
unspecified, and is not guaranteed to match the order of keys in the
result of <code>hash-table-keys</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dwalk"><span class="category">Procedure: </span><span><strong>hash-table-walk</strong> <em>hash-table proc → void</em><a href='#index-hash_002dtable_002dwalk' class='copiable-anchor'> &para;</a></span></dt>
<dd><p><var>proc</var> should be a function taking two arguments, a key and a
value. This procedure calls <var>proc</var> for each association in
<var>hash-table</var>, giving the key of the association as key and the
value of the association as value. The results of <var>proc</var> are
discarded. The order in which <var>proc</var> is called for the different
associations is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dfold"><span class="category">Procedure: </span><span><strong>hash-table-fold</strong> <em>hash-table f init-value → final-value</em><a href='#index-hash_002dtable_002dfold' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure calls <var>f</var> for every association in <var>hash-table</var>
with three arguments: the key of the association key, the value of the
association value, and an accumulated value, <var>val</var>. The <var>val</var>
is <var>init-value</var> for the first invocation of <var>f</var>, and for
subsequent invocations of <var>f</var>, the return value of the previous
invocation of <var>f</var>. The value <var>final-value</var> returned by
<code>hash-table-fold</code> is the return value of the last invocation of
<var>f</var>. The order in which <var>f</var> is called for different
associations is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002d_003ealist"><span class="category">Procedure: </span><span><strong>hash-table-&gt;alist</strong> <em>hash-table → alist</em><a href='#index-hash_002dtable_002d_003ealist' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an association list such that the <code>car</code> of each element
in <var>alist</var> is a key in <var>hash-table</var> and the corresponding
<code>cdr</code> of each element in <var>alist</var> is the value associated to
the key in <var>hash-table</var>. The order of the elements is unspecified.
</p>
<p>The following should always produce a hash table with the same mappings
as a hash table <var>h</var>:
</p><div class="example">
<pre class="example">(alist-&gt;hash-table (hash-table-&gt;alist <var>h</var>)
                        (hash-table-equivalence-function <var>h</var>)
                        (hash-table-hash-function <var>h</var>))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dcopy"><span class="category">Procedure: </span><span><strong>hash-table-copy</strong> <em>hash-table → hash-table</em><a href='#index-hash_002dtable_002dcopy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new hash table with the same equivalence predicate, hash
function and mappings as in <var>hash-table</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dtable_002dmerge_0021"><span class="category">Procedure: </span><span><strong>hash-table-merge!</strong> <em>hash-table1 hash-table2 → hash-table</em><a href='#index-hash_002dtable_002dmerge_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Adds all mappings in <var>hash-table2</var> into <var>hash-table1</var> and
returns the resulting hash table. This function may modify
<var>hash-table1</var> destructively.
</p></dd></dl>

</div>
<div class="subsubsection" id="Hash-functions-1">
<h4 class="subsubsection">14.9.2.5 Hash functions</h4>

<p>The Kawa implementation always calls these hash functions with a single
parameter, and expects the result to be within the entire
(32-bit signed) <code>int</code> range, for compatibility with
standard <code>hashCode</code> methods.
</p>
<dl class="def">
<dt id="index-hash"><span class="category">Procedure: </span><span><strong>hash</strong> <em>object [ bound ] → integer</em><a href='#index-hash' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Produces a hash value for object in the range from 0 (inclusive) tp to
<var>bound</var> (exclusive).
</p>
<p>If <var>bound</var> is not given, the Kawa implementation returns a value within
the range <code><span class="nolinebreak">(-</span>&nbsp;(expt&nbsp;2&nbsp;32))</code><!-- /@w --> (inclusive)
to <code><span class="nolinebreak">(-</span>&nbsp;(expt&nbsp;2&nbsp;32)&nbsp;1)</code><!-- /@w --> (inclusive).
It does this by calling the standard <code>hashCode</code> method,
and returning the result as is.
(If the <var>object</var> is the Java <code>null</code> value, 0 is returned.)
This hash function is acceptable for <code>equal?</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dhash-1"><span class="category">Procedure: </span><span><strong>string-hash</strong> <em>string [ bound ] → integer</em><a href='#index-string_002dhash-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The same as <code>hash</code>, except that the argument string must be a string.
(The Kawa implementation returns the same as the <code>hash</code> function.)
</p></dd></dl>

<dl class="def">
<dt id="index-string_002dci_002dhash-1"><span class="category">Procedure: </span><span><strong>string-ci-hash</strong> <em>string [ bound ] → integer</em><a href='#index-string_002dci_002dhash-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The same as <code>string-hash</code>, except that the case of characters in
string does not affect the hash value produced.
(The Kawa implementation returns the same the <code>hash</code> function
applied to the lower-cased <var>string</var>.)
</p></dd></dl>

<dl class="def">
<dt id="index-hash_002dby_002didentity"><span class="category">Procedure: </span><span><strong>hash-by-identity</strong> <em>object [ bound ] → integer</em><a href='#index-hash_002dby_002didentity' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The same as <code>hash</code>, except that this function is only guaranteed
to be acceptable for <code>eq?</code>.
Kawa uses the <code>identityHashCode</code> method of <code>java.lang.System</code>.
</p></dd></dl>


<hr>
</div>
</div>
</div>
</div>
<div class="chapter" id="Eval-and-Environments">
<div class="header">
<p>
Next: <a href="#Debugging" accesskey="n" rel="next">Debugging</a>, Previous: <a href="#Data-structures" accesskey="p" rel="prev">Data structures</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Eval-and-Environments-1"></span><h2 class="chapter">15 Eval and Environments</h2>

<dl class="def">
<dt id="index-environment"><span class="category">Procedure: </span><span><strong>environment</strong> <em>list<sup>*</sup></em><a href='#index-environment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure returns a specifier for the environment that
results by starting with an empty environment and then
importing each <var>list</var>, considered as an <a href="#meta_002dimport_002dset"><var>import-set</var></a>, into it.
The bindings of the environment represented by the specifier
are immutable, as is the environment itself.
See the <code>eval</code> function for examples.
</p></dd></dl>

<dl class="def">
<dt id="index-null_002denvironment"><span class="category">Procedure: </span><span><strong>null-environment</strong> <em>version</em><a href='#index-null_002denvironment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure returns an environment that contains no variable bindings,
but contains (syntactic) bindings for all the syntactic keywords.
</p>
<p>The effect of assigning to a variable in this environment (such
as <code>let</code>) is undefined.
</p></dd></dl>

<dl class="def">
<dt id="index-scheme_002dreport_002denvironment"><span class="category">Procedure: </span><span><strong>scheme-report-environment</strong> <em>version</em><a href='#index-scheme_002dreport_002denvironment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>version</var> must be an exact non-negative inetger corresponding to
a version of one of the Revised<var>version</var> Reports on Scheme.
The procedure returns an environment that contains exactly the set of
bindings specified in the corresponding report.
</p>
<p>This implementation supports <var>version</var> that is 4 or 5.
</p>
<p>The effect of assigning to a variable in this environment (such
as <code>car</code>) is undefined.
</p></dd></dl>

<dl class="def">
<dt id="index-interaction_002denvironment"><span class="category">Procedure: </span><span><strong>interaction-environment</strong><a href='#index-interaction_002denvironment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure return an environment that contains implementation-defined
bindings, as well as top-level user bindings.
</p></dd></dl>

<dl class="def">
<dt id="index-environment_002dbound_003f"><span class="category">Procedure: </span><span><strong>environment-bound?</strong> <em>environment symbol</em><a href='#index-environment_002dbound_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return true <code>#t</code> if there is a binding for <var>symbol</var>
in <var>environment</var>;  otherwise returns <code>#f</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-fluid_002dlet"><span class="category">Syntax: </span><span><strong>fluid-let</strong> <em>((variable init) ...) body ...</em><a href='#index-fluid_002dlet' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluate the <var>init</var> expressions.
Then modify the dynamic bindings for the <var>variables</var> to the
values of the <var>init</var> expressions, and evaluate the <var>body</var> expressions.
Return the result of the last expression in <var>body</var>.
Before returning, restore the original bindings.
The temporary bindings are only visible in the current thread, and its
descendent threads.
</p></dd></dl>

<dl class="def">
<dt id="index-base_002duri"><span class="category">Procedure: </span><span><strong>base-uri</strong> <em>[node]</em><a href='#index-base_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>node</var> is specified, returns the base-URI property
of the <var>node</var>.  If the <var>node</var> does not have the base-URI
property, returns <code>#f</code>.
(The XQuery version returns the empty sequence in that case.)
</p>
<p>In the zero-argument case, returns the &quot;base URI&quot; of the current context.
By default the base URI is the current working directory (as a URL).
While a source file is <code>load</code>ed, the base URI is temporarily
set to the URL of the document.
</p></dd></dl>

<dl class="def">
<dt id="index-eval"><span class="category">Procedure: </span><span><strong>eval</strong> <em>expression [environment]</em><a href='#index-eval' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This procedure evaluates <var>expression</var> in the environment indicated
by <var>environment</var>.
The default for <var>environment</var> is the result
of <code>(interaction-environment)</code>.
</p>
<div class="example">
<pre class="example">(eval ’(* 7 3) (environment '(scheme base)))
            &rArr; 21

(let ((f (eval '(lambda (f x) (f x x))
               (null-environment 5))))
  (f + 10))
            &rArr; 20

(eval '(define foo 32) (environment '(scheme base)))
            &rArr; <i>error is signaled</i>
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-load"><span class="category">Procedure: </span><span><strong>load</strong> <em>path [environment]</em><a href='#index-load' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-load_002drelative"><span class="category">Procedure: </span><span><strong>load-relative</strong> <em>path [environment]</em><a href='#index-load_002drelative' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>path</var> can be an (absolute) URL or a filename
of a source file, which is read and evaluated line-by-line.
The <var>path</var> can also be a fully-qualified class name.
(Mostly acts like the <code>-f</code> command-line option,
but with different error handling.)
Since <code>load</code> is a run-time function it doesn&rsquo;t know
about the enclosing lexical environment, and the latter
can&rsquo;t know about definitions introduced by <code>load</code>.
For those reasons it is highly recommended that you use instead use
<code><a href="#require">require</a></code> or <code><a href="#include">include</a></code>.
</p>
<p>Evaluation is done in the specified <var>environment</var>,
which defauls to result of <code>(interaction-environment)</code>.
</p>
<p>The <code>load-relative</code> procedure is like <code>load</code>,
except that <var>path</var> is a
URI that is relative to the context&rsquo;s current base URI.
</p></dd></dl>


<ul class="section-toc">
<li><a href="#Locations" accesskey="1">Locations</a></li>
<li><a href="#Parameter-objects" accesskey="2">Parameter objects</a></li>
</ul>
<hr>
<div class="section" id="Locations">
<div class="header">
<p>
Next: <a href="#Parameter-objects" accesskey="n" rel="next">Parameter objects</a>, Up: <a href="#Eval-and-Environments" accesskey="u" rel="up">Eval and Environments</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Locations-1"></span><h3 class="section">15.1 Locations</h3>

<p>A <em>location</em> is a place where a value can be stored.
An <em>lvalue</em> is an expression that refers to a location.
(The name &quot;lvalue&quot; refers to the fact that the left operand
of <code>set!</code> is an lvalue.)
The only kind of lvalue in standard Scheme is a <em>variable</em>.
Kawa also allows <em>computed lvalues</em>.  These are procedure
calls used in &quot;lvalue context&quot;, such as the left operand of <code>set!</code>.
</p>
<p>You can only use procedures that have an associated <em>setter</em>.
In that case, <code>(set! (f arg ...) value)</code>
is equivalent to <code>((setter f) arg ... value)</code>
Currently, only a few procedures have associated <code>setter</code>s,
and only builtin procedures written in Java can have <code>setter</code>s.
</p>
<p>For example:
</p><div class="example">
<pre class="example">(set! (car x) 10)
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">((setter car) x 10)
</pre></div>
<p>which is equivalent to:
</p><div class="example">
<pre class="example">(set-car! x 10)
</pre></div>

<dl class="def">
<dt id="index-setter"><span class="category">Procedure: </span><span><strong>setter</strong> <em>procedure</em><a href='#index-setter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Gets the &quot;setter procedure&quot; associated with a &quot;getter procedure&quot;.
Equivalent to <code>(procedure-property <var>procedure</var> 'setter)</code>.
By convention, a setter procedure takes the same parameters as
the &quot;getter&quot; procedure, plus an extra parameter that is the
new value to be stored in the location specified by the parameters.
The expectation is that following
<code>((setter <var>proc</var>) <var>args</var> ... <var>value</var>)</code> then
the value of <code>(<var>proc</var> <var>args</var> ...)</code> will be <var>value</var>.
</p>
<p>The <code>setter</code> of <code>setter</code> can be used to set the
<code>setter</code> property.
For example the Scheme prologue effectively does the following:
</p><div class="example">
<pre class="example">(set! (setter vector-set) vector-set!)
</pre></div>
</dd></dl>

<p>Kawa also gives you access to locations as first-class values:
</p>
<dl class="def">
<dt id="index-location"><span class="category">Syntax: </span><span><strong>location</strong> <em>lvalue</em><a href='#index-location' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a location object for the given <var>lvalue</var>.
You can get its value (by applying it, as if it were a procedure),
and you can set its value (by using <code>set!</code> on the application).
The <var>lvalue</var> can be a local or global variable, or a procedure
call using a procedure that has a <code>setter</code>.
</p><div class="example">
<pre class="example">(define x 100)
(define lx (location x))
(set! (lx) (cons 1 2)) ;; set x to (1 . 2)
(lx)  ;; returns (1 . 2)
(define lc (location (car x)))
(set! (lc) (+ 10 (lc)))
;; x is now (11 . 2)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-define_002dalias"><span class="category">Syntax: </span><span><strong>define-alias</strong> <em>variable lvalue</em><a href='#index-define_002dalias' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Define <var>variable</var> as an alias for <var>lvalue</var>.
In other words, makes it so that <code>(location <var>variable</var>)</code>
is equivalent to <code>(location <var>lvalue</var>)</code>.
This works both top-level and inside a function.
</p></dd></dl>

<dl class="def">
<dt id="index-define_002dprivate_002dalias"><span class="category">Syntax: </span><span><strong>define-private-alias</strong> <em>variable lvalue</em><a href='#index-define_002dprivate_002dalias' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Same as <code>define-alias</code>, but the <var>variable</var>
is local to the current module.
</p></dd></dl>

<p>Some people might find it helpful to think of a location
as a settable <em>thunk</em>.  Others may find it useful to
think of the <code>location</code> syntax as similar to the C &lsquo;<samp>&amp;</samp>&rsquo; operator;
for the &lsquo;<samp>*</samp>&rsquo; indirection operator, Kawa uses procedure application.
</p>
<p>You can use <code>define-alias</code> to define a shorter type synonym,
similar to Java&rsquo;s  <code>import TypeName</code> (single-type-import) declaration:
</p><div class="example">
<pre class="example">(define-alias StrBuf java.lang.StringBuffer)
</pre></div>

<hr>
</div>
<div class="section" id="Parameter-objects">
<div class="header">
<p>
Previous: <a href="#Locations" accesskey="p" rel="prev">Locations</a>, Up: <a href="#Eval-and-Environments" accesskey="u" rel="up">Eval and Environments</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Parameter-objects-1"></span><h3 class="section">15.2 Parameter objects</h3>

<p>A parameter object is a procedure that is bound to a location,
and may optionally have a conversion procedure.
The procedure accepts zero or one argument.
When the procedure is called with zero arguments,
the content of the location is returned.
On a call with one argument the content of the location
is updated with the result of applying the parameter object&rsquo;s conversion
procedure to the argument.
</p>
<p>Parameter objects are created with the <code>make-parameter</code> procedure
which takes one or two arguments. The second argument is a one
argument conversion procedure. If only one argument is passed to
make-parameter the identity function is used as a conversion
procedure.
A new location is created and asociated with the 
parameter object. The initial content of the location is the
result of applying the conversion procedure to the first argument of
make-parameter.
</p>
<p>Note that the conversion procedure can be used for guaranteeing the
type of the parameter object&rsquo;s binding and/or to perform some
conversion of the value.
</p>
<p>The <code>parameterize</code> special form, when given a parameter object
and a value, binds the parameter
object to a new location for the dynamic extent of its body.
The initial content of the location is the result of
applying the parameter object&rsquo;s conversion procedure to the value. The
<code>parameterize</code> special form behaves analogously to <code>let</code>
when binding more than one parameter object (that is the order of
evaluation is unspecified and the new bindings are only visible in the
body of the parameterize special form).
</p>
<p>When a new thread is created using <code>future</code> or <code>runnable</code>
then the child thread inherits initial values from its parent.
Once the child is running, changing the value in the child does not
affect the value in the parent or vice versa.
(In the past this was not the case: The child would share a location
with the parent except within a <code>parameterize</code>.
This was changed to avoid unsafe and inefficient coupling between threads.)
</p>
<p>Note that <code>parameterize</code> and <code>fluid-let</code> have similar
binding and sharing behavior.
The difference is that <code>fluid-let</code> modifies locations
accessed by name, while <code>make-parameter</code> and <code>parameterize</code>
create anonymous locations accessed by calling a parameter procedure.
</p>
<p>The R5RS procedures <code>current-input-port</code> and <code>current-output-port</code>
are parameter objects.
</p>
<dl class="def">
<dt id="index-make_002dparameter"><span class="category">Procedure: </span><span><strong>make-parameter</strong> <em>init [converter]</em><a href='#index-make_002dparameter' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Returns a new parameter object which is bound in the global dynamic
environment to a location containing the value returned by the call
<code>(<var>converter</var> <var>init</var>)</code>. If the conversion procedure
converter is not specified the identity function is used instead.
</p>
<p>The parameter object is a procedure which accepts zero or one
argument. When it is called with no argument, the content of the
location bound to this parameter object in the current dynamic
environment is returned. When it is called with one argument, the
content of the location is set to the result of the call
<code>(<var>converter</var> <var>arg</var>)</code>, where <var>arg</var> is the argument
passed to the parameter object, and an unspecified value is returned.
</p>
<div class="example">
<pre class="example">(define radix
  (make-parameter 10))

(define write-shared
  (make-parameter
    #f
    (lambda (x)
      (if (boolean? x)
          x
          (error &quot;only booleans are accepted by write-shared&quot;)))))

(radix)           &rArr;  10
(radix 2)
(radix)           &rArr;  2
(write-shared 0)  gives an error

(define prompt
  (make-parameter
    123
    (lambda (x)
      (if (string? x)
          x
          (with-output-to-string (lambda () (write x)))))))

(prompt)       &rArr;  &quot;123&quot;
(prompt &quot;&gt;&quot;)
(prompt)       &rArr;  &quot;&gt;&quot;
</pre></div>
</dd></dl>

<span id="parameterize_002dsyntax"></span><dl class="def">
<dt id="index-parameterize"><span class="category">Syntax: </span><span><strong>parameterize</strong> <em>((expr1 expr2) ...) <a href="#meta_002dbody"><var>body</var></a></em><a href='#index-parameterize' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The expressions <var>expr1</var> and <var>expr2</var> are evaluated in an
unspecified order. The value of the <var>expr1</var> expressions must be
parameter objects. For each <var>expr1</var> expression and in an
unspecified order, the local dynamic environment is extended with a
binding of the parameter object <var>expr1</var> to a new location whose
content is the result of the call <code>(<var>converter</var> <var>val</var>)</code>,
where <var>val</var> is the value of <var>expr2</var> and <var>converter</var> is the
conversion procedure of the parameter object. The resulting dynamic
environment is then used for the evaluation of <var>body</var> (which
refers to the R5RS grammar nonterminal of that name). The result(s) of
the parameterize form are the result(s) of the <var>body</var>.
</p>
<div class="example">
<pre class="example">(radix)                                              &rArr;  2
(parameterize ((radix 16)) (radix))                  &rArr;  16
(radix)                                              &rArr;  2

(define (f n) (number-&gt;string n (radix)))

(f 10)                                               &rArr;  &quot;1010&quot;
(parameterize ((radix 8)) (f 10))                    &rArr;  &quot;12&quot;
(parameterize ((radix 8) (prompt (f 10))) (prompt))  &rArr;  &quot;1010&quot;
</pre></div>
</dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Debugging">
<div class="header">
<p>
Next: <a href="#Input_002dOutput" accesskey="n" rel="next">Input, output, and file handling</a>, Previous: <a href="#Eval-and-Environments" accesskey="p" rel="prev">Eval and Environments</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Debugging-1"></span><h2 class="chapter">16 Debugging</h2>

<dl class="def">
<dt id="index-trace"><span class="category">Syntax: </span><span><strong>trace</strong> <em>procedure</em><a href='#index-trace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Cause <var>procedure</var> to be &quot;traced&quot;, that is debugging output will
be written to the standard error port every time <var>procedure</var>
is called, with the parameters and return value.
</p>
<p>Note that Kawa will normally assume that a procedure defined with
the procedure-defining variant of <code>define</code> is constant,
and so it might be inlined:
</p><div class="example">
<pre class="example">(define (ff x) (list x x))
(trace ff) ;; probably won't work
(ff 3)     ;; not traced
</pre></div>
<p>It works if you specify the <code>--no-inline</code> flag to Kawa.
Alternatively, you can use the variable-defining variant of <code>define</code>:
</p><div class="example">
<pre class="example">#|kawa:1|# (define ff (lambda (x) name: 'ff (list x x)))
#|kawa:2|# (trace ff) ;; works
#|kawa:3|# (ff 3)
call to ff (3)
return from ff =&gt; (3 3)
(3 3)
</pre></div>
<p>Note the use of the <code>name:</code> procedure property to give the
anonymous <code>lambda</code> a name.
</p></dd></dl>

<dl class="def">
<dt id="index-untrace"><span class="category">Syntax: </span><span><strong>untrace</strong> <em>procedure</em><a href='#index-untrace' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Turn off tracing (debugging output) of <var>procedure</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-disassemble"><span class="category">Procedure: </span><span><strong>disassemble</strong> <em>procedure</em><a href='#index-disassemble' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a string representation of the disassembled bytecode
for <var>procedure</var>, when known.
</p></dd></dl>

<hr>
</div>
<div class="chapter" id="Input_002dOutput">
<div class="header">
<p>
Next: <a href="#Types" accesskey="n" rel="next">Types</a>, Previous: <a href="#Debugging" accesskey="p" rel="prev">Debugging</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Input_002c-output_002c-and-file-handling"></span><h2 class="chapter">17 Input, output, and file handling</h2>

<p>Kawa has a number of useful tools for controlling input and output:
</p>
<p>A programmable reader.
</p>
<p>A powerful pretty-printer.
</p>

<ul class="section-toc">
<li><a href="#Named-output-formats" accesskey="1">Named output formats</a></li>
<li><a href="#Paths" accesskey="2">Paths - file name, URLs, and URIs</a></li>
<li><a href="#Files" accesskey="3">File System Interface</a></li>
<li><a href="#Reading-and-writing-whole-files" accesskey="4">Reading and writing whole files</a></li>
<li><a href="#Ports" accesskey="5">Ports</a></li>
<li><a href="#Format" accesskey="6">Formatted Output (Common-Lisp-style)</a></li>
<li><a href="#Pretty_002dprinting" accesskey="7">Pretty-printing</a></li>
<li><a href="#Resources" accesskey="8">Resources</a></li>
</ul>
<hr>
<div class="section" id="Named-output-formats">
<div class="header">
<p>
Next: <a href="#Paths" accesskey="n" rel="next">Paths - file name, URLs, and URIs</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Named-output-formats-1"></span><h3 class="section">17.1 Named output formats</h3>

<p>The <code>--output-format</code> (or <code>--format</code>) command-line switch
can be used to override the default format for how values are
printed on the standard output.  This format is used for values printed
by the read-eval-print interactive interface.  It is also used to
control how values are printed when Kawa evaluates a file named on the
command line (using the <code>-f</code> flag or just a script name).
(It also affects applications compiled with the <code>--main</code> flag.)
It currently affects how values are printed by a <code>load</code>,
though that may change.
</p>
<p>The default format depends on the current programming language.
For Scheme, the default is <code>scheme</code> for read-eval-print
interaction, and <code>ignore</code> for files that are loaded.
</p>
<p>The formats currently supported include the following:
</p><dl compact="compact">
<dt><span><code>scheme</code></span></dt>
<dd><p>Values are printed in a format matching the Scheme programming language,
as if using <code>display</code>.  &quot;Groups&quot; or &quot;elements&quot; are written as lists.
</p></dd>
<dt><span><code>readable-scheme</code></span></dt>
<dd><p>Like <code>scheme</code>, as if using <code>write</code>:
Values are generally printed in a way that they can
be read back by a Scheme reader.  For example, strings have quotation marks,
and character values are written like &lsquo;<samp>#\A</samp>&rsquo;.
</p></dd>
<dt><span><code>elisp</code></span></dt>
<dd><p>Values are printed in a format matching the Emacs Lisp programming language.
Mostly the same as <code>scheme</code>.
</p></dd>
<dt><span><code>readable-elisp</code></span></dt>
<dd><p>Like <code>elisp</code>, but values are generally printed in a way that they can
be read back by an Emacs Lisp reader.  For example, strings have quotation
marks, and character values are written like &lsquo;<samp>?A</samp>&rsquo;.
</p></dd>
<dt><span><code>clisp</code></span></dt>
<dt><span><code>commonlisp</code></span></dt>
<dd><p>Values are printed in a format matching the Common Lisp programming language,
as if written by <code>princ</code>.
Mostly the same as <code>scheme</code>.
</p></dd>
<dt><span><code>readable-clisp</code></span></dt>
<dt><span><code>readable-commonlisp</code></span></dt>
<dd><p>Like <code>clisp</code>, but as if written by <code>prin1</code>: values are generally
printed in a way that they can be read back by a Common Lisp reader.
For example, strings have quotation marks, and character values are
written like &lsquo;<samp>#\A</samp>&rsquo;.
</p></dd>
<dt><span><code>xml</code></span></dt>
<dt><span><code>xhtml</code></span></dt>
<dt><span><code>html</code></span></dt>
<dd><p>Values are printed in XML, XHTML, or HTML format.
This is discussed in more detail in <a href="#Formatting-XML">Formatting XML</a>.
</p></dd>
<dt><span><code>cgi</code></span></dt>
<dd><p>The output should follow the CGI standards.  I.e. assume that this
script is invoked by a web server as a CGI script/program, and that the
output should start with some response header,
followed by the actual response data.
To generate the response headers, use the <code>response-header</code> function.
If the <code>Content-type</code> response header has not been specified, and
it is required by the CGI standard, Kawa will attempt
to infer an appropriate <code>Content-type</code> depending on the following value.
</p></dd>
<dt><span><code>ignore</code></span></dt>
<dd><p>Top-level values are ignored, instead of printed.
</p></dd>
</dl>

<hr>
</div>
<div class="section" id="Paths">
<div class="header">
<p>
Next: <a href="#Files" accesskey="n" rel="next">File System Interface</a>, Previous: <a href="#Named-output-formats" accesskey="p" rel="prev">Named output formats</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Paths-_002d-file-name_002c-URLs_002c-and-URIs"></span><h3 class="section">17.2 Paths - file name, URLs, and URIs</h3>

<p>A <em>Path</em> is the name of a file or some other <em>resource</em>.
The path mechanism provides a layer of abstraction, so you can
use the same functions on either a filename or a URL/URI.
Functions that in standard Scheme take a filename
have been generalized to take a path or a path string,
as if using the <code>path</code> function below.  For example:
</p><div class="example">
<pre class="example">(open-input-file &quot;http://www.gnu.org/index.html&quot;)
(open-input-file (URI &quot;ftp://ftp.gnu.org/README&quot;))
</pre></div>

<dl class="def">
<dt id="index-path"><span class="category">Type: </span><span><strong>path</strong><a href='#index-path' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A general path, which can be a <code>filename</code> or a <code>URI</code>.
It can be either a <code>filename</code> or a <code>URI</code>.
Represented using the abstract Java class <code>gnu.kawa.io.Path</code>.
</p>
<p>Coercing a value to a <code>Path</code> is equivalent to
calling the <code>path</code> constructor documented below.
</p></dd></dl>

<dl class="def">
<dt id="index-path-1"><span class="category">Constructor: </span><span><strong>path</strong> <em>arg</em><a href='#index-path-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Coerces the <var>arg</var> to a <code>path</code>.
If <var>arg</var> is already a <code>path</code>, it is returned unchanged.
If <var>arg</var> is a <code>java.net.URI</code>, or a <code>java.net.URL</code>
then a <code>URI</code> value is returned.
If <var>arg</var> is a <code>java.io.File</code>, a <code>filepath</code> value is returned.
Otherwise, <var>arg</var> can be a string.
A <code>URI</code> value is returned if the string starts with a URI scheme
(such as <code>&quot;http:&quot;</code>),
and a <code>filepath</code> value is returned otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-path_003f"><span class="category">Predicate: </span><span><strong>path?</strong> <em>arg</em><a href='#index-path_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>True if <var>arg</var> is a <code>path</code> - i.e. an instance of a <code>gnu.kawa.io.Path</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-current_002dpath"><span class="category">Procedure: </span><span><strong>current-path</strong> <em>[new-value]</em><a href='#index-current_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>With no arguments, returns the default directory of the current thread
as a <code>path</code>.
This is used as the base directory for relative pathnames.
The initial value is that of the <code>user.dir</code> property
as returned by <code>(java.lang.System:getProperty &quot;user.dir&quot;)</code>.
</p>
<p>If a <var>new-value</var> argument is given, sets the default directory:
</p><div class="example">
<pre class="example">(current-path &quot;/opt/myApp/&quot;)
</pre></div>
<p>A string value is automatically converted to a <code>path</code>,
normally a <code>filepath</code>. 
</p>
<p>Alternatively, you can change the default using a setter:
</p><div class="example">
<pre class="example">(set! (current-path) &quot;/opt/myApp/&quot;)
</pre></div>

<p>Since <code>current-path</code> is a <a href="#Parameter-objects">parameter object</a>, you can
locally change the value using <a href="#parameterize_002dsyntax"><code>parameterize</code></a>.
</p></dd></dl>

<dl class="def">
<dt id="index-filepath"><span class="category">Type: </span><span><strong>filepath</strong><a href='#index-filepath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The name of a local file.
Represented using the Java class <code>gnu.kawa.io.FilePath</code>,
which is a wrapper around <code>java.io.File</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-filepath_003f"><span class="category">Predicate: </span><span><strong>filepath?</strong> <em>arg</em><a href='#index-filepath_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>True if <var>arg</var> is a <code>filepath</code> - i.e. an instance of
a <code>gnu.kawa.io.FilePath</code>.
</p></dd></dl>

<span id="URI_002dtype"></span><dl class="def">
<dt id="index-URI"><span class="category">Type: </span><span><strong>URI</strong><a href='#index-URI' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A Uniform Resource Indicator, which is a generalization of
the more familiar URL.  The general format is specified by
<a href="http://www.ietf.org/rfc/rfc2396.txt">RFC 2396: Uniform Resource Identifiers (URI): Generic Syntax</a>.
Represented using the Java class <code>gnu.kawa.io.URIPath</code>,
which is a wrapper around <code>java.net.URI</code>.
A URI can be a URL, or it be a relative URI.
</p></dd></dl>

<dl class="def">
<dt id="index-URI_003f"><span class="category">Predicate: </span><span><strong>URI?</strong> <em>arg</em><a href='#index-URI_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>True if <var>arg</var> is a <code>URI</code> - i.e. an instance of
a <code>gnu.kawa.io.URIPath</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-URL"><span class="category">Type: </span><span><strong>URL</strong><a href='#index-URL' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A Uniform Resource Locator - a subtype of <code>URI</code>.
Represented using the Java class <code>gnu.kawa.io.URLPath</code>,
which is a wrapper around a <code>java.net.URL</code>, in
addition to extending <code>gnu.kawa.io.URIPath</code>.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Extracting-Path-components" accesskey="1">Extracting Path components</a></li>
</ul>
<div class="subsection" id="Extracting-Path-components">
<h4 class="subsection">17.2.1 Extracting Path components</h4>

<dl class="def">
<dt id="index-path_002dscheme"><span class="category">Procedure: </span><span><strong>path-scheme</strong> <em>arg</em><a href='#index-path_002dscheme' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &ldquo;URI scheme&rdquo; of <var>arg</var> (coerced to a <code>path</code>) if it is
defined, or <code>#f</code> otherwise.  The URI scheme of a <code>filepath</code>
is <code>&quot;file&quot;</code> if the <code>filepath</code> is absolute, and <code>#f</code> otherwise.
</p><div class="example">
<pre class="example">(path-scheme &quot;http://gnu.org/&quot;) &rArr; &quot;http&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dauthority"><span class="category">Procedure: </span><span><strong>path-authority</strong> <em>arg</em><a href='#index-path_002dauthority' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the authority part of <var>arg</var> (coerced to a <code>path</code>) if it is
defined, or <code>#f</code> otherwise.
The &ldquo;authority&rdquo; is usually the hostname, but may also include user-info
or a port-number.
</p>
<div class="example">
<pre class="example">(path-authority &quot;http://me@localhost:8000/home&quot;) &rArr; &quot;me@localhost:8000&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dhost"><span class="category">Procedure: </span><span><strong>path-host</strong> <em>arg</em><a href='#index-path_002dhost' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the name name part of <var>arg</var> (coerced to a <code>path</code>) if it is
defined, or <code>#f</code> otherwise.
</p>
<div class="example">
<pre class="example">(path-host &quot;http://me@localhost:8000/home&quot;) &rArr; &quot;localhost&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002duser_002dinfo"><span class="category">Procedure: </span><span><strong>path-user-info</strong> <em>arg</em><a href='#index-path_002duser_002dinfo' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &ldquo;user info&rdquo; of <var>arg</var> (coerced to a <code>path</code>) if it is
specified, or <code>#f</code> otherwise.
</p>
<div class="example">
<pre class="example">(path-host &quot;http://me@localhost:8000/home&quot;) &rArr; &quot;me&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dport"><span class="category">Procedure: </span><span><strong>path-port</strong> <em>arg</em><a href='#index-path_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the port number of <var>arg</var> (coerced to a <code>path</code>) if it is
specified, or <code>-1</code> otherwise.  Even if there is a default port
associated with a URI scheme (such as 80 for <code>http</code>), the value
-1 is returned unless the port number is <em>explictly</em> specified.
</p>
<div class="example">
<pre class="example">(path-host &quot;http://me@localhost:8000/home&quot;) &rArr; 8000
(path-host &quot;http://me@localhost/home&quot;) &rArr; -1
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dfile"><span class="category">Procedure: </span><span><strong>path-file</strong> <em>arg</em><a href='#index-path_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &ldquo;path component&rdquo; of the <var>arg</var>
(coerced to a <code>path</code>).
(The name <code>path-path</code> might be more logical,
but it is obviously a bit awkward.)
The path component of a file name is the file name itself.
For a URI, it is the main hierarchical part of the URI,
without schema, authority, query, or fragment.
</p><div class="example">
<pre class="example">(path-file &quot;http://gnu.org/home/me.html?add-bug#body&quot;) &rArr; &quot;/home/me.html&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002ddirectory"><span class="category">Procedure: </span><span><strong>path-directory</strong> <em>arg</em><a href='#index-path_002ddirectory' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>arg</var> (coerced to a <code>path</code>) is directory,
return <var>arg</var>; otherwise return the &ldquo;parent&rdquo; path, without the
final component.
</p><div class="example">
<pre class="example">(path-directory &quot;http://gnu.org/home/me/index.html#body&quot;)
  &rArr; (path &quot;http://gnu.org/home/me/&quot;)
(path-directory &quot;http://gnu.org/home/me/&quot;)
  &rArr; (path &quot;http://gnu.org/home/me/&quot;)
</pre></div>
<p><code>(path-directory &quot;./dir&quot;)</code> <code>&rArr;</code> <code>(path &quot;./dir&quot;)</code> if <code>dir</code> is a directory, and <code>(path &quot;.&quot;)</code> otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-path_002dparent"><span class="category">Procedure: </span><span><strong>path-parent</strong> <em>arg</em><a href='#index-path_002dparent' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &ldquo;parent directory&rdquo; of <var>arg</var> (coerced to a <code>path</code>).
If <var>arg</var> is not a directory, same as <code>path-directory <var>arg</var></code>.
</p><div class="example">
<pre class="example">(path-parent &quot;a/b/c&quot;) &rArr; (path &quot;a/b&quot;)
(path-parent &quot;file:/a/b/c&quot;) &rArr; (path &quot;file:/a/b/c&quot;)
(path-parent &quot;file:/a/b/c/&quot;) &rArr; (path &quot;file:/a/b/&quot;)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dlast"><span class="category">Procedure: </span><span><strong>path-last</strong> <em>arg</em><a href='#index-path_002dlast' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The last component of path component
of <var>arg</var> (coerced to a <code>path</code>).
Returns a substring of <code>(path-file <var>arg</var>)</code>.
If that string ends with &lsquo;<samp>/</samp>&rsquo; or the path separator,
that last character is ignored.
Returns the tail of the path-string, following
the last (non-final) &lsquo;<samp>/</samp>&rsquo; or path separator.
</p><div class="example">
<pre class="example">(path-last &quot;http:/a/b/c&quot;) &rArr; &quot;c&quot;
(path-last &quot;http:/a/b/c/&quot;) &rArr; &quot;c&quot;
(path-last &quot;a/b/c&quot;) &rArr; &quot;c&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dextension"><span class="category">Procedure: </span><span><strong>path-extension</strong> <em>arg</em><a href='#index-path_002dextension' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &ldquo;extension&rdquo; of the <var>arg</var>
(coerced to a <code>path</code>).
</p><div class="example">
<pre class="example">(path-extension &quot;http://gnu.org/home/me.html?add-bug#body&quot;) &rArr; &quot;html&quot;
(path-extension &quot;/home/.init&quot;) &rArr; #f
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dquery"><span class="category">Procedure: </span><span><strong>path-query</strong> <em>arg</em><a href='#index-path_002dquery' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the query part of <var>arg</var> (coerced to a <code>path</code>) if it is
defined, or <code>#f</code> otherwise.  The query part of a URI is the
part after &lsquo;<samp>?</samp>&rsquo;.
</p><div class="example">
<pre class="example">(path-query &quot;http://gnu.org/home?add-bug&quot;) &rArr; &quot;add-bug&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dfragment"><span class="category">Procedure: </span><span><strong>path-fragment</strong> <em>arg</em><a href='#index-path_002dfragment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the fragment part of <var>arg</var> (coerced to a <code>path</code>) if it is
defined, or <code>#f</code> otherwise.  The fragment of a URI is the
part of after &lsquo;<samp>#</samp>&rsquo;.
</p><div class="example">
<pre class="example">(path-query &quot;http://gnu.org/home#top&quot;) &rArr; &quot;top&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-resolve_002duri"><span class="category">Procedure: </span><span><strong>resolve-uri</strong> <em>uri base</em><a href='#index-resolve_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a <var>uri</var> unchanged if it is an absolute URI.
Otherwise resolves it against a base URI <var>base</var>,
which is normally (though not always) absolute.
</p>
<p>This uses the algorithm specifyed by RFC-3986 (assuming <var>base</var>
is absolute), unlike the obsolete RFC-2396 algorithm used
by <code>java.net.URI.resolve</code>.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Files">
<div class="header">
<p>
Next: <a href="#Reading-and-writing-whole-files" accesskey="n" rel="next">Reading and writing whole files</a>, Previous: <a href="#Paths" accesskey="p" rel="prev">Paths - file name, URLs, and URIs</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="File-System-Interface"></span><h3 class="section">17.3 File System Interface</h3>

<dl class="def">
<dt id="index-file_002dexists_003f"><span class="category">Procedure: </span><span><strong>file-exists?</strong> <em>filename</em><a href='#index-file_002dexists_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns true iff the file named <var>filename</var> actually exists.
This function is defined on arbitrary <code>path</code> values:
for URI values we open a <code>URLConnection</code>
and invoke <code>getLastModified()</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-file_002ddirectory_003f"><span class="category">Procedure: </span><span><strong>file-directory?</strong> <em>filename</em><a href='#index-file_002ddirectory_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns true iff the file named <var>filename</var> actually exists
and is a directory.
This function is defined on arbitrary <code>path</code> values;
the default implementation for non-file objects is to
return <code>#t</code> iff the path string ends with the character &lsquo;<samp>/</samp>&rsquo;.
</p></dd></dl>

<dl class="def">
<dt id="index-file_002dreadable_003f"><span class="category">Procedure: </span><span><strong>file-readable?</strong> <em>filename</em><a href='#index-file_002dreadable_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns true iff the file named <var>filename</var> actually exists
and can be read from.
</p></dd></dl>

<dl class="def">
<dt id="index-file_002dwritable_003f"><span class="category">Procedure: </span><span><strong>file-writable?</strong> <em>filename</em><a href='#index-file_002dwritable_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns true iff the file named <var>filename</var> actually exists
and can be writen to.
(Undefined if the <var>filename</var> does not exist,
but the file can be created in the directory.)
</p></dd></dl>

<dl class="def">
<dt id="index-delete_002dfile"><span class="category">Procedure: </span><span><strong>delete-file</strong> <em>filename</em><a href='#index-delete_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Delete the file named <var>filename</var>.
On failure, throws an exception.
</p></dd></dl>

<dl class="def">
<dt id="index-rename_002dfile"><span class="category">Procedure: </span><span><strong>rename-file</strong> <em>oldname newname</em><a href='#index-rename_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Renames the file named <var>oldname</var> to <var>newname</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-copy_002dfile"><span class="category">Procedure: </span><span><strong>copy-file</strong> <em>oldname newname-from path-to</em><a href='#index-copy_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Copy the file named <var>oldname</var> to <var>newname</var>.
The return value is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-create_002ddirectory"><span class="category">Procedure: </span><span><strong>create-directory</strong> <em>dirname</em><a href='#index-create_002ddirectory' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a new directory named <var>dirname</var>.
Unspecified what happens on error (such as exiting file with the same name).
(Currently returns <code>#f</code> on error, but may change to be more compatible
with scsh.)
</p></dd></dl>

<dl class="def">
<dt id="index-system_002dtmpdir"><span class="category">Procedure: </span><span><strong>system-tmpdir</strong><a href='#index-system_002dtmpdir' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the name of the default directory for temporary files.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dtemporary_002dfile"><span class="category">Procedure: </span><span><strong>make-temporary-file</strong> <em>[format]</em><a href='#index-make_002dtemporary_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a file with a name that does not match any existing file.
Use <var>format</var> (which defaults to <code>&quot;kawa~d.tmp&quot;</code>) to generate
a unique filename in <code>(system-tmpdir)</code>.
The current implementation is <em>not</em> safe from race conditions;
this will be fixed in a future release (using Java2 features).
</p></dd></dl>

<hr>
</div>
<div class="section" id="Reading-and-writing-whole-files">
<div class="header">
<p>
Next: <a href="#Ports" accesskey="n" rel="next">Ports</a>, Previous: <a href="#Files" accesskey="p" rel="prev">File System Interface</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Reading-and-writing-whole-files-1"></span><h3 class="section">17.4 Reading and writing whole files</h3>

<p>The following procedures and syntax allow you to read and write
the entire contents of a file, without iterating using a port.
</p>
<ul class="section-toc">
<li><a href="#Reading-a-file" accesskey="1">Reading a file</a></li>
<li><a href="#Blobs-1" accesskey="2">Blobs</a></li>
<li><a href="#Writing-to-a-file" accesskey="3">Writing to a file</a></li>
<li><a href="#Functions-1" accesskey="4">Functions</a></li>
</ul>
<div class="subsection" id="Reading-a-file">
<h4 class="subsection">17.4.1 Reading a file</h4>

<p>For reading the contents of a file in a single operation,
you can use the following syntax:
</p>
<div class="display">
<pre class="display"><code><b>&amp;&lt;{</b></code><a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a>+<code><b>}</b></code>
</pre></div>

<p>This is equivalent to using the <code>path-data</code> function (defined below):
</p><div class="display">
<pre class="display"><code><b>(path-data</b></code> <code><b>&amp;{</b></code><a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a>+<code><b>})</b></code>
</pre></div>

<p>For example:
</p><div class="example">
<pre class="example">(define dir &quot;/home/me/&quot;)
(define help-message &amp;&lt;{&amp;[dir]HELP})
</pre></div>
<p>This binds <code>help-message</code> to the contents of the file
named <code>HELP</code> in the <code>dir</code> directory.
</p>
<span id="Blobs"></span></div>
<div class="subsection" id="Blobs-1">
<h4 class="subsection">17.4.2 Blobs</h4>

<p>The content of a file is, in general, a sequence of uninterpreted bytes.
Often these bytes represent text in a locale-dependent encoding,
but we don&rsquo;t always know this. Sometimes they&rsquo;re images, or videos,
or word-processor documents.  A filename extension or a &ldquo;magic number&rdquo;
in the file can give you hints, but not certainty as to the type of the data.
</p>
<p>A <em><a href="http://en.wikipedia.org/wiki/Binary_large_object">blob</a></em>
is a raw uninterpreted sequence of bytes. It is a <code>bytevector</code>
that can be automatically converted to other types as needed,
specifically to a string or a bytevector.
</p>
<p>The <code>&amp;&lt;{..}</code> returns a blob.  For example,
assume the file <code>README</code> contains (bytes representing)
the text <code>&quot;Check doc directory.\n&quot;</code>.  Then:
</p><div class="example">
<pre class="example">#|kawa:1|# (define readme &amp;&lt;{README}))
|kawa:2|# readme:class
class gnu.lists.Blob
#|kawa:3|# (write (-&gt;string readme))
&quot;Check doc directory.\n&quot;
#|kawa:4|# (write (-&gt;bytevector readme))
#u8(67 104 101 99 107 32 100 111 99 32 100 105 114 101 99 116 111 114 121 46 10)
#|kawa:5|# (-&gt;bytevector readme):class
class gnu.lists.U8Vector
</pre></div>

</div>
<div class="subsection" id="Writing-to-a-file">
<h4 class="subsection">17.4.3 Writing to a file</h4>

<p>The <code>&amp;&lt;{..}</code> syntax can be used with <code>set!</code>
to replace the contents of a file:
</p><div class="example">
<pre class="example">(set! &amp;&lt;{README} &quot;Check example.com\n&quot;)
</pre></div>

<p>The new contents must be blob-compatible - i.e. a bytevector or a string.
</p>
<p>If you dislike using <code>&lt;</code> as an output operator, you can instead using the <code>&amp;&gt;{..}</code> operation, which evaluates to a function whose single argument is the new value:
</p><div class="example">
<pre class="example">(&amp;&gt;{README} &quot;Check example.com\n&quot;)
</pre></div>
<p>In general:
</p><div class="example">
<pre class="example"><code><b>&amp;&gt;{</b></code><a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a>+<code><b>}</b></code>
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(lambda (new-contents)
  (set! <code><b>&amp;&lt;{</b></code><a href="#meta_002dnamed_002dliteral_002dpart"><var>named-literal-part</var></a>+<code><b>}</b></code> new-contents))
</pre></div>

<p>You can use <code>&amp;&gt;&gt;</code> to append more data to a file:
</p>
<div class="example">
<pre class="example">(&amp;&gt;&gt;{README} &quot;or check example2.com\n&quot;)
</pre></div>

</div>
<div class="subsection" id="Functions-1">
<h4 class="subsection">17.4.4 Functions</h4>

<dl class="def">
<dt id="index-path_002ddata"><span class="category">Procedure: </span><span><strong>path-data</strong> <em>path</em><a href='#index-path_002ddata' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads the contents of the file specified by <var>path</var>,
where <var>path</var> can be a <a href="#Paths">path</a> object, or anything that can
be converted to a <code>Path</code>, including a filename string or a URL. 
returning the result as a blob.
The result is a <em>blob</em>, which is a kind of bytevector than can be
auto-converted to a string or bytevecor as required.
</p>
<p>The function <code>path-data</code> has a setter, which replaces the contents
with new contents:
</p><div class="example">
<pre class="example">(set! &amp;&lt;{file-name} new-contents)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-path_002dbytes"><span class="category">Procedure: </span><span><strong>path-bytes</strong> <em>path</em><a href='#index-path_002dbytes' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads the contents of the file specified by <var>path</var>, as
with the <code>path-data</code> function, but the result is a plain bytevector,
rather than a blob.  This functtion also has a setter, which you
can use to replace the file-contents by new bytevector-valued data.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Ports">
<div class="header">
<p>
Next: <a href="#Format" accesskey="n" rel="next">Formatted Output (Common-Lisp-style)</a>, Previous: <a href="#Reading-and-writing-whole-files" accesskey="p" rel="prev">Reading and writing whole files</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Ports-1"></span><h3 class="section">17.5 Ports</h3>

<p>Ports represent input and output devices.
An input port is a Scheme object that can deliver data upon
command, while an output port is a Scheme object that can
accept data.
</p>
<p>Different <em>port types</em> operate on different data:
</p><ul>
<li> A <em>textual port</em> supports reading or writing of individual
characters from or to a backing store containing characters
using <code>read-char</code> and <code>write-char</code> below, and it supports
operations defined in terms of characters, such as <code>read</code> and
<code>write</code>.
</li><li> A <em>binary port</em> supports reading or writing of individual
bytes from or to a backing store containing bytes using
<code>read-u8</code> and <code>write-u8</code> below, as well as operations defined
in terms of bytes (integers in the range 0 to 255).

<p>All Kawa binary ports created by procedures documented here
are also textual ports.  Thus you can either read/write
bytes as described above, or read/write
characters whose scalar value is in the range 0 to 255
(i.e. the Latin-1 character set), using <code>read-char</code> and <code>write-char</code>.
</p>
<p>A native binary port is a <code>java.io.InputStream</code>
or <code>java.io.OutputStream</code> instance.  These are not textual ports.
You can use methods <code>read-u8</code> and <code>write-u8</code>,
but not <code>read-char</code> and <code>write-char</code> on native binary ports.
(The functions <code>input-port?</code>, <code>output-port?</code>, <code>binary-port?</code>,
and <code>port?</code> all currently return false on native binary ports,
but that may change.)
</p></li></ul>

<dl class="def">
<dt id="index-call_002dwith_002dport"><span class="category">Procedure: </span><span><strong>call-with-port</strong> <em>port proc</em><a href='#index-call_002dwith_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>call-with-port</code> procedure calls <var>proc</var> with port as an
argument. If <var>proc</var> returns, then the port is closed automatically
and the values yielded by the proc are returned.
</p>
<p>If <var>proc</var> does not return, then the port must not be closed
automatically unless it is possible to prove that the port
will never again be used for a read or write operation.
</p>
<p>As a Kawa extension, <var>port</var> may be any object
that implements <code>java.io.Closeable</code>.
It is an error if <var>proc</var> does not accept one argument.
</p>
</dd></dl>

<dl class="def">
<dt id="index-call_002dwith_002dinput_002dfile"><span class="category">Procedure: </span><span><strong>call-with-input-file</strong> <em>path proc</em><a href='#index-call_002dwith_002dinput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-call_002dwith_002doutput_002dfile"><span class="category">Procedure: </span><span><strong>call-with-output-file</strong> <em>path proc</em><a href='#index-call_002dwith_002doutput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures obtain a textual port obtained by
opening the named file for input or output as if by
<code>open-input-file</code> or <code>open-output-file</code>. The port and
<var>proc</var> are then passed to a procedure equivalent to
<code>call-with-port</code>.
</p>
<p>It is an error if <var>proc</var> does not accept one argument.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport_003f"><span class="category">Procedure: </span><span><strong>input-port?</strong> <em>obj</em><a href='#index-input_002dport_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-output_002dport_003f"><span class="category">Procedure: </span><span><strong>output-port?</strong> <em>obj</em><a href='#index-output_002dport_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-textual_002dport_003f"><span class="category">Procedure: </span><span><strong>textual-port?</strong> <em>obj</em><a href='#index-textual_002dport_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-binary_002dport_003f"><span class="category">Procedure: </span><span><strong>binary-port?</strong> <em>obj</em><a href='#index-binary_002dport_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-port_003f"><span class="category">Procedure: </span><span><strong>port?</strong> <em>obj</em><a href='#index-port_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These procedures return <code>#t</code> if obj is an input port, output port,
textual port, binary port, or any kind of port,
respectively. Otherwise they return <code>#f</code>.
</p>
<p>These procedures currently return <code>#f</code> on a native Java streams
(<code>java.io.InputStream</code> or <code>java.io.OutputStream</code>),
a native reader (a <code>java.io.Reader</code> that is not an
<code>gnu.mapping.Inport</code>), or a native writer (a <code>java.io.Writer</code>
that is not an <code>gnu.mapping.Outport</code>).  This may change if
conversions between native ports and Scheme ports becomes more seamless.
</p>
</dd></dl>

<dl class="def">
<dt id="index-input_002dport_002dopen_003f"><span class="category">Procedure: </span><span><strong>input-port-open?</strong> <em>port</em><a href='#index-input_002dport_002dopen_003f' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-output_002dport_002dopen_003f"><span class="category">Procedure: </span><span><strong>output-port-open?</strong> <em>port</em><a href='#index-output_002dport_002dopen_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>port</var> is still open and capable of performing
input or output, respectively, and <code>#f</code> otherwise.
(Not supported for native binary ports - i.e. <code>java.io.InputStteam</code>
or <code>java.io.OutputStream</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-current_002dinput_002dport"><span class="category">Procedure: </span><span><strong>current-input-port</strong><a href='#index-current_002dinput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-current_002doutput_002dport"><span class="category">Procedure: </span><span><strong>current-output-port</strong><a href='#index-current_002doutput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-current_002derror_002dport"><span class="category">Procedure: </span><span><strong>current-error-port</strong><a href='#index-current_002derror_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the current default input port, output port, or
error port (an output port), respectively.
(The error port is the port to which errors and warnings should be sent
- the <em>standard error</em> in Unix and C terminology.)
These procedures are <a href="#Parameter-objects">parameter objects</a>,
which can be overridden with <a href="#parameterize_002dsyntax"><code>parameterize</code></a>.
</p>
<p>The initial bindings for <code>(current-output-port)</code> and
<code>(current-error-port)</code> are hybrid textual/binary
ports that wrap the values of the corresponding <code>java.lang.System</code> fields
<code>out</code>, and <code>err</code>.  The latter, in turn are bound
to the standard output and error streams of the JVM process.
This means you can write binary data to standard output
using <code>write-bytevector</code> and <code>write-u8</code>.
</p>
<p>The initial value <code>(current-input-port)</code> similarly is a textual port
that wraps the <code>java.lang.System</code> field <code>in</code>, which is bound
to the standard input stream of the JVM process.
It is a <em>hybrid</em> textual/binary port only if there
is no console (as determined by <code>(java.lang.System:console)</code>
returning <code>#!null</code>) - i.e. if standard input is not a tty.
</p>
<p>Here is an example that copies standard input to standard output:
</p><div class="example">
<pre class="example">(let* ((in (current-input-port))
       (out (current-output-port))
       (blen ::int 2048)
       (buf (make-bytevector blen)))
  (let loop ()
    (define n (read-bytevector! buf in))
    (cond ((not (eof-object? n))
           (write-bytevector buf out 0 n)
           (loop)))))
</pre></div>

</dd></dl>

<dl class="def">
<dt id="index-with_002dinput_002dfrom_002dfile"><span class="category">Procedure: </span><span><strong>with-input-from-file</strong> <em>path thunk</em><a href='#index-with_002dinput_002dfrom_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-with_002doutput_002dto_002dfile"><span class="category">Procedure: </span><span><strong>with-output-to-file</strong> <em>path thunk</em><a href='#index-with_002doutput_002dto_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The file is opened for input or output as if by
<code>open-input-file</code> or <code>open-output-file</code>, and the new port
is made to be the value returned by <code>current-input-port</code>
or <code>current-output-port</code> (as used by <code>(read)</code>,
<code>(write <var>obj</var>)</code>, and so forth). The thunk is then called with no
arguments. When the <var>thunk</var> returns, the port is closed
and the previous default is restored. It is an error if <var>thunk</var>
does not accept zero arguments. Both procedures return
the values yielded by <var>thunk</var>. If an escape procedure is used
to escape from the continuation of these procedures, they
behave exactly as if the current input or output port had
been bound dynamically with <code>parameterize</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-open_002dinput_002dfile"><span class="category">Procedure: </span><span><strong>open-input-file</strong> <em>path</em><a href='#index-open_002dinput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-open_002dbinary_002dinput_002dfile"><span class="category">Procedure: </span><span><strong>open-binary-input-file</strong> <em>path</em><a href='#index-open_002dbinary_002dinput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes a <var>path</var> naming an existing file and returns a textual
input port or binary input port that is capable of delivering
data from the file.
</p>
<p>The procedure <code>open-input-file</code> checks the fluid variable
<a href="#port_002dchar_002dencoding"><code>port-char-encoding</code></a> to determine how bytes are decoded
into characters.  The procedure <code>open-binary-input-file</code>
is equivalent to calling <code>open-input-file</code> with
<code>port-char-encoding</code> set to <code>#f</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-open_002doutput_002dfile"><span class="category">Procedure: </span><span><strong>open-output-file</strong> <em>path</em><a href='#index-open_002doutput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-open_002dbinary_002doutput_002dfile"><span class="category">Procedure: </span><span><strong>open-binary-output-file</strong> <em>path</em><a href='#index-open_002dbinary_002doutput_002dfile' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes a <var>path</var> naming an output file to be created and returns
respectively a textual output port or binary output port that is
capable of writing data to a new file by that name. If a
file with the given name already exists, the effect is unspecified.
</p>
<p>The procedure <code>open-output-file</code> checks the fluid variable
<a href="#port_002dchar_002dencoding"><code>port-char-encoding</code></a> to determine how characters are
encoded as bytes.  The procedure <code>open-binary-output-file</code>
is equivalent to calling <code>open-output-file</code> with
<code>port-char-encoding</code> set to <code>#f</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-close_002dport"><span class="category">Procedure: </span><span><strong>close-port</strong> <em>port</em><a href='#index-close_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-close_002dinput_002dport"><span class="category">Procedure: </span><span><strong>close-input-port</strong> <em>port</em><a href='#index-close_002dinput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-close_002doutput_002dport"><span class="category">Procedure: </span><span><strong>close-output-port</strong> <em>port</em><a href='#index-close_002doutput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Closes the resource associated with <var>port</var>, rendering the port
incapable of delivering or accepting data. It is an error to
apply the last two procedures to a port which is not an
input or output port, respectively.
(Specifically, <code>close-input-port</code> requires a <code>java.io.Reader</code>,
while <code>close-output-port</code> requires a <code>java.io.Writer</code>.
In contrast <code>close-port</code> accepts any object whose class
implements <code>java.io.Closeable</code>.)
</p>
<p>These routines have no effect if the port has already been
closed.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#String-and-bytevector-ports" accesskey="1">String and bytevector ports</a></li>
<li><a href="#Input" accesskey="2">Input</a></li>
<li><a href="#Output" accesskey="3">Output</a></li>
<li><a href="#Prompts-for-interactive-consoles-_0028REPLs_0029" accesskey="4">Prompts for interactive consoles (REPLs)</a></li>
<li><a href="#Line-numbers-and-other-input-port-properties" accesskey="5">Line numbers and other input port properties</a></li>
<li><a href="#Miscellaneous-2" accesskey="6">Miscellaneous</a></li>
</ul>
<div class="subsection" id="String-and-bytevector-ports">
<h4 class="subsection">17.5.1 String and bytevector ports</h4>

<dl class="def">
<dt id="index-open_002dinput_002dstring"><span class="category">Procedure: </span><span><strong>open-input-string</strong> <em>string</em><a href='#index-open_002dinput_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes a string and returns a text input port that delivers characters
from the string. The port can be closed by <code>close-input-port</code>,
though its storage will be reclaimed by the
garbage collector if it becomes inaccessible. 
</p>
<div class="example">
<pre class="example">(define p
  (open-input-string &quot;(a . (b c . ())) 34&quot;))

(input-port? p)                 &rArr;  #t
(read p)                        &rArr;  (a b c)
(read p)                        &rArr;  34
(eof-object? (peek-char p))     &rArr;  #t
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-open_002doutput_002dstring"><span class="category">Procedure: </span><span><strong>open-output-string</strong><a href='#index-open_002doutput_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an textual output port that will accumulate characters
for retrieval by <code>get-output-string</code>.
The port can be closed by the procedure <code>close-output-port</code>,
though its storage will be reclaimed by the garbage collector
if it becomes inaccessible. 
</p><div class="example">
<pre class="example">(let ((q (open-output-string))
  (x '(a b c)))
    (write (car x) q)
    (write (cdr x) q)
    (get-output-string q))        &rArr;  &quot;a(b c)&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-get_002doutput_002dstring"><span class="category">Procedure: </span><span><strong>get-output-string</strong> <em>output-port</em><a href='#index-get_002doutput_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Given an output port created by <code>open-output-string</code>,
returns a string consisting of the characters that have been
output to the port so far in the order they were output.
If the result string is modified, the effect is unspecified.
</p>
<div class="example">
<pre class="example">(parameterize
    ((current-output-port (open-output-string)))
    (display &quot;piece&quot;)
    (display &quot; by piece &quot;)
    (display &quot;by piece.&quot;)
    (newline)
    (get-output-string (current-output-port)))
        &rArr; &quot;piece by piece by piece.\n&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-call_002dwith_002dinput_002dstring"><span class="category">Procedure: </span><span><strong>call-with-input-string</strong> <em>string proc</em><a href='#index-call_002dwith_002dinput_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create an input port that gets its data from <var>string</var>,
call <var>proc</var> with that port as its one argument, and return
the result from the call of <var>proc</var>
</p></dd></dl>

<dl class="def">
<dt id="index-call_002dwith_002doutput_002dstring"><span class="category">Procedure: </span><span><strong>call-with-output-string</strong> <em>proc</em><a href='#index-call_002dwith_002doutput_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create an output port that writes its data to a <var>string</var>,
and call <var>proc</var> with that port as its one argument.
Return a string consisting of the data written to the port.
</p></dd></dl>

<dl class="def">
<dt id="index-open_002dinput_002dbytevector"><span class="category">Procedure: </span><span><strong>open-input-bytevector</strong> <em>bytevector</em><a href='#index-open_002dinput_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Takes a bytevector and returns a binary input port that
delivers bytes from the bytevector.
</p></dd></dl>

<dl class="def">
<dt id="index-open_002doutput_002dbytevector"><span class="category">Procedure: </span><span><strong>open-output-bytevector</strong><a href='#index-open_002doutput_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a binary output port that will accumulate bytes
for retrieval by <code>get-output-bytevector</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-get_002doutput_002dbytevector"><span class="category">Procedure: </span><span><strong>get-output-bytevector</strong> <em>port</em><a href='#index-get_002doutput_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a bytevector consisting of the bytes that have been
output to the port so far in the order they were output.
It is an error if <var>port</var> was not created with <code>open-output-bytevector</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Input">
<h4 class="subsection">17.5.2 Input</h4>

<p>If <var>port</var> is omitted from any input procedure, it defaults
to the value returned by <code>(current-input-port)</code>. It is an
error to attempt an input operation on a closed port.
</p>
<dl class="def">
<dt id="index-read"><span class="category">Procedure: </span><span><strong>read</strong> <em>[port]</em><a href='#index-read' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>read</code> procedure converts external representations of
Scheme objects into the objects themselves. That is, it is
a parser for the non-terminal <a href="#meta_002ddatum"><var>datum</var></a>.
It returns the next object parsable from the
given textual input port, updating port to point to the
first character past the end of the external representation
of the object.
</p>
<p>If an end of file is encountered in the input before any
characters are found that can begin an object, then an
end-of-file object is returned. The port remains open, and
further attempts to read will also return an end-of-file object.
If an end of file is encountered after the beginning of
an object’s external representation, but the external representation
is incomplete and therefore not parsable, an error
that satisfies <code>read-error?</code> is signaled.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002dchar"><span class="category">Procedure: </span><span><strong>read-char</strong> <em>[port]</em><a href='#index-read_002dchar' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the next character available from the textual input
<var>port</var>, updating the port to point to the following character.
If no more characters are available, an end-of-file value is
returned.
</p>
<p>The result type is <code>character-or-eof</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-peek_002dchar"><span class="category">Procedure: </span><span><strong>peek-char</strong> <em>[port]</em><a href='#index-peek_002dchar' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the next character available from the textual input <var>port</var>,
but <em>without</em> updating the port to point to the
following character. If no more characters are available, an
end-of-file value is returned.
</p>
<p>The result type is <code>character-or-eof</code>.
</p>
<p><em>Note:</em> The value returned by a call to <code>peek-char</code> is the same as
the value that would have been returned by a call to <code>read-char</code>
with the same <var>port</var>. The only difference is that the very next call
to <code>read-char</code> or <code>peek-char</code> on that <var>port</var> will return the
value returned by the preceding call to <code>peek-char</code>. In particular, a
call to <code>peek-char</code> on an interactive port will hang waiting for
input whenever a call to <code>read-char</code> would have hung.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002dline"><span class="category">Procedure: </span><span><strong>read-line</strong> <em>[port [handle-newline]]</em><a href='#index-read_002dline' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads a line of input from the textual input <var>port</var>.
The <var>handle-newline</var> parameter determines what is done with
terminating end-of-line delimiter.
The default, <code>'trim</code>, ignores the delimiter;
<code>'peek</code> leaves the delimiter in the input stream;
<code>'concat</code> appends the delimiter to the returned value;
and <code>'split</code> returns the delimiter as a second value.
You can use the last three options to tell if the string was
terminated by end-or-line or by end-of-file.
If an end of file is encountered before any end of
line is read, but some characters have been read, a string
containing those characters is returned.
(In this case, <code>'trim</code>, <code>'peek</code>, and <code>'concat</code>
have the same result and effect.  The <code>'split</code> case returns two
values: The characters read, and the delimiter is an empty string.)
If an end of file is encountered before any characters are read,
an end-of-file object is returned.
For the purpose of this procedure, an
end of line consists of either a linefeed character, a carriage
return character, or a sequence of a carriage return character
followed by a linefeed character.
</p></dd></dl>

<dl class="def">
<dt id="index-eof_002dobject_003f"><span class="category">Procedure: </span><span><strong>eof-object?</strong> <em>obj</em><a href='#index-eof_002dobject_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if <var>obj</var> is an end-of-file object,
otherwise returns <code>#f</code>.
</p>
<p><code>Performance note</code>: If <var>obj</var> has type <code>character-or-eof</code>,
this is compiled as an <code>int</code> comparison with -1.
</p></dd></dl>

<dl class="def">
<dt id="index-eof_002dobject"><span class="category">Procedure: </span><span><strong>eof-object</strong><a href='#index-eof_002dobject' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an end-of-file object.
</p></dd></dl>

<dl class="def">
<dt id="index-char_002dready_003f"><span class="category">Procedure: </span><span><strong>char-ready?</strong> <em>[port]</em><a href='#index-char_002dready_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if a character is ready on the textual input
<var>port</var> and returns <code>#f</code> otherwise. If char-ready returns <code>#t</code>
then the next <code>read-char</code> operation on the given <var>port</var> is
guaranteed not to hang. If the port is at end of file then
<code>char-ready?</code> returns <code>#t</code>.
</p>
<p><em>Rationale:</em> The <code>char-ready?</code> procedure exists to make it
possible for a program to accept characters from interactive ports
without getting stuck waiting for input. Any input editors as-
sociated with such ports must ensure that characters whose
existence has been asserted by <code>char-ready?</code> cannot be removed
from the input. If <code>char-ready?</code> were to return <code>#f</code> at end of
file, a port at end-of-file would be indistinguishable from an
interactive port that has no ready characters.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002dstring"><span class="category">Procedure: </span><span><strong>read-string</strong> <em>k [port]</em><a href='#index-read_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads the next <var>k</var> characters, or as many as are available
before the end of file, from the textual input <var>port</var> into a
newly allocated string in left-to-right order and returns the
string. If no characters are available before the end of file,
an end-of-file object is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002du8"><span class="category">Procedure: </span><span><strong>read-u8</strong> <em>[port]</em><a href='#index-read_002du8' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the next byte available from the binary input <var>port</var>,
updating the <var>port</var> to point to the following byte. If no more
bytes are available, an end-of-file object is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-peek_002du8"><span class="category">Procedure: </span><span><strong>peek-u8</strong> <em>[port]</em><a href='#index-peek_002du8' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the next byte available from the binary input <var>port</var>,
but <em>without</em> updating the <var>port</var> to point to the following byte.
If no more bytes are available, an end-of-file object is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-u8_002dready_003f"><span class="category">Procedure: </span><span><strong>u8-ready?</strong> <em>[port]</em><a href='#index-u8_002dready_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> if a byte is ready on the binary input <var>port</var> and
returns <code>#f</code> otherwise. If <code>u8-ready?</code> returns <code>#t</code> then the
next <code>read-u8</code> operation on the given port is guaranteed
not to hang. If the port is at end of file then <code>u8-ready?</code>
returns <code>#t</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002dbytevector"><span class="category">Procedure: </span><span><strong>read-bytevector</strong> <em>k [port]</em><a href='#index-read_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads the next <var>k</var> bytes, or as many as are available before
the end of file, from the binary input <var>port</var> into a newly
allocated bytevector in left-to-right order and returns the
bytevector. If no bytes are available before the end of file,
an end-of-file object is returned.
</p></dd></dl>

<dl class="def">
<dt id="index-read_002dbytevector_0021"><span class="category">Procedure: </span><span><strong>read-bytevector!</strong> <em>bytevector [port [start [end]]]</em><a href='#index-read_002dbytevector_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Reads the next <var>end</var> − <var>start</var> bytes, or as many as are
available before the end of file, from the binary input <var>port</var>
into <var>bytevector</var> in left-to-right order beginning at the <var>start</var>
position. If <var>end</var> is not supplied, reads until the end of
<var>bytevector</var> has been reached. If <var>start</var> is not supplied, reads
beginning at position 0. Returns the number of bytes read.
If no bytes are available, an end-of-file object is returned.
</p></dd></dl>

</div>
<div class="subsection" id="Output">
<h4 class="subsection">17.5.3 Output</h4>

<p>If <var>port</var> is omitted from any output procedure, it defaults
to the value returned by <code>(current-output-port)</code>. It is an
error to attempt an output operation on a closed port.
</p>
<p>The return type of these methods is <code>void</code>.
</p>
<dl class="def">
<dt id="index-write"><span class="category">Procedure: </span><span><strong>write</strong> <em>obj [port]</em><a href='#index-write' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes a representation of <var>obj</var> to the given textual output
<var>port</var>. Strings that appear in the written representation
are enclosed in quotation marks, and within those strings
backslash and quotation mark characters are escaped by
backslashes.
Symbols that contain non-ASCII characters
are escaped with vertical lines.
Character objects are written using the <code>#\</code> notation.
</p>
<p>If <var>obj</var> contains cycles which would cause an infinite loop
using the normal written representation, then at least the
objects that form part of the cycle must be represented
using <a href="#datum-labels">datum labels</a>. Datum
labels must not be used if there are no cycles.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002dshared"><span class="category">Procedure: </span><span><strong>write-shared</strong> <em>obj [port]</em><a href='#index-write_002dshared' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>write-shared</code> procedure is the same as <code>write</code>, except
that shared structure must be represented using datum
labels for all pairs and vectors that appear more than once
in the output.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002dsimple"><span class="category">Procedure: </span><span><strong>write-simple</strong> <em>obj [port]</em><a href='#index-write_002dsimple' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <code>write-simple</code> procedure is the same as <code>write</code>, except
that shared structure is never represented using datum labels.
This can cause write-simple not to terminate if <var>obj</var>
contains circular structure.
</p></dd></dl>

<dl class="def">
<dt id="index-display"><span class="category">Procedure: </span><span><strong>display</strong> <em>obj [port]</em><a href='#index-display' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes a representation of <var>obj</var> to the given textual output
port. Strings that appear in the written representation
are output as if by <code>write-string</code> instead of by <code>write</code>.
Symbols are not escaped. Character objects appear in the
representation as if written by <code>write-char</code> instead of by
<code>write</code>.
The <code>display</code> representation of other objects is unspecified.
</p></dd></dl>

<dl class="def">
<dt id="index-newline"><span class="category">Procedure: </span><span><strong>newline</strong> <em>[port]</em><a href='#index-newline' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes an end of line to textual output <var>port</var>.
This is done using the <code>println</code> method
of the Java class <code>java.io.PrintWriter</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002dchar"><span class="category">Procedure: </span><span><strong>write-char</strong> <em>char [port]</em><a href='#index-write_002dchar' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes the character <var>char</var> (not an external representation
of the character) to the given textual output <var>port</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002dstring"><span class="category">Procedure: </span><span><strong>write-string</strong> <em>string [port [start [end]]]</em><a href='#index-write_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes the characters of <var>string</var> from <var>start</var> to <var>end</var>
in left-to-right order to the textual output <var>port</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002du8"><span class="category">Procedure: </span><span><strong>write-u8</strong> <em>byte [port]</em><a href='#index-write_002du8' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes the <var>byte</var> to the given binary output port.
</p></dd></dl>

<dl class="def">
<dt id="index-write_002dbytevector"><span class="category">Procedure: </span><span><strong>write-bytevector</strong> <em>bytevector [port [start [end]]]</em><a href='#index-write_002dbytevector' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes the bytes of <var>bytevector</var> from <var>start</var> to <var>end</var>
in left-to-right order to the binary output <var>port</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-flush_002doutput_002dport"><span class="category">Procedure: </span><span><strong>flush-output-port</strong> <em>[port]</em><a href='#index-flush_002doutput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-force_002doutput"><span class="category">Procedure: </span><span><strong>force-output</strong> <em>[port]</em><a href='#index-force_002doutput' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Forces any pending output on <var>port</var> to be delivered to the output file or
device and returns an unspecified value.  If the <var>port</var> argument is
omitted it defaults to the value returned by <code>(current-output-port)</code>.
(The name <code>force-output</code> is older,
while R6RS added <code>flush-output-port</code>. They have the same effect.)
</p></dd></dl>

<span id="Prompts"></span><span id="index-prompts"></span>
</div>
<div class="subsection" id="Prompts-for-interactive-consoles-_0028REPLs_0029">
<h4 class="subsection">17.5.4 Prompts for interactive consoles (REPLs)</h4>

<p>When an interactive input port is used for a read-eval-print-loop (REPL
or console) it is traditional for the REPL to print a short
<em>prompt</em> string to signal that the user is expected to type
an expression.  These prompt strings can be customized.
</p>
<span id="input_002dprompt1"></span><dl class="def">
<dt id="index-input_002dprompt1"><span class="category">Variable: </span><span><strong>input-prompt1</strong><a href='#index-input_002dprompt1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-input_002dprompt2"><span class="category">Variable: </span><span><strong>input-prompt2</strong><a href='#index-input_002dprompt2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>These are fluid variable whose values are string templates
with placeholders similar to <code>printf</code>-style format.
The placeholders are expanded (depending on the current state),
and the resulting string printed in front of the input line.
</p>
<p>The <code>input-prompt1</code> is used normally.  For multi-line input commands
(for example if the first line is incomplete), <code>input-prompt1</code>
is used for the first line of each command, while <code>input-prompt2</code> is
used for subsequent &ldquo;continuation&rdquo; lines.
</p>
<p>The following placeholders are handled:
</p><dl compact="compact">
<dt><span><code><b>%%</b></code></span></dt>
<dd><p>A literal &lsquo;<samp>%</samp>&rsquo;.
</p></dd>
<dt><span><code><b>%N</b></code></span></dt>
<dd><p>The current line number.  This is <code>(+ 1 (port-line <var>port</var>))</code>.
</p></dd>
<dt><span><code><b>%</b></code><var>n</var><code><b>P</b></code><var>c</var></span></dt>
<dd><p>Insert padding at this possion, repeating the following
  character <code><var>c</var></code> as needed to bring the total number of columns
of the prompt to that specified by the digits <code><var>n</var></code>.
</p></dd>
<dt><span><code><b>%P</b></code><var>c</var></span></dt>
<dd><p>Same as <code>%<var>n</var>P<var>c</var></code>, but <code><var>n</var></code> defaults to the number
of columns in the initial prompt from the expansion of <code>input-prompt1</code>.
This is only meaningful when expanding <code>input-prompt2</code> for
continuation lines.
</p></dd>
<dt><span><code><b>%</b></code><code><b>{</b></code><var>hidden</var><code><b>%}</b></code></span></dt>
<dd><p>Same as <var>hidden</var>, but the characters of <var>hidden</var>
are assumed to have zero visible width.  Can be used for
<a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape sequences</a>
to change color or style:
</p><div class="example">
<pre class="example">(set! input-prompt1 &quot;%{\e[48;5;51m%}{Kawa:%N} %{\e[0m%}&quot;)
</pre></div>
<p>The above changes both the text and the background color
(to a pale blue).
</p></dd>
<dt><span><code><b>%M</b></code></span></dt>
<dd><p>Insert a &ldquo;message&rdquo; string.
Not normally used by Kawa, but supported by JLine.
</p></dd>
</dl>

<p>These variables can be initialized by the command-line
arguments <code>console:prompt1=<var>prompt1</var></code> and
<code>console:prompt2=<var>prompt2</var></code>, respectively.  If these are
not specified, languages-specific defaults are used.
For example for Scheme the default value of <code>input-prompt1</code>
is <code>&quot;#|kawa:%N|# &quot;</code> and <code>input-prompt2</code> is <code>&quot;#|$P.%N| &quot;</code>.
These have the form of Scheme comments, to make it easier to cut-and-paste.
</p>
<p>If <code>input-prompt1</code> (respectively <code>input-prompt2</code>) does not contain
an escape sequence (either <code>&quot;%{</code> or the escape character <code>&quot;\e&quot;</code>)
then ANSI escape sequences are added to to highlight the prompt.
(Under DomTerm this sets the <code>prompt</code> style, which can be customised
with CSS but defaults to a light green background;
if using JLine the background is set to light green.)
</p></dd></dl>

<p>For greater flexibility, you can also set a prompter procedure.
</p>
<dl class="def">
<dt id="index-set_002dinput_002dport_002dprompter_0021"><span class="category">Procedure: </span><span><strong>set-input-port-prompter!</strong> <em>port prompter</em><a href='#index-set_002dinput_002dport_002dprompter_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Set the prompt procedure associated with <var>port</var> to <var>prompter</var>,
which must be a one-argument procedure taking an input port,
and returning a string.
The procedure is called before reading the first line of a command;
its return value is used as the first-line prompt.
</p>
<p>The prompt procedure can have side effects.
In Bash shell terms: It combines the features of <code>PROMPT_COMMAND</code>
and <code>PS1</code>.
</p>
<p>The initial <var>prompter</var> is <code>default-prompter</code>,
which returns the expansion of <code>input-prompt1</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport_002dprompter"><span class="category">Procedure: </span><span><strong>input-port-prompter</strong> <em>port</em><a href='#index-input_002dport_002dprompter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the prompt procedure associated with <var>port</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-default_002dprompter"><span class="category">Procedure: </span><span><strong>default-prompter</strong> <em>port</em><a href='#index-default_002dprompter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The default prompt procedure.
Normally (i.e. when <code>input-port-read-state</code> is a space)
returns <code>input-prompt1</code> after expanding the <code>%</code>-placeholders.
Can also expand <code>input-prompt2</code> when <code>input-port-read-state</code>
is not whitespace.
</p></dd></dl>

</div>
<div class="subsection" id="Line-numbers-and-other-input-port-properties">
<h4 class="subsection">17.5.5 Line numbers and other input port properties</h4>

<dl class="def">
<dt id="index-port_002dcolumn"><span class="category">Function: </span><span><strong>port-column</strong> <em>input-port</em><a href='#index-port_002dcolumn' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-port_002dline"><span class="category">Function: </span><span><strong>port-line</strong> <em>input-port</em><a href='#index-port_002dline' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the current column number or line number of <var>input-port</var>,
using the current input port if none is specified.
If the number is unknown, the result is <code>#f</code>.  Otherwise,
the result is a 0-origin integer - i.e. the first character
of the first line is line 0, column 0.  (However, when you
display a file position, for example in an error message,
we recommend you add 1 to get 1-origin integers.  This is
because lines and column numbers traditionally start with
1, and that is what non-programmers will find most natural.)
</p></dd></dl>

<dl class="def">
<dt id="index-set_002dport_002dline_0021"><span class="category">Procedure: </span><span><strong>set-port-line!</strong> <em>port line</em><a href='#index-set_002dport_002dline_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Set (0-origin) line number of the current line of <var>port</var> to <var>num</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport_002dline_002dnumber"><span class="category">Procedure: </span><span><strong>input-port-line-number</strong> <em>port</em><a href='#index-input_002dport_002dline_002dnumber' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the line number of the current line of <var>port</var>,
which must be a (non-binary) input port.
The initial line is line 1.
Deprecated; replaced by <code>(+ 1 (port-line <var>port</var>))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-set_002dinput_002dport_002dline_002dnumber_0021"><span class="category">Procedure: </span><span><strong>set-input-port-line-number!</strong> <em>port num</em><a href='#index-set_002dinput_002dport_002dline_002dnumber_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Set line number of the current line of <var>port</var> to <var>num</var>.
Deprecated;  replaced by <code>(set-port-line! <var>port</var> (- <var>num</var> 1))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport_002dcolumn_002dnumber"><span class="category">Procedure: </span><span><strong>input-port-column-number</strong> <em>port</em><a href='#index-input_002dport_002dcolumn_002dnumber' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the column number of the current line of <var>port</var>, 
which must be a (non-binary) input port.
The initial column is column 1.
Deprecated; replaced by <code>(+ 1 (port-column <var>port</var>))</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport_002dread_002dstate"><span class="category">Procedure: </span><span><strong>input-port-read-state</strong> <em>port</em><a href='#index-input_002dport_002dread_002dstate' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a character indicating the current <code>read</code> state of the <var>port</var>.
Returns <code>#\Return</code> if not current doing a <var>read</var>,
<code>#\&quot;</code> if reading a string;  <code>#\|</code> if reading a comment;  <code>#\(</code>
if inside a list; and <code>#\Space</code> when otherwise in a <code>read</code>.
The result is intended for use by prompt prcedures, and is not necessarily
correct except when reading a new-line.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol_002dread_002dcase"><span class="category">Variable: </span><span><strong>symbol-read-case</strong><a href='#index-symbol_002dread_002dcase' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A symbol that controls how <code>read</code> handles letters when reading a symbol.
If the first letter is &lsquo;<samp>U</samp>&rsquo;, then letters in symbols are upper-cased.
If the first letter is &lsquo;<samp>D</samp>&rsquo; or &lsquo;<samp>L</samp>&rsquo;, then letters
in symbols are down-cased.
If the first letter is &lsquo;<samp>I</samp>&rsquo;, then the case of letters in symbols
is inverted.
Otherwise (the default), the letter is not changed.
(Letters following a &lsquo;<samp>\</samp>&rsquo; are always unchanged.)
The value of <code>symbol-read-case</code> only checked
when a reader is created, not each time a symbol is read.
</p></dd></dl>

</div>
<div class="subsection" id="Miscellaneous-2">
<h4 class="subsection">17.5.6 Miscellaneous</h4>

<span id="port_002dchar_002dencoding"></span><dl class="def">
<dt id="index-port_002dchar_002dencoding"><span class="category">Variable: </span><span><strong>port-char-encoding</strong><a href='#index-port_002dchar_002dencoding' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Controls how bytes in external files are converted to/from internal
Unicode characters.  Can be either a symbol or a boolean.
If <code>port-char-encoding</code> is <code>#f</code>, the file is assumed
to be a binary file and no conversion is done.
Otherwise, the file is a text file.  The default is <code>#t</code>, which
uses a locale-dependent conversion.  If <code>port-char-encoding</code>
is a symbol, it must be the name of a character encoding known to Java.
For all text files (that is if <code>port-char-encoding</code> is not <code>#f</code>),
on input a <code>#\Return</code> character or
a <code>#\Return</code> followed by <code>#\Newline</code>
are converted into plain <code>#\Newline</code>.
</p>
<p>This variable is checked when the file is opened;  not when actually
reading or writing.  Here is an example of how you can safely
change the encoding temporarily:
</p><div class="example">
<pre class="example">(define (open-binary-input-file name)
  (fluid-let ((port-char-encoding #f)) (open-input-file name)))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-_002aprint_002dbase_002a"><span class="category">Variable: </span><span><strong>*print-base*</strong><a href='#index-_002aprint_002dbase_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The number base (radix) to use by default when printing rational numbers.
Must be an integer between 2 and 36, and the default is of course 10.
For example setting <code>*print-base*</code> to 16 produces hexadecimal output.
</p></dd></dl>

<dl class="def">
<dt id="index-_002aprint_002dradix_002a"><span class="category">Variable: </span><span><strong>*print-radix*</strong><a href='#index-_002aprint_002dradix_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If true, prints an indicator of the radix used when printing rational numbers.
If <code>*print-base*</code> is respectively 2, 8, or 16, then
<code>#b</code>, <code>#o</code> or <code>#x</code> is written before the number;
otherwise <code>#<var>N</var>r</code> is written, where <code><var>N</var></code> is the base.
An exception is when  <code>*print-base*</code> is 10, in which case a period
is written <em>after</em> the number, to match Common Lisp; this may
be inappropriate for Scheme, so is likely to change.
</p></dd></dl>

<dl class="def">
<dt id="index-_002aprint_002dright_002dmargin_002a"><span class="category">Variable: </span><span><strong>*print-right-margin*</strong><a href='#index-_002aprint_002dright_002dmargin_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The right margin (or line width) to use when pretty-printing.
</p></dd></dl>

<dl class="def">
<dt id="index-_002aprint_002dmiser_002dwidth_002a"><span class="category">Variable: </span><span><strong>*print-miser-width*</strong><a href='#index-_002aprint_002dmiser_002dwidth_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If this an integer, and the available width is less or equal to this value,
then the pretty printer switch to the more <em>miser</em> compact style.
</p></dd></dl>

<dl class="def">
<dt id="index-_002aprint_002dxml_002dindent_002a"><span class="category">Variable: </span><span><strong>*print-xml-indent*</strong><a href='#index-_002aprint_002dxml_002dindent_002a' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>When writing to XML, controls pretty-printing and indentation.
If the value is <code>'always</code> or  <code>'yes</code> force each element to
start on a new suitably-indented line.
If the value is <code>'pretty</code> only force new lines for elements that
won&rsquo;t fit completely on a line.
The the value is <code>'no</code> or unset, don&rsquo;t add extra whitespace.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Format">
<div class="header">
<p>
Previous: <a href="#Ports" accesskey="p" rel="prev">Ports</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Formatted-Output-_0028Common_002dLisp_002dstyle_0029"></span><h3 class="section">17.6 Formatted Output (Common-Lisp-style)</h3>

<dl class="def">
<dt id="index-format"><span class="category">Procedure: </span><span><strong>format</strong> <em>destination fmt . arguments</em><a href='#index-format' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An almost complete implementation of Common LISP format description
according to the CL reference book <cite>Common LISP</cite> from Guy L.
Steele, Digital Press.  Backward compatible to most of the available
Scheme format implementations.
</p>
<p>Returns <code>#t</code>, <code>#f</code> or a string; has side effect of printing
according to <var>fmt</var>.  If <var>destination</var> is <code>#t</code>,
the output is to the current output port and <code>#!void</code> is returned.  If
<var>destination</var> is <code>#f</code>, a formatted string is returned as the
result of the call.  If <var>destination</var> is a string,
<var>destination</var> is regarded as the format string; <var>fmt</var> is
then the first argument and the output is returned as a string. If
<var>destination</var> is a number, the output is to the current error port
if available by the implementation. Otherwise <var>destination</var> must be
an output port and <code>#!void</code> is returned.
</p>
<p><var>fmt</var> must be a string or an instance of <code>gnu.text.MessageFormat</code>
or <code>java.text.MessageFormat</code>.  If <var>fmt</var> is a string,
it is parsed as if by <code>parse-format</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-parse_002dformat"><span class="category">Procedure: </span><span><strong>parse-format</strong> <em>format-string</em><a href='#index-parse_002dformat' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Parses <code>format-string</code>, which is a string of the form of a Common LISP
format description.  Returns an instance of <code>gnu.text.ReportFormat</code>,
which can be passed to the <code>format</code> function.
</p></dd></dl>

<p>A format string passed to <code>format</code> or <code>parse-format</code>
consists of format directives (that start with &lsquo;<samp>~</samp>&rsquo;),
and regular characters (that are written directly to the destination).
Most of the Common Lisp (and Slib) format directives are implemented.
Neither justification, nor pretty-printing are supported yet.
</p>
<p>Plus of course, we need documentation for <code>format</code>!
</p>
<ul class="section-toc">
<li><a href="#Implemented-CL-Format-Control-Directives" accesskey="1">Implemented CL Format Control Directives</a></li>
<li><a href="#Formatting-Integers" accesskey="2">Formatting Integers</a></li>
<li><a href="#Formatting-real-numbers" accesskey="3">Formatting real numbers</a></li>
<li><a href="#Miscellaneous-formatting-operators" accesskey="4">Miscellaneous formatting operators</a></li>
<li><a href="#Unimplemented-CL-Format-Control-Directives" accesskey="5">Unimplemented CL Format Control Directives</a></li>
<li><a href="#Extended_002c-Replaced-and-Additional-Control-Directives" accesskey="6">Extended, Replaced and Additional Control Directives</a></li>
</ul>
<div class="subsection" id="Implemented-CL-Format-Control-Directives">
<h4 class="subsection">17.6.1 Implemented CL Format Control Directives</h4>

<p>Documentation syntax: Uppercase characters represent the corresponding
control directive characters. Lowercase characters represent control
directive parameter descriptions.
</p>
<dl compact="compact">
<dd><span id="index-_007ea"></span>
</dd>
<dt><span><code>~A</code></span></dt>
<dd><p>Any (print as <code>display</code> does).
</p><dl compact="compact">
<dt><span><code>~@A</code></span></dt>
<dd><p>left pad.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>colinc</var>,<var>minpad</var>,<var>padchar</var>A</code></span></dt>
<dd><p>full padding.
</p></dd>
</dl>
<span id="index-_007es"></span>
</dd>
<dt><span><code>~S</code></span></dt>
<dd><p>S-expression (print as <code>write</code> does).
</p><dl compact="compact">
<dt><span><code>~@S</code></span></dt>
<dd><p>left pad.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>colinc</var>,<var>minpad</var>,<var>padchar</var>S</code></span></dt>
<dd><p>full padding.
</p></dd>
</dl>

<span id="index-_007ec"></span>
</dd>
<dt><span><code>~C</code></span></dt>
<dd><p>Character.
</p><dl compact="compact">
<dt><span><code>~@C</code></span></dt>
<dd><p>prints a character as the reader can understand it (i.e. <code>#\</code> prefixing).
</p></dd>
<dt><span><code>~:C</code></span></dt>
<dd><p>prints a character as emacs does (eg. <code>^C</code> for ASCII 03).
</p></dd>
</dl>
</dd>
</dl>

</div>
<div class="subsection" id="Formatting-Integers">
<h4 class="subsection">17.6.2 Formatting Integers</h4>

<dl compact="compact">
<dd><span id="index-_007ed"></span>
</dd>
<dt><span><code>~D</code></span></dt>
<dd><p>Decimal.
</p><dl compact="compact">
<dt><span><code>~@D</code></span></dt>
<dd><p>print number sign always.
</p></dd>
<dt><span><code>~:D</code></span></dt>
<dd><p>print comma separated.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>padchar</var>,<var>commachar</var>,<var>commawidth</var>D</code></span></dt>
<dd><p>padding.
</p></dd>
</dl>
<span id="index-_007ex"></span>
</dd>
<dt><span><code>~X</code></span></dt>
<dd><p>Hexadecimal.
</p><dl compact="compact">
<dt><span><code>~@X</code></span></dt>
<dd><p>print number sign always.
</p></dd>
<dt><span><code>~:X</code></span></dt>
<dd><p>print comma separated.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>padchar</var>,<var>commachar</var>,<var>commawidth</var>X</code></span></dt>
<dd><p>padding.
</p></dd>
</dl>
<span id="index-_007eo"></span>
</dd>
<dt><span><code>~O</code></span></dt>
<dd><p>Octal.
</p><dl compact="compact">
<dt><span><code>~@O</code></span></dt>
<dd><p>print number sign always.
</p></dd>
<dt><span><code>~:O</code></span></dt>
<dd><p>print comma separated.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>padchar</var>,<var>commachar</var>,<var>commawidth</var>O</code></span></dt>
<dd><p>padding.
</p></dd>
</dl>
<span id="index-_007eb"></span>
</dd>
<dt><span><code>~B</code></span></dt>
<dd><p>Binary.
</p><dl compact="compact">
<dt><span><code>~@B</code></span></dt>
<dd><p>print number sign always.
</p></dd>
<dt><span><code>~:B</code></span></dt>
<dd><p>print comma separated.
</p></dd>
<dt><span><code>~<var>mincol</var>,<var>padchar</var>,<var>commachar</var>,<var>commawidth</var>B</code></span></dt>
<dd><p>padding.
</p></dd>
</dl>
<span id="index-_007er"></span>
</dd>
<dt><span><code>~<var>n</var>R</code></span></dt>
<dd><p>Radix <var>n</var>.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>,<var>mincol</var>,<var>padchar</var>,<var>commachar</var>,<var>commawidth</var>R</code></span></dt>
<dd><p>padding.
</p></dd>
</dl>
</dd>
<dt><span><code>~@R</code></span></dt>
<dd><p>print a number as a Roman numeral.
</p></dd>
<dt><span><code>~:@R</code></span></dt>
<dd><p>print a number as an &ldquo;old fashioned&rdquo; Roman numeral.
</p></dd>
<dt><span><code>~:R</code></span></dt>
<dd><p>print a number as an ordinal English number.
</p></dd>
<dt><span><code>~R</code></span></dt>
<dd><p>print a number as a cardinal English number.
<span id="index-_007ep"></span>
</p></dd>
<dt><span><code>~P</code></span></dt>
<dd><p>Plural.
</p><dl compact="compact">
<dt><span><code>~@P</code></span></dt>
<dd><p>prints <code>y</code> and <code>ies</code>.
</p></dd>
<dt><span><code>~:P</code></span></dt>
<dd><p>as <code>~P but jumps 1 argument backward.</code>
</p></dd>
<dt><span><code>~:@P</code></span></dt>
<dd><p>as <code>~@P but jumps 1 argument backward.</code>
</p></dd>
</dl>
</dd>
</dl>

<p><var>commawidth</var> is the number of characters between two comma characters.
</p>

</div>
<div class="subsection" id="Formatting-real-numbers">
<h4 class="subsection">17.6.3 Formatting real numbers</h4>

<dl compact="compact">
<dd><span id="index-_007ef"></span>
</dd>
<dt><span><code>~F</code></span></dt>
<dd><p>Fixed-format floating-point (prints a flonum like <var>mmm.nnn</var>).
</p><dl compact="compact">
<dt><span><code>~<var>width</var>,<var>digits</var>,<var>scale</var>,<var>overflowchar</var>,<var>padchar</var>F</code></span></dt>
<dt><span><code>~@F</code></span></dt>
<dd><p>If the number is positive a plus sign is printed.
</p></dd>
</dl>
</dd>
</dl>

<dl compact="compact">
<dd><span id="index-_007ee"></span>
</dd>
<dt><span><code>~E</code></span></dt>
<dd><p>Exponential floating-point (prints a flonum like <var>mmm.nnn</var><code>E</code><var>ee</var>)
</p><dl compact="compact">
<dt><span><code>~<var>width</var>,<var>digits</var>,<var>exponentdigits</var>,<var>scale</var>,<var>overflowchar</var>,<var>padchar</var>,<var>exponentchar</var>E</code></span></dt>
<dt><span><code>~@E</code></span></dt>
<dd><p>If the number is positive a plus sign is printed.
</p></dd>
</dl>
</dd>
</dl>

<dl compact="compact">
<dd><span id="index-_007eg"></span>
</dd>
<dt><span><code>~G</code></span></dt>
<dd><p>General floating-point (prints a flonum either fixed or exponential).
</p><dl compact="compact">
<dt><span><code>~<var>width</var>,<var>digits</var>,<var>exponentdigits</var>,<var>scale</var>,<var>overflowchar</var>,<var>padchar</var>,<var>exponentchar</var>G</code></span></dt>
<dt><span><code>~@G</code></span></dt>
<dd><p>If the number is positive a plus sign is printed.
</p></dd>
</dl>
<p>A slight difference from Common Lisp:  If the number is printed
in fixed form and the fraction is zero,
then a zero digit is printed for the fraction, if allowed by the <var>width</var>
and <var>digits</var> is unspecified.
</p></dd>
</dl>

<dl compact="compact">
<dd><span id="index-_007e_0024"></span>
</dd>
<dt><span><code>~$</code></span></dt>
<dd><p>Dollars floating-point (prints a flonum in fixed with signs separated).
</p><dl compact="compact">
<dt><span><code>~<var>digits</var>,<var>scale</var>,<var>width</var>,<var>padchar</var>$</code></span></dt>
<dt><span><code>~@$</code></span></dt>
<dd><p>If the number is positive a plus sign is printed.
</p></dd>
<dt><span><code>~:@$</code></span></dt>
<dd><p>A sign is always printed and appears before the padding.
</p></dd>
<dt><span><code>~:$</code></span></dt>
<dd><p>The sign appears before the padding.
</p></dd>
</dl>
</dd>
</dl>

</div>
<div class="subsection" id="Miscellaneous-formatting-operators">
<h4 class="subsection">17.6.4 Miscellaneous formatting operators</h4>

<dl compact="compact">
<dd><span id="index-_007e_0025"></span>
</dd>
<dt><span><code>~%</code></span></dt>
<dd><p>Newline.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>%</code></span></dt>
<dd><p>print <var>n</var> newlines.
</p></dd>
</dl>
<span id="index-_007e_0026"></span>
</dd>
<dt><span><code>~&amp;</code></span></dt>
<dd><p>print newline if not at the beginning of the output line.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>&amp;</code></span></dt>
<dd><p>prints <code>~&amp;</code> and then <var>n-1</var> newlines.
</p></dd>
</dl>
<span id="index-_007e_007c"></span>
</dd>
<dt><span><code>~|</code></span></dt>
<dd><p>Page Separator.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>|</code></span></dt>
<dd><p>print <var>n</var> page separators.
</p></dd>
</dl>
<span id="index-_007e_007e"></span>
</dd>
<dt><span><code>~~</code></span></dt>
<dd><p>Tilde.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>~</code></span></dt>
<dd><p>print <var>n</var> tildes.
</p></dd>
</dl>
<span id="index-_007enewline"></span>
</dd>
<dt><span><code>~</code>&lt;newline&gt;</span></dt>
<dd><p>Continuation Line.
</p><dl compact="compact">
<dt><span><code>~:</code>&lt;newline&gt;</span></dt>
<dd><p>newline is ignored, white space left.
</p></dd>
<dt><span><code>~@</code>&lt;newline&gt;</span></dt>
<dd><p>newline is left, white space ignored.
</p></dd>
</dl>
<span id="index-_007et"></span>
</dd>
<dt><span><code>~T</code></span></dt>
<dd><p>Tabulation.
</p><dl compact="compact">
<dt><span><code>~@T</code></span></dt>
<dd><p>relative tabulation.
</p></dd>
<dt><span><code>~<var>colnum</var>,<var>colinc</var>T</code></span></dt>
<dd><p>full tabulation.
</p></dd>
</dl>
<span id="index-_007e_003f"></span>
</dd>
<dt><span><code>~?</code></span></dt>
<dd><p>Indirection (expects indirect arguments as a list).
</p><dl compact="compact">
<dt><span><code>~@?</code></span></dt>
<dd><p>extracts indirect arguments from format arguments.
</p></dd>
</dl>
<span id="index-_007e_0028"></span>
</dd>
<dt><span><code>~(<var>str</var>~)</code></span></dt>
<dd><p>Case conversion (converts by <code>string-downcase</code>).
</p><dl compact="compact">
<dt><span><code>~:(<var>str</var>~)</code></span></dt>
<dd><p>converts by <code>string-capitalize</code>.
</p></dd>
<dt><span><code>~@(<var>str</var>~)</code></span></dt>
<dd><p>converts by <code>string-capitalize-first</code>.
</p></dd>
<dt><span><code>~:@(<var>str</var>~)</code></span></dt>
<dd><p>converts by <code>string-upcase</code>.
</p></dd>
</dl>
<span id="index-_007e_002a"></span>
</dd>
<dt><span><code>~*</code></span></dt>
<dd><p>Argument Jumping (jumps 1 argument forward).
</p><dl compact="compact">
<dt><span><code>~<var>n</var>*</code></span></dt>
<dd><p>jumps <var>n</var> arguments forward.
</p></dd>
<dt><span><code>~:*</code></span></dt>
<dd><p>jumps 1 argument backward.
</p></dd>
<dt><span><code>~<var>n</var>:*</code></span></dt>
<dd><p>jumps <var>n</var> arguments backward.
</p></dd>
<dt><span><code>~@*</code></span></dt>
<dd><p>jumps to the 0th argument.
</p></dd>
<dt><span><code>~<var>n</var>@*</code></span></dt>
<dd><p>jumps to the <var>n</var>th argument (beginning from 0)
</p></dd>
</dl>
</dd>
<dt><span><code>~[<var>str0</var>~;<var>str1</var>~;...~;<var>strn</var>~]</code></span></dt>
<dd><p>Conditional Expression (numerical clause conditional).
</p><dl compact="compact">
<dd><span id="index-_007e_005b"></span>
</dd>
<dt><span><code>~<var>n</var>[</code></span></dt>
<dd><p>take argument from <var>n</var>.
</p></dd>
<dt><span><code>~@[</code></span></dt>
<dd><p>true test conditional.
</p></dd>
<dt><span><code>~:[</code></span></dt>
<dd><p>if-else-then conditional.
<span id="index-_007e_003b"></span>
</p></dd>
<dt><span><code>~;</code></span></dt>
<dd><p>clause separator.
</p></dd>
<dt><span><code>~:;</code></span></dt>
<dd><p>default clause follows.
</p></dd>
</dl>
</dd>
<dt><span><code>~{<var>str</var>~}</code></span></dt>
<dd><p>Iteration (args come from the next argument (a list)).
</p><dl compact="compact">
<dt><span><code>~<var>n</var>{</code></span></dt>
<dd><p>at most <var>n</var> iterations.
<span id="index-_007e_007b"></span>
</p></dd>
<dt><span><code>~:{</code></span></dt>
<dd><p>args from next arg (a list of lists).
</p></dd>
<dt><span><code>~@{</code></span></dt>
<dd><p>args from the rest of arguments.
</p></dd>
<dt><span><code>~:@{</code></span></dt>
<dd><p>args from the rest args (lists).
</p></dd>
</dl>
<span id="index-_007e_005e"></span>
</dd>
<dt><span><code>~^</code></span></dt>
<dd><p>Up and out.
</p><dl compact="compact">
<dt><span><code>~<var>n</var>^</code></span></dt>
<dd><p>aborts if <var>n</var> = 0
</p></dd>
<dt><span><code>~<var>n</var>,<var>m</var>^</code></span></dt>
<dd><p>aborts if <var>n</var> = <var>m</var>
</p></dd>
<dt><span><code>~<var>n</var>,<var>m</var>,<var>k</var>^</code></span></dt>
<dd><p>aborts if <var>n</var> &lt;= <var>m</var> &lt;= <var>k</var>
</p></dd>
</dl>
</dd>
</dl>

</div>
<div class="subsection" id="Unimplemented-CL-Format-Control-Directives">
<h4 class="subsection">17.6.5 Unimplemented CL Format Control Directives</h4>

<dl compact="compact">
<dt><span><code>~:A</code></span></dt>
<dd><p>print <code>#f</code> as an empty list (see below).
</p></dd>
<dt><span><code>~:S</code></span></dt>
<dd><p>print <code>#f</code> as an empty list (see below).
</p></dd>
<dt><span><code>~&lt;~&gt;</code></span></dt>
<dd><p>Justification.
</p></dd>
<dt><span><code>~:^</code></span></dt>
</dl>

</div>
<div class="subsection" id="Extended_002c-Replaced-and-Additional-Control-Directives">
<h4 class="subsection">17.6.6 Extended, Replaced and Additional Control Directives</h4>

<p>These are not necesasrily implemented in Kawa!
</p>
<dl compact="compact">
<dt><span><code>~I</code></span></dt>
<dd><p>print a R4RS complex number as <code>~F~@Fi</code> with passed parameters for
<code>~F</code>.
</p></dd>
<dt><span><code>~Y</code></span></dt>
<dd><p>Pretty print formatting of an argument for scheme code lists.
</p></dd>
<dt><span><code>~K</code></span></dt>
<dd><p>Same as <code>~?.</code>
</p></dd>
<dt><span><code>~!</code></span></dt>
<dd><p>Flushes the output if format <var>destination</var> is a port.
</p></dd>
<dt><span><code>~_</code></span></dt>
<dd><p>Print a <code>#\space</code> character
</p><dl compact="compact">
<dt><span><code>~<var>n</var>_</code></span></dt>
<dd><p>print <var>n</var> <code>#\space</code> characters.
</p></dd>
</dl>

</dd>
<dt><span><code>~<var>n</var>C</code></span></dt>
<dd><p>Takes <var>n</var> as an integer representation for a character. No arguments
are consumed. <var>n</var> is converted to a character by
<code>integer-&gt;char</code>.  <var>n</var> must be a positive decimal number.
</p></dd>
<dt><span><code>~:S</code></span></dt>
<dd><p>Print out readproof.  Prints out internal objects represented as
<code>#&lt;...&gt;</code> as strings <code>&quot;#&lt;...&gt;&quot;</code> so that the format output can always
be processed by <code>read</code>.

</p></dd>
<dt><span><code>~:A</code></span></dt>
<dd><p>Print out readproof.  Prints out internal objects represented as
<code>#&lt;...&gt;</code> as strings <code>&quot;#&lt;...&gt;&quot;</code> so that the format output can always
be processed by <code>read</code>.

</p></dd>
<dt><span><code>~F, ~E, ~G, ~$</code></span></dt>
<dd><p>may also print number strings, i.e. passing a number as a string and
format it accordingly.
</p></dd>
</dl>

<hr>
</div>
</div>
<div class="section" id="Pretty_002dprinting">
<div class="header">
<p>
Next: <a href="#Resources" accesskey="n" rel="next">Resources</a>, Previous: <a href="#Format" accesskey="p" rel="prev">Formatted Output (Common-Lisp-style)</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Pretty_002dprinting-1"></span><h3 class="section">17.7 Pretty-printing</h3>

<p>Pretty-printing is displaying a data structure as text,
by adding line-breaks and indenttaion so that the visual
structure of the output corresponds to the logical structure of
data structure.  This makes it easier to read and understand.
Pretty-printing takes into account the column width of the output
so as to avoid using more lines than needed.
</p>
<p>Pretty-printing of standard sequences types such as lists and
vectors is done by default.  For example:
</p><div class="example">
<pre class="example">#|kawa:11|# <kbd>(set! *print-right-margin* 50)</kbd>
#|kawa:12|# <kbd>'(ABCDEF (aa bb cc dd) (x123456789</kbd>
#|.....13|# <kbd>y123456789 z123456789) ABCDEFG HIJKL)</kbd>
(ABCDEF (aa bb cc dd)
 (x123456789 y123456789 z123456789) ABCDEFG HIJK)
</pre></div>
<p>Setting <code>*print-right-margin*</code> to 50
causes output to be limited to 50 columns.
Notice the top-level list has to be split,
but sub-lists <code>(aa bb cc dd)</code>
and <code>(x123456789 y123456789 z123456789)</code>
don&rsquo;t need to be split.
</p>
<p>When outputting to a DomTerm REPL,
then <code>*print-right-margin*</code> is ignored,
and the line-breaking is actually handled by DomTerm.
If you change the window width, DomTerm will dynamically
re-calculate the line-breaks of previous pretten output.
This works even in the case of a session saved to an HTML
file, as long as JavaScript is enabled.
</p>
<p>The concepts and terminology are
based on those of <a href="https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node253.html">Common Lisp</a>.
</p>
<ul class="section-toc">
<li><a href="#Pretty_002dprinting-Scheme-forms" accesskey="1">Pretty-printing Scheme forms</a></li>
<li><a href="#Generic-pretty_002dprinting-functions" accesskey="2">Generic pretty-printing functions</a></li>
</ul>
<div class="subsection" id="Pretty_002dprinting-Scheme-forms">
<h4 class="subsection">17.7.1 Pretty-printing Scheme forms</h4>

<p>Scheme and Lisp code is traditionally pretty-printed
slightly differently than plain lists.
The <code>pprint</code> procedure assumes the argument
is a Scheme form, and prints its accordingly.
For example the special form <code>(let ...)</code> is printed
differently from a regular function call <code>(list ...)</code>.
</p>
<dl class="def">
<dt id="index-pprint"><span class="category">Procedure: </span><span><strong>pprint</strong> <em>obj [out]</em><a href='#index-pprint' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Assume <var>obj</var> is a Scheme form, and pretty-print it
in traditional Scheme format.  For example:
</p><div class="example">
<pre class="example">#|kawa:1|# <kbd>(import (kawa pprint))</kbd>
#|kawa:2|# <kbd>(define fib-form</kbd>
#|.....3|# <kbd>  '(define (fibonacci n)</kbd>
#|.....4|# <kbd>     (let loop ((i0 0) (i1 1) (n n))</kbd>
#|.....5|# <kbd>       (if (&lt;= n 0) i0</kbd>
#|.....6|# <kbd>           (loop i1 (+ i0 i1) (- n 1))))))</kbd>
#|kawa:7|# <kbd>(set! *print-right-margin* 80)</kbd>
#|kawa:8|# <kbd>(pprint fib-form)</kbd>
(define (fibonacci n)
  (let loop ((i0 0) (i1 1) (n n)) (if (&lt;= n 0) i0 (loop i1 (+ i0 i1) (- n 1)))))
#|kawa:9|# <kbd>(set! *print-right-margin* 40)</kbd>
#|kawa:10|# <kbd>(pprint fib-form)</kbd>
(define (fibonacci n)
  (let loop ((i0 0) (i1 1) (n n))
    (if (&lt;= n 0)
        i0
        (loop i1 (+ i0 i1) (- n 1)))))
</pre></div>

<p>The <code>pprint</code> special-cases forms that start with
<code>define</code>, <code>if</code>, <code>lambda</code>, <code>let</code>,
and a few more, and formats them with &ldquo;traditional&rdquo; indentation.
However, it is not as complete or polished as it should be.
(It should also use a programmable dispatch table,
rather than having these special cases hard-wired.
That is an improvemet for another day.)
</p></dd></dl>

</div>
<div class="subsection" id="Generic-pretty_002dprinting-functions">
<h4 class="subsection">17.7.2 Generic pretty-printing functions</h4>

<p>The following procedures are used to indicate logical blocks,
and optional newlines.
</p>
<p>To access them do:
</p><div class="example">
<pre class="example">(import (kawa pprint))
</pre></div>

<p>In the following, <var>out</var> is the output port, which
defaults to <code>(current-output-port)</code>.
</p>
<dl class="def">
<dt id="index-pprint_002dlogical_002dblock"><span class="category">Syntax: </span><span><strong>pprint-logical-block</strong> <em><var>options</var> <a href="#meta_002dstatement"><var>statement</var></a><sup>*</sup></em><a href='#index-pprint_002dlogical_002dblock' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Evaluate the <var>statement</var>s within the context of a new &ldquo;logical block&rdquo;.
</p>

<p>The <var>options</var> are one or more of the following:
</p><dl compact="compact">
<dt><span><code><b>prefix:</b></code> <var>prefix</var></span></dt>
<dt><span><code><b>per-line:</b></code> <var>per-line-prefix</var></span></dt>
<dd><p>Emit <var>prefix</var> or <var>per-line-prefix</var> (only one of them can be specified) before the start of the logical block.
If <var>per-line-prefix</var> is provided, it is also print for each
line within the logical block, indented the same.
These are strings and default to <code>&quot;&quot;</code>.
</p></dd>
<dt><span><code><b>suffix:</b></code> <var>suffix</var></span></dt>
<dd><p>Emit <var>suffix</var> after the end of the logical block.
</p></dd>
<dt><span><code><b>out:</b></code> <var>out</var></span></dt>
<dd><p>The output file.
</p></dd>
</dl>

<p>For example to print a list you might do:
</p><div class="example">
<pre class="example">(pprint-logical-block prefix: &quot;(&quot; suffix: &quot;)&quot;
   <i>print contents of list</i>)
</pre></div>

<p>This macro is equivalent to:
</p><div class="example">
<pre class="example">(pprint-start-logical-block <var>prefix</var> <var>is-per-line</var> <var>suffix</var> <var>out</var>)
(try-finally
  (begin <var>statement</var><sup>*</sup>)
  (pprint-end-logical-block <var>suffix</var> <var>out</var>))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-pprint_002dstart_002dlogical_002dblock"><span class="category">Procedure: </span><span><strong>pprint-start-logical-block</strong> <em>prefix is-per-line suffix out</em><a href='#index-pprint_002dstart_002dlogical_002dblock' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Start a logical block.
The <var>is-per-line</var> argument is a boolean to specifiy
of <var>prefix</var> is a per-line-prefix or a plain prefix.
</p></dd></dl>
<dl class="def">
<dt id="index-pprint_002dend_002dlogical_002dblock"><span class="category">Procedure: </span><span><strong>pprint-end-logical-block</strong> <em>suffix out</em><a href='#index-pprint_002dend_002dlogical_002dblock' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>End a logical block.
</p></dd></dl>

<dl class="def">
<dt id="index-pprint_002dnewline"><span class="category">Procedure: </span><span><strong>pprint-newline</strong> <em>kind [out]</em><a href='#index-pprint_002dnewline' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Print a conditional newline, where <var>kind</var> is one of the
symbols <code>'fill</code>, <code>'linear</code>, <code>'mandatory</code>,
or <code>'miser</code>.
Usually follows printing of a space, as nothing is printed
if the line is not broken here.
</p></dd></dl>

<dl class="def">
<dt id="index-pprint_002dident"><span class="category">Procedure: </span><span><strong>pprint-ident</strong> <em>mode amount [out]</em><a href='#index-pprint_002dident' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Change how much following lines are indented
(with the current logical block).
The <var>amount</var> is the size of the indentation, in characters.
The <var>mode</var> is either <code>'current</code> (if the
<var>amount</var> is relative to the current position),
or <code>'block</code> (if the <var>amount</var> is relative to the
start (after any <var>prefix</var>) of the current logical block).
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Resources">
<div class="header">
<p>
Previous: <a href="#Pretty_002dprinting" accesskey="p" rel="prev">Pretty-printing</a>, Up: <a href="#Input_002dOutput" accesskey="u" rel="up">Input, output, and file handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Resources-1"></span><h3 class="section">17.8 Resources</h3>

<p>A resource is a file or other fixed data that an application may access.
Resources are part of the application and are shipped with it, but are
stored in external files.  Examples are images, sounds,
and translation (localization) of messages.
In the Java world a resource is commonly bundled in the same jar file
as the application itself.
</p>
<dl class="def">
<dt id="index-resource_002durl"><span class="category">Syntax: </span><span><strong>resource-url</strong> <em>resource-name</em><a href='#index-resource_002durl' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a <code>URLPath</code> you can use as a <code>URL</code>, or
you can pass to it <code>open-input-file</code> to read the resource data.
The <var>resource-name</var> is a string which is passed to the
<code>ClassLoader</code> of the containing module.
If the module class is in a jar file, things will magically
work if the resource is in the same jar file, and <var>resource-name</var>
is a filename relative to the module class in the jar.
If the module is immediately evaluated, the <var>resource-name</var> is resolved
against the location of the module source file.
</p></dd></dl>

<dl class="def">
<dt id="index-module_002duri"><span class="category">Syntax: </span><span><strong>module-uri</strong><a href='#index-module_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to a special URI that can be used to access resources
relative to the class of the containing module.
The URI has the form <code>&quot;class-resource://<var>CurrentClass</var>/&quot;</code>
in compiled code, to allow moving the classes/jars.
The current <code>ClassLoader</code> is associated with the URI, so accessing
resources using the URI will use that <code>ClassLoader</code>.
Therefore you should not create a <code>&quot;class-resource:&quot;</code> URI
except by using this function or <code>resolve-uri</code>,
since that might try to use the wrong <code>ClassLoader</code>.
</p>
<p>The macro <code>resource-url</code> works by using <code>module-uri</code>
and resolving that to a normal <code>URL</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-module_002dclass"><span class="category">Syntax: </span><span><strong>module-class</strong><a href='#index-module_002dclass' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to the containing module class, as a <code>java.lang.Class</code> instance.
</p></dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Types">
<div class="header">
<p>
Next: <a href="#Objects-Classes-and-Modules" accesskey="n" rel="next">Object, Classes and Modules</a>, Previous: <a href="#Input_002dOutput" accesskey="p" rel="prev">Input, output, and file handling</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Types-1"></span><h2 class="chapter">18 Types</h2>

<p>A <em>type</em> is a set of values, plus an associated set of operations
valid on those values.
Types are useful for catching errors (&quot;type-checking&quot;), documenting
the programmer&rsquo;s intent, and to help the compiler generate better code.
Types in some languages (such as C) appear in programs,
but do not exist at run-time.  In such languages, all type-checking
is done at compile-time.  Other languages (such as standard Scheme)
do not have types as such, but they have <em>predicates</em>, which
allow you to check if a value is a member of certain sets;  also,
the primitive functions will check at run-time if the arguments
are members of the allowed sets.  Other languages, including Java
and Common Lisp, provide a combination:  Types may be used as specifiers
to guide the compiler, but also exist as actual run-time values.
In Java, for each class, there is a corresponding <code>java.lang.Class</code>
run-time object, as well as an associated type (the set of values
of that class, plus its sub-classes, plus <code>null</code>).
</p>
<p>Kawa, like Java, has first-class types, that is types exist as
objects you can pass around at run-time.  For each Java type,
there is a corresponding Kawa type (but not necessarily vice
versa).  It would be nice if we could represent run-time
type values using <code>java.lang.Class</code> objects, but unfortunately
that does not work very well.  One reason is that we need
to be able to refer to types and classes that do not exist yet,
because we are in the processing of compiling them.  Another
reason is that we want to be able to distinguish between different
types that are implemented using the same Java class.
</p>
<p>Various Kawa constructs require or allow a type to be specified.
Those specifications consist of <em>type expressions</em>, and a type expression
is evaluated to yield a type value.  The current Kawa compiler
is rather simple-minded, and in many places only allows simple
types that the compiler can evaluate at compile-time.
More specifically, it only allows simple <em>type names</em>
that map to primitive Java types or Java classes.
</p>
<div class="display">
<pre class="display"><span id="index-type"></span><span id="meta_002dtype"></span><var>type</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-opt_002dtype_002dspecifier"></span><span id="meta_002dopt_002dtype_002dspecifier"></span><var>opt-type-specifier</var> <tt>::=</tt> [<code><b>::</b></code> <a href="#meta_002dtype"><var>type</var></a>]
</pre></div>


<ul class="section-toc">
<li><a href="#Standard-Types" accesskey="1">Standard Types</a></li>
<li><a href="#Parameterized-Types" accesskey="2">Parameterized Types</a></li>
<li><a href="#Type-tests-and-conversions" accesskey="3">Type tests and conversions</a></li>
</ul>
<hr>
<div class="section" id="Standard-Types">
<div class="header">
<p>
Next: <a href="#Parameterized-Types" accesskey="n" rel="next">Parameterized Types</a>, Up: <a href="#Types" accesskey="u" rel="up">Types</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Standard-Types-1"></span><h3 class="section">18.1 Standard Types</h3>

<p>These types are predefined with the following names.
</p>
<p>Instead of plain <code><var>typename</var></code> you can also use
the syntax <code>&lt;<var>typename</var>&gt;</code> with angle brackets,
but that syntax is no longer recommended, because it doesn&rsquo;t
&ldquo;fit&rdquo; as well with some ways type names are used.
</p>
<p>To find which Java classes these types map into, look in
<code>kawa/standard/Scheme.java</code>.
</p>
<p>Note that the value of these variables are instances
of <code>gnu.bytecode.Type</code>,
not (as you might at first expect) <code>java.lang.Class</code>.
</p>
<p>The numeric types (<code>number</code>, <code>quantity</code>,
<code>complex</code>, <code>real</code>, <code>rational</code>, <code>integer</code>,
<code>long</code>, <code>int</code>, <code>short</code>, <code>byte</code>
<code>ulong</code>, <code>uint</code>, <code>ushort</code>, <code>ubyte</code>,
<code>double</code>, <code>float</code>)
are discussed in <a href="#Numerical-types">Numerical types</a>.
</p>
<p>The types <code>character</code> and <code>char</code>
are discussed in <a href="#Characters">Characters</a>.
</p>
<dl class="def">
<dt id="index-Object"><span class="category">Variable: </span><span><strong>Object</strong><a href='#index-Object' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An arbitrary Scheme value - and hence an arbitrary Java object.
</p></dd></dl>

<dl class="def">
<dt id="index-symbol-3"><span class="category">Variable: </span><span><strong>symbol</strong><a href='#index-symbol-3' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme symbols.
(Implemented using the Java class <code>gnu.mapping.Symbol</code>.)
(<em>Compatibility:</em> Previous versions of Kawa implemented
a simple Scheme symbol using an interned <code>java.lang.String</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-keyword-1"><span class="category">Variable: </span><span><strong>keyword</strong><a href='#index-keyword-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of keyword values.  See <a href="#Keywords">Keywords</a>.
</p></dd></dl>

<dl class="def">
<dt id="index-list-1"><span class="category">Variable: </span><span><strong>list</strong><a href='#index-list-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme lists (pure and impure, including the empty list).
</p></dd></dl>

<dl class="def">
<dt id="index-pair"><span class="category">Variable: </span><span><strong>pair</strong><a href='#index-pair' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme pairs.  This is a sub-type of <code>list</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-string-3"><span class="category">Variable: </span><span><strong>string</strong><a href='#index-string-3' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme strings.
(Implemented using <code>java.lang.String</code> for immutable strings,
and <code>gnu.lists.FString</code> for mutable strings.
Both of these implement the interface <code>java.lang.CharSequence</code>.
In the future, we may change the representation for strings
containing &ldquo;surrogate characters&rdquo;, for efficient indexing.)
(<em>Compatibility:</em> Previous versions of Kawa
always used <code>gnu.lists.FString</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-character-2"><span class="category">Variable: </span><span><strong>character</strong><a href='#index-character-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme character values.  This is a sub-type of
<code>Object</code>, in contrast to type <code>char</code>, which is the
primitive Java <code>char</code> type.
</p></dd></dl>

<dl class="def">
<dt id="index-vector-3"><span class="category">Variable: </span><span><strong>vector</strong><a href='#index-vector-3' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme vectors.
</p></dd></dl>

<dl class="def">
<dt id="index-procedure"><span class="category">Variable: </span><span><strong>procedure</strong><a href='#index-procedure' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme procedures.
</p></dd></dl>

<dl class="def">
<dt id="index-input_002dport"><span class="category">Variable: </span><span><strong>input-port</strong><a href='#index-input_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme input ports.
</p></dd></dl>

<dl class="def">
<dt id="index-output_002dport"><span class="category">Variable: </span><span><strong>output-port</strong><a href='#index-output_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The type of Scheme output ports.
</p></dd></dl>

<dl class="def">
<dt id="index-String"><span class="category">Variable: </span><span><strong>String</strong><a href='#index-String' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This type name is a special case.  It specifies the class
<code>java.lang.String</code>.
However, coercing a value to <code>String</code> is done by
invoking the <code>toString</code> method on the value to be coerced.
Thus it &quot;works&quot; for all objects.
It also works for <code>#!null</code>.
</p>
<p>When Scheme code invokes a Java method, any parameter
whose type is <code>java.lang.String</code> is converted
as if it was declared as a <code>String</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-parameter"><span class="category">Variable: </span><span><strong>parameter</strong><a href='#index-parameter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A parameter object, as created by <code>make-parameter</code>.
This type can take a type parameter (sic):
</p><div class="example">
<pre class="example">(define-constant client ::parameter[Client] (make-parameter #!null))
</pre></div>
<p>This lets Kawa know that reading the parameter (as in <code>(client)</code>)
returns a value of the specified type (in this case <code>Client</code>).
</p></dd></dl>

<p>More will be added later.
</p>
<p>A type specifier can also be one of the primitive Java types.
The numeric types <code>long</code>, <code>int</code>, <code>short</code>,
<code>byte</code>, <code>float</code>, and <code>double</code> are converted from the
corresponding Scheme number classes.  Similarly, <code>char</code>
can be converted to and from Scheme characters.  The type
<code>boolean</code> matches any object, and the result is <code>false</code>
if and only if the actual argument is <code>#f</code>.
(The value <code>#f</code> is identical to <code>Boolean.FALSE</code>,
and <code>#t</code> is identical to <code>Boolean.TRUE</code>.)
The return type <code>void</code> indicates that no value is returned.
</p>
<p>A type specifier can also be a fully-qualified Java class name
(for example <code>java.lang.StringBuffer</code>).  In that case,
the actual argument is cast at run time to the named class.
Also, <code>java.lang.StringBuffer[]</code> represents
an array of references to <code>java.lang.StringBuffer</code> objects.
</p>
<span id="dynamic_002dtype"></span><dl class="def">
<dt id="index-dynamic"><span class="category">Variable: </span><span><strong>dynamic</strong><a href='#index-dynamic' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Used to specify that the type is unknown, and is likely to change
at run-time.
Warnings about unknown member names are supressed
(a run-time name lookup is formed).
An expression of type <code>dynamic</code> is (statically) compatible with
any type.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Parameterized-Types">
<div class="header">
<p>
Next: <a href="#Type-tests-and-conversions" accesskey="n" rel="next">Type tests and conversions</a>, Previous: <a href="#Standard-Types" accesskey="p" rel="prev">Standard Types</a>, Up: <a href="#Types" accesskey="u" rel="up">Types</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Parameterized-Types-1"></span><h3 class="section">18.2 Parameterized Types</h3>
<p>Kawa has some basic support for parameterized (generic) types.
The syntax:
</p><div class="example">
<pre class="example">Type[Arg1 Arg2 ... ArgN]
</pre></div>
<p>is more-or-less equivalent to Java&rsquo;s:
</p><div class="example">
<pre class="example">Type&lt;Arg1, Arg2, ..., ArgN&gt;
</pre></div>

<p>This is a work-in-progress.  You can use this syntax with
fully-qualified class names, and also type aliases:
</p><div class="example">
<pre class="example">(define v1 ::gnu.lists.FVector[gnu.math.IntNum] [4 5 6])
(define-alias fv gnu.lists.FVector)
(define v2 ::fv[integer] [5 6 7])
(define-alias fvi fv[integer])
(define v3 ::fvi [6 7 8])
</pre></div>

<hr>
</div>
<div class="section" id="Type-tests-and-conversions">
<div class="header">
<p>
Previous: <a href="#Parameterized-Types" accesskey="p" rel="prev">Parameterized Types</a>, Up: <a href="#Types" accesskey="u" rel="up">Types</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Type-tests-and-conversions-1"></span><h3 class="section">18.3 Type tests and conversions</h3>

<p>Scheme defines a number of standard type testing predicates.
For example <code>(vector? x)</code> is <code>#t</code> if and only if
<code>x</code> is a vector.
</p>
<p>Kawa generalizes this to arbitrary type names:
If <var>T</var> is a type-name (that is in scope at compile-time),
then <code><var>T</var>?</code> is a one-argument function that returns
<code>#t</code> if the argument is an instance of the type <code><var>T</var></code>,
and <code>#f</code> otherwise:
</p><div class="example">
<pre class="example">(gnu.lists.FVector? #(123)) &rArr; #t
(let ((iarr (int[] 10))) (int[]? iarr)) &rArr; #t 
</pre></div>

<p>To convert (coerce) the result of an expression <var>value</var> to a
type <var>T</var> use the syntax: <code>(-&gt;<var>T</var> <var>value</var>)</code>.
</p><div class="example">
<pre class="example">(-&gt;float 12) &rArr; 12.0f0
</pre></div>

<p>In general:
</p><div class="example">
<pre class="example">(<var>T</var>? <var>x</var>) &rArr; (instance? <var>x</var> <var>T</var>)
(-&gt;<var>T</var> <var>x</var>) &rArr; (as <var>T</var> <var>x</var>)
</pre></div>

<dl class="def">
<dt id="index-instance_003f"><span class="category">Procedure: </span><span><strong>instance?</strong> <em>value type</em><a href='#index-instance_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns <code>#t</code> iff <var>value</var> is an instance of type <var>type</var>.
(Undefined if <var>type</var> is a primitive type, such as <code>int</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-as"><span class="category">Procedure: </span><span><strong>as</strong> <em>type value</em><a href='#index-as' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Converts or coerces <var>value</var> to a value of type <var>type</var>.
Throws an exception if that cannot be done.
Not supported for <var>type</var> to be a primitive type such as <code>int</code>.
</p></dd></dl>

<hr>
</div>
</div>
<div class="chapter" id="Objects-Classes-and-Modules">
<div class="header">
<p>
Next: <a href="#XML-tools" accesskey="n" rel="next">Working with XML and HTML</a>, Previous: <a href="#Types" accesskey="p" rel="prev">Types</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Object_002c-Classes-and-Modules"></span><h2 class="chapter">19 Object, Classes and Modules</h2>

<p>Kawa provides various ways to define, create, and access Java objects.
Here are the currently supported features.
</p>
<p>The Kawa module system is based on the features of the Java class system.
</p>

<dl class="def">
<dt id="index-this"><span class="category">Syntax: </span><span><strong>this</strong><a href='#index-this' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the &quot;this object&quot; - the current instance of the current class.
The current implementation is incomplete, not robust, and not
well defined.  However, it will have to do for now.
Note:  &quot;<code>this</code>&quot; is a macro, not a variable, so you have to write
it using parentheses: &lsquo;<samp>(this)</samp>&rsquo;.  A planned extension will
allow an optional class specifier (needed for nested clases).
</p></dd></dl>

<ul class="section-toc">
<li><a href="#Defining-new-classes" accesskey="1">Defining new classes</a></li>
<li><a href="#Anonymous-classes" accesskey="2">Anonymous classes</a></li>
<li><a href="#Enumerations" accesskey="3">Enumeration types</a></li>
<li><a href="#Annotations" accesskey="4">Annotations of declarations</a></li>
<li><a href="#Module-classes" accesskey="5">Modules and how they are compiled to classes</a></li>
<li><a href="#Importing" accesskey="6">Importing from a library</a></li>
<li><a href="#Record-types" accesskey="7">Record types</a></li>
<li><a href="#Dynamic-records" accesskey="8">Creating New Record Types On-the-fly</a></li>
<li><a href="#Method-operations" accesskey="9">Calling Java methods from Scheme</a></li>
<li><a href="#Allocating-objects">Allocating objects</a></li>
<li><a href="#Field-operations">Accessing object fields</a></li>
<li><a href="#Mangling">Mapping Scheme names to Java names</a></li>
<li><a href="#Scheme-types-in-Java">Scheme types in Java</a></li>
<li><a href="#Array-operations">Using Java Arrays</a></li>
<li><a href="#Loading-Java-functions-into-Scheme">Loading Java functions into Scheme</a></li>
<li><a href="#Evaluating-Scheme-expressions-from-Java">Evaluating Scheme expressions from Java</a></li>
</ul>
<hr>
<div class="section" id="Defining-new-classes">
<div class="header">
<p>
Next: <a href="#Anonymous-classes" accesskey="n" rel="next">Anonymous classes</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Defining-new-classes-1"></span><h3 class="section">19.1 Defining new classes</h3>

<p>Kawa provides various mechanisms for defining new classes.
The <code>define-class</code> and <code>define-simple-class</code> forms
will usually be the preferred mechanisms.  They have basically
the same syntax, but have a couple of differences.
<code>define-class</code> allows multiple inheritance as well as true nested
(first-class) class objects.  However, the implementation
is more complex: code using it is slightly slower, and the mapping to
Java classes is a little less obvious.   (Each Scheme class is implemented
as a pair of an interface and an implementation class.)
A class defined by <code>define-simple-class</code> is slightly more
efficient, and it is easier to access it from Java code.
</p>
<p>The syntax of <code>define-class</code> are mostly compatible with that
in the Guile and Stk dialects of Scheme.
</p>
<dl class="def">
<dt id="index-define_002dclass"><span class="category">Syntax: </span><span><strong>define-class</strong> <em><a href="#meta_002dclass_002dname"><var>class-name</var></a> <code><b>(</b></code>supers ...<code><b>)</b></code> (<a href="#meta_002dannotation"><var>annotation</var></a>|<a href="#meta_002doption_002dpair"><var>option-pair</var></a>)<sup>*</sup> <a href="#meta_002dfield_002dor_002dmethod_002ddecl"><var>field-or-method-decl</var></a> ...</em><a href='#index-define_002dclass' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-define_002dsimple_002dclass"><span class="category">Syntax: </span><span><strong>define-simple-class</strong> <em><a href="#meta_002dclass_002dname"><var>class-name</var></a> <code><b>(</b></code>supers ...<code><b>)</b></code> (<a href="#meta_002dannotation"><var>annotation</var></a>|<a href="#meta_002doption_002dpair"><var>option-pair</var></a>)<sup>*</sup>  <a href="#meta_002dfield_002dor_002dmethod_002ddecl"><var>field-or-method-decl</var></a> ...</em><a href='#index-define_002dsimple_002dclass' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Defines a new class named <var>class-name</var>.  If <code>define-simple-class</code> is
used, creates a normal Java class named <var>class-name</var> in the current package.
(If <var>class-name</var> has the form <code>&lt;xyz&gt;</code> the Java implementation
type is named <code>xyz</code>.)  For <code>define-class</code> the implementation is
unspecified.  In most cases, the compiler creates a class pair,
consisting of a Java interface and a Java implementation class.
</p></dd></dl>
<div class="display">
<pre class="display"><span id="index-class_002dname"></span><span id="meta_002dclass_002dname"></span><var>class-name</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-option_002dpair"></span><span id="meta_002doption_002dpair"></span><var>option-pair</var> <tt>::=</tt> <var>option-keyword</var> <var>option-value</var>
<span id="index-field_002dor_002dmethod_002ddecl"></span><span id="meta_002dfield_002dor_002dmethod_002ddecl"></span><var>field-or-method-decl</var> <tt>::=</tt> <a href="#meta_002dfield_002ddecl"><var>field-decl</var></a> | <a href="#meta_002dmethod_002ddecl"><var>method-decl</var></a>
</pre></div>

<ul class="section-toc">
<li><a href="#General-class-properties" accesskey="1">General class properties</a></li>
<li><a href="#Declaring-fields" accesskey="2">Declaring fields</a></li>
<li><a href="#Declaring-methods" accesskey="3">Declaring methods</a></li>
<li><a href="#Example" accesskey="4">Example</a></li>
</ul>
<div class="subsection" id="General-class-properties">
<h4 class="subsection">19.1.1 General class properties</h4>

<p>The class inherits from the classes and interfaces listed in <var>supers</var>.
This is a list of names of classes that are in scope (perhaps imported
using <code>require</code>), or names for existing classes or interfaces
optionally surrounded by <code>&lt;&gt;</code>, such as <code>&lt;gnu.lists.Sequence&gt;</code>.
If <code>define-simple-class</code> is used, at most one of these may be
the name of a normal Java class or classes defined using
<code>define-simple-class</code>; the rest must be interfaces or classes
defined using <code>define-class</code>.
If <code>define-class</code> is used, <em>all</em> of the classes listed
in <var>supers</var> should be interfaces or classes defined using
<code>define-class</code>.
</p>
<dl compact="compact">
<dt><span><code><b>interface:</b></code> <var>make-interface</var></span></dt>
<dd><p>Specifies whether Kawa generates a Java class, interface, or both.
If <var>make-interface</var> is <code>#t</code>, then a Java interface is generated.
In that case all the supertypes must be interfaces, and
all the declared methods must be abstract.
If <var>make-interface</var> is <code>#f</code>, then a Java class is generated.
If <code>interface:</code>  is unspecified, the default is <code>#f</code>
for <code>define-simple-class</code>.  For <code>define-class</code> the default
is to generate an interface, and in addition (if needed) a helper
class that implements the interface.  (In that case any non-abstract methods
are compiled to static methods.  The methods that implement the interface
are just wrapper methods that call the real static methods.  This
allows Kawa to implement true multiple inheritance.)
</p>
</dd>
<dt><span><code><b>access:</b></code> <var>kind</var></span></dt>
<dd><p>Specifies the Java access permission on the class.
Can be one of <code>'public</code> (which is the default in Kawa),
<code>'package</code> (which the default &quot;unnamed&quot; permission in Java code),
<code>'protected</code>, <code>'private</code>,
<code>'volatile</code>, or <code>'transient</code>.
Can also be used to specify <code>final</code>, <code>abstract</code>, or <code>enum</code>, as in Java.
(You don&rsquo;t need to explicitly specify the class is <code>abstract</code>
if any <var>method-body</var> is <code>#!abstract</code>,
or you specify <code>interface: #t</code>.)
The <var>kind</var> can also be a list, as for example:
</p><div class="example">
<pre class="example">access: '(protected volatile)
</pre></div>

</dd>
<dt><span><code><b>class-name:</b></code> <code>&quot;</code><var>cname</var><code>&quot;</code></span></dt>
<dd><p>Specifies the Java name of the created class.
The <var>name</var> specified after <code>define-class</code>
or <code>define-simple-class</code> is the <em>Scheme name</em>,
i.e. the name of a Scheme variable that is bound to the class.
The Java name is by default derived from the Scheme name,
but you can override the default with a <code>class-name:</code> specifier.
If the <var>cname</var> has no periods, then it is a name in
the package of the main (module) class.
If the <var>cname</var> starts with a period,
then you get a class nested within the module class.
In this case the actual class name is <var>moduleClass</var><code>$</code><var>rname</var>,
where <var>rname</var> is <var>cname</var> without the initial period.
To force a class in the top-level (unnamed) package (something
not recommended) write a period at the end of the <var>cname</var>.
</p></dd>
</dl>

</div>
<div class="subsection" id="Declaring-fields">
<h4 class="subsection">19.1.2 Declaring fields</h4>

<div class="display">
<pre class="display"><span id="index-field_002ddecl"></span><span id="meta_002dfield_002ddecl"></span><var>field-decl</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a> (<a href="#meta_002dannotation"><var>annotation</var></a> | <a href="#meta_002dopt_002dtype_002dspecifier"><var>opt-type-specifier</var></a> | <a href="#meta_002dfield_002doption"><var>field-option</var></a>)*<code><b>)</b></code>
<span id="index-field_002dname"></span><span id="meta_002dfield_002dname"></span><var>field-name</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-field_002doption"></span><span id="meta_002dfield_002doption"></span><var>field-option</var> <tt>::=</tt> <a href="#meta_002dkeyword"><var>keyword</var></a> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>As a matter of style the following order is suggested, though this not enforced:
</p><div class="display">
<pre class="display"><code><b>(</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a> <a href="#meta_002dannotation"><var>annotation</var></a>* <a href="#meta_002dopt_002dtype_002dspecifier"><var>opt-type-specifier</var></a> <a href="#meta_002dfield_002doption"><var>field-option</var></a>*<code><b>)</b></code>
</pre></div>

<p>Each <var>field-decl</var> declares a instance &quot;slot&quot; (field)
with the given <var>field-name</var>. 
By default it is publicly visible, but you can specify
a different visiblity with the <code>access:</code> specifier.
The following <var>field-option</var> <var>keyword</var>s are implemented:
</p><dl compact="compact">
<dt><span><code><b>type:</b></code> <a href="#meta_002dtype"><var>type</var></a></span></dt>
<dd><p>Specifies that <var>type</var> is the type of (the values of) the field.
Equivalent to &lsquo;<samp>:: <var>type</var></samp>&rsquo;.
</p></dd>
<dt><span><code><b>allocation:</b></code> <var>kind</var></span></dt>
<dd><p>If <var>kind</var> is <code>'class</code> or <code>'static</code> a single slot is shared
between all instances of the class (and its sub-classes).
Not yet implemented for <code>define-class</code>,
only for <code>define-simple-class</code>.
In Java terms this is a <code>static</code> field.
</p>
<p>If <var>kind</var> is <code>'instance</code> then
each instance has a separate value &quot;slot&quot;, and they
are not shared. In Java terms, this is a non-<code>static</code> field.
This is the default.
</p>
</dd>
<dt><span><code><b>access:</b></code> <var>kind</var></span></dt>
<dd><p>Specifies the Java access permission on the field.
Can be one of <code>'private</code>, <code>'protected</code>,
<code>'public</code> (which is the default in Kawa),
or <code>'package</code> (which the default &quot;unnamed&quot; permission
in Java code).
Can also be used to specify <code>volatile</code>, <code>transient</code>,
<code>enum</code>, or <code>final</code>, as in Java,
or a quoted list with these symbols.
</p></dd>
<dt><span><code><b>init:</b></code> <var>expr</var></span></dt>
<dd><p>An expression used to initialize the slot.
The expression is evaluated in a scope that includes the field and
method names of the current class.
</p></dd>
<dt><span><code><b>init-form:</b></code> <var>expr</var></span></dt>
<dd><p>An expression used to initialize the slot.
The lexical environment of the <var>expr</var> is that of the <code>define-class</code>;
it does <em>not</em> include the field and method names of the current class.
or <code>define-simple-class</code>.
</p></dd>
<dt><span><code><b>init-value:</b></code> <var>value</var></span></dt>
<dd><p>A value expression used to initialize the slot.
For now this is synonymous with <var>init-form:</var>, but that may change
(depending on what other implementation do), so to be safe only use
<code>init-value:</code> with a literal.
</p></dd>
<dt><span><code><b>init-keyword:</b></code> <code><var>name</var>:</code></span></dt>
<dd><p>A keyword that that can be used to initialize instance in <code>make</code> calls.
For now, this is ignored, and <var>name</var> should be the same as the
field&rsquo;s <var>field-name</var>.
</p></dd>
</dl>

<p>The <var>field-name</var> can be left out.  That indicates a &quot;dummy slot&quot;,
which is useful for initialization not tied to a specific field.
In Java terms this is an instance or static initializer, i.e., a
block of code executed when a new instance is created or the class is loaded.
</p>
<p>In this example, <code>x</code> is the only actual field.  It is first
initialized to 10, but if <code>(some-condition)</code> is true
then its value is doubled.
</p><div class="example">
<pre class="example">(define-simple-class &lt;my-class&gt; ()
  (allocation: 'class
   init: (perform-actions-when-the-class-is-initizalized))
  (x init: 10)
  (init: (if (some-condition) (set! x (* x 2)))))
</pre></div>

</div>
<div class="subsection" id="Declaring-methods">
<h4 class="subsection">19.1.3 Declaring methods</h4>

<div class="display">
<pre class="display"><span id="index-method_002ddecl"></span><span id="meta_002dmethod_002ddecl"></span><var>method-decl</var> <tt>::=</tt> <code><b>((</b></code><a href="#meta_002dmethod_002dname"><var>method-name</var></a> <a href="#meta_002dformal_002darguments"><var>formal-arguments</var></a><code><b>)</b></code>
    <a href="#meta_002dmethod_002doption"><var>method-option</var></a><sup>*</sup> [<a href="#meta_002ddeprecated_002dreturn_002dspecifier"><var>deprecated-return-specifier</var></a>] <a href="#meta_002dmethod_002dbody"><var>method-body</var></a><code><b>)</b></code>
<span id="index-method_002dname"></span><span id="meta_002dmethod_002dname"></span><var>method-name</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-method_002doption"></span><span id="meta_002dmethod_002doption"></span><var>method-option</var> <tt>::=</tt> <a href="#meta_002dannotation"><var>annotation</var></a> | <a href="#meta_002dopt_002dreturn_002dtype"><var>opt-return-type</var></a> | <a href="#meta_002doption_002dpair"><var>option-pair</var></a>
<span id="index-method_002dbody"></span><span id="meta_002dmethod_002dbody"></span><var>method-body</var> <tt>::=</tt> <a href="#meta_002dbody"><var>body</var></a> | <code><b>#!abstract</b></code> | <code><b>#!native</b></code>
<span id="index-deprecated_002dreturn_002dspecifier"></span><span id="meta_002ddeprecated_002dreturn_002dspecifier"></span><var>deprecated-return-specifier</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>

<p>Each <var>method-decl</var> declares a method,
which is by default public and non-static, and whose name is <var>method-name</var>.
(If <var>method-name</var> is not a valid
Java method name, it is mapped to something reasonable.
For example <code>foo-bar?</code> is mapped to <code>isFooBar</code>.)
The types of the method arguments can be specified in the
<var>formal-arguments</var>.  The return type can be specified by
a <var>opt-return-type</var>, <var>deprecated-return-specifier</var>,
or is otherwise the type of the <var>body</var>.
Currently, the <var>formal-arguments</var> cannot contain optional, rest,
or keyword parameters.  (The plan is to allow optional parameters,
implemented using multiple overloaded methods.)
</p>
<p>A <var>method-decl</var> in a <code>define-simple-class</code>
can have the following <var>option-keyword</var>s:
</p><dl compact="compact">
<dt><span><code><b>access:</b></code> <var>kind</var></span></dt>
<dd><p>Specifies the Java access permission on the method.
Can be one of <code>'private</code>, <code>'protected</code>,
<code>'public</code>, or <code>'package</code>.
Can also be <code>'synchronized</code>, <code>'final</code>, <code>'strictfp</code>,
or a quoted list.
</p></dd>
<dt><span><code><b>allocation:</b></code> <var>kind</var></span></dt>
<dd><p>If <var>kind</var> is <code>'class</code> or <code>'static</code> creates a static method.
</p></dd>
<dt><span><code><b>throws:</b></code> ( <var>exception-class-name</var> ... )</span></dt>
<dd><p>Specifies a list of checked exception that the method may throw.
Equivalent to a <code>throws</code> specification in Java code.
For example:
</p><div class="example">
<pre class="example">(define-simple-class T
  (prefix)
  ((lookup name) throws: (java.io.FileNotFoundException)
   (make java.io.FileReader (string-append prefix name))))
</pre></div>
</dd>
</dl>

<p>The scope of the <var>body</var> of a method includes the <var>field-decl</var>s
and <var>method-decl</var>s of the class, including those inherited from
superclasses and implemented interfaces.
</p>
<p>If the <var>method-body</var> is the special form <code>#!abstract</code>,
then the method is abstract.  This means the method must
be overridden in a subclass, and you&rsquo;re not allowed to
create an instance of the enclosing class.
</p>
<div class="example">
<pre class="example">(define-simple-class Searchable () interface: #t
  ((search value) :: boolean #!abstract))
</pre></div>

<p>If the <var>method-body</var> is the special form <code>#!native</code>,
then the method is native, implemented using <a href="http://en.wikipedia.org/wiki/Java_Native_Interface">JNI</a>.
</p>
<p>The special <var>method-name</var> &lsquo;<samp>*init*</samp>&rsquo; can be used to name
a non-default constructor (only if <var>make-interface</var> discussed above
is <code>#f</code>).
It can be used to initialize a freshly-allocated instance
using passed-in parameters.
You can call a superclass or a sibling constructor using
the <code>invoke-special</code> special function.
(This is general but admittedly a bit verbose; a more compact
form may be added in the future.)
See the example below.
</p>
</div>
<div class="subsection" id="Example">
<h4 class="subsection">19.1.4 Example</h4>

<p>In the following example we define a simple class <code>2d-vector</code>
and a class <code>3d-vector</code> that extends it.  (This is for illustration
only - defining 3-dimensional points as an extension
of 2-dimensional points does not really make sense.)
</p>
<div class="example">
<pre class="example">(define-simple-class 2d-vector ()
  (x ::double init-keyword: x:)
  ;; Alternative type-specification syntax.
  (y type: double init-keyword: y:)
  (zero-2d :: 2d-vector allocation: 'static
   init-value: (2d-vector 0))
  ;; An object initializer (constructor) method.
  ((*init* (x0 ::double) (y0 ::double))
   (set! x x0)
   (set! y y0))
  ((*init* (xy0 ::double))
   ;; Call above 2-argument constructor.
   (invoke-special 2d-vector (this) '*init* xy0 xy0))
  ;; Need a default constructor as well.
  ((*init*) #!void)
  ((add (other ::2d-vector)) ::2d-vector
   ;; Kawa compiles this using primitive Java types!
   (2d-vector
     x: (+ x other:x)
     y: (+ y other:y)))
  ((scale (factor ::double)) ::2d-vector
   (2d-vector x: (* factor x) y: (* factor y))))

(define-simple-class 3d-vector (2d-vector)
  (z type: double init-value: 0.0 init-keyword: z:)
  ;; A constructor which calls the superclass constructor.
  ((*init* (x0 ::double) (y0 ::double) (z0 ::double))
   (invoke-special 2d-vector (this) '*init* x0 y0)
   (set! z z0))
  ;; Need a default constructor.
  ((*init*) #!void)
  ((scale (factor ::double)) ::2d-vector
   ;; Note we cannot override the return type to 3d-vector
   ;; because Kawa doesn't yet support covariant return types.
   (3d-vector
     x: (* factor x)
     y: (* factor (this):y) ;; Alternative syntax.
     z: (* factor z))))
</pre></div>

<p>Note we define both explicit non-default constructor methods,
and we associate fields with keywords, so they can be named
when allocating an object.  Using keywords requires a default constructor,
and since having non-default constructors suppresses
the implicit default constructor we have to explicitly define it.
Using both styles of constructors is rather redundant, though.
</p>
<hr>
</div>
</div>
<div class="section" id="Anonymous-classes">
<div class="header">
<p>
Next: <a href="#Enumerations" accesskey="n" rel="next">Enumeration types</a>, Previous: <a href="#Defining-new-classes" accesskey="p" rel="prev">Defining new classes</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Anonymous-classes-1"></span><h3 class="section">19.2 Anonymous classes</h3>

<dl class="def">
<dt id="index-object"><span class="category">Syntax: </span><span><strong>object</strong> <em><code><b>(</b></code>supers ...<code><b>)</b></code> field-or-method-decl ...</em><a href='#index-object' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new instance of an anonymous (inner) class.
The syntax is similar to <code>define-class</code>.
</p><div class="display">
<pre class="display"><span id="index-object_002dfield_002dor_002dmethod_002ddecl"></span><span id="meta_002dobject_002dfield_002dor_002dmethod_002ddecl"></span><var>object-field-or-method-decl</var> <tt>::=</tt> <a href="#meta_002dobject_002dfield_002ddecl"><var>object-field-decl</var></a> | <a href="#meta_002dmethod_002ddecl"><var>method-decl</var></a>
<span id="index-object_002dfield_002ddecl"></span><span id="meta_002dobject_002dfield_002ddecl"></span><var>object-field-decl</var> <tt>::=</tt> <code><b>(</b></code><a href="#meta_002dfield_002dname"><var>field-name</var></a> (<a href="#meta_002dannotation"><var>annotation</var></a> | <a href="#meta_002dopt_002dtype_002dspecifier"><var>opt-type-specifier</var></a> | <a href="#meta_002dfield_002doption"><var>field-option</var></a>)*  [<a href="#meta_002dobject_002dinit"><var>object-init</var></a>] <code><b>)</b></code>
<span id="index-object_002dinit"></span><span id="meta_002dobject_002dinit"></span><var>object-init</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>Returns a new instance of a unique (anonymous) class.
The class inherits from the list of <var>supers</var>, where at most one of the
elements should be the base class being extended from, and the rest
are interfaces.
</p>
<p>This is roughly equivalent to:
</p><div class="example">
<pre class="example">(begin
  (define-simple-class <var>hname</var> (<var>supers</var> ...) <var>field-or-method-decl</var> ...)
  (make <var>hname</var>))
</pre></div>

<p>A <var>field-decl</var> is as for <code>define-class</code>, except
that we also allow an abbreviated syntax.
Each <var>field-decl</var> declares a public instance field.
If <var>object-finit</var> is given, it is an expression whose value
becomes the initial value of the field.
The <var>object-init</var> is evaluated at the same time as the <code>object</code>
expression is evaluated,
in a scope where all the <var>field-name</var>s are visible.
</p>
<p>A <var>method-decl</var> is as for <code>define-class</code>.
</p></dd></dl>

<span id="SAM_002dconversion"></span><ul class="section-toc">
<li><a href="#Lambda-as-shorthand-for-anonymous-class" accesskey="1">Lambda as shorthand for anonymous class</a></li>
</ul>
<div class="subsection" id="Lambda-as-shorthand-for-anonymous-class">
<h4 class="subsection">19.2.1 Lambda as shorthand for anonymous class</h4>
<p>An anonymous class is commonly used in the Java platform where a
function language would use a lambda expression.
Examples are call-back handlers, events handlers, and <code>run</code> methods.
In these cases Kawa lets you use a lambda expression as a short-hand
for an anonymous class.  For example:
</p><div class="example">
<pre class="example">(button:addActionListener
  (lambda (e) (do-something)))
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(button:addActionListener
  (object (java.awt.event.ActionListener)
    ((actionPerformed (e ::java.awt.event.ActionEvent))::void
     (do-something))))
</pre></div>
<p>This is possible when the required type is an interface or
abstract class with a Single (exactly one) Abstract Methods.
Such a class is sometypes called a <em>SAM-type</em>, and the
conversion from a lambda expression to an anonymous class
is sometimes called <em>SAM-conversion</em>.
</p>
<p>Note that Kawa can also infer the parameter and return types
of a method that overrides a method in a super-class.
</p>
<hr>
</div>
</div>
<div class="section" id="Enumerations">
<div class="header">
<p>
Next: <a href="#Annotations" accesskey="n" rel="next">Annotations of declarations</a>, Previous: <a href="#Anonymous-classes" accesskey="p" rel="prev">Anonymous classes</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Enumeration-types"></span><h3 class="section">19.3 Enumeration types</h3>

<p>An enumeration type is a set of named atomic enumeration values
that are distinct from other values.  You define the type
using <code>define-enum</code>, and you reference enumeration values
using colon notation:
</p><div class="example">
<pre class="example">(define-enum colors (red blue green))
(define favorite-color colors:green)
</pre></div>
<p>Displaying an enum just prints the enum name,
but readable output using <code>write</code> (or the <code>~s</code> <code>format</code>
specifier) prepends the type name:
</p><div class="example">
<pre class="example">(format &quot;~a&quot; favorite-color) &rArr; &quot;green&quot;
(format &quot;~s&quot; favorite-color) &rArr; &quot;colors:green&quot;
</pre></div>
<p>The static <code>values</code> method returns a Java array of the enumeration
values, in declaration order, while <code>ordinal</code> yields the index
of an enumeration value:
</p><div class="example">
<pre class="example">(colors:values) &rArr; [red blue green]
((colors:values) 1) &rArr; blue
(favorite-color:ordinal) &rArr; 2
</pre></div>
<p>If you invoke the enumeration type as a function,
it will map the name (as a string) to the corresponding value.
(This uses the <code>valueOf</code> method.)
</p><div class="example">
<pre class="example">(colors &quot;red&quot;) &rArr; red
(colors &quot;RED&quot;) &rArr; throws IllegalArgumentException
(eq? favorite-color (colors:valueOf &quot;green&quot;)) &rArr; #t
</pre></div>

<p>Kawa enumerations are based on Java enumerations.
Thus the above is similar to a Java5 <code>enum</code> declaration,
and the type <code>colors</code> above extends <code>java.lang.Enum</code>.
</p>
<dl class="def">
<dt id="index-define_002denum"><span class="category">Syntax: </span><span><strong>define-enum</strong> <em>enum-type-name <var>option-pair</var>... <code><b>(</b></code>enum-value-name ...<code><b>)</b></code> <var>field-or-method-decl</var>...</em><a href='#index-define_002denum' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This declares a new enumeration type <var>enum-type-name</var>,
whose enumerations values are the <var>enum-value-name</var> list.
You can specify extra options and members using
<var>option-pair</var> and <var>field-or-method-decl</var>,
which are as in <code>define-simple-class</code>.
(The <var>define-enum</var> syntax is similar to a
<code>define-simple-class</code> that extends <code>java.lang.Enum</code>.)
</p></dd></dl>

<p>(Note that R6RS has a separate Enumerations library <code>(rnrs enum)</code>.
Unfortunately, this is not compatible with standard Java enums.
R6RS enums are simple symbols, which means you cannot distinguish
two enum values from different enumeration types if they have the
same value, nor from a vanilla symbol.  That makes them less useful.)
</p>
<hr>
</div>
<div class="section" id="Annotations">
<div class="header">
<p>
Next: <a href="#Module-classes" accesskey="n" rel="next">Modules and how they are compiled to classes</a>, Previous: <a href="#Enumerations" accesskey="p" rel="prev">Enumeration types</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Annotations-of-declarations"></span><h3 class="section">19.4 Annotations of declarations</h3>

<p>The Java platform lets you associate with each declaration zero or more
<a href="http://download.oracle.com/javase/1.5.0/docs/guide/language/annotations.html">annotations</a>.
They provide an extensible mechanism to associate properties
with declarations.
Kawa support for annotations is not complete (the most important
functionality missing is being able to declare annotation types),
but is fairly functional.
Here is a simple example illustrating use of
<a href="http://jcp.org/en/jsr/detail?id=222">JAXB annotations</a>:
an <code>XmlRootElement</code> annotation on a class,
and an <code>XmlElement</code> annotation on a field:
</p><div class="example">
<pre class="example">(import (class javax.xml.bind.annotation XmlRootElement XmlElement))
(define-simple-class Bib ( ) (@XmlRootElement name: &quot;bib&quot;)
  (books (@XmlElement name: &quot;book&quot; type: Book) ::java.util.ArrayList))
(define-simple-class Book () ...)
</pre></div>

<p><a href="http://per.bothner.com/blog/2011/Using-JAXB-annotations">This tutorial</a>
explains the JAXB example in depth.
</p>
<p>Here is the syntax:
</p><div class="display">
<pre class="display"><span id="index-annotation"></span><span id="meta_002dannotation"></span><var>annotation</var> <tt>::=</tt> <code><b>(@</b></code><a href="#meta_002dannotation_002dtypename"><var>annotation-typename</var></a> <a href="#meta_002dannotations_002delement_002dvalues"><var>annotations-element-values</var></a><code><b>)</b></code>
<span id="index-annotations_002delement_002dvalues"></span><span id="meta_002dannotations_002delement_002dvalues"></span><var>annotations-element-values</var> <tt>::=</tt> <a href="#meta_002dannotation_002delement_002dvalue"><var>annotation-element-value</var></a>
  | <a href="#meta_002dannotation_002delement_002dpair"><var>annotation-element-pair</var></a> ...
<span id="index-annotation_002delement_002dpair"></span><span id="meta_002dannotation_002delement_002dpair"></span><var>annotation-element-pair</var> <tt>::=</tt> <a href="#meta_002dkeyword"><var>keyword</var></a> <a href="#meta_002dannotation_002delement_002dvalue"><var>annotation-element-value</var></a>
<span id="index-annotation_002delement_002dvalue"></span><span id="meta_002dannotation_002delement_002dvalue"></span><var>annotation-element-value</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-annotation_002dtypename"></span><span id="meta_002dannotation_002dtypename"></span><var>annotation-typename</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>An <var>annotations-element-values</var> consisting of just
a single <var>annotation-element-value</var> is equivalent to an
<var>annotation-element-pair</var> with a <code>value:</code> keyword.
</p>
<p>Each <var>keyword</var> must correspond to the name of
an element (a zero-argument method) in the annotation type.
The corresponding <var>annotation-element-value</var> must be compatible with the
element type (return type of the method) of the annotation type.
</p>
<p>Allowed element types are of the following kinds:
</p><ul>
<li> Primitive types, where the <var>annotation-element-value</var> must
be number or boolean coercible to the element type.
</li><li> Strings, where the <var>annotation-element-value</var> is normally a string literal.
</li><li> Classes, where the <var>annotation-element-value</var> is normally
a classname.
</li><li> Enumeration types. The value usually has the form <code><var>ClassName</var>:<var>enumFieldname</var></code>.
</li><li> Nested annotation types, where the  <var>annotation-element-value</var> must
be a compatible <var>annotation</var> value.
</li><li> An array of one of the allowable types.
An array constructor expression works, but using the
square bracket syntax is recommended.
</li></ul>

<p>Annotations are usually used in declarations,
where they are required to be &ldquo;constant-folded&rdquo; to compile-time
constant annotation values.
This is so they can be written to class files.
However, in other contexts an annotation can be used as an expression
with general sub-expressions evaluated at run-time:
</p><div class="example">
<pre class="example">(define bk-name &quot;book&quot;)
(define be (@XmlElement name: bk-name type: Book))
(be:name) &rArr; &quot;book&quot;
</pre></div>
<p>(This may have limited usefulness:  There are some bugs, including
lack of support for default values for annotation elements.
These bugs can be fixed if someone reports a need for
runtime construction of annotation values.)
</p>
<hr>
</div>
<div class="section" id="Module-classes">
<div class="header">
<p>
Next: <a href="#Importing" accesskey="n" rel="next">Importing from a library</a>, Previous: <a href="#Annotations" accesskey="p" rel="prev">Annotations of declarations</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Modules-and-how-they-are-compiled-to-classes"></span><h3 class="section">19.5 Modules and how they are compiled to classes</h3>

<p>Modules provide a way to organize Scheme into
reusable parts with explicitly defined interfaces to the rest
of the program.
A <em>module</em> is a set of definitions that the module <em>exports</em>,
as well as some <em>actions</em> (expressions evaluated for their side effect).
The top-level forms in a Scheme source file compile a module;
the source file is the <em>module source</em>.
When Kawa compiles the module source, the result is the
<em>module class</em>.  Each exported definition is translated to
a public field in the module class.
</p>
<ul class="section-toc">
<li><a href="#Name-visibility" accesskey="1">Name visibility</a></li>
<li><a href="#R7RS-explicit-library-modules" accesskey="2">R7RS explicit library modules</a></li>
<li><a href="#How-a-module-becomes-a-class" accesskey="3">How a module becomes a class</a></li>
<li><a href="#Same-class-for-module-and-defined-class" accesskey="4">Same class for module and defined class</a></li>
<li><a href="#Static-vs-non_002dstatic-modules" accesskey="5">Static vs non-static modules</a></li>
<li><a href="#Module-options" accesskey="6">Module options</a></li>
</ul>
<div class="subsection" id="Name-visibility">
<h4 class="subsection">19.5.1 Name visibility</h4>

<p>The definitions that a module exports are accessible to other modules.
These are the &quot;public&quot; definitions, to use Java terminology.
By default, all the identifiers declared at the top-level of a module
are exported, except those defined using <code>define-private</code>.
(If compiling with the <code>--main</code> flag,
then by default no identifiers are exported.)
However, a major purpose of using modules is to control the set of
names exported.  One reason is to reduce the chance of accidental
name conflicts between separately developed modules.  An even more
important reason is to enforce an interface:  Client modules should
only use the names that are part of a documented interface, and should
not use internal implementation procedures (since those may change).
</p>
<p>If there is a <code>module-export</code> (or <code>export</code>)
declaration in the module, then only those names listed are exported.
There can be more than one <code>module-export</code>, and they can be
anywhere in the Scheme file.  The recommended style has
a single <code>module-export</code> near the beginning of the file.
</p>
<span id="meta_002dexport_002ddeclaration"></span><dl class="def">
<dt id="index-module_002dexport"><span class="category">Syntax: </span><span><strong>module-export</strong> <em><a href="#meta_002dexport_002dspec"><var>export-spec</var></a><sup>*</sup></em><a href='#index-module_002dexport' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-export"><span class="category">Syntax: </span><span><strong>export</strong> <em><a href="#meta_002dexport_002dspec"><var>export-spec</var></a><sup>*</sup></em><a href='#index-export' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The forms <code>export</code> and <code>module-export</code> are equivalent.
(The older Kawa name is <code>module-export</code>;
<code>export</code> comes from R7RS.)
Either form specifies a list of identifiers which
can be made visible to other libraries or programs.
</p><div class="display">
<pre class="display"><span id="index-export_002dspec"></span><span id="meta_002dexport_002dspec"></span><var>export-spec</var> <tt>::=</tt> <var>identifier</var>
  | <code><b>(rename</b></code> <a href="#meta_002didentifier"><var>identifier</var></a><sub>1</sub> <a href="#meta_002didentifier"><var>identifier</var></a><sub>2</sub><code><b>)</b></code>
</pre></div>
<p>In the former variant, an <var>identifier</var> names a single binding
defined within or imported into the library, where the
external name for the export is the same as the name of
the binding within the library.
A <code>rename</code> spec exports the
binding defined within or imported into the library and
named by <var>identifier</var><sub>1</sub>,
using <var>identifier</var><sub>2</sub> as the external name.
</p>
<p>Note that it is an error if there is no definition for <var>identifier</var>
(or <var>identifier</var><sub>1</sub>)
in the current module, or if it is defined using <code>define-private</code>.
</p>
<p>As a matter of style, <code>export</code> or <code>module-export</code> should
appear after <code>module-name</code> but <em>before</em> other commands
(including <code>import</code> or <code>require</code>).
(This is a requirement if there are any cycles.)
</p>
</dd></dl>

<p>In this module, <code>fact</code> is public and <code>worker</code> is private:
</p><div class="example">
<pre class="example">(module-export fact)
(define (worker x) ...)
(define (fact x) ...)
</pre></div>

<p>Alternatively, you can write:
</p><div class="example">
<pre class="example">(define-private (worker x) ...)
(define (fact x) ...)
</pre></div>

</div>
<div class="subsection" id="R7RS-explicit-library-modules">
<h4 class="subsection">19.5.2 R7RS explicit library modules</h4>

<p>A R7RS <code>define-library</code> form is another way to create a module.
The R7RS term <em>library</em> is roughly the same as a Kawa module.
In Kawa, each source file is a <a href="#implicit-library"><em>implicit module</em></a>,
which may contain zero or more explicit sub-modules (in
the form of <code>define-library</code>) optionally followed by
the definitions and expressions of the implicit (file-level) module.
</p>
<span id="meta_002dlibrary_002ddefinition"></span><span id="index-library_002ddefinition"></span>
<dl class="def">
<dt id="index-define_002dlibrary"><span class="category">Syntax: </span><span><strong>define-library</strong> <em><a href="#meta_002dlibrary_002dname"><var>library-name</var></a> <a href="#meta_002dlibrary_002ddeclaration"><var>library-declaration</var></a><sup>*</sup></em><a href='#index-define_002dlibrary' class='copiable-anchor'> &para;</a></span></dt>
</dl>
<div class="display">
<pre class="display"><span id="index-library_002dname"></span><span id="meta_002dlibrary_002dname"></span><var>library-name</var> <tt>::=</tt> <code><b>(</b></code> <a href="#meta_002dlibrary_002dname_002dparts"><var>library-name-parts</var></a> <code><b>)</b></code>
<span id="index-library_002dname_002dparts"></span><span id="meta_002dlibrary_002dname_002dparts"></span><var>library-name-parts</var> <tt>::=</tt> <var>identifier</var><sup>+</sup>
</pre></div>

<p>A <var>library-name</var> is a list whose members are identifiers and
exact non-negative integers. It is used to identify the library
uniquely when importing from other programs or
libraries. Libraries whose first identifier is <code>scheme</code> are
reserved for use by the R7RS report and future versions of that
report. Libraries whose first identifier is <code>srfi</code> are reserved
for libraries implementing <a href="http://srfi.schemer.org/">Scheme Requests for Implementation</a>.
It is inadvisable, but not an error, for identifiers
in library names to contain any of the characters <code>|</code> <code>\</code> <code>?</code>
<code>*</code> <code>&lt;</code> <code>&quot;</code> <code>:</code> <code>&gt;</code> <code>+</code> <code>[</code> <code>]</code>
<code>/</code> <code>.</code> or control characters after escapes are
expanded.
</p>
<p>See <a href="#module_002dname">module-name</a> for how a <var>library-name</var> is
mapped to a class name.
</p>
<div class="display">
<pre class="display"><span id="index-library_002ddeclaration"></span><span id="meta_002dlibrary_002ddeclaration"></span><var>library-declaration</var> <tt>::=</tt>
  <a href="#meta_002dexport_002ddeclaration"><var>export-declaration</var></a>
  | <a href="#meta_002dimport_002ddeclaration"><var>import-declaration</var></a>
  | <code><b>(begin</b></code> <a href="#meta_002dstatement"><var>statement</var></a><sup>*</sup> <code><b>)</b></code>
  | <code><b>(include</b></code> <var>filename</var><sup>+</sup><code><b>)</b></code>
  | <code><b>(include-ci</b></code> <var>filename</var><sup>+</sup><code><b>)</b></code>
  | <code><b>(include-library-declarations</b></code> <var>filename</var><sup>+</sup><code><b>)</b></code>
  | <code><b>(cond-expand</b></code> <a href="#meta_002dcond_002dexpand_002dclause"><var>cond-expand-clause</var></a><sup>*</sup> [<code><b>(else</b></code> command-or-definition*<code><b>)</b></code>]<code><b>)</b></code>
  | <a href="#meta_002dstatement"><var>statement</var></a>
</pre></div>

<p>The <code>begin</code>, <code>include</code>, and <code>include-ci</code> declarations are
used to specify the body of the library. They have the
same syntax and semantics as the corresponding expression types.
This form of <code>begin</code> is analogous to, but not the
same as regular <code>begin</code>.
A plain <var>statement</var> (which is allowed as a Kawa extension)
is also part of the body of the library,
as if it were wrapped in a <code>begin</code>).
</p>
<p>The <code>include-library-declarations</code> declaration is similar
to <code>include</code> except that the contents of the file are
spliced directly into the current library definition. This
can be used, for example, to share the same <code>export</code> declaration
among multiple libraries as a simple form of library interface.
</p>
<p>The <code>cond-expand</code> declaration has the same syntax and semantics
as the <code>cond-expand</code> expression type, except that
it expands to spliced-in library declarations rather than
expressions enclosed in <code>begin</code>.
</p>
<p>When a library is loaded, its expressions are executed in
textual order. If a library’s definitions are referenced in
the expanded form of a program or library body, then that
library must be loaded before the expanded program or
library body is evaluated. This rule applies transitively. If
a library is imported by more than one program or library,
it may possibly be loaded additional times.
</p>
<p>Similarly, during the expansion of a library <code>(foo)</code>, if any
syntax keywords imported from another library <code>(bar)</code> are
needed to expand the library, then the library <code>(bar)</code> must
be expanded and its syntax definitions evaluated before the
expansion of <code>(foo)</code>.
</p>
<p>Regardless of the number of times that a library is loaded,
each program or library that imports bindings from a library must
do so from a single loading of that library, regardless
of the number of import declarations in which it
appears. That is, <code>(import (only (foo) a</code>)) followed by
<code>(import (only (foo) b))</code> has the same effect as
<code>(import (only (foo) a b))</code>.
</p>
</div>
<div class="subsection" id="How-a-module-becomes-a-class">
<h4 class="subsection">19.5.3 How a module becomes a class</h4>

<p>If you want to just use a Scheme module as a module (i.e. <code>load</code>
or <code>require</code> it), you don&rsquo;t care how it gets translated
into a module class.  However, Kawa gives you some control over how this
is done, and you can use a Scheme module to define a class which
you can use with other Java classes.  This style of class definition
is an alternative to <code>define-class</code>,
which lets you define classes and instances fairly conveniently.
</p>
<p>The default name of the module class is the main part of the
filename of the Scheme source file (with directories and extensions
stripped off).  That can be overridden by the <code>-T</code> Kawa
command-line flag.  The package-prefix specified by the <code>-P</code>
flag is prepended to give the fully-qualified class name.
</p>
<span id="module_002dname"></span><dl class="def">
<dt id="index-module_002dname"><span class="category">Syntax: </span><span><strong>module-name</strong> <em>name</em><a href='#index-module_002dname' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-module_002dname-1"><span class="category">Syntax: </span><span><strong>module-name</strong> <em>&lt;name&gt;</em><a href='#index-module_002dname-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-module_002dname-2"><span class="category">Syntax: </span><span><strong>module-name</strong> <em><a href="#meta_002dlibrary_002dname"><var>library-name</var></a></em><a href='#index-module_002dname-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Sets the name of the generated class, overriding the default.
If there is no &lsquo;<samp>.</samp>&rsquo; in the <var>name</var>, the package-prefix
(specified by the <code>-P</code> Kawa command-line flag) is prepended.
</p>
<p>If the form <var>library-name</var> is used,
then the class name is the result of taking
each <var>identifier</var> in the <var>library-name-parts</var>,
<a href="#Mangling">mangling</a> if needed, and concatenating them
separated by periods.
For example <code>(org example doc-utils)</code> becomes
<code>org.example.doc-utils</code>.  (You can&rsquo;t reference the class name
<code>doc-utils</code> directly in Java, but the JVM has no problems with it.
In Java you can use reflection to access classes with such names.)
</p>
<p>As a matter of style, <code>module-name</code> should be the first
command in a file (after possible comments).  It must appear
before a <code>require</code> or <code>import</code>, in case of cycles.
</p></dd></dl>

<p>By default, the base class of the generated module class is unspecified;
you cannot count on it being more specific than <code>Object</code>.
However, you can override it with <code>module-extends</code>.
</p>
<dl class="def">
<dt id="index-module_002dextends"><span class="category">Syntax: </span><span><strong>module-extends</strong> <em>class</em><a href='#index-module_002dextends' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Specifies that the class generated from the immediately surrounding
module should extend (be a sub-class of) the class <code><var>class</var></code>.
</p></dd></dl>

<dl class="def">
<dt id="index-module_002dimplements"><span class="category">Syntax: </span><span><strong>module-implements</strong> <em>interface ...</em><a href='#index-module_002dimplements' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Specifies that the class generated from the immediately surrounding
module should implement the interfaces listed.
</p></dd></dl>

<p>Note that the compiler does <em>not</em> currently check that all the
abstract methods requires by the base class or implemented interfaces
are actually provided, and have the correct signatures.  This will
hopefully be fixed, but for now, if you are forgot a method, you will
probably get a verifier error
</p>
<p>For each top-level exported definition the compiler creates a
corresponding public field with a similar (mangled) name.
By default, there is some indirection:  The value of the Scheme variable
is not that of the field itself.  Instead, the field is a
<code>gnu.mapping.Location</code> object, and the value Scheme variable is
defined to be the value stored in the <code>Location</code>.
Howewer, if you specify an explicit type, then the field will
have the specified type, instead of being a <code>Location</code>.
The indirection using <code>Location</code> is also avoided if you use
<code>define-constant</code>.
</p>
<p>If the Scheme definition defines a procedure (which is not re-assigned
in the module), then the compiler assumes the variable as bound as a
constant procedure.  The compiler generates one or more methods
corresponding to the body of the Scheme procedure. It also generates
a public field with the same name; the value of the field is an
instance of a subclass of <code>&lt;gnu.mapping.Procedure&gt;</code> which when
applied will execute the correct method (depending on the actual arguments).
The field is used when the procedure used as a value (such as being passed
as an argument to <code>map</code>), but when the compiler is able to do so,
it will generate code to call the correct method directly.
</p>
<p>You can control the signature of the generated method by declaring
the parameter types and the return type of the method.  See the
applet (see <a href="#Applet-compilation">Compiling to an applet</a>) example for how this can be done.
If the procedures has optional parameters, then the compiler will
generate multiple methods, one for each argument list length.
(In rare cases the default expression may be such that this is
not possible, in which case an &quot;variable argument list&quot; method
is generated instead.  This only happens when there is a nested
scope <em>inside</em> the default expression, which is very contrived.)
If there are <code>#!keyword</code> or <code>#!rest</code> arguments, the compiler
generate a &quot;variable argument list&quot; method.  This is a method whose
last parameter is either an array or a <code>&lt;list&gt;</code>, and whose
name has <code>$V</code> appended to indicate the last parameter is a list.
</p>
<p>Top-leval macros (defined using either <code>define-syntax</code>
or <code>defmacro</code>) create a field whose type is currently a sub-class of
<code>kawa.lang.Syntax</code>;  this allows importing modules to detect
that the field is a macro and apply the macro at compile time.
</p>
<p>Unfortunately, the Java class verifier does not allow fields to have
arbitrary names.  Therefore, the name of a field that represents a
Scheme variable is &quot;mangled&quot; (see <a href="#Mangling">Mapping Scheme names to Java names</a>) into an acceptable Java name.
The implementation can recover the original name of a field <code>X</code>
as <code>((gnu.mapping.Named) X).getName()</code> because all the standard
compiler-generated field types implement the <code>Named</code> interface.
</p>
<span id="dual_002dpurpose_002dclass"></span></div>
<div class="subsection" id="Same-class-for-module-and-defined-class">
<h4 class="subsection">19.5.4 Same class for module and defined class</h4>

<p>You can declare a class using <code>define-simple-class</code>
with the same name as the module class, for example the
following in a file named <code>foo.scm</code>:
</p><div class="example">
<pre class="example">(define-simple-class foo ...)
</pre></div>
<p>In this case the defined class will serve dual-purpose as the module class.
</p>
<p>To avoid confusion, in this case you must not specify
<code>module-extends</code>, <code>module-implements</code>, or <code>(module-static #t)</code>.
Also, the defined class should not have public static members.
In that case it works out pretty well: public static members
represent bindings exported by the module; other non-private members
&ldquo;belong&rdquo; to the defined class.
</p>
<p>In this case <code>(module-static 'init-run)</code> is implied.
</p>
<span id="static_002dor_002dnon_002dmodules"></span></div>
<div class="subsection" id="Static-vs-non_002dstatic-modules">
<h4 class="subsection">19.5.5 Static vs non-static modules</h4>

<p>There are two kinds of module class:
A <em>static module</em> is a class (or gets compiled to a class)
all of whose public fields are static, and that does not have a
public constructor.  A JVM can only have a single global instance of
a static module.
An <em>instance module</em> has a public default constructor,
and usually has at least one non-static public field.
There can be multiple instances
of an instance module; each instance is called a <em>module instance</em>.
However, only a single instance of a module can be <em>registered</em>
in an environment, so in most cases there is only a single
instance of instance modules.  Registering an instance in an environment
means creating a binding mapping a magic name (derived from the class name)
to the instance.
</p>
<p>In fact, any Java class class that has the properties of either
an instance module or a static module, is a module, and can be
loaded or imported as such;  the class need not have written
using Scheme.
</p>
<p>You can control whether a module is compiled to a static or
a non-static class using either a command-line flag to the compiler,
or using the <code>module-static</code> special form.
</p>
<dl compact="compact">
<dt><span><code>--module-static</code></span></dt>
<dd><p>Generate a static module
(as if <code>(module-static #t)</code> were specified).
This is (now) the default.
</p></dd>
<dt><span><code>--module-nonstatic</code></span></dt>
<dt><span><code>--no-module-static</code></span></dt>
<dd><p>Generate a non-static module
(as if <code>(module-static #f)</code> were specified).
This used to be the default.
</p></dd>
<dt><span><code>--module-static-run</code></span></dt>
<dd><p>Generate a static module
(as if <code>(module-static 'init-run)</code> were specified).
</p></dd>
</dl>

<dl class="def">
<dt id="index-module_002dstatic"><span class="category">Syntax: </span><span><strong>module-static</strong> <em>name ...</em><a href='#index-module_002dstatic' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-module_002dstatic-1"><span class="category">Syntax: </span><span><strong>module-static</strong> <em><code>#t</code></em><a href='#index-module_002dstatic-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-module_002dstatic-2"><span class="category">Syntax: </span><span><strong>module-static</strong> <em><code>#f</code></em><a href='#index-module_002dstatic-2' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-module_002dstatic-3"><span class="category">Syntax: </span><span><strong>module-static</strong> <em><code>'init-run</code></em><a href='#index-module_002dstatic-3' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Control whether the generated fields and methods are static.
If <code>#t</code>  or <code>'init-run</code> is specified, then the module will be a
static module, <em>all</em> definitions will be static.
If <code>'init-run</code> is specified, in addition the module body
is evaluated in the class&rsquo;s static initializer.
(Otherwise, it is run the first time it is <code>require</code>&rsquo;d.)
Otherwise, the module is an instance module.  If there is a non-empty
list of <var>name</var>s then the module is an instance module, but the <var>name</var>s
that are explicitly listed will be compiled to static fields and methods.
If <code>#f</code> is specified, then all exported names will
be compiled to non-static (instance) fields and methods.
</p>
<p>By default, if no <code>module-static</code> is specified:
</p><ol>
<li> If there is a <code>module-extends</code> or <code>module-implements</code>
declaration, or one of the <code>--applet</code> or <code>--servlet</code>
command-line flags was specified, then <code>(module-static #f)</code> is implied.
</li><li> If one of the command-line flags
<code>--no-module-static</code>, <code>--module-nonstatic</code>,
<code>--module-static</code>, or <code>--module-static-run</code> was specified,
then the default is <code>#f</code>, <code>#f</code>, <code>#t</code>, or <code>'init-run</code>,
respectively.
</li><li> If the module class is <a href="#dual_002dpurpose_002dclass">dual-purpose</a>
then <code>(module-static 'init-run)</code> is implied.
</li><li> Otherwise the default is <code>(module-static #t)</code>.
(It used to be <code>(module-static #f)</code> in older Kawa versions.)
</li></ol>

<p>The default is <code>(module-static #t)</code>.  It usually produces more efficient
code, and is recommended if a module contains only procedure or macro
definitions. However, a static module means that all environments in a JVM
share the same bindings, which you may not want if you use
multiple top-level environments.
</p></dd></dl>

<p>The top-level actions of a module will get compiled to a <code>run</code>
method.  If there is an explicit <code>method-extends</code>, then the
module class will also automatically implement <code>java.lang.Runnable</code>.
(Otherwise, the class does not implement <code>Runnable</code>, since in that
case the <code>run</code> method return an <code>Object</code> rather than <code>void</code>.
This will likely change.)
</p>
</div>
<div class="subsection" id="Module-options">
<h4 class="subsection">19.5.6 Module options</h4>

<p>Certain compilation options can be be specified <em>either</em>
on the command-line when compiling, or in the module itself.
</p>
<dl class="def">
<dt id="index-module_002dcompile_002doptions"><span class="category">Syntax: </span><span><strong>module-compile-options</strong> <em>[key<code><b>:</b></code> value] ...</em><a href='#index-module_002dcompile_002doptions' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This sets the value of the <code>key</code> option to <code>value</code>
for the current module (source file).  It takes effect as
soon it is seen during the first macro-expansion pass,
and is active thereafter (unless overridden by <code>with-compile-options</code>).
</p>
<p>The <var>key:</var> is one of the supported option names 
(The ending colon makes it a Kawa keyword). Valid
option keys are:
</p>
<ul>
<li> <code><b>main:</b></code> - Generate an application, with a main method.
</li></ul>

<ul>
<li> <code><b>full-tailcalls:</b></code> - Use a calling convention that supports proper tail recursion.
</li></ul>

<ul>
<li> <code><b>warn-undefined-variable:</b></code> - Warn if no compiler-visible binding for a variable.

</li><li> <code><b>warn-unknown-member:</b></code> - Warn if referencing an unknown method or field.

</li><li> <code><b>warn-invoke-unknown-method:</b></code> - Warn if invoke calls an unknown method (subsumed by warn-unknown-member).

</li><li> <code><b>warn-unused:</b></code> - Warn if a variable is usused or code never executed.

</li><li> <code><b>warn-unreachable:</b></code> - Warn if this code can never be executed.
</li><li> <code><b>warn-void-used:</b></code> - Warn if an expression depends on the value of a void sub-expression (one that never returns a value).
</li><li> <code><b>warn-as-error:</b></code> - Treat a compilation warning as if it were an error.
</li></ul>

<p>The <var>value</var> must be a literal value: either a boolean
(<code>#t</code> or <code>#f</code>), a number, or a string,
depending on the <var>key</var>.
(All the options so far are boolean options.)
</p>
<div class="example">
<pre class="example">(module-compile-options warn-undefined-variable: #t)
;; This causes a warning message that y is unknown.
(define (func x) (list x y))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-with_002dcompile_002doptions"><span class="category">Syntax: </span><span><strong>with-compile-options</strong> <em>[key: value] ... body</em><a href='#index-with_002dcompile_002doptions' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Similar to <code>module-compile-options</code>, but the option
is only active within <var>body</var>.
</p>
<p>The module option key <code>main:</code> has no effect when applied 
to a particular body via the <code>with-compile-options</code> syntax.
</p>
<div class="example">
<pre class="example">(define (func x)
  (with-compile-options warn-invoke-unknown-method: #f
    (invoke x 'size)))
</pre></div>
</dd></dl>

<hr>
</div>
</div>
<div class="section" id="Importing">
<div class="header">
<p>
Next: <a href="#Record-types" accesskey="n" rel="next">Record types</a>, Previous: <a href="#Module-classes" accesskey="p" rel="prev">Modules and how they are compiled to classes</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Importing-from-a-library"></span><h3 class="section">19.6 Importing from a library</h3>

<span id="require"></span><p>You can import a module into the current namespace with <code>import</code> or <code>require</code>.  This adds the exported bindings (or a subset of them) to the
current lexical scope.  It follows that these bindings (which are said
to be imported) are determined at compile-time.
</p>
<span id="meta_002dimport_002ddeclaration"></span><dl class="def">
<dt id="index-import"><span class="category">Syntax: </span><span><strong>import</strong> <em><a href="#meta_002dimport_002dset"><var>import-set</var></a><sup>*</sup></em><a href='#index-import' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>An <code>import</code> declaration provides a way to import identifiers
exported by a library (module). Each <var>import-set</var> names a set of
bindings from a library and possibly specifies local names
for the imported bindings.
</p><div class="display">
<pre class="display"><span id="index-import_002dset"></span><span id="meta_002dimport_002dset"></span><var>import-set</var> <tt>::=</tt>
    <var>classname</var>
  | <a href="#meta_002dlibrary_002dreference"><var>library-reference</var></a>
  | <code><b>(library</b></code> <a href="#meta_002dlibrary_002dreference"><var>library-reference</var></a> <code><b>)</b></code>
  | <code><b>(class</b></code> <var>class-prefix</var> <var>import-only-name</var><sup>*</sup><code><b>)</b></code>
  | <code><b>(only</b></code> <a href="#meta_002dimport_002dset"><var>import-set</var></a> <var>import-only-name</var><sup>*</sup><code><b>)</b></code>
  | <code><b>(except</b></code> <a href="#meta_002dimport_002dset"><var>import-set</var></a> <var>identifier</var><sup>*</sup><code><b>)</b></code>
  | <code><b>(prefix</b></code> <a href="#meta_002dimport_002dset"><var>import-set</var></a> <var>identifier</var> <code><b>)</b></code>
  | <code><b>(rename</b></code> <a href="#meta_002dimport_002dset"><var>import-set</var></a> <a href="#meta_002drename_002dpair"><var>rename-pair</var></a><sup>*</sup><code><b>)</b></code>
<span id="index-library_002dreference"></span><span id="meta_002dlibrary_002dreference"></span><var>library-reference</var> <tt>::=</tt> <code><b>(</b></code> <a href="#meta_002dlibrary_002dname_002dparts"><var>library-name-parts</var></a> [<a href="#meta_002dexplicit_002dsource_002dname"><var>explicit-source-name</var></a>]<code><b>)</b></code>
<span id="index-import_002donly_002dname"></span><span id="meta_002dimport_002donly_002dname"></span><var>import-only-name</var> <tt>::=</tt> <var>identifier</var>|<a href="#meta_002drename_002dpair"><var>rename-pair</var></a>
<span id="index-explicit_002dsource_002dname"></span><span id="meta_002dexplicit_002dsource_002dname"></span><var>explicit-source-name</var> <tt>::=</tt> <a href="#meta_002dstring"><var>string</var></a>
<span id="index-rename_002dpair"></span><span id="meta_002drename_002dpair"></span><var>rename-pair</var> <tt>::=</tt> <code><b>(</b></code> <var>identifier</var><sub>1</sub> <var>identifier</var><sub>2</sub><code><b>)</b></code>
</pre></div>

<p>A <var>library-reference</var> is mapped to a class name by concatenating
all the identifiers, separated by dots.
For example:
</p><div class="example">
<pre class="example">(import (gnu kawa slib srfi37))
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(import gnu.kawa.slib.srfi37)
</pre></div>
<p>as well as to:
</p><div class="example">
<pre class="example">(require gnu.kawa.slib.srfi37)
</pre></div>

<p>By default, all of an imported library&rsquo;s exported bindings are made
visible within an importing library using the names given to the
bindings by the imported library.  The precise set of bindings to be
imported and the names of those bindings can be adjusted with the
<code>only</code>, <code>except</code>, <code>prefix</code>, and <code> rename</code> forms as
described below.
</p>
<ul>
<li> An <code>only</code> form produces a subset of the bindings from another
<var>import-set</var>, including only the listed <var>identifier</var>s.  The
included <var>identifier</var>s must be in the original <var>import-set</var>.
If a <var>rename-pair</var> is used, then the <code><var>identifier</var><sub>1</sub></code>
must be in the original <var>import-set</var>,
and is renamed to <code><var>identifier</var><sub>2</sub></code>.  For example:
<div class="example">
<pre class="example">(import (only (kawa example) A (B1 B2) C (D1 D2)))
</pre></div>
<p>is equivalent to:
</p><div class="example">
<pre class="example">(import (rename (only (kawa example) A B1 C D1)
                (B1 B2) (D1 D2)))
</pre></div>
<p>The names <code>A</code>, <code>B1</code>, <code>C</code>, and <code>D1</code> must
exist in the library <code>(kawa example)</code>.  The bindings are
accessible using the names <code>A</code>, <code>B2</code>, <code>C</code>, and <code>D2</code>.
</p>
</li><li> An <code>except</code> form produces a subset of the bindings from another
<var>import-set</var>, including all but the listed <var>identifier</var>s.  All
of the excluded <var>identifier</var>s must be in the original <var>import-set</var>.

</li><li> A <code>prefix</code> form adds the <var>identifier</var> prefix to each name from
another <var>import-set</var>.

</li><li> A <code>rename</code> form:
<div class="example">
<pre class="example">(rename (<var>identifier</var><sub>1</sub> <var>identifier</var><sub>2</sub>) &hellip;)
</pre></div>
<p>removes the bindings for <code><var>identifier</var><sub>1</sub> &hellip;</code> to form an
intermediate <var>import-set</var>, then adds the bindings back for the
corresponding <code><var>identifier</var><sub>2</sub> &hellip;</code> to form the final
<var>import-set</var>.  Each <code><var>identifier</var><sub>1</sub></code> must be in the original
<var>import-set</var>, each <var>identifier</var><sub>2</sub> must not be in the
intermediate <var>import-set</var>, and the <var>identifier</var><sub>2</sub>s must be
distinct.
</p></li></ul>

<p>A <code>class</code> form is a convenient way to define abbreviations
for class names; it may be more convenient than <code>define-alias</code>.
The <var>class-prefix</var> is concatenated with each <var>identifier</var>
(with a period in between) to produce a classname.
Each <var>identifier</var> becomes an alias for the class.
For example:
</p><div class="example">
<pre class="example">(import (class java.util Map (HashMap HMap)))
</pre></div>
<p>This defines <code>Map</code> as an alias for <code>java.util.Map</code>,
and <code>HMap</code> as an alias for <code>java.util.HashMap</code>.
(You can think of the <code>class</code> form as similar to a <code>only</code> form,
where the <var>class-prefix</var> names a special kind of
library represented of a Java package, and whose exported
bindings are the classes in the package.)
</p>
<p>You can combine the <code>class</code> form with
<code>only</code>, <code>except</code>, <code>rename</code>, and <code>prefix</code>,
though only <code>prefix</code> is likely to be useful.  For example:
</p><div class="example">
<pre class="example">(import (prefix (class java.lang Long Short) jl-))
</pre></div>
<p>is equivalent to
</p><div class="example">
<pre class="example">(import (class java.lang (Long jl-Long) (Short jl-Short)))
</pre></div>
<p>which is equivalent to:
</p><div class="example">
<pre class="example">(define-private-alias jl-Short java.lang.Short)
(define-private-alias jl-Long java.lang.Long)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-require"><span class="category">Syntax: </span><span><strong>require</strong> <em><code><b>&rsquo;</b></code>featureName</em><a href='#index-require' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-require-1"><span class="category">Syntax: </span><span><strong>require</strong> <em>classname [<a href="#meta_002dexplicit_002dsource_002dname"><var>explicit-source-name</var></a>]</em><a href='#index-require-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-require-2"><span class="category">Syntax: </span><span><strong>require</strong> <em><a href="#meta_002dexplicit_002dsource_002dname"><var>explicit-source-name</var></a>]</em><a href='#index-require-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Search for a matching module (class), and add the names
exported by that module to the current set of visible names.
Normally, the module is specified using <var>classname</var>.
</p>
<p>The form <code>require</code> has similar functionality as <code>import</code>,
but with a different syntax, and without options like <code>rename</code>.
</p>
<p>If a <code><code><b>&quot;</b></code><var>sourcepath</var><code><b>&quot;</b></code></code> is specified then
that is used to locate the source file for the module, and if necessary,
compile it.
</p>
<p>If a <code>'<var>featurename</var></code> is specified then the
<var>featurename</var> is looked up (at compile time) in the &quot;feature table&quot;
which yields the implementing <var>classname</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-provide"><span class="category">Syntax: </span><span><strong>provide</strong> <em><code><b>&rsquo;</b></code>featurename</em><a href='#index-provide' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Declare that <code>'<var>featurename</var></code> is available.
A following <code>cond-expand</code> in this scope will match <var>featurename</var>.
</p></dd></dl>

<p>Using <code>require</code> and <code>provide</code> with <var>featurename</var>s is
similar to the same-named macros in SLib, Emacs, and Common Lisp.
However, in Kawa these are not functions, but instead they
are syntax forms that are processed at compile time.  That is
why only quoted <var>featurename</var>s are supported.
This is consistent with Kawa emphasis on compilation and
static binding.
</p>
<p>For some examples, you may want to look in the <code>gnu/kawa/slib</code>
directory.
</p>
<ul class="section-toc">
<li><a href="#Searching-for-modules" accesskey="1">Searching for modules</a></li>
<li><a href="#Searching-for-source-files" accesskey="2">Searching for source files</a></li>
<li><a href="#Builtin-libraries" accesskey="3">Builtin libraries</a></li>
<li><a href="#Importing-a-SRFI-library" accesskey="4">Importing a SRFI library</a></li>
<li><a href="#Importing-from-a-plain-class" accesskey="5">Importing from a plain class</a></li>
</ul>
<div class="subsection" id="Searching-for-modules">
<h4 class="subsection">19.6.1 Searching for modules</h4>

<p>When Kawa sees a <code>import</code> or <code>require</code> it searches for
either a matching source file or a previously-compiled class with a
matching name.
</p>
<p>For <code>import</code> we generate a classname by converting it in the same
way <code>module-name</code> does:  taking each identifier in the
<var>library-name-parts</var>, mangling if needed, and concatenating the parts
separated by periods.
</p>
<p>If there is a matching module in any <var>program-unit</var> that is
in the process of being compiled, we use that.  This may be
a file requested to be compiled with the <code>-C</code> command-line switch,
or an extra <var>library-definition</var> in a file already parsed.
Kawa will attempt to finish compiling the module and load the class,
but if there are circular dependencies it will use the uncompiled definitions.
</p>
<p>Next Kawa looks for a matching class in the context classpath.
(There is special handling if the library-name starts with <code>srfi</code>,
and certain builtin classes will have <code>kawa.lib.</code> prepended.)
</p>
<p>Kawa also searches for a matching source file, described below.
It uses the implicit source name (formed by concatenating the
library-name parts, separated by <code>&quot;/&quot;</code>), as well as
any <var>explicit-source-name</var>.  The source file is parsed as
a <a href="#meta_002dprogram_002dunit"><var>program-unit</var></a>.  It is an error if the <var>program-unit</var>
does not declare a library (explicit or implicit) with the
matching name.
</p>
<p>If Kawa finds both a matching source file and a class, it will pick one
based on which is newer.
</p>
</div>
<div class="subsection" id="Searching-for-source-files">
<h4 class="subsection">19.6.2 Searching for source files</h4>

<p>The Java property <code>kawa.import.path</code> controls how <code>import</code>
and <code>require</code> search for a suitable source file.  Example usage:
</p><div class="example">
<pre class="example">$ kawa -Dkawa.import.path=&quot;.:&lt;foo fo&gt;/opt/fo-libs/*.scm:/usr/local/kawa&quot;
</pre></div>

<p>The value of the <code>kawa.import.path</code> property is a list of
path elements, separated by <code>&quot;:&quot;</code>.
Each path element is combined with either the explicit source name
or the implicit source name to produce a filename.
If a matching file exists, then we have found a source file.
</p>
<p>If a path element contains a <code>&quot;*&quot;</code> then the <code>&quot;*&quot;</code>
is replaced by the implicit source name (without an extension).
(Any explicit source name is ignored in this case.)
For example, for <code>(import (foo bar))</code> or <code>(require foo.bar)</code>
the implicit source name is <code>&quot;foo/bar&quot;</code>.  If the path element is
<code>&quot;/opt/kawa/*.sc&quot;</code> then the resulting filename is <code>&quot;/opt/kawa/foo/bar.sc&quot;</code>.
</p>
<p>If there is no <code>&quot;*&quot;</code> in the path element, and there is an
explicit source, then it is appended to the path element
(or replaces the path element if the explicit source is absolute).
Otherwise we use the implicit source, followed by the default file extension.
(The default file extension is that of the current source if that is a
named file; otherwise the default for the current language, which
is <code>&quot;.scm&quot;</code>  for Scheme.)
</p>
<p>A path element that starts with a selector of the
form <code>&quot;&lt;<a href="#meta_002dlibrary_002dname_002dparts"><var>library-name-parts</var></a>&gt;&quot;</code> is only applicable if a prefix
of the requested module name matches the <var>library-name-parts</var>.  If there
is <code>&quot;*&quot;</code> in the path element, that is replaced by the corresponding rest
of the implicit source name. For example if importing <code>(fee fo foo fum</code>)
and the path element is <code>&quot;&lt;fee fo&gt;/opt/fo-libs/*.scm&quot;</code> then the
resulting filename is <code>&quot;/opt/fo-libs/foo/fum.scm&quot;</code>.
If there is a selector but no <code>&quot;*&quot;</code>, then the rest of the path element
following the selector is combined with the explicit or implicit source
as if there were no selector (assuming of course that the selector matches).
</p>
<p>If the resulting filename is relative, then it is resolved
relative to the <em>current root</em>.  For example the source to
a library with the name <code>(x y)</code> that compiles to
a class <code>x.y</code> might be a  file named <code>/a/b/x/y.scm</code>.
Then the current root would be <code>/a/b/</code>
- that is the directory that results from removing the library name
suffix from the file name.
</p>
<p>More generally: assume the current module has <em class='tex2jax_process'>\(N\)</em> name components.
For example the name <code>(x y)</code>
(with the class name <code>x.y</code>) has 2 components.
The current root is what you get when you take the current file name
(say <code>&quot;/a/b/c/d.scm&quot;</code>), and remove everything after
the <em class='tex2jax_process'>\(N\)</em>&rsquo;th slash (<code>&quot;/&quot;</code>) from the end (say <code>&quot;c/d.scm&quot;</code>;
what remains (e.g. <code>&quot;/a/b/&quot;</code> is the current root.
(If the current input source is not a named file,
use the value of <code>(current-path)</code> with a <code>&quot;/&quot;</code> appended.)
</p>
<p>The default search path is <code>&quot;.&quot;</code> - i.e. just search relative
to the current root.
</p>
</div>
<div class="subsection" id="Builtin-libraries">
<h4 class="subsection">19.6.3 Builtin libraries</h4>

<p>The following libraries are bundled with Kawa:
</p>
<dl compact="compact">
<dt><span><code>(scheme base)</code></span></dt>
<dt><span><code>(scheme case-lambda)</code></span></dt>
<dt><span><code>(scheme char)</code></span></dt>
<dt><span><code>(scheme complex)</code></span></dt>
<dt><span><code>(scheme cxr)</code></span></dt>
<dt><span><code>(scheme cxr)</code></span></dt>
<dt><span><code>(scheme eval)</code></span></dt>
<dt><span><code>(scheme inexact)</code></span></dt>
<dt><span><code>(scheme lazy)</code></span></dt>
<dt><span><code>(scheme load)</code></span></dt>
<dt><span><code>(scheme process-context)</code></span></dt>
<dt><span><code>(scheme read)</code></span></dt>
<dt><span><code>(scheme repl)</code></span></dt>
<dt><span><code>(scheme time)</code></span></dt>
<dt><span><code>(scheme write)</code></span></dt>
<dt><span><code>(scheme r5rs)</code></span></dt>
<dd><p>The above are standard libraries as defined by R7RS.
</p></dd>
<dt><span><code>(rnrs arithmetic bitwise)</code></span></dt>
<dt><span><code>(rnrs hashtables)</code></span></dt>
<dt><span><code>(rnrs lists)</code></span></dt>
<dt><span><code>(rnrs programs)</code></span></dt>
<dt><span><code>(rnrs sorting)</code></span></dt>
<dt><span><code>(rnrs unicode)</code></span></dt>
<dd><p>The above are standard libraries as defined by R6RS.
</p></dd>
<dt><span><code>(kawa reflect)</code></span></dt>
<dd><p>Defines procedures and syntax for acessing Java objects and members:
  <code>as</code>
  <code>field</code>
  <code>instance?</code>
  <code>invoke</code>
  <code>invoke-static</code>
  <code>invoke-special</code>
  <code>make</code>
  <code>primitive-throw</code>
  <code>set-field!</code>
  <code>set-static-field!</code>
  <code>static-field</code>
</p></dd>
<dt><span><code>(kawa expressions)</code></span></dt>
<dt><span><code>(kawa hashtable)</code></span></dt>
<dt><span><code>(kawa quaternions)</code></span></dt>
<dt><span><code>(kawa rotations)</code></span></dt>
<dt><span><code>(kawa regex)</code></span></dt>
<dt><span><code>(kawa string-cursors)</code></span></dt>
<dd><p>Various Kawa libraries <i>add details</i>.
</p></dd>
<dt><span><code>(kawa base)</code></span></dt>
<dd><p>All the bindings by default available to the kawa top-level.
</p></dd>
</dl>

</div>
<div class="subsection" id="Importing-a-SRFI-library">
<h4 class="subsection">19.6.4 Importing a SRFI library</h4>

<p>Importing a supported SRFI numbered <var>N</var> is conventionally
doing using a <code>(import (srfi <var>N</var>))</code>
or the older R6RS syntax <code>(import (srfi :<var>N</var>))</code> (with a colon, for historical reasons).  You can also give it
a name, as specified by <a href="http://srfi.schemers.org/srfi-95/srfi-95.html">SRFI 95</a>. For example, any of these work:
</p><div class="example">
<pre class="example">(import (srfi 95))
(import (srfi 95 sorting-and-merging))
(import (srfi :95))
(import (srfi :95 sorting-and-merging))
</pre></div>
<p>You can also use <code>(require 'srfi-<var>N</var>)</code>:
</p><div class="example">
<pre class="example">(require 'srfi-95)
</pre></div>

</div>
<div class="subsection" id="Importing-from-a-plain-class">
<h4 class="subsection">19.6.5 Importing from a plain class</h4>

<p>Note you can import from many classes, even if they weren&rsquo;t
compiled from a library-definition.  The set of <code>public</code> fields
in a class are considered as the set of exported definitions,
with the names demangled as needed.
</p>
<p>The module can be static module (all public fields must be static),
or an instance module (it has a public default constructor).
</p>
<p>If an imported definition is a non-static field and if no module
instance for that class
has been registered in the current environment, then a new instance
is created and registered (using a &quot;magic&quot; identifier).
If the module class either inherits from <code>gnu.expr.ModuleBody</code>
or implements <code>java.lang.Runnable</code> then the corresponding <code>run</code>
method is executed.  (This is done <em>after</em> the instance is
registered so that cycles can be handled.)  These actions (creating,
registering, and running the module instance) are done both at compile
time and at run time, if necessary.
</p>
<p>All the imported fields of the module class are then incorporated
in the current set of local visible names in the current module.
(This is for both instance and static modules.)
This is done at compile time - no new bindings are created at run-time
(except for the magic binding used to register the module instance),
and the imported bindings are private to the current module.
References to the imported bindings will be compiled as field
references, using the module instance (except for static fields).
</p>
<hr>
</div>
</div>
<div class="section" id="Record-types">
<div class="header">
<p>
Next: <a href="#Dynamic-records" accesskey="n" rel="next">Creating New Record Types On-the-fly</a>, Previous: <a href="#Importing" accesskey="p" rel="prev">Importing from a library</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Record-types-1"></span><h3 class="section">19.7 Record types</h3>

<p>The <code>define-record-type</code> form can be used for creating new data
types, called record types. A predicate, constructor, and field
accessors and modifiers are defined for each record type.
The <code>define-record-type</code> feature is specified
by <a href="http://srfi.schemers.org/srfi-9/srfi-9.html">SRFI-9</a>,
which is implemented by many modern Scheme implementations.
</p>
<dl class="def">
<dt id="index-define_002drecord_002dtype"><span class="category">Syntax: </span><span><strong>define-record-type</strong> <em><var>type-name</var> (<var>constructor-name</var> <var>field-tag</var> ...) <var>predicate-name</var> (<var>field-tag</var> <var>accessor-name</var> [<var>modifier-name</var>]) ...</em><a href='#index-define_002drecord_002dtype' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The form <code>define-record-type</code> is generative: each use creates a new
record type that is distinct from all existing types, including other
record types and Scheme&rsquo;s predefined types. Record-type definitions may
only occur at top-level (there are two possible semantics for &lsquo;internal&rsquo;
record-type definitions, generative and nongenerative, and no consensus
as to which is better).
</p>
<p>An instance of <code>define-record-type</code> is equivalent to the following definitions:
</p><ul>
<li> The <var>type-name</var> is bound to a representation of the record type
itself.
</li><li> The <var>constructor-name</var> is bound to a procedure that takes
as many arguments as there are <var>field-tag</var>s in the
<code>(<var>constructor-name</var> ...)</code> subform and returns
a new <var>type-name</var> record. Fields whose tags are listed with
<var>constructor-name</var> have the corresponding argument as their initial
value. The initial values of all other fields are unspecified.
</li><li> The <var>predicate-name</var> is a predicate that returns <code>#t</code>
when given a value returned by <var>constructor-name</var>
and <code>#f</code> for everything else.
</li><li> Each <var>accessor-name</var> is a procedure that takes a record of
type <var>type-name</var> and returns the current value of the corresponding field.
It is an error to pass an accessor a value which is not a record of the
appropriate type.
</li><li> Each <var>modifier-name</var> is a procedure that takes a record of
type <var>type-name</var> and a value which becomes the new value of
the corresponding field.
The result (in Kawa) is the empty value <code>#!void</code>.
It is an error to pass a
modifier a first argument which is not a record of the appropriate type.
</li></ul>

<p>Set!ing the value of any of these identifiers has no effect on the
behavior of any of their original values.
</p></dd></dl>

<p>Here is an example of how you can define a record type named <code>pare</code>
with two fields <code>x</code> and <code>y</code>:
</p><div class="example">
<pre class="example">(define-record-type pare
  (kons x y)
  pare?
  (x kar set-kar!)
  (y kdr))
</pre></div>

<p>The above defines <code>kons</code> to be a constructor,
<code>kar</code> and <code>kdr</code> to be accessors,
<code>set-kar!</code> to be a modifier,
and <code>pare?</code> to be a predicate for <code>pare</code>s.
</p><div class="example">
<pre class="example">(pare? (kons 1 2))        &rArr; #t
(pare? (cons 1 2))        &rArr; #f
(kar (kons 1 2))          &rArr; 1
(kdr (kons 1 2))          &rArr; 2
(let ((k (kons 1 2)))
  (set-kar! k 3)
  (kar k))                &rArr; 3
</pre></div>

<p>Kawa compiles the record type into a nested class.
If the <code>define-record-type</code> appears at module level,
the result is a class that is a member of the module class.
For example if the above <code>pare</code> class is define in a
module <code>parelib</code>, then the result is a class
named <code>pare</code> with the internal JVM name <code>parelib$pare</code>.
The <code>define-record-type</code> can appear inside a procedure,
in which case the result is an inner class.
</p>
<p>The nested class has a name derived from
the <var>type-name</var>.  If the <var>type-name</var> is valid Java class name,
that becomes the name of the Java class.  If the <var>type-name</var> has
the form <code>&lt;<var>name</var>&gt;</code> (for example <code>&lt;pare&gt;</code>), then <var>name</var>
is used, if possible, for the Java class name.  Otherwise, the name
of the Java class is derived by &quot;mangling&quot; the <var>type-name</var>.
In any case, the package is the same as that of the surrounding module.
</p>
<p>Kawa generates efficient code for the resulting functions,
without needing to use run-time reflection.
</p>
<hr>
</div>
<div class="section" id="Dynamic-records">
<div class="header">
<p>
Next: <a href="#Method-operations" accesskey="n" rel="next">Calling Java methods from Scheme</a>, Previous: <a href="#Record-types" accesskey="p" rel="prev">Record types</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Creating-New-Record-Types-On_002dthe_002dfly"></span><h3 class="section">19.8 Creating New Record Types On-the-fly</h3>

<p>Calling the <code>make-record-type</code> procedure creates a new record data
type at run-time, without any compile-time support.
It is primarily provided for compatibility; in most cases it is better
to use the <code>define-record-type</code> form (see <a href="#Record-types">Record types</a>).
</p>
<dl class="def">
<dt id="index-make_002drecord_002dtype"><span class="category">Procedure: </span><span><strong>make-record-type</strong> <em>type-name field-names</em><a href='#index-make_002drecord_002dtype' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a <em>record-type descriptor</em>, a value representing a new data
type disjoint from all others.  The <var>type-name</var> argument must be a
string, but is only used for debugging purposes (such as the printed
representation of a record of the new type).  The <var>field-names</var>
argument is a list of symbols naming the <em>fields</em> of a record of the
new type.  It is an error if the list contains any duplicates.
</p></dd></dl>


<dl class="def">
<dt id="index-record_002dconstructor"><span class="category">Procedure: </span><span><strong>record-constructor</strong> <em>rtd [field-names]</em><a href='#index-record_002dconstructor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a procedure for constructing new members of the type represented
by <var>rtd</var>.  The returned procedure accepts exactly as many arguments
as there are symbols in the given list, <var>field-names</var>; these are
used, in order, as the initial values of those fields in a new record,
which is returned by the constructor procedure.  The values of any
fields not named in that list are unspecified.  The <var>field-names</var>
argument defaults to the list of field names in the call to
<code>make-record-type</code> that created the type represented by <var>rtd</var>;
if the <var>field-names</var> argument is provided, it is an error if it
contains any duplicates or any symbols not in the default list.
</p>
</dd></dl>

<dl class="def">
<dt id="index-record_002dpredicate"><span class="category">Procedure: </span><span><strong>record-predicate</strong> <em>rtd</em><a href='#index-record_002dpredicate' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a procedure for testing membership in the type represented by
<var>rtd</var>.  The returned procedure accepts exactly one argument and
returns a true value if the argument is a member of the indicated record
type; it returns a false value otherwise.
</p>
</dd></dl>


<dl class="def">
<dt id="index-record_002daccessor"><span class="category">Procedure: </span><span><strong>record-accessor</strong> <em>rtd field-name</em><a href='#index-record_002daccessor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a procedure for reading the value of a particular field of a
member of the type represented by <var>rtd</var>.  The returned procedure
accepts exactly one argument which must be a record of the appropriate
type; it returns the current value of the field named by the symbol
<var>field-name</var> in that record.  The symbol <var>field-name</var> must be a
member of the list of field-names in the call to <code>make-record-type</code>
that created the type represented by <var>rtd</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-record_002dmodifier"><span class="category">Procedure: </span><span><strong>record-modifier</strong> <em>rtd field-name</em><a href='#index-record_002dmodifier' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a procedure for writing the value of a particular field of a
member of the type represented by <var>rtd</var>.  The returned procedure
accepts exactly two arguments: first, a record of the appropriate type,
and second, an arbitrary Scheme value; it modifies the field named by
the symbol <var>field-name</var> in that record to contain the given value.
The returned value of the modifier procedure is unspecified.  The symbol
<var>field-name</var> must be a member of the list of field-names in the call
to <code>make-record-type</code> that created the type represented by <var>rtd</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-record_003f"><span class="category">Procedure: </span><span><strong>record?</strong> <em>obj</em><a href='#index-record_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a true value if <var>obj</var> is a record of any type and a false
value otherwise.
</p></dd></dl>

<dl class="def">
<dt id="index-record_002dtype_002ddescriptor"><span class="category">Procedure: </span><span><strong>record-type-descriptor</strong> <em>record</em><a href='#index-record_002dtype_002ddescriptor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a record-type descriptor representing the type of the given
record.  That is, for example, if the returned descriptor were passed to
<code>record-predicate</code>, the resulting predicate would return a true
value when passed the given record.
</p></dd></dl>

<dl class="def">
<dt id="index-record_002dtype_002dname"><span class="category">Procedure: </span><span><strong>record-type-name</strong> <em>rtd</em><a href='#index-record_002dtype_002dname' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the type-name associated with the type represented by rtd.  The
returned value is <code>eqv?</code> to the <var>type-name</var> argument given in
the call to <code>make-record-type</code> that created the type represented by
<var>rtd</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-record_002dtype_002dfield_002dnames"><span class="category">Procedure: </span><span><strong>record-type-field-names</strong> <em>rtd</em><a href='#index-record_002dtype_002dfield_002dnames' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a list of the symbols naming the fields in members of the type
represented by <var>rtd</var>.  The returned value is <code>equal?</code> to the
field-names argument given in the call to <code>make-record-type</code> that
created the type represented by <var>rtd</var>.
</p></dd></dl>

<p>Records are extensions of the class <code>Record</code>.
These procedures use the Java 1.1 reflection facility.
</p>
<hr>
</div>
<div class="section" id="Method-operations">
<div class="header">
<p>
Next: <a href="#Allocating-objects" accesskey="n" rel="next">Allocating objects</a>, Previous: <a href="#Dynamic-records" accesskey="p" rel="prev">Creating New Record Types On-the-fly</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Calling-Java-methods-from-Scheme"></span><h3 class="section">19.9 Calling Java methods from Scheme</h3>

<p>You can call a Java method as if it were a Scheme procedure
using various mechanisms.
</p>
<ul class="section-toc">
<li><a href="#Calling-static-methods-using-colon-notation" accesskey="1">Calling static methods using colon notation</a></li>
<li><a href="#Calling-instance-methods-using-colon-notation" accesskey="2">Calling instance methods using colon notation</a></li>
<li><a href="#Method-names" accesskey="3">Method names</a></li>
<li><a href="#Invoking-a-method-with-the-invoke-function" accesskey="4">Invoking a method with the <code>invoke</code> function</a></li>
<li><a href="#Using-a-namespace-prefix" accesskey="5">Using a namespace prefix</a></li>
</ul>
<div class="subsection" id="Calling-static-methods-using-colon-notation">
<h4 class="subsection">19.9.1 Calling static methods using colon notation</h4>

<p>The easiest way to invoke a static method is to use
<a href="#Colon-notation">colon notation</a>, specifically:
</p><div class="display">
<pre class="display"><code><b>(</b></code><var>class-expression</var><code><b>:</b></code><var>method-name</var> <var>argument</var> ...<code><b>)</b></code>
</pre></div>

<p>The <var>class-expression</var> can be a class in the current lexical
scope, such as a class defined using <code>define-simple-class</code>:
</p><div class="example">
<pre class="example">(define-simple-class MyClass ()
  ((add2 x y) allocation: 'static (+ x y)))
(MyClass:add2 3 4) &rArr; 7
</pre></div>

<p>Often <var>class-expression</var> is a fully-qualified class name:
</p><div class="example">
<pre class="example">(java.lang.Math:sqrt 9.0) &rArr; 3.0
</pre></div>

<p>This is only allowed when the name is of a class that exists
and is accessible both at compile-time and run-time,
and the name is not otherwise lexically bound.
</p>
<p>You can also use a defined alias:
</p><div class="example">
<pre class="example">(define-alias jlMath java.lang.Math)
(jlMath:sqrt 16.0) &rArr; 4.0
</pre></div>

<p>You can even evaluate <var>class-expression</var> at run-time
(in which case Kawa may have to use slower reflection):
</p><div class="example">
<pre class="example">(let ((math java.lang.Math)) math:sqrt 9.0) &rArr; 3.0
</pre></div>

<p>Here <code>java.lang.Math</code> evaluates to a <code>java.lang.Class</code>
instance for the named class (like Java&rsquo;s <code>java.lang.Class.class</code>,
again assuming the class exists and is accessible both at compile-time and
run-time, and the name is not otherwise lexically bound.
</p>
</div>
<div class="subsection" id="Calling-instance-methods-using-colon-notation">
<h4 class="subsection">19.9.2 Calling instance methods using colon notation</h4>

<p>The syntax is:
</p><div class="display">
<pre class="display"><code><b>(</b></code><var>instance</var><code><b>:</b></code><var>method-name</var> <var>argument</var> ...<code><b>)</b></code>
</pre></div>
<p>This invokes the method named <var>method-name</var>
with the evaluated  <var>instance</var> as the target object
and the evaluated <var>argument</var>s as the method arguments.
</p>
<p>For example:
</p><div class="example">
<pre class="example">((list 9 8 7):toString) &rArr; &quot;(9 8 7)&quot;
([5 6 7]:get 2) &rArr; 7
</pre></div>

<p>This older syntax is also available:
</p><div class="display">
<pre class="display"><code><b>(*:</b></code><var>method-name</var> <var>instance</var> <var>argument</var> ...<code><b>)</b></code>
</pre></div>

<p>For example:
</p><div class="example">
<pre class="example">(*:toString (list 9 8 7))
</pre></div>

<p>You can also name the class explicitly:
</p><div class="display">
<pre class="display"><code><b>(</b></code><var>class-expression</var><code><b>:</b></code><var>method-name</var> <var>instance</var> <var>argument</var> ...<code><b>)</b></code>
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">(java.util.List:get [5 6 7] 2) &rArr; 7
</pre></div>
<p>Using an explicit class is like coercing the <var>instance</var>:
</p><div class="display">
<pre class="display"><code><b>(*:</b></code><var>method-name</var> <code><b>(as </b></code><var>class-expression</var> <var>instance</var> <code><b>)</b></code><var>argument</var> ...<code><b>)</b></code>
</pre></div>

<p>Note that for some special values,
including <code>java.lang.Class</code> instances, you can&rsquo;t
use the compact form of <a href="#Colon-notation">colon notation</a>
where the <var>instance</var> is before the comma:
</p><div class="example">
<pre class="example">(java.lang.Integer:getDeclaredField &quot;MAX_VALUE&quot;) &rArr; <i>error</i>
</pre></div>
<p>This is because in this case we look for a static member
of <code>java.lang.Integer</code>
(at least as currently defined and implemented),
while we want an instance member of <code>java.lang.Class</code>.
In those cases you can use one of
these alternative forms, which all return the same
<code>java.lang.reflect.Field</code> result:
</p><div class="example">
<pre class="example">(*:getDeclaredField java.lang.Integer &quot;MAX_VALUE&quot;)
(java.lang.Class:getDeclaredField java.lang.Integer &quot;MAX_VALUE&quot;)
(invoke java.lang.Integer 'getDeclaredField &quot;MAX_VALUE&quot;)
</pre></div>

</div>
<div class="subsection" id="Method-names">
<h4 class="subsection">19.9.3 Method names</h4>

<p>The method to invoke is selected using the specified
method name and argments.  If specified name is not a Java name,
it is &quot;mangled&quot; (see <a href="#Mangling">Mapping Scheme names to Java names</a>) into a valid Java name.
All accessible methods whose names match are considered.
Methods that match after appending <code>$V</code> or <code>$X</code> or <code>$V$X</code>
are also considered.  A <code>$V</code> suffix matches a variable
number of arguments:  any excess arguments are collect into an
<code>gnu.lists.LList</code> or a Java array (depending on the final parameter type).
A <code>$X</code> specifies that the method expects an extra implicit
<code>CallContext</code> parameter.  In that case the method&rsquo;s result is written
to the <code>CallContext</code>, so the method result type must be <code>void</code>.
</p>
<p>(Kawa may compile a procedure with a <code>#!rest</code> or keyword args
whose name is <code><var>fn</var></code> to a method named <code><var>fn</var>$V</code>.
It adds an implicit parameter for the extra arguments.
By default this extra extra parameter is a Scheme list.
You can specify a Java array type instead, in which case the method is
named <code><var>fn</var></code> without the <code>$V</code>,
and instead it is marked as a Java-5 varargs method.
The array element type must be compatible with all the extra arguments.)
</p>
</div>
<div class="subsection" id="Invoking-a-method-with-the-invoke-function">
<h4 class="subsection">19.9.4 Invoking a method with the <code>invoke</code> function</h4>

<p>If you prefer, you can instead use the following functions.
(There is also an older deprecated lower-level interface
(see <a href="#Low_002dlevel-Method-invocation">Low-level Method invocation</a>.)
</p>
<dl class="def">
<dt id="index-invoke_002dstatic"><span class="category">Procedure: </span><span><strong>invoke-static</strong> <em>class name args ...</em><a href='#index-invoke_002dstatic' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>class</var> can be a <code>java.lang.Class</code>, a
<code>gnu.bytecode.ClassType</code>, or a <code>symbol</code> or <code>string</code>
that names a Java class.  The <var>name</var> can be <code>symbol</code> or
<code>string</code> that names one or more methods in the Java class.
</p>
<p>Any accessible methods (static or instance) in the specified <var>class</var>
(or its super-classes) that match &quot;<var>name</var>&quot; or &quot;<var>name</var>$V&quot; collectively
form a generic procedure.  When the procedure is applied to the argument list,
the most specific applicable method is chosen depending on the
argument list;  that method is then
called with the given arguments.  Iff the method is an instance method,
the first actual argument is used as the <code>this</code> argument.  If there are
no applicable methods (or no methods at all!), or there is no &quot;best&quot;
method, <code>WrongType</code> is thrown.
</p>
<p>An example:
</p><div class="example">
<pre class="example">(invoke-static java.lang.Thread 'sleep 100)
</pre></div>

<p>The behavior of interpreted code and compiled code is not
identical, though you should get the same result either way
unless you have designed the classes rather strangely.  The
details will be nailed down later, but the basic idea is that
the compiler will &quot;inline&quot; the <code>invoke-static</code> call
if it can pick a single &quot;best&quot; matching method.
</p></dd></dl>

<dl class="def">
<dt id="index-invoke"><span class="category">Procedure: </span><span><strong>invoke</strong> <em>object name args ...</em><a href='#index-invoke' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>name</var> can be <code>&lt;symbol&gt;</code> or
<code>&lt;string&gt;</code> that names one or more methods in the Java class.
</p>
<p>Any accessible methods (static or instance) in the specified <var>class</var>
(or its super-classes) that match &quot;<var>name</var>&quot; or &quot;<var>name</var>$V&quot; collectively
form a generic procedure.  When the procedure is applied to the argument list,
the most specific applicable method is chosen depending on the
argument list;  that method is then
called with the given arguments.  Iff the method is an instance method,
the <var>object</var> is used as the <code>this</code> argument;
otherwise <var>object</var> is prepended to the <var>args</var> list.  If there are
no applicable methods (or no methods at all!), or there is no &quot;best&quot;
method, <code>WrongType</code> is thrown.
</p>
<p>The behavior of interpreted code and compiled code is not
indentical, though you should get the same result either way
unless you have designed the classes rather strangely.  The
details will be nailed down later, but the basic idea is that
the compiler will &quot;inline&quot; the <code>invoke-static</code> call
if it can pick a single &quot;best&quot; matching method.
</p>
<p>If the compiler cannot determine the method to call (assuming
the method name is constant), the compiler has to generate code
at run-time to find the correct method.  This is much slower,
so the compiler will print a warning.  To avoid a waning, you can
use a type declaration, or insert a cast:
</p><div class="example">
<pre class="example">(invoke (as java.util.Date my-date) 'setDate cur-date)
</pre></div>
<p>or
</p><div class="example">
<pre class="example">(let ((my-date ::java.util.Date (calculate-date))
      (cur-date ::int (get-cur-date)))
  (invoke my-date 'setDate cur-date))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-invoke_002dspecial"><span class="category">Procedure: </span><span><strong>invoke-special</strong> <em>class receiver-object name arg ...</em><a href='#index-invoke_002dspecial' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>class</var> can be a <code>java.lang.Class</code>, a
<code>gnu.bytecode.ClassType</code>, or a <code>symbol</code> or <code>string</code>
that names a Java class.  
The <var>name</var> can be <code>symbol</code> or
<code>string</code> that names one or more methods in the Java class.
</p>
<p>This procedure is very similar to <code>invoke</code> and <code>invoke-static</code>
and invokes the specified method, ignoring any methods in subclasses
that might overide it.  One interesting use is to invoke a method in
your super-class like the Java language <code>super</code> keyword.
</p>
<p>Any methods in the specified <var>class</var> that match &quot;<var>name</var>&quot; or
&quot;<var>name</var>$V&quot; collectively form a generic procedure.  That generic
procedure is then applied as in <code>invoke</code> using the
<code>receiver-object</code> and the arguments (if any).
</p>
<p>The compiler must be able to inline this procedure (because you cannot
force a specific method to be called using reflection).  Therefore the
<var>class</var> and <var>name</var> must resolve at compile-time to a specific
method.
</p>
<div class="example">
<pre class="example">(define-simple-class &lt;MyClass&gt; (&lt;java.util.Date&gt;)
  ((get-year) :: &lt;int&gt;
   (+ (invoke-special &lt;java.util.Date&gt; (this) 'get-year)) 1900)
  ((set-year (year :: &lt;int&gt;)) :: &lt;void&gt;
   (invoke-special &lt;java.util.Date&gt; (this) 'set-year (- year 1900))))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-class_002dmethods"><span class="category">Procedure: </span><span><strong>class-methods</strong> <em>class name</em><a href='#index-class_002dmethods' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a generic function containing those methods of <var>class</var>
that match the name <var>name</var>, in the sense of <code>invoke-static</code>.
Same as:
</p><div class="example">
<pre class="example">(lambda args (apply invoke-static (cons class (cons name args))))
</pre></div>
</dd></dl>

<p>Some examples using these functions are &lsquo;<samp>vectors.scm</samp>&rsquo;
and &lsquo;<samp>characters.scm</samp>&rsquo; the directory &lsquo;<samp>kawa/lib</samp>&rsquo; in
the Kawa sources.
</p>
</div>
<div class="subsection" id="Using-a-namespace-prefix">
<h4 class="subsection">19.9.5 Using a namespace prefix</h4>

<p><em>This way of invoking a method is deprecated.</em>
</p>
<p>You can use <code>define-namespace</code> to define an alias for a Java class:
</p><div class="example">
<pre class="example">(define-namespace Int32 &quot;class:java.lang.Integer&quot;)
</pre></div>
<p>In this example the name <code>Int32</code> is a <em>namespace alias</em>
for the namespace whose full name is <code>&quot;class:java.lang.Integer&quot;</code>.
The full name should be the 6 characters <code>&quot;class:&quot;</code> followed
by the fully-qualified name of a Java class.
</p>
<p>Instead of a <var>vamespace-uri</var> you can use a variable that names
a class, usually of the form <code>&lt;<var>classname</var>&gt;</code>.
The following is equivalent to the above:
</p><div class="example">
<pre class="example">(define-namespace Int32 &lt;java.lang.Integer&gt;)
</pre></div>
<p>However, there is one important difference: The <code>&lt;<var>classname</var>&gt;</code>
is first searched in the lexical scope.
It may resolve to a class defined in the current compilation unit
(perhaps defined using <code>define-simple-class</code>),
or imported from another module,
or an alias (such as from <code>define-alias</code>).
Only if <code>&lt;<var>classname</var>&gt;</code> is <em>not</em> found in the current
scope is it tried as the class name <var>classname</var>.
</p>
<p>You can name a method using a <em>qualified name</em> containing a colon.
The part of the name before the colon is a namespace alias (in
this case <code>Int32</code>), and the part of the name after the colon is the
method name.  For example:
</p><div class="example">
<pre class="example">(Int32:toHexString 255) &rArr; &quot;ff&quot;
</pre></div>
<p>This invokes the static method <code>toHexString</code> in the
Java class <code>java.lang.Integer</code>, passing it the argument <code>255</code>,
and returning the String <code>&quot;ff&quot;</code>.
</p>
<p>The general syntax is
</p><div class="example">
<pre class="example">(<var>prefix</var>:<var>method-name</var> <var>arg</var> ...)
</pre></div>
<p>This invokes the method named <var>method-name</var> in the class corresponding
to <var>prefix</var>, and the <var>arg</var>s are the method arguments.
</p>
<p>You can use the method name <code>new</code> to construct new objects:
</p><div class="example">
<pre class="example">(Int32:new '|255|)
</pre></div>
<p>This is equivalent to the Java expression <code>new Integer(&quot;255&quot;)</code>.
You can also write:
</p><div class="example">
<pre class="example">(Int32:new &quot;255&quot;)
</pre></div>

<p>You can also call instance methods using a namespace prefix:
</p><div class="example">
<pre class="example">(Int32:doubleValue (Int32:new &quot;00255&quot;))
</pre></div>
<p>This returns the <code>double</code> value <code>255.0</code>.
</p>
<p>As a shorthand, you can use the name of a Java class instead of a
namespace alias:
</p><div class="example">
<pre class="example">(java.lang.Integer:toHexString 255)
(java.lang.Object:toString some-value)
</pre></div>
<p>If Kawa sees a qualified name with a prefix that is not defined <em>and</em>
that matches the name of a known class, then Kawa will automatically
treat the prefix
as a nickname for namespace uri like <code>class:java.lang.Integer</code>.
Both conditions should be true at both compile-time and run-time.
However, using an explicit <code>define-namespace</code> is recommended.
</p>
<p>As a final shorthand you can use an identifier in handle brackets,
such as an existing type alias like <code>&lt;list&gt;</code>.
The following are all equivalent:
</p><div class="example">
<pre class="example">(&lt;list&gt;:list3 'a 'b 'c)
</pre></div>
<p>This is equivalent to:
</p><div class="example">
<pre class="example">(define-namespace <var>prefix</var> &lt;list&gt;
(<var>prefix</var>:list3 'a 'b 'c)
</pre></div>
<p>for some otherwise-unused <var>prefix</var>.
</p>
<hr>
</div>
</div>
<div class="section" id="Allocating-objects">
<div class="header">
<p>
Next: <a href="#Field-operations" accesskey="n" rel="next">Accessing object fields</a>, Previous: <a href="#Method-operations" accesskey="p" rel="prev">Calling Java methods from Scheme</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Allocating-objects-1"></span><h3 class="section">19.10 Allocating objects</h3>

<p>The recommended way to create an instance of a type <var>T</var>
is to &ldquo;call&rdquo; <var>T</var> as if it were a function, with the
arguments used to initialize the object.
If <code>T</code> is a class and <code>T</code> has a matching constructor,
then the arguments will used for constructor arguments:
</p><div class="example">
<pre class="example">(java.util.StringTokenizer &quot;this/is/a/test&quot; &quot;/&quot;)
</pre></div>
<p>(You can think of the type <var>T</var> as being
coerced to an instance-constructor function.)
</p>
<p>If <code>T</code> is a container or collection type,
then typically the arguments will be used to specify
the child or component values.
Many standard Scheme procedures fit this convention.
For example in Kawa <code>list</code> and <code>vector</code> evaluate to
types, rather than procedures as in standard Scheme,
but because types can be used as constructor functions it just works:
</p><div class="example">
<pre class="example">(list 'a (+ 3 4) 'c) &rArr; (a 7 c)
(vector 'a 'b 'c) &rArr; #(a b c)
</pre></div>
<p>Any class <code>T</code> that has a default constructor
and an <code>add</code> method can be initialized this way.
Examples are <code>java.util</code> collection classes,
and <code>jawa.awt</code> and <code>javax.swing</code> containers.
</p><div class="example">
<pre class="example">(java.util.ArrayList 11 22 33) &rArr; [11, 22, 333]
</pre></div>
<p>The above expression is equivalent to:
</p><div class="example">
<pre class="example">(let ((tmp (java.util.ArrayList)))
  (tmp:add 11)
  (tmp:add 22)
  (tmp:add 33)
  tmp)
</pre></div>

<p>Allocating Java arrays (see <a href="#Creating_002dnew_002dJava_002darrays">Creating-new-Java-arrays</a>) uses a
similar pattern:
</p><div class="example">
<pre class="example">(int[] 2 3 5 7 11)
</pre></div>

<p>Sometimes you want to set some named property to an initial value.
You can do that using a keyword argument.  For example:
</p><div class="example">
<pre class="example">(javax.swing.JButton text: &quot;Do it!&quot; tool-tip-text: &quot;do it&quot;)
</pre></div>

<p>This is equivalent to using <em>setter methods</em>:
</p><div class="example">
<pre class="example">(let ((tmp (javax.swing.JButton)))
  (tmp:setText &quot;Do it!&quot;)
  (tmp:setToolTipText &quot;do it&quot;)
  tmp)
</pre></div>

<p>A keyword argument <code><var>key-name</var></code><code><b>:</b></code> can
can translated to either a <code><code><b>set</b></code><var>KeyName</var><code><b>:</b></code></code>
or a  <code><code><b>add</b></code><var>KeyName</var><code><b>:</b></code></code> method.
The latter makes it convenient to add listeners:
</p>
<div class="example">
<pre class="example">(javax.swing.JButton
  text: &quot;Do it!&quot;
  action-listener:
   (object (java.awt.event.ActionListener)
     ((actionPerformed e) (do-the-action))))
</pre></div>
<p>This is equivalent to: 
</p><div class="example">
<pre class="example">(let ((tmp (javax.swing.JButton)))
  (tmp:setText &quot;Do it!&quot;)
  (tmp:addActionListener
    (object (java.awt.event.ActionListener)
      ((actionPerformed e) (do-the-action))))
  tmp)
</pre></div>

<p>Making use of so-called &ldquo;SAM-conversion&rdquo; (see <a href="#SAM_002dconversion">SAM-conversion</a>)
 makes it even more convenient:
</p><div class="example">
<pre class="example">(javax.swing.JButton
  text: &quot;Do it!&quot;
  action-listener:
   (lambda (e) (do-the-action)))
</pre></div>

<p>The general case allows for a mix of
constructor arguments, property keywords, and child values:
</p><div class="display">
<pre class="display"><var>class-type</var> <a href="#meta_002dconstructor_002dvalue"><var>constructor-value</var></a>... <a href="#meta_002dproperty_002dinitializer"><var>property-initializer</var></a>... <a href="#meta_002dchild_002dvalue"><var>child-value</var></a>...
<span id="index-constructor_002dvalue"></span><span id="meta_002dconstructor_002dvalue"></span><var>constructor-value</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-property_002dinitializer"></span><span id="meta_002dproperty_002dinitializer"></span><var>property-initializer</var> <tt>::=</tt> <a href="#meta_002dkeyword"><var>keyword</var></a> <a href="#meta_002dexpression"><var>expression</var></a>
<span id="index-child_002dvalue"></span><span id="meta_002dchild_002dvalue"></span><var>child-value</var> <tt>::=</tt> <a href="#meta_002dexpression"><var>expression</var></a>
</pre></div>

<p>First an object is constructed with the <var>constructor-value</var> arguments
(if any) passed to the object constructor; 
then named properties (if any) are used to initialize named properties;
and then remaining arguments are used to add child values.
</p>
<p>There is an ambiguity if there is no <var>property-initializer</var> -
we can&rsquo;t distinguish between a <var>constructor-value</var>
and a <var>child-value</var>.
In that case, if there is a matching constructor method, then all of the
arguments are constructor arguments;
otherwise, there must a default constructor, and all
of the arguments are <var>child-value</var> arguments.
</p>
<p>There is a trick you can you if you need both
<var>constructor-value</var> and <var>child-value</var> arguments:
separate them with an &ldquo;empty keyword&rdquo; <code>||:</code>.
This matches a method named <code>add</code>, which means that
the next argument effectively a <var>child-value</var> - as do
all the remaining arguments. Example:
</p><div class="example">
<pre class="example">(let ((vec #(1 2 3)))
  (java.util.ArrayList vec ||: 4 5 6))
  &rArr; [1, 2, 3, 4, 5, 6]
</pre></div>

<p>The compiler rewrites these allocations expression
to generated efficient bytecode, assuming that the &ldquo;function&rdquo;
being applied is a type known by the compiler.
Most of the above expressions also work if the type is applied
at run-time, in which case Kawa has to use slower reflection:
</p><div class="example">
<pre class="example">(define iarr int[])
(apply iarr (list 3 4 5)) &rArr; [3 4 5]
</pre></div>
<p>However <code>add<var>Xxx</var></code> methods and SAM-conversion
are currently only recognized in the case of a class known at compile-time,
not at run-time.
</p>
<p>Here is a working Swing demo illustrating many of these techniques:
</p>
<div class="example">
<pre class="example">(import (class javax.swing
               JButton Box JFrame))
(define-simple-class HBox (Box)
  ((*init*) (invoke-special Box (this) '*init* 0)))

(define value 0)

(define txt
  (javax.swing.JLabel
   text: &quot;0&quot;))

(define (set-value i)
  (set! value i)
  (set! txt:text (number-&gt;string i)))

(define fr
  (JFrame
     title: &quot;Hello!&quot;
     (Box 1#|VERTICAL|# ||:
      (javax.swing.Box:createGlue)
      txt
      (javax.swing.Box:createGlue)
      (HBox
       (JButton ;; uses 1-argument constructor
	&quot;Decrement&quot; ;; constructor argument
	tool-tip-text: &quot;decrement&quot;
	action-listener: (lambda (e) (set-value (- value 1))))
       (javax.swing.Box:createGlue)
       (JButton ;; uses 0-argument constructor
	text: &quot;Increment&quot;
	tool-tip-text: &quot;increment&quot;
	action-listener: (lambda (e) (set-value (+ value 1))))))))
(fr:setSize 200 100)
(set! fr:visible #t)
</pre></div>

<p>If you prefer, you can use the older <code>make</code> special function:
</p>
<dl class="def">
<dt id="index-make"><span class="category">Procedure: </span><span><strong>make</strong> <em>type args ...</em><a href='#index-make' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Constructs a new object instance of the specified <var>type</var>,
which must be either a <code>java.lang.Class</code> or a
<code>&lt;gnu.bytecode.ClassType&gt;</code>.
Equivalent to:
</p><div class="example">
<pre class="example"><var>type</var> <var>args</var> ...
</pre></div>
</dd></dl>

<p>Another (semi-deprecated) function is to use the colon notation
with the <code>new</code> pseudo-function.
The following three are all equivalent:
</p><div class="example">
<pre class="example">(java.awt.Point:new x: 4 y: 3)
(make java.awt.Point: x: 4 y: 3)
(java.awt.Point x: 4 y: 3)
</pre></div>

<hr>
</div>
<div class="section" id="Field-operations">
<div class="header">
<p>
Next: <a href="#Mangling" accesskey="n" rel="next">Mapping Scheme names to Java names</a>, Previous: <a href="#Allocating-objects" accesskey="p" rel="prev">Allocating objects</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Accessing-object-fields"></span><h3 class="section">19.11 Accessing object fields</h3>

<ul class="section-toc">
<li><a href="#Accessing-static-fields-and-properties" accesskey="1">Accessing static fields and properties</a></li>
<li><a href="#Accessing-instance-fields-and-properties" accesskey="2">Accessing instance fields and properties</a></li>
<li><a href="#Using-field-and-static_002dfield-methods" accesskey="3">Using field and static-field methods</a></li>
<li><a href="#Older-colon_002ddot-notation" accesskey="4">Older colon-dot notation</a></li>
</ul>
<div class="subsection" id="Accessing-static-fields-and-properties">
<h4 class="subsection">19.11.1 Accessing static fields and properties</h4>

<p>The recommmended way to access fields 
uses the <a href="#Colon-notation">colon notation</a>.
For static fields and properties the following is recommended:
</p><div class="display">
<pre class="display"><var>class-expression</var><code><b>:</b></code><var>field-name</var>
</pre></div>
<p>For example:
</p><div class="example">
<pre class="example">java.lang.Integer:MAX_VALUE
</pre></div>

<p>A property with a <code>get</code> method is equivalent to a field.
The following are all equivalent:
</p><div class="example">
<pre class="example">java.util.Currency:available-currencies
java.util.Currency:availableCurrencies
(java.util.Currency:getAvailableCurrencies)
</pre></div>

<p>Just like for a method call, the <var>class-expression</var>
can be a class in the current lexical scope,
a fully-qualified class name, or more generally an
expression that evaluates to a class.
</p>
</div>
<div class="subsection" id="Accessing-instance-fields-and-properties">
<h4 class="subsection">19.11.2 Accessing instance fields and properties</h4>

<p>The syntax is:
</p><div class="display">
<pre class="display"><var>instance</var><code><b>:</b></code><var>field-name</var>
</pre></div>

<p>The <var>field-name</var> can of course be the name of an actual
object field, but it can also be the name of a property with
a zero-argument <code>get</code> method.
For example, if <code>cal</code> is a <code>java.util-Calendar</code> instance,
then the following are all equivalent:
</p><div class="example">
<pre class="example">cal:time-zone
cal:timeZone
(cal:getTimeZone)
(cal:get-time-zone)
</pre></div>

<p>You can use colon notation to assign to a field:
</p><div class="example">
<pre class="example">(set! cal:time-zone TimeZone:default)
</pre></div>
<p>which is equivalent to:
</p><div class="example">
<pre class="example">(cal:setTimeZone (TimeZone:getDefault))
</pre></div>

<p>A Java array only has the <code>length</code> field, plus the <code>class</code> property:
</p><div class="example">
<pre class="example">(int[] 4 5 6):length &rArr; 3
(int[] 4 5 6):class:name &rArr; &quot;int[]&quot;
</pre></div>

</div>
<div class="subsection" id="Using-field-and-static_002dfield-methods">
<h4 class="subsection">19.11.3 Using field and static-field methods</h4>

<p>The following methods are useful in cases where colon notation
is ambiguous, for example where there are both fields and methods
with the same name.
You might also prefer as a matter of style, to
emphasise that a field is being accessed.
</p>
<dl class="def">
<dt id="index-field"><span class="category">Procedure: </span><span><strong>field</strong> <em>object fieldname</em><a href='#index-field' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the instance field with the given <var>fieldname</var> from the given
<var>Object</var>.  Returns the value of the field, which must be accessible.
This procedure has a <code>setter</code>, and so can be used as the first
operand to <code>set!</code>.
</p>
<p>The field name is &quot;mangled&quot; (see <a href="#Mangling">Mapping Scheme names to Java names</a>) into a valid Java name.
If there is no accessible field whose name is <code>&quot;<var>fieldname</var>&quot;</code>,
we look for a no-argument method whose name is
<code>&quot;get<var>Fieldname</var>&quot;</code> (or <code>&quot;is<var>Fieldname</var>&quot;</code> for a
boolean property).
</p>
<p>If <var>object</var> is a primitive Java array, then <var>fieldname</var> can only
be <code>'length</code>, and the result is the number of elements of the array.
</p></dd></dl>

<dl class="def">
<dt id="index-static_002dfield"><span class="category">Procedure: </span><span><strong>static-field</strong> <em>class fieldname</em><a href='#index-static_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the static field with the given <var>fieldname</var> from the given
<var>class</var>.  Returns the value of the field, which must be accessible.
This procedure has a <code>setter</code>, and so can be used as the first
operand to <code>set!</code>.
</p>
<p>If the <var>fieldname</var> is the special name <code>class</code>,
then it returns the <code>java.lang.Class</code> object corresponding to
<var>class</var> (which is usually a <code>gnu.bytecode.ClassType</code> object).
</p></dd></dl>

<p>Examples:
</p><div class="example">
<pre class="example">(static-field java.lang.System 'err)
;; Copy the car field of b into a.
(set! (field a 'car) (field b 'car))
</pre></div>

<dl class="def">
<dt id="index-slot_002dref"><span class="category">Procedure: </span><span><strong>slot-ref</strong> <em>object fieldname</em><a href='#index-slot_002dref' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A synonym for <code>(field <var>object</var> <var>fieldname</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-slot_002dset_0021"><span class="category">Procedure: </span><span><strong>slot-set!</strong> <em>object fieldname value</em><a href='#index-slot_002dset_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A synonym for <code>(set! (field <var>object</var> <var>fieldname</var>) <var>value</var>)</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Older-colon_002ddot-notation">
<h4 class="subsection">19.11.4 Older colon-dot notation</h4>

<p>There is older syntax where following the colon
there is field name a following the colon <em>and</em> a period.
</p>
<p>To access an static field named <var>field-name</var> use this syntax
</p><div class="example">
<pre class="example">(<var>prefix</var>:.<var>field-name</var> <var>instance</var>)
</pre></div>
<p>The <var>prefix</var> can be as discussed in See <a href="#Method-operations">Calling Java methods from Scheme</a>.
Here are 5 equivalent ways:
</p><div class="example">
<pre class="example">(java.lang.Integer:.MAX_VALUE)
(&lt;java.lang.Integer&gt;:.MAX_VALUE)
(define-namespace Int32 &lt;java.lang.Integer&gt;)
(Int32:.MAX_VALUE)
(define-namespace Integer &quot;class:java.lang.Integer&quot;)
(Integer:.MAX_VALUE)
(define-alias j.l.Integer java.lang.Integer)
(j.l.Integer:.MAX_VALUE)
</pre></div>
<p>You can set a static field using this syntax:
</p><div class="example">
<pre class="example">(set! (<var>prefix</var>:.<var>field-name</var>) <var>new-value</var>)
</pre></div>

<p>The special field name <code>class</code> can be used to extract the
<code>java.lang.Class</code> object for a class-type.  For example:
</p><div class="example">
<pre class="example">(java.util.Vector:.class) &rArr; class java.util.Vector
</pre></div>

<p>To access a instance field named <var>field-name</var> use the following syntax.
Note the period before the <var>field-name</var>.
</p><div class="example">
<pre class="example">(*:.<var>field-name</var> <var>instance</var>)
</pre></div>
<p>This syntax works with <code>set!</code> - to set the field use this syntax:
</p><div class="example">
<pre class="example">(set! (*:.<var>field-name</var> <var>instance</var>) <var>new-value</var>)
</pre></div>
<p>Here is an example:
</p><div class="example">
<pre class="example">(define p (list 3 4 5))
(*:.cdr p) &rArr; (4 5)
(set! (*:.cdr p) (list 6 7))
p &rArr; (3 6 7)
</pre></div>

<p>You can specify an explicit class:
</p><div class="example">
<pre class="example">(<var>prefix</var>:.<var>field-name</var> <var>instance</var>)
</pre></div>
<p>If <var>prefix</var> is bound to <code>&lt;<var>class</var>&gt;</code>, then the above
is equivalent to:
</p><div class="example">
<pre class="example">(*:.<var>field-name</var> (as &lt;<var>class</var>&gt; <var>instance</var>))
</pre></div>

<hr>
</div>
</div>
<div class="section" id="Mangling">
<div class="header">
<p>
Next: <a href="#Scheme-types-in-Java" accesskey="n" rel="next">Scheme types in Java</a>, Previous: <a href="#Field-operations" accesskey="p" rel="prev">Accessing object fields</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Mapping-Scheme-names-to-Java-names"></span><h3 class="section">19.12 Mapping Scheme names to Java names</h3>

<p>Programs use &quot;names&quot; to refer to various values and procedures.
The definition of what is a &quot;name&quot; is different in different
programming languages.  A name in Scheme (and other Lisp-like
languages) can in principle contain any character (if using a
suitable quoting convention), but typically names consist of
&quot;words&quot; (one or more letters) separated by hyphens, such
as &lsquo;<samp>make-temporary-file</samp>&rsquo;.  Digits
and some special symbols are also used.  Traditionally, Scheme is
case-insensitive;  this means that the names &lsquo;<samp>loop</samp>&rsquo;,
&lsquo;<samp>Loop</samp>&rsquo;, and &lsquo;<samp>LOOP</samp>&rsquo; are all the same name.  Kawa
is by default case-sensitive, but we recommend that you
avoid using upper-case letters as a general rule.
</p>
<p>The Java language and the Java virtual machine uses names for
classes, variables, fields and methods.
Names in the Java language can contain upper- and lower-case letters,
digits, and the special symbols &lsquo;<samp>_</samp>&rsquo; and &lsquo;<samp>$</samp>&rsquo;.
The Java virtual machine (JVM) allows most characters, but still
has some limitations.
</p>
<p>Kawa translates class names, package names, field names, and local variable
names using the
<a href="https://blogs.oracle.com/jrose/entry/symbolic_freedom_in_the_vm">&rdquo;symbolic&rdquo; convention</a>, so most characters are unchanged.
For example the Scheme function &lsquo;<samp>file-exists?</samp>&rsquo;
becomes the field &lsquo;<samp>file-exists?</samp>&rsquo;, but <code>dotted.name</code>
becomes &lsquo;<samp>dotted\,name</samp>&rsquo;.
Such names may not be valid Java name, so to access them from a
Java program you might have to use reflection.
</p>
<p>When translating procedure names to method names,
Kawa uses a different translation, in order to achieve
more &ldquo;Java-like&rdquo; names. This means translating a
Scheme-style name like &lsquo;<samp>make-temporary-file</samp>&rsquo; to
&quot;mixed-case&quot; words, such as &lsquo;<samp>makeTemporaryFile</samp>&rsquo;.
The basic rule is simple:  Hyphens are dropped, and
a letter that follows a hyphen is translated to its
upper-case (actually &quot;title-case&quot;) equivalent.  Otherwise,
letters are translated as is.
</p>
<p>Some special characters are handled specially.  A final &lsquo;<samp>?</samp>&rsquo;
is replaced by an <em>initial</em> &lsquo;<samp>is</samp>&rsquo;, with the following
letter converted to titlecase.  Thus &lsquo;<samp>number?</samp>&rsquo; is
converted to &lsquo;<samp>isNumber</samp>&rsquo; (which fits with Java conventions),
and &lsquo;<samp>file-exists?</samp>&rsquo; is converted to &lsquo;<samp>isFileExists</samp>&rsquo;
(which doesn&rsquo;t really).
The pair &lsquo;<samp>-&gt;</samp>&rsquo; is translated to &lsquo;<samp>$To$</samp>&rsquo;.
For example &lsquo;<samp>list-&gt;string</samp>&rsquo; is translated to &lsquo;<samp>list$To$string</samp>&rsquo;.
</p>
<p>Some symbols are mapped to a mnemonic sequence, starting with a dollar-sign,
followed by a two-character abbreviation.  For example, the less-than
symbol &lsquo;<samp>&lt;</samp>&rsquo; is mangled as &lsquo;<samp>$Ls</samp>&rsquo;.
See the source code to the <code>mangleName</code> method in the
<code>gnu.expr.Mangling</code> class for the full list.
Characters that do not have a mnemonic abbreviation are
mangled as &lsquo;<samp>$</samp>&rsquo; followed by a four-hex-digit unicode value.
For example &lsquo;<samp>Tamil vowel sign ai</samp>&rsquo; is mangled as &lsquo;<samp>$0bc8</samp>&rsquo;.
</p>
<p>Note that this mapping may map different Scheme names to the
same Java name.  For example &lsquo;<samp>string?</samp>&rsquo;, &lsquo;<samp>String?</samp>&rsquo;,
&lsquo;<samp>is-string</samp>&rsquo;, &lsquo;<samp>is-String</samp>&rsquo;,
and &lsquo;<samp>isString</samp>&rsquo; are all mapped to the same Java identifier
&lsquo;<samp>isString</samp>&rsquo;.  Code that uses such &quot;Java-clashing&quot; names
is <em>not</em> supported.  There is very partial support for
renaming names in the case of a clash, and there may be better
support in the future.  However, some of the nice features of
Kawa depend on being able to map Scheme name to Java names
naturally, so we urge you to <em>not</em> write code that
&quot;mixes&quot; naming conventions by using (say) the names &lsquo;<samp>open-file</samp>&rsquo;
and &lsquo;<samp>openFile</samp>&rsquo; to name two different objects.
</p>
<hr>
</div>
<div class="section" id="Scheme-types-in-Java">
<div class="header">
<p>
Next: <a href="#Array-operations" accesskey="n" rel="next">Using Java Arrays</a>, Previous: <a href="#Mangling" accesskey="p" rel="prev">Mapping Scheme names to Java names</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Scheme-types-in-Java-1"></span><h3 class="section">19.13 Scheme types in Java</h3>

<p>All Scheme values are implemented by sub-classes of &lsquo;<samp>java.lang.Object</samp>&rsquo;.
</p>
<p>Scheme symbols are implemented using <code>java.lang.String</code>.
(Don&rsquo;t be confused by the fact the Scheme sybols are represented
using Java Strings, while Scheme strings are represented by
<code>gnu.lists.FString</code>.  It is just that the semantics of Java strings
match Scheme symbols, but do not match mutable Scheme strings.)
Interned symbols are presented as interned Strings.
(Note that with JDK 1.1 string literals are automatically interned.)
</p>
<p>Scheme integers are implemented by <code>gnu.math.IntNum</code>.
Use the make static function to create a new IntNum from an int or a long.
Use the intValue or longValue methods to get the int or long value of
an IntNum.
</p>
<p>A Scheme &quot;flonum&quot; is implemented by <code>gnu.math.DFloNum</code>.
</p>
<p>A Scheme pair is implemented by <code>gnu.lists.Pair</code>.
</p>
<p>A Scheme vector is implemented by <code>gnu.lists.FVectror</code>.
</p>
<p>Scheme characters are implemented using <code>gnu.text.Char</code>.
</p>
<p>Scheme strings are implemented using <code>gnu.lists.FString</code>.
</p>
<p>Scheme procedures are all sub-classes of <code>gnu.mapping.Procedure</code>.
The &quot;action&quot; of a &lsquo;<samp>Procedure</samp>&rsquo; is invoked by using one of
the &lsquo;<samp>apply*</samp>&rsquo; methods:  &lsquo;<samp>apply0</samp>&rsquo;, &lsquo;<samp>apply1</samp>&rsquo;,
&lsquo;<samp>apply2</samp>&rsquo;, &lsquo;<samp>apply3</samp>&rsquo;, &lsquo;<samp>apply4</samp>&rsquo;, or &lsquo;<samp>applyN</samp>&rsquo;.
Various sub-class of &lsquo;<samp>Procedure</samp>&rsquo; provide defaults
for the various &lsquo;<samp>apply*</samp>&rsquo; methods.  For example,
a &lsquo;<samp>Procedure2</samp>&rsquo; is used by 2-argument procedures.
The &lsquo;<samp>Procedure2</samp>&rsquo; class provides implementations of all
the &lsquo;<samp>apply*</samp>&rsquo; methods <em>except</em> &lsquo;<samp>apply2</samp>&rsquo;,
which must be provided by any class that extends <code>Procedure2</code>.
</p>
<hr>
</div>
<div class="section" id="Array-operations">
<div class="header">
<p>
Next: <a href="#Loading-Java-functions-into-Scheme" accesskey="n" rel="next">Loading Java functions into Scheme</a>, Previous: <a href="#Scheme-types-in-Java" accesskey="p" rel="prev">Scheme types in Java</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Using-Java-Arrays"></span><h3 class="section">19.14 Using Java Arrays</h3>

<span id="Creating_002dnew_002dJava_002darrays"></span><ul class="section-toc">
<li><a href="#Creating-new-Java-arrays" accesskey="1">Creating new Java arrays</a></li>
<li><a href="#Accessing-Java-array-elements" accesskey="2">Accessing Java array elements</a></li>
<li><a href="#Old-low_002dlevel-array-macros" accesskey="3">Old low-level array macros</a></li>
</ul>
<div class="subsection" id="Creating-new-Java-arrays">
<h4 class="subsection">19.14.1 Creating new Java arrays</h4>
<p>To allocate a Java array you can use the array type specifier
as a constructor function.  For example, to allocate an array with room for 10 elements
each of each is a primitive <code>int</code>:
</p><div class="example">
<pre class="example">(int[] length: 10)
</pre></div>

<p>You can specify the initial elements instead of the length:
</p><div class="example">
<pre class="example">(object[] 31 32 33 34)
</pre></div>
<p>This creates a 4-length array, initialized to the given values.
</p>
<p>Note this is a variation of the generation object-allocation
(see <a href="#Allocating-objects">Allocating objects</a>) pattern.  You can explicitly
use the <code>make</code> function, if you prefer:
</p><div class="example">
<pre class="example">(make object[] 31 32 33 34)
</pre></div>

<p>If you specify a length, you can also specify initial values for selected
elements.
If you specify an index, in the form of a literal integer-valued keyword,
then following elements are placed starting at that position.
</p><div class="example">
<pre class="example">(int[] length: 100 10 12 80: 15 16 50: 13 14)
</pre></div>
<p>This creates an array with 100 elements.  Most of them are initialized
to the default value of zero,
but elements with indexes 0, 1, 50, 51, 80, 81 are initialized
to the values 10, 12, 13, 14, 15, 16, respectively.
</p>
</div>
<div class="subsection" id="Accessing-Java-array-elements">
<h4 class="subsection">19.14.2 Accessing Java array elements</h4>

<p>You can access the elements of a Java array by treating it as
a one-argument function, where the argument is the index:
</p><div class="example">
<pre class="example">(define primes (integer[] 2 3 5 7 11 13))
(primes 0) &rArr; 2
(primes 5) &rArr; 13
</pre></div>

<p>You can set an element by treating the array as a function
with a <code>setter</code>:
</p><div class="example">
<pre class="example">(set! (primes 0) -2)
(set! (primes 3) -7)
primes &rArr; [-2 3 5 -7 11 13]
</pre></div>

<p>To get the number of elements of an array, you can treat
it as having a <code>length</code> field:
</p><div class="example">
<pre class="example">primes:length &rArr; 6
</pre></div>

<p>Here is a longer example.  This is the actual definition of the
standard <code>gcd</code> function.  Note the <code>args</code> variable
receives all the arguments on the form of an <code>integer</code> array.
(This uses the Java5 varargs feature.)
</p><div class="example">
<pre class="example">(define (gcd #!rest (args ::integer[])) ::integer
  (let ((n ::int args:length))
    (if (= n 0)
	0
	(let ((result ::integer (args 0)))
	  (do ((i ::int 1 (+ i 1)))
	      ((&gt;= i n) result)
	    (set! result (gnu.math.IntNum:gcd result (args i))))))))
</pre></div>

<p>The above example generates good code,
thanks to judicious use of casts and type specifications.
In general, if Kawa knows that
a &ldquo;function&rdquo; is an array then it will generate efficient
bytecode instructions for array operations.
</p>
</div>
<div class="subsection" id="Old-low_002dlevel-array-macros">
<h4 class="subsection">19.14.3 Old low-level array macros</h4>

<p>The deprecated <a href="#Low_002dlevel-array-macros">Low-level array macros</a> are also supported.
</p>
<hr>
</div>
</div>
<div class="section" id="Loading-Java-functions-into-Scheme">
<div class="header">
<p>
Next: <a href="#Evaluating-Scheme-expressions-from-Java" accesskey="n" rel="next">Evaluating Scheme expressions from Java</a>, Previous: <a href="#Array-operations" accesskey="p" rel="prev">Using Java Arrays</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Loading-Java-functions-into-Scheme-1"></span><h3 class="section">19.15 Loading Java functions into Scheme</h3>

<p>When <code>kawa -C</code> compiles (see <a href="#Files-compilation">Compiling to a set of .class files</a>) a Scheme module
it creates a class that implements the <code>java.lang.Runnable</code> interface.
(Usually it is a class that extends the <code>gnu.expr.ModuleBody</code>.)
It is actually fairly easy to write similar &quot;modules&quot; by hand in Java,
which is useful when you want to extend Kawa with  new &quot;primitive functions&quot;
written in Java.  For each function you need to create an object that
extends <code>gnu.mapping.Procedure</code>, and then bind it in the global
environment.  We will look at these two operations.
</p>
<p>There are multiple ways you can create a <code>Procedure</code> object.  Below
is a simple example, using the <code>Procedure1</code> class, which is class
extending <code>Procedure</code> that can be useful for one-argument
procedure.  You can use other classes to write procedures.  For example
a <code>ProcedureN</code> takes a variable number of arguments, and you must
define <code>applyN(Object[] args)</code> method instead of <code>apply1</code>.
(You may notice that some builtin classes extend <code>CpsProcedure</code>.
Doing so allows has certain advantages, including support for
full tail-recursion, but it has some costs, and is a bit trickier.)
</p>
<div class="example">
<pre class="example">import gnu.mapping.*;
import gnu.math.*;
public class MyFunc extends Procedure1
{
  // An &quot;argument&quot; that is part of each procedure instance.
  private Object arg0;

  public MyFunc(String name, Object arg0)
  {
    super(name);
    this.arg0 = arg0;
  }

  public Object apply1 (Object arg1)
  {
    // Here you can so whatever you want. In this example,
    // we return a pair of the argument and arg0.
    return gnu.lists.Pair.make(arg0, arg1);
  }
}
</pre></div>

<p>You can create a <code>MyFunc</code> instance and call it from Java:
</p><div class="example">
<pre class="example">  Procedure myfunc1 = new MyFunc(&quot;my-func-1&quot;, Boolean.FALSE);
  Object aresult = myfunc1.apply1(some_object);
</pre></div>
<p>The name <code>my-func-1</code> is used when <code>myfunc1</code> is printed
or when <code>myfunc1.toString()</code> is called.  However,
the Scheme variable <code>my-func-1</code> is still not bound.
To define the function to Scheme, we can create
a &quot;module&quot;, which is a class intended to be loaded
into the top-level environment.  The provides the definitions to be
loaded, as well as any actions to be performed on loading 
</p>
<div class="example">
<pre class="example">public class MyModule
{
  // Define a function instance.
  public static final MyFunc myfunc1
    = new MyFunc(&quot;my-func-1&quot;, IntNum.make(1));
}
</pre></div>

<p>If you use Scheme you can use <code>require</code>:
</p><div class="example">
<pre class="example">#|kawa:1|# (require &lt;MyModule&gt;)
#|kawa:2|# (my-func-1 0)
(1 0)
</pre></div>

<p>Note that <code>require</code> magically defines <code>my-func-1</code> without
you telling it to.  For each public final
field, the name and value of the field are entered in the
top-level environment when the class is loaded.  (If there are
non-static fields, or the class implements <code>Runnable</code>, then
an instance of the object is created, if one isn&rsquo;t available.)
If the field value is a <code>Procedure</code> (or implements <code>Named</code>),
then the name bound to the procedure is used instead of the field name.
That is why the variable that gets bound in the Scheme environment is
<code>my-func-1</code>, not <code>myfunc1</code>.
</p>
<p>Instead of <code>(require &lt;MyModule&gt;)</code>, you can do <code>(load &quot;MyModule&quot;)</code>
or <code>(load &quot;MyModule.class&quot;)</code>.
If you&rsquo;re not using Scheme, you can use Kawa&rsquo;s <code>-f</code> option:
</p><div class="example">
<pre class="example">$ kawa -f MyModule --xquery --
#|kawa:1|# my-func-1(3+4)
&lt;list&gt;1 7&lt;/list&gt;
</pre></div>

<p>If you need to do some more complex calculations when a module is loaded,
you can put them in a <code>run</code> method, and have the module
implement <code>Runnable</code>:
</p>
<div class="example">
<pre class="example">public class MyModule implements Runnable
{
  public void run ()
  {
    Interpreter interp = Interpreter.getInterpreter();
    Object arg = Boolean.TRUE;
    interp.defineFunction (new MyFunc (&quot;my-func-t&quot;, arg));
    System.err.println(&quot;MyModule loaded&quot;);
  }
}
</pre></div>

<p>Loading <code>MyModule</code> causes <code>&quot;MyModule loaded&quot;</code> to be printed,
and <code>my-func-t</code> to be defined.  Using <code>Interpreter</code>&rsquo;s
<code>defineFunction</code> method is recommended because it does the righ
things even for languages like Common Lisp that use separate
&quot;namespaces&quot; for variables and functions.
</p>
<p>A final trick is that you can have a <code>Procedure</code> be its own module:
</p>
<div class="example">
<pre class="example">import gnu.mapping.*;
import gnu.math.*;
public class MyFunc2 extends Procedure2
{
  public MyFunc(String name)
  {
    super(name);
  }

  public Object apply2 (Object arg1, arg2)
  {
    return gnu.lists.Pair.make(arg1, arg2);
  }

  public static final MyFunc myfunc1 = new MyFunc(&quot;my-func-2);
}
</pre></div>

<hr>
</div>
<div class="section" id="Evaluating-Scheme-expressions-from-Java">
<div class="header">
<p>
Previous: <a href="#Loading-Java-functions-into-Scheme" accesskey="p" rel="prev">Loading Java functions into Scheme</a>, Up: <a href="#Objects-Classes-and-Modules" accesskey="u" rel="up">Object, Classes and Modules</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Evaluating-Scheme-expressions-from-Java-1"></span><h3 class="section">19.16 Evaluating Scheme expressions from Java</h3>

<p>The following methods are recommended if you need to evaluate a
Scheme expression from a Java method.
(Some details (such as the &lsquo;<samp>throws</samp>&rsquo; lists) may change.)
</p>
<dl class="def">
<dt id="index-Scheme_002eregisterEnvironment"><span class="category">Static method: </span><span><em>void</em> <strong>Scheme.registerEnvironment</strong> <em>()</em><a href='#index-Scheme_002eregisterEnvironment' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Initializes the Scheme environment.  Maybe needed if you
try to load a module compiled from a Scheme source file.
</p></dd></dl>

<dl class="def">
<dt id="index-Scheme_002eeval"><span class="category">Static method: </span><span><em>Object</em> <strong>Scheme.eval</strong> <em>(InPort <var>port</var>, Environment <var>env</var>)</em><a href='#index-Scheme_002eeval' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Read expressions from <var>port</var>, and evaluate them in the
<var>env</var> environment, until end-of-file is reached.
Return the value of the last expression,
or <code>Interpreter.voidObject</code> if there is no expression.
</p></dd></dl>

<dl class="def">
<dt id="index-Scheme_002eeval-1"><span class="category">Static method: </span><span><em>Object</em> <strong>Scheme.eval</strong> <em>(String <var>string</var>, Environment <var>env</var>)</em><a href='#index-Scheme_002eeval-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Read expressions from <var>string</var>, and evaluate them in the
<var>env</var> environment, until the end of the string is reached.
Return the value of the last expression,
or <code>Interpreter.voidObject</code> if there is no expression.
</p></dd></dl>

<dl class="def">
<dt id="index-Scheme_002eeval-2"><span class="category">Static method: </span><span><em>Object</em> <strong>Scheme.eval</strong> <em>(Object <var>sexpr</var>, Environment <var>env</var>)</em><a href='#index-Scheme_002eeval-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>sexpr</var> is an S-expression (as may be returned by <code>read</code>).
Evaluate it in the <var>env</var> environment, and return the result.
</p></dd></dl>

<p>For the <code>Environment</code> in most cases you could use
&lsquo;<samp>Environment.current()</samp>&rsquo;.  Before you start, you
need to initialize the global environment,
which you can do with
</p><div class="example">
<pre class="example">Environment.setCurrent(new Scheme().getEnvironment());
</pre></div>

<p>Alternatively, rather than setting the global environment,
you can use this style:
</p><div class="example">
<pre class="example">Scheme scm = new Scheme();
Object x = scm.eval(&quot;(+ 3 2)&quot;);
System.out.println(x);
</pre></div>

<ul class="section-toc">
<li><a href="#Using-javax_002escript-portable-Java-scripting" accesskey="1">Using <code>javax.script</code> portable Java scripting</a></li>
</ul>
<div class="subsection" id="Using-javax_002escript-portable-Java-scripting">
<h4 class="subsection">19.16.1 Using <code>javax.script</code> portable Java scripting</h4>

<p>Kawa also supports the standard
<a href="http://docs.oracle.com/javase/8/docs/api/javax/script/package-summary.html"><code>javax.script</code></a> API.
The main advantage of this API is if you want your users to be able to choose
between multiple scripting languages.  That way you can support Kawa
without Kawa-specific programming.
</p>
<p>For example the standard JDK tool <a href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jrunscript.html">jrunscript</a> provides a
read-eval-print-loop for any language that implements the  <code>javax.script</code>
API.  It knows nothing about Kawa but can still use it:
</p><div class="example">
<pre class="example">$ jrunscript -cp kawa.jar -l scheme
scheme&gt; (cadr '(3 4 5))
4
</pre></div>

<p>(Of course the <code>jrunscript</code> REPL isn&rsquo;t as  nice as the one that
Kawa provides.  For example the latter can handle multi-line inputs.)
</p>
<hr>
</div>
</div>
</div>
<div class="chapter" id="XML-tools">
<div class="header">
<p>
Next: <a href="#Miscellaneous" accesskey="n" rel="next">Miscellaneous topics</a>, Previous: <a href="#Objects-Classes-and-Modules" accesskey="p" rel="prev">Object, Classes and Modules</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Working-with-XML-and-HTML"></span><h2 class="chapter">20 Working with XML and HTML</h2>

<p>Kawa has a number of features for working with XML, HTML,
and generated web pages.
</p>
<p>In Kawa you don&rsquo;t write XML or HTML directly.
Instead you write expressions that evaluate to &ldquo;node objects&rdquo;
corresponding to elements, attributes, and text.
You then write these node objects using either an XML or HTML format.
</p>
<p>Many web-page-generating tools require you to work directly
with raw HTML, as for example:
</p><div class="example">
<pre class="example">(display &quot;&lt;p&gt;Don't use the &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tag.&lt;/p&gt;&quot;)
</pre></div>

<p>In Kawa you would instead do:
</p><div class="example">
<pre class="example">(display (html:p &quot;Don't use the &quot; (html:code &quot;&lt;blink&gt;&quot;) &quot; tag.&quot;))
</pre></div>

<p>The conversion from node objects to XML or HTML is handled by
the formatter (or serializer).
Some advantages of doing it this way are:
</p><ul>
<li> You don&rsquo;t have to worry about quoting special characters.
Missing or incorrect quoting is a common source of bugs
and security problems on systems that work directly with text, such as PHP.
</li><li> Some errors, such as mismatched element tags, are automatically avoided.
</li><li> The generated XML can be validated as it is generated,
or even using compile-time type-checking.  (Kawa doesn&rsquo;t yet do either.)
</li><li> In an application that also reads XML,
you can treat XML that is read in and XML that is generated using
the same functions.
</li></ul>


<ul class="section-toc">
<li><a href="#Formatting-XML" accesskey="1">Formatting XML</a></li>
<li><a href="#Creating-HTML-nodes" accesskey="2">Creating HTML nodes</a></li>
<li><a href="#Creating-XML-nodes" accesskey="3">Creating XML nodes</a></li>
<li><a href="#XML-literals" accesskey="4">XML literals</a></li>
<li><a href="#Server_002dside-scripts" accesskey="5">Web page scripts</a></li>
<li><a href="#Self_002dconfiguring-page-scripts" accesskey="6">Self-configuring web page scripts</a></li>
<li><a href="#Servlets" accesskey="7">Installing web page scripts as Servlets</a></li>
<li><a href="#CGI-scripts" accesskey="8">Installing Kawa programs as CGI scripts</a></li>
<li><a href="#HTTP-requests" accesskey="9">Functions for accessing HTTP requests</a></li>
<li><a href="#HTTP-response">Generating HTTP responses</a></li>
<li><a href="#XML-beyond-Scheme">Using non-Scheme languages for XML/HTML</a></li>
</ul>
<hr>
<div class="section" id="Formatting-XML">
<div class="header">
<p>
Next: <a href="#Creating-HTML-nodes" accesskey="n" rel="next">Creating HTML nodes</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Formatting-XML-1"></span><h3 class="section">20.1 Formatting XML</h3>

<p>The easiest way to generate HTML or XML output is to run Kawa
with the appropriate <a href="#Named-output-formats"><code>--output-format</code> option</a>.
</p>
<p>The intentation is that these output modes should be compatible with
<a href="http://www.w3.org/TR/2006/PR-xslt-xquery-serialization-20061121/">XSLT 2.0 and XQuery 1.0 Serialization</a>.
(However, that specifies many options, most
of which have not yet been implemented.
</p>
<dl compact="compact">
<dt><span><code>xml</code></span></dt>
<dd><p>Values are printed in XML format.
&quot;Groups&quot; or &quot;elements&quot; are written as using xml element syntax.
Plain characters (such as &lsquo;<samp>&lt;</samp>&rsquo;) are escaped (such as &lsquo;<samp>&amp;lt;</samp>&rsquo;).
</p></dd>
<dt><span><code>xhtml</code></span></dt>
<dd><p>Same as <code>xml</code>, but follows the xhtml compatibility guidelines.
</p></dd>
<dt><span><code>html</code></span></dt>
<dd><p>Values are printed in HTML format.
Mostly same as <code>xml</code> format, but certain elements without body,
are written without a closing tag.   For example <code>&lt;img&gt;</code> is written
without <code>&lt;/img&gt;</code>, which would be illegal for html, but required for xml.
Plain characters (such as &lsquo;<samp>&lt;</samp>&rsquo;) are not escaped inside <code>&lt;script&gt;</code>
or <code>&lt;style&gt;</code> elements.
</p></dd>
</dl>

<p>To illustrate:
</p><div class="example">
<pre class="example">$ kawa --output-format html
#|kawa:1|# (html:img src:&quot;img.jpg&quot;)
&lt;img src=&quot;img.jpg&quot;&gt;
</pre></div>
<div class="example">
<pre class="example">$ kawa --output-format xhtml
#|kawa:1|# (html:img src:&quot;img.jpg&quot;)
&lt;img xmlns=&quot;http://www.w3.org/1999/xhtml&quot; src=&quot;img.jpg&quot; /&gt;
</pre></div>
<div class="example">
<pre class="example">$ kawa --output-format xml
#|kawa:1|# (html:img src:&quot;img.jpg&quot;)
&lt;img xmlns=&quot;http://www.w3.org/1999/xhtml&quot; src=&quot;img.jpg&quot;&gt;&lt;/img&gt;
</pre></div>
<p>And here is the default <code>scheme</code> formatting:
</p><div class="example">
<pre class="example">$ kawa
#|kawa:1|# (html:img src:&quot;img.jpg&quot;)
({http://www.w3.org/1999/xhtml}img src: img.jpg )
</pre></div>

<dl class="def">
<dt id="index-as_002dxml"><span class="category">Procedure: </span><span><strong>as-xml</strong> <em>value</em><a href='#index-as_002dxml' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a value (or multiple values) that when printed will
print <var>value</var> in XML syntax.
</p><div class="example">
<pre class="example">(require 'xml)
(as-xml (make-element 'p &quot;Some &quot; (make-element 'em &quot;text&quot;) &quot;.&quot;))
</pre></div>
<p>prints <code>&lt;p&gt;Some &lt;em&gt;text&lt;/em&gt;.&lt;/p&gt;</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-unescaped_002ddata"><span class="category">Procedure: </span><span><strong>unescaped-data</strong> <em>data</em><a href='#index-unescaped_002ddata' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a special value which causes <code>data</code> to be printed,
as is, without normal escaping.  For example, when the output format
is XML, then printing <code>&quot;&lt;?xml?&gt;&quot;</code> prints as &lsquo;<samp>&amp;lt;?xml?&amp;gt;</samp>&rsquo;,
but <code>(unescaped-data &quot;&lt;?xml?&gt;&quot;)</code> prints as  &lsquo;<samp>&lt;?xml?&gt;</samp>&rsquo;.
</p></dd></dl>

<hr>
</div>
<div class="section" id="Creating-HTML-nodes">
<div class="header">
<p>
Next: <a href="#Creating-XML-nodes" accesskey="n" rel="next">Creating XML nodes</a>, Previous: <a href="#Formatting-XML" accesskey="p" rel="prev">Formatting XML</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Creating-HTML-nodes-1"></span><h3 class="section">20.2 Creating HTML nodes</h3>

<p>The <code>html</code> prefix names a special namespace
(see <a href="#Namespaces">Namespaces and compound symbols</a>) of functions to create HTML element nodes.
For example, <code>html:em</code> is a constructor that
when called creates a element node whose tag is <code>em</code>.
If this element node is formatted as HTML, the
result has an <code>&lt;em&gt;</code> tag.
</p>
<dl class="def">
<dt id="index-html_003atag"><span class="category">Syntax: </span><span><strong>html:<var>tag</var></strong> <em>attributes ... content ...</em><a href='#index-html_003atag' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates an element node whose tag is <var>tag</var>.
The parameters are first zero or more attributes, followed
by zero of more child values.
An attribute is either an attribute value (possibly
created using <code>make-attribute</code>), or a pair of arguments:
A keyword followed by the attribute value.
Child values are usually either strings (text content),
or nested element nodes, but can also be comment or processing-instruction
nodes.
</p><div class="example">
<pre class="example">(html:a href: &quot;http://gnu.org/&quot; &quot;the &quot;(html:i &quot;GNU&quot;)&quot; homepage&quot;)
</pre></div>
</dd></dl>

<p>The compound identifier <code>html:<var>tag</var></code> is actually
a type: When you call it as a function you&rsquo;re using Kawa&rsquo;s
standard coercion of a type to its constructor function.
This means you can do type tests:
</p><div class="example">
<pre class="example">(define some-node ...)
(if (instance? some-node html:blink)
  (error &quot;blinking not allowed!&quot;))
</pre></div>

<p>Object identity is currently not fully specified.  Specifically,
it is undefined if a nested (child) element node is copied
&ldquo;by value&rdquo; or &ldquo;by reference&rdquo;.  This is related to whether
nodes have a parent reference.  In the XPath/XQuery data model
nodes do have a parent reference, and child nodes are conceptually
copied.  (In the actual implemention copying is commonly avoided.)
Kawa/Scheme currently followed the XQuery copying semantics,
which may not be the most appropriate for Scheme.
</p>
<hr>
</div>
<div class="section" id="Creating-XML-nodes">
<div class="header">
<p>
Next: <a href="#XML-literals" accesskey="n" rel="next">XML literals</a>, Previous: <a href="#Creating-HTML-nodes" accesskey="p" rel="prev">Creating HTML nodes</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Creating-XML-nodes-1"></span><h3 class="section">20.3 Creating XML nodes</h3>

<p>The XML data model is similar to HTML, with one important addition:
XML tags may be <em>qualified names</em>, which are similar
to <a href="#Namespaces">compound symbols</a>.
</p>
<p>You must do this to use the following types and functions:
</p><div class="example">
<pre class="example">(require 'xml)
</pre></div>

<p>The following types and functions assume:
</p><div class="example">
<pre class="example">(require 'xml)
</pre></div>

<dl class="def">
<dt id="index-make_002delement"><span class="category">Procedure: </span><span><strong>make-element</strong> <em>tag [attribute ...] child ...</em><a href='#index-make_002delement' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a representation of a XML element, corresponding to
</p><div class="example">
<pre class="example">&lt;<var>tag</var> <var>attribute</var>...&gt;<var>child</var>...&lt;/<var>tag</var>&gt;
</pre></div>
<p>The result is a <code>TreeList</code>, though if the result context is a consumer
the result is instead &quot;written&quot; to the consumer.
Thus nested calls to <code>make-element</code> only result in a
single <code>TreeList</code>.
More generally, whether an <var>attribute</var> or <var>child</var> is includded
by copying or by reference is (for now) undefined.
The <var>tag</var> should currently be a symbol, though in the future it should
be a qualified name.
An <var>attribute</var> is typically a call to <code>make-attribute</code>,
but it can be any attribute-valued expression.
</p><div class="example">
<pre class="example">(make-element 'p
	      &quot;The time is now: &quot;
	      (make-element 'code (make &lt;java.util.Date&gt;)))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-element_002dname"><span class="category">Procedure: </span><span><strong>element-name</strong> <em>element</em><a href='#index-element_002dname' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the name (tag) of the element node, as a symbol (QName).
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dattribute"><span class="category">Procedure: </span><span><strong>make-attribute</strong> <em>name value...</em><a href='#index-make_002dattribute' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create an &quot;attribute&quot;, which is a name-value pair.
For now, <var>name</var> should be a symbol.
</p></dd></dl>

<dl class="def">
<dt id="index-attribute_002dname"><span class="category">Procedure: </span><span><strong>attribute-name</strong> <em>element</em><a href='#index-attribute_002dname' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the name of the attribute node, as a symbol (QName).
</p></dd></dl>

<dl class="def">
<dt id="index-comment-1"><span class="category">Type: </span><span><strong>comment</strong><a href='#index-comment-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Instances of this type represent comment values,
specifically including comments in XML files.
Comment nodes are currently ignored when printing using Scheme formatting,
though that may change.
</p></dd></dl>
<dl class="def">
<dt id="index-comment-2"><span class="category">Constructor: </span><span><strong>comment</strong> <em>comment-text</em><a href='#index-comment-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a comment object with the specified <var>comment-text</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-processing_002dinstruction"><span class="category">Type: </span><span><strong>processing-instruction</strong><a href='#index-processing_002dinstruction' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Instances of this type represent &ldquo;processing instructions&rdquo;,
such as may appear in XML files.
Processing-instruction nodes are currently ignored when printing using
Scheme formatting, though that may change.
</p></dd></dl>
<dl class="def">
<dt id="index-processing_002dinstruction-1"><span class="category">Constructor: </span><span><strong>processing-instruction</strong> <em>target contents</em><a href='#index-processing_002dinstruction-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Crreate a processing-instruction object with the specified <var>target</var>
(a simple symbol) and <var>contents</var> (a string).
</p></dd></dl>

<hr>
</div>
<div class="section" id="XML-literals">
<div class="header">
<p>
Next: <a href="#Server_002dside-scripts" accesskey="n" rel="next">Web page scripts</a>, Previous: <a href="#Creating-XML-nodes" accesskey="p" rel="prev">Creating XML nodes</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="XML-literals-1"></span><h3 class="section">20.4 XML literals</h3>

<p>You can write XML literals directly in Scheme code,
following a <code>#</code>.
Notice that the outermost element needs to be prefixed
by <code>#</code>, but nested elements do not (and must not).
</p><div class="example">
<pre class="example">#&lt;p&gt;The result is &lt;b&gt;final&lt;/b&gt;!&lt;/p&gt;
</pre></div>

<p>Actually, these are not really literals since they can contain
enclosed expressions:
</p><div class="example">
<pre class="example">#&lt;em&gt;The result is &amp;{result}.&lt;/em&gt;
</pre></div>
<p>The value of <var>result</var> is substituted into the output,
in a similar way to quasi-quotation.
(If you try to quote one of these &ldquo;XML literals&rdquo;,
what you get is unspecified and is subject to change.)
</p>
<p>An <var>xml-literal</var> is usually an element constructor,
but there some rarely used forms (processing-instructions,
comments, and CDATA section) we&rsquo;ll cover later.
</p>
<div class="display">
<pre class="display"><span id="index-xml_002dliteral"></span><span id="meta_002dxml_002dliteral"></span><var>xml-literal</var> <tt>::=</tt> <code><b>#</b></code><a href="#meta_002dxml_002dconstructor"><var>xml-constructor</var></a>
<span id="index-xml_002dconstructor"></span><span id="meta_002dxml_002dconstructor"></span><var>xml-constructor</var> <tt>::=</tt> <a href="#meta_002dxml_002delement_002dconstructor"><var>xml-element-constructor</var></a>
  | <a href="#meta_002dxml_002dPI_002dconstructor"><var>xml-PI-constructor</var></a>
  | <a href="#meta_002dxml_002dcomment_002dconstructor"><var>xml-comment-constructor</var></a>
  | <a href="#meta_002dxml_002dCDATA_002dconstructor"><var>xml-CDATA-constructor</var></a>
</pre></div>

<ul class="section-toc">
<li><a href="#Element-constructors" accesskey="1">Element constructors</a></li>
<li><a href="#Elements-contents-_0028children_0029" accesskey="2">Elements contents (children)</a></li>
<li><a href="#Attributes" accesskey="3">Attributes</a></li>
<li><a href="#QNames-and-namespaces" accesskey="4">QNames and namespaces</a></li>
<li><a href="#Other-XML-types" accesskey="5">Other XML types</a></li>
</ul>
<div class="subsection" id="Element-constructors">
<h4 class="subsection">20.4.1 Element constructors</h4>

<div class="display">
<pre class="display"><span id="index-xml_002delement_002dconstructor"></span><span id="meta_002dxml_002delement_002dconstructor"></span><var>xml-element-constructor</var> <tt>::=</tt>
    <code><b>&lt;</b></code><a href="#meta_002dQName"><var>QName</var></a> <a href="#meta_002dxml_002dattribute"><var>xml-attribute</var></a>*<code><b>&gt;</b></code><a href="#meta_002dxml_002delement_002ddatum"><var>xml-element-datum</var></a>...<code><b>&lt;/</b></code><a href="#meta_002dQName"><var>QName</var></a> <code><b>&gt;</b></code>
  | <code><b>&lt;</b></code><a href="#meta_002dxml_002dname_002dform"><var>xml-name-form</var></a> <a href="#meta_002dxml_002dattribute"><var>xml-attribute</var></a>*<code><b>&gt;</b></code><a href="#meta_002dxml_002delement_002ddatum"><var>xml-element-datum</var></a>...<code><b>&lt;/&gt;</b></code>
  | <code><b>&lt;</b></code><var>xml-name-form</var> <a href="#meta_002dxml_002dattribute"><var>xml-attribute</var></a>*<code><b>/&gt;</b></code>
<span id="index-xml_002dname_002dform"></span><span id="meta_002dxml_002dname_002dform"></span><var>xml-name-form</var> <tt>::=</tt> <a href="#meta_002dQName"><var>QName</var></a>
  | <a href="#meta_002dxml_002denclosed_002dexpression"><var>xml-enclosed-expression</var></a>
<span id="index-xml_002denclosed_002dexpression"></span><span id="meta_002dxml_002denclosed_002dexpression"></span><var>xml-enclosed-expression</var> <tt>::=</tt>
    <code><b>{</b></code><a href="#meta_002dexpression"><var>expression</var></a><code><b>}</b></code>
  | <code><b>(</b></code><a href="#meta_002dexpression"><var>expression</var></a>...<code><b>)</b></code>
</pre></div>

<p>The first <var>xml-element-constructor</var> variant uses a literal <var>QName</var>,
and looks like standard non-empty XML element, where the starting <var>QName</var>
and the ending <var>QName</var> must match exactly:
</p>
<div class="example">
<pre class="example">#&lt;a href=&quot;next.html&quot;&gt;Next&lt;/a&gt;
</pre></div>

<p>As a convenience, you can leave out the ending tag(s):
</p><div class="example">
<pre class="example">This is a paragraph in &lt;emphasis&gt;DocBook&lt;/&gt; syntax.&lt;/&gt;
</pre></div>

<p>You can use an expression to compute the element tag at runtime -
in that case you <em>must</em> leave out the ending tag:
</p><div class="example">
<pre class="example">#&lt;p&gt;This is &lt;(if be-bold 'strong 'em)&gt;important&lt;/&gt;!&lt;/p&gt;
</pre></div>

<p>You can use arbitrary <var>expression</var> inside curly braces,
as long as it evaluates to a symbol.
You can leave out the curly braces
if the <var>expression</var> is a simple parenthesised compound expression.
The previous example is equivalent to:
</p><div class="example">
<pre class="example">#&lt;p&gt;This is &lt;{(if be-bold 'strong 'em)}&gt;important&lt;/&gt;!&lt;/p&gt;
</pre></div>

<p>The third <var>xml-element-constructor</var> variant above is an XML
&ldquo;empty element&rdquo;; it is equivalent to the second variant
when there are no <var>xml-element-datum</var> items.
</p>
<p>(Note that every well-formed XML element, as defined in the XML specifications,
is a valid <var>xml-element-constructor</var>, but not vice versa.)
</p>
</div>
<div class="subsection" id="Elements-contents-_0028children_0029">
<h4 class="subsection">20.4.2 Elements contents (children)</h4>

<p>The &ldquo;contents&rdquo; (children) of an element
are a sequence of character (text) data, and nested nodes.
The characters <code>&amp;</code>, <code>&lt;</code>, and <code>&gt;</code> are special,
and need to be escaped.
</p>
<div class="display">
<pre class="display"><span id="index-xml_002delement_002ddatum"></span><span id="meta_002dxml_002delement_002ddatum"></span><var>xml-element-datum</var> <tt>::=</tt>
    any character except <code>&amp;</code>, or <code>&lt;</code>.
  | <a href="#meta_002dxml_002dconstructor"><var>xml-constructor</var></a>
  | <a href="#meta_002dxml_002descaped"><var>xml-escaped</var></a>
<span id="index-xml_002descaped"></span><span id="meta_002dxml_002descaped"></span><var>xml-escaped</var> <tt>::=</tt>
    <code><b>&amp;</b></code><a href="#meta_002dxml_002denclosed_002dexpression"><var>xml-enclosed-expression</var></a>
  | <code><b>&amp;</b></code><a href="#meta_002dxml_002dentity_002dname"><var>xml-entity-name</var></a><code><b>;</b></code>
  | <a href="#meta_002dxml_002dcharacter_002dreference"><var>xml-character-reference</var></a>
<span id="index-xml_002dcharacter_002dreference"></span><span id="meta_002dxml_002dcharacter_002dreference"></span><var>xml-character-reference</var> <tt>::=</tt>
    <code><b>&amp;#</b></code><a href="#meta_002ddigit"><var>digit</var></a>+<code><b>;</b></code>
  | <code><b>&amp;#x</b></code><a href="#meta_002dhex_002ddigit"><var>hex-digit</var></a>+<code><b>;</b></code>
</pre></div>

<p>Here is an example shows both hex and decimal character references:
</p><div class="example">
<pre class="example">#&lt;p&gt;A&amp;#66;C&amp;#x44;E&lt;/p&gt;  &rArr;  &lt;p&gt;ABCDE&lt;/p&gt;
</pre></div>

<div class="display">
<pre class="display"><span id="index-xml_002dentity_002dname"></span><span id="meta_002dxml_002dentity_002dname"></span><var>xml-entity-name</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>
<p>Currently, the only supported values for <var>xml-entity-name</var>
are the builtin XML names <code>lt</code>, <code>gt</code>, <code>amp</code>,
<code>quot</code>, and <code>apos</code>, which stand for the characters
<code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, <code>&quot;</code>, and <code>'</code>, respectively.
The following two expressions are equivalent:
</p><div class="example">
<pre class="example">#&lt;p&gt;&amp;lt; &amp;gt; &amp;amp; &amp;quot; &amp;apos;&lt;/p&gt;
#&lt;p&gt;&amp;{&quot;&lt; &gt; &amp; \&quot; '&quot;}&lt;/p&gt;
</pre></div>

</div>
<div class="subsection" id="Attributes">
<h4 class="subsection">20.4.3 Attributes</h4>

<div class="display">
<pre class="display"><span id="index-xml_002dattribute"></span><span id="meta_002dxml_002dattribute"></span><var>xml-attribute</var> <tt>::=</tt>
    <a href="#meta_002dxml_002dname_002dform"><var>xml-name-form</var></a><code><b>=</b></code><a href="#meta_002dxml_002dattribute_002dvalue"><var>xml-attribute-value</var></a>
<span id="index-xml_002dattribute_002dvalue"></span><span id="meta_002dxml_002dattribute_002dvalue"></span><var>xml-attribute-value</var> <tt>::=</tt>
    <code><b>&quot;</b></code><a href="#meta_002dquot_002dattribute_002ddatum"><var>quot-attribute-datum</var></a>*<code><b>&quot;</b></code>
  | <code><b>&rsquo;</b></code><a href="#meta_002dapos_002dattribute_002ddatum"><var>apos-attribute-datum</var></a>*<code><b>&rsquo;</b></code>
<span id="index-quot_002dattribute_002ddatum"></span><span id="meta_002dquot_002dattribute_002ddatum"></span><var>quot-attribute-datum</var> <tt>::=</tt>
    any character except <code>&quot;</code>, <code>&amp;</code>, or <code>&lt;</code>.
  | <a href="#meta_002dxml_002descaped"><var>xml-escaped</var></a>
<span id="index-apos_002dattribute_002ddatum"></span><span id="meta_002dapos_002dattribute_002ddatum"></span><var>apos-attribute-datum</var> <tt>::=</tt>
    any character except <code>'</code>, <code>&amp;</code>, or <code>&lt;</code>.
  | <a href="#meta_002dxml_002descaped"><var>xml-escaped</var></a>
</pre></div>

<p>If the <var>xml-name-form</var> is either <code>xmlns</code> or
a compound named with the prefix <code>xmlns</code>, then
technically we have a namespace declaration, rather than
an attribute.
</p>
</div>
<div class="subsection" id="QNames-and-namespaces">
<h4 class="subsection">20.4.4 QNames and namespaces</h4>

<p>The names of elements and attributes are <em>qualified names</em>
(QNames), which are represented using compound symbols (see <a href="#Namespaces">Namespaces and compound symbols</a>).
The lexical syntax for a QName is either a simple identifier,
or a (prefix,local-name) pair:
</p>
<div class="display">
<pre class="display"><span id="index-QName"></span><span id="meta_002dQName"></span><var>QName</var> <tt>::=</tt> <a href="#meta_002dxml_002dlocal_002dpart"><var>xml-local-part</var></a>
   | <a href="#meta_002dxml_002dprefix"><var>xml-prefix</var></a><code><b>:</b></code><a href="#meta_002dxml_002dlocal_002dpart"><var>xml-local-part</var></a>
<span id="index-xml_002dlocal_002dpart"></span><span id="meta_002dxml_002dlocal_002dpart"></span><var>xml-local-part</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
<span id="index-xml_002dprefix"></span><span id="meta_002dxml_002dprefix"></span><var>xml-prefix</var> <tt>::=</tt> <a href="#meta_002didentifier"><var>identifier</var></a>
</pre></div>

<p>An <var>xml-prefix</var> is an alias for a namespace-uri,
and the mapping between them is defined by a namespace-declaration.
You can either use a <code>define-namespace</code> form, or you
can use a <em>namespace declaration attribute</em>:
</p>
<div class="display">
<pre class="display"><span id="index-xml_002dnamespace_002ddeclaration_002dattribute"></span><span id="meta_002dxml_002dnamespace_002ddeclaration_002dattribute"></span><var>xml-namespace-declaration-attribute</var> <tt>::=</tt>
    <code><b>xmlns:</b></code><a href="#meta_002dxml_002dprefix"><var>xml-prefix</var></a><code><b>=</b></code><a href="#meta_002dxml_002dattribute_002dvalue"><var>xml-attribute-value</var></a>
  | <code><b>xmlns=</b></code><a href="#meta_002dxml_002dattribute_002dvalue"><var>xml-attribute-value</var></a>
</pre></div>

<p>The former declares <var>xml-prefix</var> as a namespace alias for
the namespace-uri specified by <var>xml-attribute-value</var>
(which must be a compile-time constant).
The second declares that <var>xml-attribute-value</var> is the default
namespace for simple (unprefixed) element tags.
(A default namespace declaration is ignored for attribute names.)
</p>
<div class="example">
<pre class="example">(let ((qn (element-name #&lt;gnu:b xmlns:gnu=&quot;http://gnu.org/&quot;/&gt;)))
  (list (symbol-local-name qn)
        (symbol-prefix qn)
        (symbol-namespace-uri qn)))
&rArr; (&quot;b&quot; &quot;gnu&quot; &quot;http://gnu.org/&quot;)

</pre></div>

</div>
<div class="subsection" id="Other-XML-types">
<h4 class="subsection">20.4.5 Other XML types</h4>

<ul class="section-toc">
<li><a href="#Processing-instructions" accesskey="1">Processing instructions</a></li>
<li><a href="#XML-comments" accesskey="2">XML comments</a></li>
<li><a href="#CDATA-sections" accesskey="3">CDATA sections</a></li>
</ul>
<div class="subsubsection" id="Processing-instructions">
<h4 class="subsubsection">20.4.5.1 Processing instructions</h4>

<p>An <var>xml-PI-constructor</var> can be used to create an XML
<em>processing instruction</em>, which can be used to pass
instructions or annotations to an XML processor (or tool).
(Alternatively, you can use the <code>processing-instruction</code>
type constructor.)
</p>
<div class="display">
<pre class="display"><span id="index-xml_002dPI_002dconstructor"></span><span id="meta_002dxml_002dPI_002dconstructor"></span><var>xml-PI-constructor</var> <tt>::=</tt> <code><b>&lt;?</b></code><a href="#meta_002dxml_002dPI_002dtarget"><var>xml-PI-target</var></a> <a href="#meta_002dxml_002dPI_002dcontent"><var>xml-PI-content</var></a><code><b>?&gt;</b></code>
<span id="index-xml_002dPI_002dtarget"></span><span id="meta_002dxml_002dPI_002dtarget"></span><var>xml-PI-target</var> <tt>::=</tt> <var>NCname</var> (i.e. a simple (non-compound) identifier)
<span id="index-xml_002dPI_002dcontent"></span><span id="meta_002dxml_002dPI_002dcontent"></span><var>xml-PI-content</var> <tt>::=</tt> any characters, not containing <code>?&gt;</code>.
</pre></div>

<p>For example, the DocBook XSLT stylesheets can use the <code>dbhtml</code>
instructions to specify that a specific chapter should be
written to a named HTML file:
</p><div class="example">
<pre class="example">#&lt;chapter&gt;&lt;?dbhtml filename=&quot;intro.html&quot; ?&gt;
&lt;title&gt;Introduction&lt;/title&gt;
...
&lt;/chapter&gt;
</pre></div>

</div>
<div class="subsubsection" id="XML-comments">
<h4 class="subsubsection">20.4.5.2 XML comments</h4>

<p>You can cause XML comments to be emitted in the XML output document.
Such comments can be useful for humans reading the XML document,
but are usually ignored by programs.
(Alternatively, you can use the <code>comment</code> type constructor.)
</p>
<div class="display">
<pre class="display"><span id="index-xml_002dcomment_002dconstructor"></span><span id="meta_002dxml_002dcomment_002dconstructor"></span><var>xml-comment-constructor</var> <tt>::=</tt> <code><b>&lt;!&ndash;</b></code><a href="#meta_002dxml_002dcomment_002dcontent"><var>xml-comment-content</var></a><code><b>&ndash;&gt;</b></code>
<span id="index-xml_002dcomment_002dcontent"></span><span id="meta_002dxml_002dcomment_002dcontent"></span><var>xml-comment-content</var> <tt>::=</tt> any characters, not containing <code>--</code>.
</pre></div>

</div>
<div class="subsubsection" id="CDATA-sections">
<h4 class="subsubsection">20.4.5.3 CDATA sections</h4>

<p>A <code>CDATA</code> section can be used to avoid excessive use of
<var>xml-entity-ref</var> such as <code>&amp;amp;</code> in element content.
</p>
<div class="display">
<pre class="display"><span id="index-xml_002dCDATA_002dconstructor"></span><span id="meta_002dxml_002dCDATA_002dconstructor"></span><var>xml-CDATA-constructor</var> <tt>::=</tt> <code><b>&lt;![CDATA[</b></code><a href="#meta_002dxml_002dCDATA_002dcontent"><var>xml-CDATA-content</var></a><code><b>]]&gt;</b></code>
<span id="index-xml_002dCDATA_002dcontent"></span><span id="meta_002dxml_002dCDATA_002dcontent"></span><var>xml-CDATA-content</var> <tt>::=</tt> any characters, not containing <code>]]&gt;</code>.
</pre></div>

<p>The following are equivalent:
</p><div class="example">
<pre class="example">#&lt;p&gt;Specal characters &lt;![CDATA[&lt; &gt; &amp; ' &quot;]]&gt; here.&lt;/p&gt;
#&lt;p&gt;Specal characters &amp;lt; &amp;gt; &amp;amp; &amp;quot; &amp;apos; here.&lt;/p&gt;
</pre></div>

<p>Kawa remembers that you used a <code>CDATA</code> section in
the <var>xml-element-constructor</var> and will write it out
using a <code>CDATA</code> constructor.
</p>
<hr>
</div>
</div>
</div>
<div class="section" id="Server_002dside-scripts">
<div class="header">
<p>
Next: <a href="#Self_002dconfiguring-page-scripts" accesskey="n" rel="next">Self-configuring web page scripts</a>, Previous: <a href="#XML-literals" accesskey="p" rel="prev">XML literals</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Web-page-scripts"></span><h3 class="section">20.5 Web page scripts</h3>

<p>A Kawa <em>web page script</em> is a Kawa program that is invoked
by a web server because the server received an HTTP request.
The result of evaluating the top-level expressions becomes
the HTTP response that the servlet sends back to the client, usually a browser.
</p>
<p>A web page script may be as simple as:
</p><div class="example">
<pre class="example">(format &quot;The time is &lt;~s&gt;.&quot; (java.util.Date))
</pre></div>
<p>This returns a response of consisting of a formatted string
giving the current time.
The string would interpreted as <code>text/plain</code> content:
The angle brackets are regular characters, and not
HTML tag markers.
</p>
<p>The script can alternatively evaluate to XML/HTML node
values, for example those created by <a href="#XML-literals">XML literals</a>:
</p><div class="example">
<pre class="example">#&lt;p&gt;Hello, &lt;b&gt;&amp;(request-remote-host)&lt;/b&gt;!&lt;/p&gt;
</pre></div>
<p>In this case the response would be <code>text/html</code> or similar content:
The angle brackets should be interpreted by the browser as HTML tag markers.
The function <code>request-remote-host</code> is available (automatically)
to web page scripts; it returns the host that made the HTTP request,
which is then interpolated into the response.
</p>
<p>Following sections will go into more details about how
to write web page scripts.  You can do so in any supported
Kawa language, including Scheme, BRL, KRL, or XQuery.
</p>
<p>A web server will use a URL mapping to map a request URL
to a specific web page script.  This can be done in a
number of different ways:
</p><ul>
<li> The easiest to manage is to use Kawa&rsquo;s mechanism for
<a href="#Self_002dconfiguring-page-scripts">Self-configuring web page scripts</a>.  Ths is especially
easy if you the web server built in to JDK 6, since no
configuration files are needed.
You can also use a &ldquo;servlet engine&rdquo; like Tomcat or Glassfish.

</li><li> You can explicitly compile the web page script to a servlet,
in the same way Java servlets are compiled.
This can then be installed (&quot;deployed&quot;) in a servlet-supporting
web server, such a Tomcat or Glassfish.  See <a href="#Servlets">Installing web page scripts as Servlets</a>.
</li><li> You can run the servlet as a <a href="#CGI-scripts">CGI script</a>.
</li></ul>

<p>For details on how to extract information from the request
see <a href="#HTTP-requests">Functions for accessing HTTP requests</a>.
For details on how the response is created see <a href="#HTTP-response">Generating HTTP responses</a>.
If the response is HTML or XML, you may want to
read <a href="#Creating-HTML-nodes">Creating HTML nodes</a>, or <a href="#Creating-XML-nodes">Creating XML nodes</a>,
or <a href="#XML-literals">XML literals</a>.
</p>
<p>Here are some examples, starting with a simple <code>hello.scm</code>:
</p><div class="example">
<pre class="example">(response-content-type 'text/html) ; Optional
(html:p
  &quot;The request URL was: &quot; (request-url))
(make-element 'p
  (let ((query (request-query-string)))
    (if query
      (values-append &quot;The query string was: &quot; query)
      &quot;There was no query string.&quot;)))
</pre></div>
<p>This returns two <code>&lt;p&gt;</code> (paragraph) elements: One using
<code>make-element</code> and one using the <code>html:p</code> constructor.
Or you may prefer to use <a href="#XML-literals">XML literals</a>.
</p>
<p>The same program using KRL:
</p><div class="example">
<pre class="example">&lt;p&gt;The request URL was: [(request-url)]&lt;/p&gt;,
&lt;p&gt;[(let ((query (request-query-string)))
    (if query
      (begin ]The query string was: [query)

      ]There was no query string.[))]&lt;/p&gt;
</pre></div>

<p>You can also use XQuery:
</p><div class="example">
<pre class="example">&lt;p&gt;The request URL was: {request-url()}&lt;/p&gt;
&lt;p&gt;{let $query := request-query-string() return
    if ($query)
    then (&quot;The query string was: &quot;,$query)
    else &quot;There was no query string.&quot;}&lt;/p&gt;
</pre></div>

<p>The <code>+default+</code> script in the <code>doc</code> directory is
useful for reading the Kawa documentation using a browser.
The script uses the <code>jar:</code> URL scheme to automatically extract
and uncompress the pages from <code>doc/kawa-manual.epub</code>,
which is in EPUB3 format.  Read the script for usage instructions.
</p>
<hr>
</div>
<div class="section" id="Self_002dconfiguring-page-scripts">
<div class="header">
<p>
Next: <a href="#Servlets" accesskey="n" rel="next">Installing web page scripts as Servlets</a>, Previous: <a href="#Server_002dside-scripts" accesskey="p" rel="prev">Web page scripts</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Self_002dconfiguring-web-page-scripts"></span><h3 class="section">20.6 Self-configuring web page scripts</h3>

<p>Kawa makes it easy to set up a web site without configuration
files.  Instead, the mapping from request URL to web page script
matches the layout of files in the application directory.
</p>
<p>Many web servers make it easy to execute a script using a script
processor which is selected depending on the extension of the
requested URL. That is why you see lots of URLs that end in
<code>.cgi</code>, <code>.php</code>, or <code>.jsp</code>. This is bad, because it
exposes the server-side implementation to the user: Not only are such
URLs ugly, but they make it difficult to change the server without
breaking people&rsquo;s bookmarks and search engines. A server will usually
provide a mechanism to use prettier URLs, but doing so requires extra
effort, so many web-masters don&rsquo;t.
</p>
<p>If you want a script to be executed in response to a URL
<code>http://host/app/foo/bar</code> you give the script the name
<code>app/foo/bar</code>, in the appropriate server &ldquo;application&rdquo;
directory (as explained below). You get to pick the name <code>bar</code>.
Or you can use the name <code>bar.html</code>, even though the file named
<code>bar.html</code> isn&rsquo;t actually
an html file - rather it produces html when evaluated. Or better: just use
a name without an extension at all.
Kawa figures
out what kind of script it is based on the content of the file,
rather than the file name.  Once Kawa has
found a script, it looks at the first line to see if it can recognize
the kind (language) of the script. Normally this would be a comment
that contains the name of a programming language that Kawa
knows about.  For example:
</p><div class="example">
<pre class="example">;; Hello world page script written in -*- scheme -*- 
#&lt;p&gt;Hello, &lt;b&gt;&amp;(request-remote-host)&lt;/b&gt;!&lt;/p&gt;
</pre></div>
<p>(Using the funny-looking string <code>-*- scheme -*-</code> has the
bonus is that it recognized by the Emacs text editor.)
</p>
<p>A script named <code>+default+</code> is run if there isn&rsquo;t a matching script.
For example assume the following is a file named <code>+default</code>.
</p><div class="example">
<pre class="example">;; This is -*- scheme -*-
(make-element 'p &quot;servlet-path: &quot; (request-servlet-path))
</pre></div>
<p>This becomes the default script for HTTP requests that aren&rsquo;t handled
by a more specific script. 
The <code>request-servlet-path</code> function
returns the &quot;servlet path&quot;, which is the part of the requested URL
that is relative to the current web application. Thus a request for
<code>http://host:port/app/this/is/a/test</code> will return:
</p><div class="example">
<pre class="example">servlet-path: /this/is/a/test
</pre></div>

<ul class="section-toc">
<li><a href="#Using-the-OpenJDK-built_002din-web-server" accesskey="1">Using the OpenJDK built-in web server</a></li>
<li><a href="#Using-a-servlet-container" accesskey="2">Using a servlet container</a></li>
<li><a href="#Finding-a-matching-script" accesskey="3">Finding a matching script</a></li>
<li><a href="#Determining-script-language" accesskey="4">Determining script language</a></li>
<li><a href="#Compilation-and-caching" accesskey="5">Compilation and caching</a></li>
</ul>
<div class="subsection" id="Using-the-OpenJDK-built_002din-web-server">
<h4 class="subsection">20.6.1 Using the OpenJDK built-in web server</h4>

<p>The easiest way to run a Kawa web server is to
use the web server built in to JDK 6 or later.
</p>
<div class="example">
<pre class="example">kawa --http-auto-handler <var>context-path</var> <var>appdir</var> --http-start <var>port</var>
</pre></div>

<p>This starts a web server that listens on the given <var>port</var>,
using the files in directory <var>appdir</var> to handle
requests that start with the given <var>context-path</var>.
The <var>context-path</var> must start with a <code>&quot;/&quot;</code> (one is added if
needed), and it is recommended that it also end with a <code>&quot;/&quot;</code>
(otherwise you might get some surprising behavior).
</p>
<p>You can specify multiple <code>--http-auto-handler</code> options.
</p>
<p>For example use the files in the current directory to handle
all requests on the standard port 80 do:
</p><div class="example">
<pre class="example">kawa --http-auto-handler / . --http-start 80
</pre></div>

<p>There are some examples in the <code>testsuite/webtest</code> directory
the Kawa source distribution.  You can start the server thus:
</p><div class="example">
<pre class="example">bin/kawa --http-auto-handler / testsuite/webtest/ --http-start 8888
</pre></div>
<p>and then for example browse to <code>http://localhost:8888/adder.scm</code>.
</p>
<p>For lots of information about the HTTP request, browse to
<code>http://localhost:8888/info/<var>anything</var></code>.
</p>
</div>
<div class="subsection" id="Using-a-servlet-container">
<h4 class="subsection">20.6.2 Using a servlet container</h4>

<p>You can also can use a &ldquo;servlet container&rdquo;
such as Tomcat or Glassfish with self-configuring script.
See <a href="#Servlets">Installing web page scripts as Servlets</a> for information on how to install
these servers, and the concept of web applications.
Once you have these server installed, you create a
web application with the following in the
<code><var>appdir</var>/WEB-INF/web.xml</code> configuration file:
</p><div class="example">
<pre class="example">&lt;web-app&gt;
  &lt;display-name&gt;Kawa auto-servlet&lt;/display-name&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;KawaPageServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;gnu.kawa.servlet.KawaPageServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;KawaPageServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre></div>
<p>This creates a web application where all URLs
are handled by the <code>gnu.kawa.servlet.KawaPageServlet</code> servlet class,
which is included in the Kawa jar file.
The <code>KawaPageServlet</code> class handles the searching
and compiling described in this page.
</p>
</div>
<div class="subsection" id="Finding-a-matching-script">
<h4 class="subsection">20.6.3 Finding a matching script</h4>

<p>When Kawa receives a request for:
</p><div class="example">
<pre class="example">http://host:port/appname/a/b/anything
</pre></div>
<p>it will look for a file:
</p><div class="example">
<pre class="example"><var>appdir</var>/a/b/anything
</pre></div>

<p>If such a file exists, the script will be executed, as described
below. If not, it will look for a file name <code>+default+</code> in the same
directory. If that desn&rsquo;t exist either, it will look for <code>+default+</code>
in the parent
directory, then the grand-parent directory, and so on until it gets to
the appname web application root directory. So the default script is
this: <code><var>appdir</var>/+default</code>.
</p>
<p>If that doesn&rsquo;t exist then Kawa returns a 404 &quot;page not found&quot; error. 
</p>
</div>
<div class="subsection" id="Determining-script-language">
<h4 class="subsection">20.6.4 Determining script language</h4>

<p>Once Kawa has found a script file corresponding to a request URL,
it needs to determine if this is a data file or a web page script,
and in the latter case, what language it is written in.
</p>
<p>Kawa recognizes the following &quot;magic strings&quot; in the first line of a script:
</p>
<dl compact="compact">
<dt><span><code>kawa:scheme</code></span></dt>
<dd><p>The Scheme language.
</p>
</dd>
<dt><span><code>kawa:xquery</code></span></dt>
<dd><p>The XQuery language.
</p>
</dd>
<dt><span><code>kawa:<var>language</var></code></span></dt>
<dd><p>Some other language known to Kawa.
</p></dd>
</dl>

<p>Kawa also recognizes Emacs-style &quot;mode specifiers&quot;:
</p>
<dl compact="compact">
<dt><span><code>-*- scheme -*-</code></span></dt>
<dd><p>The Scheme language.
</p></dd>
<dt><span><code>-*- xquery -*-</code></span></dt>
<dd><p>The XQuery language (though Emacs doesn&rsquo;t know about XQuery).
</p></dd>
<dt><span><code>-*- emacs-lisp -*-</code></span></dt>
<dt><span><code>-*- elisp -*-</code></span></dt>
<dd><p>The Emacs Lisp extension language.
</p></dd>
<dt><span><code>-*- common-lisp -*-</code></span></dt>
<dt><span><code>-*- lisp -*-</code></span></dt>
<dd><p>The Common Lisp language.
</p></dd>
</dl>

<p>Also, it also recognizes comments in the first two columns of the line:
</p><dl compact="compact">
<dt><span><code>;;</code></span></dt>
<dd><p>A Scheme or Lisp comment - assumed to be in the Scheme language.
</p></dd>
<dt><span><code>(:</code></span></dt>
<dd><p>Start of an XQuery comment, so assumed to be in the XQuery language.
</p></dd>
</dl>

<p>If Kawa doesn&rsquo;t recognize the language of a script (and it
isn&rsquo;t named +default+) then it assumes the file is a data file. It
asks the servlet engine to figure out the content type (using the
getMimeType method of ServletContext), and just copies the file into
the response.
</p>
</div>
<div class="subsection" id="Compilation-and-caching">
<h4 class="subsection">20.6.5 Compilation and caching</h4>

<p>Kawa automatically compiles a script into a class. The
class is internal to the server, and is not written out to
disk. (There is an unsupported option to write the compiled file to a
class file, but there is no support to use previously-compiled
classes.) The server then creates a module instance to handle the
actual request, and runs the body (the <code>run</code> method)
of the script class. On subsequence
requests for the same script, the same class and instance are reused;
only the <code>run</code> is re-executed.
</p>
<p>If the script is changed, then it is re-compiled and a new module
instance created. This makes it very easy to develop and modify a
script. (Kawa for performance reasons doesn&rsquo;t check more
than once a second whether a script has been modified.)
</p>
<hr>
</div>
</div>
<div class="section" id="Servlets">
<div class="header">
<p>
Next: <a href="#CGI-scripts" accesskey="n" rel="next">Installing Kawa programs as CGI scripts</a>, Previous: <a href="#Self_002dconfiguring-page-scripts" accesskey="p" rel="prev">Self-configuring web page scripts</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Installing-web-page-scripts-as-Servlets"></span><h3 class="section">20.7 Installing web page scripts as Servlets</h3>

<p>You can compile a Kawa program to a <a href="http://en.wikipedia.org/wiki/Java_Servlet">Servlet</a>, and run it
in a servlet engine (a Servlet-aware web server).
One or more servlets are installed together as a web application.
This section includes specific information for
the Tomcat and Glassfish web servers.
</p>
<ul class="section-toc">
<li><a href="#Creating-a-web-application" accesskey="1">Creating a web application</a></li>
<li><a href="#Compiling-a-web-page-script-to-a-servlet" accesskey="2">Compiling a web page script to a servlet</a></li>
<li><a href="#Installing-a-servlet-under-Tomcat" accesskey="3">Installing a servlet under Tomcat</a></li>
<li><a href="#Installing-a-servlet-under-Glassfish" accesskey="4">Installing a servlet under Glassfish</a></li>
<li><a href="#Servlet_002dspecific-script-functions" accesskey="5">Servlet-specific script functions</a></li>
</ul>
<div class="subsection" id="Creating-a-web-application">
<h4 class="subsection">20.7.1 Creating a web application</h4>

<p>A <em>web application</em> is a group of data, servlets, and
configuration files to handle a related set of URLs.
The <a href="http://jcp.org/aboutJava/communityprocess/final/jsr315/index.html">servlet specification</a>
specifies the directory structure of a web application.
</p>
<p>Assume the web application is called <code>myapp</code>, and lives in a
directory with the same name.  The application normally handles
requests for URLs that start with <code>http://example.com/myapp</code>.
Most files in the application directory are used to handle
requests with corresponding URL.  For example,
a file <code>myapp/list/help.html</code> would be the response
to the request <code>http://example.com/myapp/list/help.html</code>.
</p>
<p>The directory <code>WEB-INF</code> is special.  It contains configuration
files, library code, and other server data.
</p>
<p>So to create the <code>myapp</code> application, start with:
</p><div class="example">
<pre class="example">mkdir myapp
cd myapp
mkdir WEB-INF WEB-INF/lib WEB-INF/classes
</pre></div>

<p>Copy the Kawa jar from the <code>lib</code> direcory.
(You can also use a &ldquo;hard&rdquo; link, but symbolic links may not
work, for security systems.)
</p><div class="example">
<pre class="example">cp <var>kawa-home</var>/kawa-2.93.jar WEB-INF/lib/kawa.jar
</pre></div>

<p>If you build Kawa from source, you must specify the
<code>--with-servlet</code> <a href="#configure-options">configure option</a>.
</p>
<p>You should also create the file <code>WEB-INF/web.xml</code>.
For now, this is is just a place-holder:
</p><div class="example">
<pre class="example">&lt;web-app&gt;
  &lt;display-name&gt;My Application&lt;/display-name&gt;
&lt;/web-app&gt;
</pre></div>

</div>
<div class="subsection" id="Compiling-a-web-page-script-to-a-servlet">
<h4 class="subsection">20.7.2 Compiling a web page script to a servlet</h4>

<p>Assume for simplicity that the source files
are in the <code>WEB-INF/classes</code> directory, and make that the
current directory:
</p><div class="example">
<pre class="example">cd .../myapp/WEB-INF/classes
</pre></div>

<p>Depending on the source language, you compile your script
sing the <code>--servlet</code> switch:
</p><div class="example">
<pre class="example">kawa --servlet -C hello.scm
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">kawa --servlet --krl -C hello.krl
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">kawa --servlet --xquery -C hello.xql
</pre></div>

<p>This lets the web-application find the compiled servlets.
Finally, you just need to add the new servlet to
the <code>WEB-INF/web.xml</code> file:
</p><div class="example">
<pre class="example">&lt;web-app&gt;
  &lt;display-name&gt;My Application&lt;/display-name&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;MyHello&lt;/servlet-name&gt;
    &lt;servlet-class&gt;hello&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;MyHello&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/hello&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre></div>

<p>The <code>&lt;servlet&gt;</code> clause says that the servlet named
<code>MyHello</code> is implemented by the Java class <code>hello</code>.
The <code>&lt;servlet-mapping&gt;</code> clause says that a request
URL <code>/hello</code> should be handled by the servlet named <code>MyHello</code>.
The URL is relative to the application context path,
so the actual URL would be <code>http://example.com/myapp/hello</code>.
</p>
</div>
<div class="subsection" id="Installing-a-servlet-under-Tomcat">
<h4 class="subsection">20.7.3 Installing a servlet under Tomcat</h4>
<span id="index-Tomcat"></span>

<p>Apache&rsquo;s <a href="http://tomcat.apache.org/">Tomcat</a> is an open-source
implementation of the servlet specifications.
After you <a href="http://tomcat.apache.org/download-60.cgi">download it</a>,
uncompress it in some convenient location,
which is commonly referred to as <code>$CATALINA_HOME</code>.
</p>
<p>To install your web application, copy/move its directory
to be in the <code>$CATALINA_HOME/webapps</code> directory.
Thus for the example above you would have
a <code>$CATALINA_HOME/webapps/myapp</code> directory.
</p>
<p>To start or stop Tomcat use the scripts in <code>$CATALINA_HOME/bin</code>.
For example to start Tomcat on a GNU/Linux system run
<code>$CATALINA_HOME/bin/startup.sh</code>.  This will start a web server
that listens on the default port of 8080,
so you can browse the above example at <code>http://localhost:8080/myapp/hello</code>.
</p>
<p>If you&rsquo;re running Fedora GNU/Linux, you can use the <code>tomcat6</code> package:
</p><div class="example">
<pre class="example"># yum install tomcat6
# export CATALINA_HOME=/usr/share/tomcat6
</pre></div>
<p>You can the manage Tomcat like other system services.
You can install webapps under <code>$CATALINA_HOME/webapps</code>.
</p>
</div>
<div class="subsection" id="Installing-a-servlet-under-Glassfish">
<h4 class="subsection">20.7.4 Installing a servlet under Glassfish</h4>
<span id="index-Glassfish"></span>

<p><a href="https://glassfish.dev.java.net/">Glassfish</a> from Oracle/Sun
is a open-source &ldquo;application server&rdquo; that implements
Java EE 6, including the 3.0 servlet specification.
After you <a href="https://glassfish.dev.java.net/downloads/3.0.1-final.html">download it</a>, uncompress it in some convenient location.
This location is called <var>as-install-parent</var> in the
<a href="http://docs.sun.com/app/docs/doc/820-7689/aboaa?a=view">Quick Start Guide</a>.
The commands you will use is most in <code><var>as-install</var>/bin</code>,
where <var>as-install</var> is <code><var>as-install</var>/glassfish</code>.
</p>
<p>To start the server, do:
</p><div class="example">
<pre class="example"><var>as-install</var>/bin/startserv
</pre></div>
<p>or under under Windows:
</p><div class="example">
<pre class="example"><var>as-install</var>\bin\startserv.bat
</pre></div>
<p>The default post to listen to is <code>8080</code>;
you can the port (and lots of other properties)
using the adminstration console at port <code>4848</code>.
</p>
<p>A web application does not need to be any particular
location, instead you just install it with this command:
</p><div class="example">
<pre class="example"><var>as-install</var>/bin/adadmin deploy <var>appdir</var>
</pre></div>
<p>where <var>appdir</var> is the application directory - <code>myapp</code> in the example.
(Use <code>asadmin.bat</code> under Windows.)
</p>
</div>
<div class="subsection" id="Servlet_002dspecific-script-functions">
<h4 class="subsection">20.7.5 Servlet-specific script functions</h4>

<p>The following functions only work within a servlet container.
To use these functions, first do:
</p><div class="example">
<pre class="example">(require 'servlets)
</pre></div>

<p>You can conditionalize your code to check at compile-time for servlets,
like this:
</p>
<div class="example">
<pre class="example">(cond-expand
 (in-servlet
   (require 'servlets)
   (format &quot;[servlet-context: ~s]&quot; (current-servlet-context)))
 (else
   &quot;[Not in a servlet]&quot;))
</pre></div>

<p>For a run-time check you can test if <code>(current-servlet)</code> is
non-<code>#!null</code>.
</p>
<dl class="def">
<dt id="index-current_002dservlet"><span class="category">Procedure: </span><span><strong>current-servlet</strong><a href='#index-current_002dservlet' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>When called from a Kawa servlet handler, returns the
actual <code>javax.servlet.http.HttpServlet</code> instance.
Returns <code>#!null</code> if the current context is not that of
<code>KawaServlet</code>.
(Hence this function also returns <code>#!null</code> if you compile a servlet
&ldquo;by hand&rdquo; rather that using the <code>--servet</code> option.)
</p></dd></dl>

<dl class="def">
<dt id="index-current_002dservlet_002dcontext"><span class="category">Procedure: </span><span><strong>current-servlet-context</strong><a href='#index-current_002dservlet_002dcontext' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the context of the currently executing servlet,
as an instance of <code>javax.servlet.ServletContext</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-current_002dservlet_002dconfig"><span class="category">Procedure: </span><span><strong>current-servlet-config</strong><a href='#index-current_002dservlet_002dconfig' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the <code>ServletConfig</code> of the currently executing servlet.
</p></dd></dl>

<dl class="def">
<dt id="index-get_002drequest"><span class="category">Procedure: </span><span><strong>get-request</strong><a href='#index-get_002drequest' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the current servlet request, as an instance of
<code>javax.servlet.http.HttpServletRequest</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-get_002dresponse"><span class="category">Procedure: </span><span><strong>get-response</strong><a href='#index-get_002dresponse' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the current servlet response, as an instance of
<code>javax.servlet.http.HttpServletResponse</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dservlet_002dpath"><span class="category">Procedure: </span><span><strong>request-servlet-path</strong><a href='#index-request_002dservlet_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the servlet path of the current request.
Similar to <code>request-script-path</code>, but not always the same,
depending on configuration, and does <em>not</em> end with a <code>&quot;/&quot;</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dpath_002dinfo"><span class="category">Procedure: </span><span><strong>request-path-info</strong><a href='#index-request_002dpath_002dinfo' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the path info of the current request.
Corresponds to the CGI variable <code>PATH_INFO</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-servlet_002dcontext_002drealpath"><span class="category">Procedure: </span><span><strong>servlet-context-realpath</strong> <em>[path]</em><a href='#index-servlet_002dcontext_002drealpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the file path of the current servlet&rsquo;s &quot;Web application&quot;.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="CGI-scripts">
<div class="header">
<p>
Next: <a href="#HTTP-requests" accesskey="n" rel="next">Functions for accessing HTTP requests</a>, Previous: <a href="#Servlets" accesskey="p" rel="prev">Installing web page scripts as Servlets</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Installing-Kawa-programs-as-CGI-scripts"></span><h3 class="section">20.8 Installing Kawa programs as CGI scripts</h3>

<p>The recommended way to have a web-server run a Kawa program
as a CGI script is to compile the Kawa program to a servlet
(as explained in <a href="#Server_002dside-scripts">Web page scripts</a>, and then use
Kawa&rsquo;s supplied CGI-to-servlet bridge.
</p>
<p>First, compile your program to one or more class files
as explained in <a href="#Server_002dside-scripts">Web page scripts</a>.  For example:
</p><div class="example">
<pre class="example">kawa --servlet --xquery -C hello.xql
</pre></div>

<p>Then copy the resulting <code>.class</code> files to your server&rsquo;s
CGI directory.  On Red Hat GNU/Linux, you can do the following (as root):
</p><div class="example">
<pre class="example">cp hello*.class /var/www/cgi-bin/
</pre></div>

<p>Next find the <code>cgi-servlet</code> program that Kawa builds and installs.
If you installed Kawa in the default place, it will be in
<code>/usr/local/bin/cgi-servlet</code>.
(You&rsquo;ll have this if you installed Kawa from source, but not
if you&rsquo;re just using Kawa <code>.jar</code> file.)
Copy this program into the same CGI directory:
</p><div class="example">
<pre class="example">cp /usr/local/bin/cgi-servlet /var/www/cgi-bin/
</pre></div>

<p>You can link instead of copying:
</p><div class="example">
<pre class="example">ln -s /usr/local/bin/cgi-servlet /var/www/cgi-bin/
</pre></div>
<p>However, because of security issues this may not work, so it is
safer to copy the file.  However, if you already have a copy
of <code>cgi-servlet</code> in the CGI-directory, it is safe to make
a hard link instead of making an extra copy.
</p>
<p>Make sure the files have the correct permissions:
</p><div class="example">
<pre class="example">chmod a+r /var/www/cgi-bin/hello*.class /var/www/cgi-bin/hello
chmod a+x /var/www/cgi-bin/hello
</pre></div>

<p>Now you should be able to run the Kawa program,
using the URL <a href="http://localhost/cgi-bin/hello">http://localhost/cgi-bin/hello</a>.
It may take a few seconds to get the reply, mainly because of the
start-up time of the Java VM.  That is why servlets are
preferred.  Using the CGI interface can still be useful
for testing or when you can&rsquo;t run servlets.
</p>
<hr>
</div>
<div class="section" id="HTTP-requests">
<div class="header">
<p>
Next: <a href="#HTTP-response" accesskey="n" rel="next">Generating HTTP responses</a>, Previous: <a href="#CGI-scripts" accesskey="p" rel="prev">Installing Kawa programs as CGI scripts</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Functions-for-accessing-HTTP-requests"></span><h3 class="section">20.9 Functions for accessing HTTP requests</h3>

<p>The following functions are useful for accessing
properties of a HTTP request, in a Kawa program that is
run either as a servlet or a CGI script.  These functions
can be used from plain Scheme, from KRL (whether
in BRL-compatible mode or not), and from XQuery.
</p>
<p>The examples below assume the request <code>http://example.com:8080/myapp/foo/bar?val1=xyz&amp;val2=abc</code>, where <code>myapp</code> is the application context.
We also assume that this is handled by a script <code>foo/+default+</code>.
</p>
<p>The file <code>testsuite/webtest/info/+default+</code> in the Kawa source distribution
calls most of these functions.
You can try it as described in <a href="#Self_002dconfiguring-page-scripts">Self-configuring web page scripts</a>.
</p>
<ul class="section-toc">
<li><a href="#Request-URL-components" accesskey="1">Request URL components</a></li>
<li><a href="#Request-parameters" accesskey="2">Request parameters</a></li>
<li><a href="#Request-headers" accesskey="3">Request headers</a></li>
<li><a href="#Request-body" accesskey="4">Request body</a></li>
<li><a href="#Request-IP-addresses-and-ports" accesskey="5">Request IP addresses and ports</a></li>
<li><a href="#Miscellaneous-request-properties" accesskey="6">Miscellaneous request properties</a></li>
</ul>
<div class="subsection" id="Request-URL-components">
<h4 class="subsection">20.9.1 Request URL components</h4>

<dl class="def">
<dt id="index-request_002dURI"><span class="category">Procedure: </span><span><strong>request-URI</strong><a href='#index-request_002dURI' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the URI of the request, as a value of type <code>URI</code>.
This excludes the server specification,
but includes the query string.
(It is the combination of CGI variables <code>SCRIPT_NAME</code>,
<code>PATH_INFO</code>, and <code>QUERY_STRING</code>.
Using servlets terminology, it is the combination of
Context Path, Servlet Path, PathInfo, and Query String.)
</p><div class="example">
<pre class="example">(request-URI) &rArr; &quot;/myapp/foo/bar?val1=xyz&amp;val2=abc&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dpath"><span class="category">Procedure: </span><span><strong>request-path</strong><a href='#index-request_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the URI of the request, as a value of type <code>URI</code>.
This excludes the server specification and the query string.
Equivalent to <code>(path-file (request-URI))</code>.
(It is the combination of CGI variables <code>SCRIPT_NAME</code>, and
<code>PATH_INFO</code>.
Same as the concatenation of <code>(request-context-path)</code>,
<code>(request-script-path)</code>, and <code>(request-local-path)</code>.
Using servlets terminology, it is the combination of
Context Path, Servlet Path, and PathInfo.)
</p><div class="example">
<pre class="example">(request-path) &rArr; &quot;/myapp/foo/bar&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002duri"><span class="category">Procedure: </span><span><strong>request-uri</strong><a href='#index-request_002duri' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This function is deprecated, because of possible confusion
with <code>request-URI</code>.  Use <code>request-path</code> instead.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002durl"><span class="category">Procedure: </span><span><strong>request-url</strong><a href='#index-request_002durl' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the complete URL of the request, except the query string.
The result is a <code>java.lang.StringBuffer</code>.
</p><div class="example">
<pre class="example">(request-url) &rArr; &quot;http://example.com:8080/myapp/foo/bar&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dcontext_002dpath"><span class="category">Procedure: </span><span><strong>request-context-path</strong><a href='#index-request_002dcontext_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the context path, relative to the server root.
This is an initial substring of the <code>(request-path)</code>.
Similar to the Context Path of a servlet request,
except that it ends with a <code>&quot;/&quot;</code>.
</p><div class="example">
<pre class="example">(request-context-path) &rArr; &quot;/myapp/&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dscript_002dpath"><span class="category">Procedure: </span><span><strong>request-script-path</strong><a href='#index-request_002dscript_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the path of the script, relative to the context.
This is either an empty string, or a string that ends with <code>&quot;/&quot;</code>,
but does not start with one. (The reason for this is to produce URIs
that work better with operations like <code>resolve-uri</code>.)
This is conceptually similar to <code>request-servlet-path</code>,
though not always the same, and the <code>&quot;/&quot;</code> conventions differ.
</p><div class="example">
<pre class="example">(request-script-path) &rArr; &quot;foo/&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dlocal_002dpath"><span class="category">Procedure: </span><span><strong>request-local-path</strong><a href='#index-request_002dlocal_002dpath' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the remainder of the <code>request-path</code>,
relative to the <code>request-script-path</code>.
</p><div class="example">
<pre class="example">(request-local-path) &rArr; &quot;bar&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dquery_002dstring"><span class="category">Procedure: </span><span><strong>request-query-string</strong><a href='#index-request_002dquery_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the query string from an HTTP request.  The query string is
the part of the request URL after a question mark.
Returns false if there was no query string.
Corresponds to the CGI variable <code>QUERY_STRING</code>.
</p><div class="example">
<pre class="example">(request-query-string) &rArr; &quot;val1=xyz&amp;val2=abc&quot;
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Request-parameters">
<h4 class="subsection">20.9.2 Request parameters</h4>

<p>Request parameters are used for data returned from forms,
and for other uses.
They may be encoded in the query string or in the request body.
</p>
<dl class="def">
<dt id="index-request_002dparameter"><span class="category">Procedure: </span><span><strong>request-parameter</strong> <em>name [default]</em><a href='#index-request_002dparameter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If there is a parameter with the given name (a string),
return the (first) corresponding value, as a string.
Otherwise, return the <var>default</var> value,
or <code>#!null</code> if there is no <var>default</var>.
</p><div class="example">
<pre class="example">(request-parameter &quot;val1&quot;) &rArr; &quot;xyz&quot;
(request-parameter &quot;val9&quot; &quot;(missing)&quot;) &rArr; &quot;(missing)&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dparameters"><span class="category">Procedure: </span><span><strong>request-parameters</strong> <em>name</em><a href='#index-request_002dparameters' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If there is are one or more parameter with the given name (a string),
return them all (as multiple values).
Otherwise, return no values (i.e. <code>(values)</code>).
</p><div class="example">
<pre class="example">(request-parameters &quot;val1&quot;) &rArr; &quot;xyz&quot;
(request-parameters &quot;val9&quot;) &rArr; #!void
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dparameter_002dmap"><span class="category">Procedure: </span><span><strong>request-parameter-map</strong><a href='#index-request_002dparameter_002dmap' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Request a map of all the parameters.
This is a map from strings to a sequence of strings.
(Specifically, a <code>java.util.Map&lt;String,java.util.List&lt;String&gt;&gt;</code>.)
</p></dd></dl>

</div>
<div class="subsection" id="Request-headers">
<h4 class="subsection">20.9.3 Request headers</h4>

<p>The request headers are a set of (keyword, string)-pairs
transmitted as part of the HTTP request, before the request body.
</p>
<dl class="def">
<dt id="index-request_002dheader"><span class="category">Procedure: </span><span><strong>request-header</strong> <em>name</em><a href='#index-request_002dheader' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If there is a header with the given <var>name</var> (a string),
return the corresponding value string.
Otherwise, return <code>#!null</code>.
</p><div class="example">
<pre class="example">(request-header &quot;accept-language&quot;) &rArr; &quot;en-us,en;q=0.5&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-request_002dheader_002dmap"><span class="category">Procedure: </span><span><strong>request-header-map</strong><a href='#index-request_002dheader_002dmap' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Request a map of all the headers.
This is a map from strings to a sequence of strings.
(Specifically, a <code>java.util.Map&lt;String,java.util.List&lt;String&gt;&gt;</code>.)
</p></dd></dl>

</div>
<div class="subsection" id="Request-body">
<h4 class="subsection">20.9.4 Request body</h4>

<dl class="def">
<dt id="index-request_002dinput_002dport"><span class="category">Procedure: </span><span><strong>request-input-port</strong><a href='#index-request_002dinput_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a textual input port for reading the request body,
as a sequence of characters.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dinput_002dstream"><span class="category">Procedure: </span><span><strong>request-input-stream</strong><a href='#index-request_002dinput_002dstream' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a binary input stream for reading the request body,
as a sequence of bytes.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dbody_002dstring"><span class="category">Procedure: </span><span><strong>request-body-string</strong><a href='#index-request_002dbody_002dstring' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the entire request body as a string
</p></dd></dl>

</div>
<div class="subsection" id="Request-IP-addresses-and-ports">
<h4 class="subsection">20.9.5 Request IP addresses and ports</h4>

<p>Information about the interface and port on which the request was received.
</p>
<dl class="def">
<dt id="index-request_002dlocal_002dsocket_002daddress"><span class="category">Procedure: </span><span><strong>request-local-socket-address</strong><a href='#index-request_002dlocal_002dsocket_002daddress' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The local address on which the request was received.
This is the combination of <code>(request-local-host)</code>
and <code>(request-local-port)</code>, as an instance of
<code>java.net.InetSocketAddress</code>.
</p></dd></dl>
<dl class="def">
<dt id="index-request_002dlocal_002dhost"><span class="category">Procedure: </span><span><strong>request-local-host</strong><a href='#index-request_002dlocal_002dhost' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the IP address of the interface on which request was received,
as an <code>java.net.InetAddress</code>.
</p></dd></dl>
<dl class="def">
<dt id="index-request_002dlocal_002dIP_002daddress"><span class="category">Procedure: </span><span><strong>request-local-IP-address</strong><a href='#index-request_002dlocal_002dIP_002daddress' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the IP address of the interface on which request was received,
a string in numeric form:
</p><div class="example">
<pre class="example">(request-local-host) &rArr; &quot;127.0.0.1&quot;
</pre></div>
</dd></dl>
<dl class="def">
<dt id="index-request_002dlocal_002dport"><span class="category">Procedure: </span><span><strong>request-local-port</strong><a href='#index-request_002dlocal_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the port this request was received on.
</p><div class="example">
<pre class="example">(request-local-port) &rArr; 8080
</pre></div>
</dd></dl>

<p>Information about the interface and port of the remote client that invoked the request.
</p>
<dl class="def">
<dt id="index-request_002dremote_002dsocket_002daddress"><span class="category">Procedure: </span><span><strong>request-remote-socket-address</strong><a href='#index-request_002dremote_002dsocket_002daddress' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The address of the remote client (usually a web browser)
which invoked the request.
This is the combination of <code>(request-remove-host)</code>
and <code>(request-remote-port)</code>, as an instance of
<code>java.net.InetSocketAddress</code>.
</p></dd></dl>
<dl class="def">
<dt id="index-request_002dremote_002dhost"><span class="category">Procedure: </span><span><strong>request-remote-host</strong><a href='#index-request_002dremote_002dhost' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the IP address of the remote client which invoked the request,
as an <code>java.net.InetAddress</code>.
</p></dd></dl>
<dl class="def">
<dt id="index-request_002dremote_002dIP_002daddress"><span class="category">Procedure: </span><span><strong>request-remote-IP-address</strong><a href='#index-request_002dremote_002dIP_002daddress' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Get the IP address of the remote client which invoked the request,
as a string in numeric form.
</p><div class="example">
<pre class="example">(request-remote-host) &rArr; &quot;123.45.6.7&quot;
</pre></div>
</dd></dl>
<dl class="def">
<dt id="index-request_002dremote_002dport"><span class="category">Procedure: </span><span><strong>request-remote-port</strong><a href='#index-request_002dremote_002dport' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The port used by the remote client.
</p></dd></dl>

</div>
<div class="subsection" id="Miscellaneous-request-properties">
<h4 class="subsection">20.9.6 Miscellaneous request properties</h4>

<dl class="def">
<dt id="index-request_002dpath_002dtranslated"><span class="category">Procedure: </span><span><strong>request-path-translated</strong><a href='#index-request_002dpath_002dtranslated' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Map the request-path to a file name (a string)
in the server application directory.
Corresponds to the CGI variable <code>PATH_TRANSLATED</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dmethod"><span class="category">Procedure: </span><span><strong>request-method</strong><a href='#index-request_002dmethod' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the method of the HTTP request, usually <code>&quot;GET&quot;</code>
or <code>&quot;POST&quot;</code>.  Corresponds to the CGI variable <code>REQUEST_METHOD</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-request_002dscheme"><span class="category">Procedure: </span><span><strong>request-scheme</strong><a href='#index-request_002dscheme' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the scheme (protocol) of the request.
Usually <code>&quot;http&quot;</code>, or <code>&quot;https&quot;</code>.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="HTTP-response">
<div class="header">
<p>
Next: <a href="#XML-beyond-Scheme" accesskey="n" rel="next">Using non-Scheme languages for XML/HTML</a>, Previous: <a href="#HTTP-requests" accesskey="p" rel="prev">Functions for accessing HTTP requests</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Generating-HTTP-responses"></span><h3 class="section">20.10 Generating HTTP responses</h3>

<p>The result of evaluating the top-level expressions of a web page script
becomes the HTTP response that the servlet sends back to the browser.
The result is typically an HTML/XML element code object
Kawa will automatically format the result as appropriate for the type.
Before the main part of the response there may be
special &quot;response header values&quot;,
as created by the <code>response-header</code> function.
Kawa will use the response header values to set various
required and optional fields of the HTTP response.
Note that <code>response-header</code> does not actually do anything
until it is &quot;printed&quot; to the standard output.
Note also that a <code>&quot;Content-Type&quot;</code> response value is
special since it controls the formatting of the following
non-response-header values.
</p>
<dl class="def">
<dt id="index-response_002dheader"><span class="category">Procedure: </span><span><strong>response-header</strong> <em>key value</em><a href='#index-response_002dheader' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create the response header &lsquo;<samp><var>key</var>: <var>value</var></samp>&rsquo; in the HTTP
response.  The result is a &quot;response header value&quot; (of some unspecified
type).  It does not directly set or print a response header, but only
does so when you actually &quot;print&quot; its value to the response output stream.
</p></dd></dl>

<dl class="def">
<dt id="index-response_002dcontent_002dtype"><span class="category">Procedure: </span><span><strong>response-content-type</strong> <em>type</em><a href='#index-response_002dcontent_002dtype' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Species the content-type of the result - for example <code>&quot;text/plain&quot;</code>.
Convenience function for <code>(response-header &quot;Content-Type&quot; <var>type</var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-error_002dresponse"><span class="category">Procedure: </span><span><strong>error-response</strong> <em>code [message]</em><a href='#index-error_002dresponse' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a response-header with an error code of <var>code</var> and a
response message of <var>message</var>.
(For now this is the same as <code>response-status</code>.)
</p>
<p>Note this also returns a response-header value, which does not actually
do anything unless it is returned as the result of executing a servlet body.
</p></dd></dl>

<dl class="def">
<dt id="index-response_002dstatus"><span class="category">Procedure: </span><span><strong>response-status</strong> <em>code [message]</em><a href='#index-response_002dstatus' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a response-header with an status code of <var>code</var> and a
response message of <var>message</var>.
(For now this is the same as <code>error-response</code>.)
</p></dd></dl>

<hr>
</div>
<div class="section" id="XML-beyond-Scheme">
<div class="header">
<p>
Previous: <a href="#HTTP-response" accesskey="p" rel="prev">Generating HTTP responses</a>, Up: <a href="#XML-tools" accesskey="u" rel="up">Working with XML and HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Using-non_002dScheme-languages-for-XML_002fHTML"></span><h3 class="section">20.11 Using non-Scheme languages for XML/HTML</h3>

<ul class="section-toc">
<li><a href="#XQuery-language" accesskey="1">XQuery language</a></li>
<li><a href="#XSL-transformations" accesskey="2">XSL transformations</a></li>
<li><a href="#KRL" accesskey="3">KRL - The Kawa Report Language for generating XML/HTML</a></li>
<li><a href="#Differences-between-KRL-and-BRL" accesskey="4">Differences between KRL and BRL</a></li>
</ul>
<div class="subsection" id="XQuery-language">
<h4 class="subsection">20.11.1 XQuery language</h4>

<p>Bundled with Kawa is a fairly complete implementation of W3C&rsquo;s
new <a href="http://www.w3c.org/XML/Query">XML Query language</a>.
If you start Kawa with the <code>--xquery</code> it selects the &quot;XQuery&quot;
source language; this also prints output using XML syntax.
See the <a href="http://www.gnu.org/software/qexo/">Qexo (Kawa-XQuery) home page</a>
for examples and more information.
</p>
</div>
<div class="subsection" id="XSL-transformations">
<h4 class="subsection">20.11.2 XSL transformations</h4>

<p>There is an experimental implementation of the XSLT (XML Stylesheet
Language Transformations) language.  Selecting <code>--xslt</code> at the
Kawa command line will parse a source file according to the syntax
on an XSLT stylesheet.
See the <a href="http://www.gnu.org/software/qexo/xslt.html">Kawa-XSLT page</a>
for more information.
</p>

<hr>
</div>
<div class="subsection" id="KRL">
<div class="header">
<p>
Up: <a href="#XML-beyond-Scheme" accesskey="u" rel="up">Using non-Scheme languages for XML/HTML</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="KRL-_002d-The-Kawa-Report-Language-for-generating-XML_002fHTML"></span><h4 class="subsection">20.11.3 KRL - The Kawa Report Language for generating XML/HTML</h4>

<p>KRL (the &quot;Kawa Report Language&quot;) is powerful Kawa dialect for embedding
Scheme code in text files such as HTML or XML templates.  You select
the KRL language by specifying <code>--krl</code> on the Kawa command line.
</p>
<p>KRL is based on on <a href="http://brl.sourceforge.net/">BRL</a>,
Bruce Lewis&rsquo;s &quot;Beautiful Report Language&quot;, and
uses some of BRL&rsquo;s code, but there are some experimental differences,
and the implementation core is different.  You can run KRL in
BRL-compatility-mode by specifying <code>--brl</code> instead of <code>--krl</code>.
</p>
</div>
<div class="subsection" id="Differences-between-KRL-and-BRL">
<h4 class="subsection">20.11.4 Differences between KRL and BRL</h4>

<p>This section summarizes the known differences between KRL and BRL.
Unless otherwise specified, KRL in BRL-compatibility mode will
act as BRL.
</p>
<ul>
<li> In BRL a normal Scheme string <code>&quot;mystring&quot;</code> is the same
as the inverted quote string <code>]mystring[</code>, and both are instances
of the type <code>&lt;string&gt;</code>.
In KRL <code>&quot;mystring&quot;</code> is a normal Scheme string of type <code>&lt;string&gt;</code>,
but <code>]mystring[</code> is special type that suppresses output escaping.
(It is equivalent to <code>(unescaped-data &quot;mystring&quot;)</code>.)
</li><li> When BRL writes out a string, it does not do any processing
to escape special characters like <code>&lt;</code>.  However, KRL in its default
mode does normally escape characters and strings.  Thus <code>&quot;&lt;a&gt;&quot;</code>
is written as <code>&amp;lt;a&amp;gr;</code>.
You can stop it from doing this by overriding the output format, for example
by specifying <code>--output-format scheme</code> on the Kawa command line,
or by using the <code>unescaped-data</code> function.
</li><li> Various Scheme syntax forms, including <code>lambda</code>,
take a <a href="#meta_002dbody"><var>body</var></a>, which is a list of one or more declarations and
expressions.  In normal Scheme and in BRL the value of a <var>body</var>
is the value of the last expression.  In KRL the value of a <var>body</var>
is the concatenation of all the values of the expressions,
as if using <code>values-append</code>.
</li><li> In BRL a word starting with a colon is a keyword.
In KRL a word starting with a colon is an identifier, which by
default is bound to the <code>make-element</code> function specialized
to take the rest of the word as the tag name (first argument).
</li><li> BRL has an extensive utility library.  Most of this has not yet been ported
to KRL, even in BRL-compatibility mode.
</li></ul>

<hr>
</div>
</div>
</div>
<div class="chapter" id="Miscellaneous">
<div class="header">
<p>
Next: <a href="#FAQs" accesskey="n" rel="next">Frequently Asked Questions</a>, Previous: <a href="#XML-tools" accesskey="p" rel="prev">Working with XML and HTML</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Miscellaneous-topics"></span><h2 class="chapter">21 Miscellaneous topics</h2>

<dl class="def">
<dt id="index-scheme_002dimplementation_002dversion"><span class="category">Procedure: </span><span><strong>scheme-implementation-version</strong><a href='#index-scheme_002dimplementation_002dversion' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the Kawa version number as a string.
</p></dd></dl>

<dl class="def">
<dt id="index-scheme_002dwindow"><span class="category">Procedure: </span><span><strong>scheme-window</strong> <em>[shared]</em><a href='#index-scheme_002dwindow' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a read-eval-print-loop in a new top-level window.
If <var>shared</var> is true, it uses the same environment as the
current <code>(interaction-environment)</code>;  if not (the default),
a new top-level environment is created.
</p>
<p>You can create multiple top-level window that can co-exist.
They run in separate threads.
</p></dd></dl>


<ul class="section-toc">
<li><a href="#Composable-pictures" accesskey="1">Composable pictures</a></li>
<li><a href="#Building-JavaFX-applications" accesskey="2">Building JavaFX applications</a></li>
<li><a href="#Building-for-Android" accesskey="3">Building for Android</a></li>
<li><a href="#Android-view-construction" accesskey="4">Android view construction</a></li>
<li><a href="#System-inquiry" accesskey="5">System inquiry</a></li>
<li><a href="#Processes" accesskey="6">Processes</a></li>
<li><a href="#Time_002drelated-functions" accesskey="7">Time-related functions</a></li>
<li><a href="#Low_002dlevel-functions" accesskey="8">Deprecated low-level functions</a></li>
</ul>
<hr>
<div class="section" id="Composable-pictures">
<div class="header">
<p>
Next: <a href="#Building-JavaFX-applications" accesskey="n" rel="next">Building JavaFX applications</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Composable-pictures-2"></span><h3 class="section">21.1 Composable pictures</h3>

<p>The <code>(kawa pictures)</code> library lets you create geometric shapes
and images, and combine them in interesting ways.
The <a href="#Tutorial-_002d-Pictures">tutorial</a> gives an introduction.
</p>
<p>The easiest way to use and learn the <code>pictures</code> library
is with a suitable REPL.  You can use the old Swing-based console
or any <a href="#Using-DomTerm">DomTerm</a>-based terminal emulator.
You can create a suitable window either by starting <code>kawa</code>
with the <code>-w</code> flag, or by running the <code>kawa</code> command
inside an existing DomTerm-based terminal emulator.
The screenshot below is of the latter,
using the <code>qtdomterm</code> terminal emulator.
</p>
<img src="images/domterm-pictures-1.png" alt="images/domterm-pictures-1">

<p>After <code>(import (kawa swing))</code> you can use <code>show-picture</code>
to display a picture in a Swing window.
</p>
<p>A <em>picture</em> is an object that can be displayed on a screen,
web-page, or printed page, and combined with other pictures.
</p>
<p>A picture has a method printing itself in a graphical context.
It also has various properties.
</p>
<p>An important property of a picture is its <em>bounding box</em>.
This is a rectangle (with edges parallel to the axes) that
surrounds the contents of the picture.
Usually the entire visible part of the picture is inside the
bounding box, but in some cases part of the picture may stick
outside the bounding box.
For example when a circle is drawn (stroked) with a &ldquo;pen&rdquo;,
the bounding box is that of the infinitely-thin mathematical circle, so
&ldquo;ink&rdquo; from the pen that is outside the circle may be outside the bounding box.
</p>
<p>A picture has an origin point corresponding to the (0 0) cordinates.
The origin is commonly but not always inside the bounding box.
Certain operations (for example <code>hbox</code>) combine pictures by putting
them &ldquo;next to&rdquo; each other, where &ldquo;next to&rdquo; is defined in
terms of the bounding box and origin point.
</p>

<ul class="section-toc">
<li><a href="#Coordinates-_002d-points-and-dimensions" accesskey="1">Coordinates - points and dimensions</a></li>
<li><a href="#Shapes" accesskey="2">Shapes</a></li>
<li><a href="#Colors-and-paints" accesskey="3">Colors and paints</a></li>
<li><a href="#Filling-a-shape-with-a-color" accesskey="4">Filling a shape with a color</a></li>
<li><a href="#Stroking-_0028outlining_0029-a-shape" accesskey="5">Stroking (outlining) a shape</a></li>
<li><a href="#Affine-transforms" accesskey="6">Affine transforms</a></li>
<li><a href="#Combining-pictures" accesskey="7">Combining pictures</a></li>
<li><a href="#Images" accesskey="8">Images</a></li>
<li><a href="#Compositing-_002d-Controlling-how-pictures-are-combined" accesskey="9">Compositing - Controlling how pictures are combined</a></li>
<li><a href="#Displaying-and-exporting-pictures">Displaying and exporting pictures</a></li>
</ul>
<div class="subsection" id="Coordinates-_002d-points-and-dimensions">
<h4 class="subsection">21.1.1 Coordinates - points and dimensions</h4>

<p>The library works with a two-dimensional grid,
where each position has an x cordinate and y coordinate.
Normally, x values increase as you move right on the screen/page,
while y values increase as you move <em>down</em>.
This convention matches that used by Java 2D, SVG, and many other
graphics library.  However, note that this is different from the traditional
mathematical convention of y values increasing as you go up.
</p>
<p>By default, one unit is one &ldquo;pixel&rdquo;.  (More precisely,
it is the <code>px</code> unit in the CSS specification.)
</p>
<dl class="def">
<dt id="index-Point"><span class="category">Type: </span><span><strong>Point</strong><a href='#index-Point' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A point is a pair consisting of an x and a y coordinate.
</p></dd></dl>

<dl class="def">
<dt id="index-_0026P_005b"><span class="category">Literal: </span><span><em></em> <strong>&amp;P<code><b>[</b></code></strong> <em><var>x</var> <var>y</var> <code><b>]</b></code></em><a href='#index-_0026P_005b' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Construct a point value with the specified <var>x</var> and <var>y</var> values.
Both <var>x</var> and <var>y</var> are expressions that evaluate to real numbers:
</p><div class="example">
<pre class="example">&amp;P[(+ old-right 10) baseline]
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-Dimension"><span class="category">Type: </span><span><strong>Dimension</strong><a href='#index-Dimension' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A dimension value is a pair of a width and a height.
It is used for the size of pictures in the two dimensions.
</p>
<p>In a context that expects a point, a dimension is treated
as an offset relative to some other point.
</p></dd></dl>

<dl class="def">
<dt id="index-_0026D_005b"><span class="category">Literal: </span><span><em></em> <strong>&amp;D<code><b>[</b></code></strong> <em><var>width</var> <var>height</var> <code><b>]</b></code></em><a href='#index-_0026D_005b' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Construct a dimension value with the specified <var>width</var>
and <var>height</var> values, which are both expressions that
evaluate to real numbers.
</p></dd></dl>

</div>
<div class="subsection" id="Shapes">
<h4 class="subsection">21.1.2 Shapes</h4>

<p>A shape is a collection of lines and curves.
Examples include lines, circles, and polygons.
A shape can be <em>stroked</em>, which you can think of as
being drawn by a very fancy calligraphic pen that
follows the lines and curves of the shape.
</p>
<p>A <em>closed shape</em> is a shape that is continuous and ends up where it
started.  This includes circles and polygons.
A closed shape can be filled, which means the entire &ldquo;interior&rdquo;
is painted with some color or texture.
</p>
<p>A shape is represented by the Java <code>java.awt.Shape</code> interface.
The <code>picture</code> library only provides relatively simple shapes,
but you can use any methods that create a <code>java.awt.Shape</code> object.
</p>
<p><em>Shape</em> is effectively a sub-type of <em>picture</em>,
though they&rsquo;re represented using using disjoint classes:
If you use a shape where a picture is required,
the shape is automatically converted to a picture,
as if using the <code>draw</code> procedure.
</p>
<dl class="def">
<dt id="index-line"><span class="category">Procedure: </span><span><strong>line</strong> <em>p1 [p2 ...]</em><a href='#index-line' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>In the simple case two points are specified, and the result
is a line that goes from point <var>p1</var> to <var>p2</var>.
If <var>n</var> points are specied, the result is a <em>polyline</em>:
a path consisting of <var>n-1</var> line segments, connecting adjacent arguments.
(If only a single point is specified, the result is degenerate
single-point shape.)
</p>
<p>All of the points except the first can optionally be specified
using a dimension, which is treated an an offset from the previous point:
</p><div class="example">
<pre class="example">(line &amp;P[30 40] &amp;D[10 5] &amp;D[10 -10])
</pre></div>
<p>is the same as:
</p><div class="example">
<pre class="example">(line &amp;P[30 40] &amp;P[40 45] &amp;P[50 35])
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-polygon"><span class="category">Procedure: </span><span><strong>polygon</strong> <em>p1 [p2 ...]</em><a href='#index-polygon' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Constructs a closed shape from line segments.
This is the same as calling <code>line</code> with the same arguments,
with the addition of a final line segment from the last point
back to the first point.
</p></dd></dl>

<dl class="def">
<dt id="index-rectangle"><span class="category">Procedure: </span><span><strong>rectangle</strong> <em>p1 [p2]</em><a href='#index-rectangle' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A rectangle is closed polygon of 4 line segments that are
alternatively parallel to the x-axis and the y-axis.
I.e. if you rotate a rectangle it is no longer a rectangle by
this definition, though of course it still has a rectangular shape.
If <var>p2</var> is not specified, constructs a rectangle whose upper-left corner
is <code>&amp;P[0 0]</code> and whose lower-right corner is <var>p1</var>.
If <var>p2</var> is specified, constructs a rectangle whose upper-left corner
is <var>p1</var> and whose lower-right corner is <var>p2</var>.
If <var>p2</var> is a dimension it is considered a relative offset from <var>p1</var>,
just like for <code>polygon</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-circle"><span class="category">Procedure: </span><span><strong>circle</strong> <em>radius [center]</em><a href='#index-circle' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a circle with the specified <var>radius</var>.
If the <var>center</var> is not specified, it defaults to <code>&amp;P[0 0]</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Colors-and-paints">
<h4 class="subsection">21.1.3 Colors and paints</h4>

<p>A <em>paint</em> is a color pattern used to fill part of the canvas.
A paint can be a color, a texture (a replicated pattern), or a gradient
(a color that gradually fades to some other color).
</p>
<p>A <em>color</em> is defined by red, green, and blue values.
It may also have an alpha component, which specifies transparency.
</p>
<dl class="def">
<dt id="index-_002d_003epaint"><span class="category">Procedure: </span><span><strong>-&gt;paint</strong> <em>value</em><a href='#index-_002d_003epaint' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Converts <var>value</var> to a color - or more general a paint.
Specificlly, the return type is <code>java.awt.Paint</code>.
The <var>value</var> can be any one of:
</p><ul>
<li> A <code>java.awt.Paint</code>, commonly a <code>java.awt.Color</code>.
</li><li> A 24-bit integer value is converted to a color.
Assume the integer is equal
to a hexadecimal literal of the form <code>#xRRGGBB</code>.
Then <code>RR</code> (bits 16-23) is the intensity of the red component;
<code>GG</code> (bits 8-15) is the intensity of the green component; and
<code>RR</code> (bits 0-7) is the intensity of the red component.
</li><li> One of the standard HTML/CSS/SVG color names, as a string or symbol.
See the table in <code>gnu/kawa/models/StandardColor.java</code> source file.
Case is ignored, and you can optionally use hyphens to separate words.
For example <code>'hot-pink</code>, <code>'hotpink</code>, and <code>'hotPink</code>
are all the same sRGB color <code>#xFF69B4</code>.
</li></ul>
</dd></dl>

<dl class="def">
<dt id="index-with_002dpaint"><span class="category">Procedure: </span><span><strong>with-paint</strong> <em>paint picture</em><a href='#index-with_002dpaint' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Create a new picture that is the &ldquo;same&rdquo; as <var>picture</var>
but use <var>paint</var> as the default paint.
For <var>paint</var> you can use any valid argument to <code>-&gt;paint</code>.
The default paint (which is the color black if none is specified)
is used for both <code>fill</code> (paint interior) and <code>draw</code> (stroke outline).
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(! circ1 (circle 20 &amp;P[20 20]))</kbd>
#|kawa:2|# <kbd>(hbox (fill circ1) (draw circ1))</kbd>
<img src="images/paint-circ-1.png" alt="images/paint-circ-1">
#|kawa:3|# <kbd>(with-paint 'hot-pink (hbox (fill circ1) (draw circ1)))</kbd>
<img src="images/paint-circ-2.png" alt="images/paint-circ-2">
</pre></div>
<p>Above we use <code>with-paint</code> to create a cloned picture, which is
the same as the original <code>hbox</code>, except for the default paint,
in this case the color <code>hot-pink</code>.
</p><div class="example">
<pre class="example">#|kawa:4|# <kbd>(! circ2 (hbox (fill circ1) (with-paint 'hot-pink (fill circ1))))</kbd>
#|kawa:5|# <kbd>circ2</kbd>
<img src="images/paint-circ-3.png" alt="images/paint-circ-3">
#|kawa:6|# <kbd>(with-paint 'lime-green circ2)</kbd>
<img src="images/paint-circ-4.png" alt="images/paint-circ-4">
</pre></div>
<p>Here <code>circ2</code> is an <code>hbox</code> of two filled circles,
one that has unspecified paint, and one that is <code>hot-pink</code>.
Printing <code>circ2</code> directly uses black for the
circle with unspecified color,
but if we wrap <code>circ2</code> in another <code>with-paint</code>
that provides a default that is used for the first circle.
</p></dd></dl>

</div>
<div class="subsection" id="Filling-a-shape-with-a-color">
<h4 class="subsection">21.1.4 Filling a shape with a color</h4>

<dl class="def">
<dt id="index-fill"><span class="category">Procedure: </span><span><strong>fill</strong> <em>shape</em><a href='#index-fill' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-fill-1"><span class="category">Procedure: </span><span><strong>fill</strong> <em>paint shape</em><a href='#index-fill-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Fill the &ldquo;inside&rdquo; of <var>shape</var>.
If no <var>paint</var> is specified, uses the current default paint.
Otherwise, <code>(fill <var>paint</var> <var>shape</var>)</code>
is the same <code>(with-paint <var>paint</var> (file <var>shape</var>))</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Stroking-_0028outlining_0029-a-shape">
<h4 class="subsection">21.1.5 Stroking (outlining) a shape</h4>

<dl class="def">
<dt id="index-draw"><span class="category">Procedure: </span><span><strong>draw</strong> <em>option<sup>*</sup> shape<sup>+</sup></em><a href='#index-draw' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Returns a picture that draws the outline of the <var>shape</var>.
This is called <em>stroking</em>.
An <var>option</var> may be one of:
</p><ul>
<li> A <code>Paint</code> or <code>Color</code> object, which is used to draw the shape.
</li><li> A standard color name, such as <code>'red</code> or <code>'medium-slate-blue</code>.
This is mapped to a <code>Color</code>.
</li><li> A join-specifier, which is a symbol specifying how each curve of the shape is
connected to the next one.
The options are <code>'miter-join</code>, <code>'round-join</code>, and <code>'bevel-join</code>.
The default if none is specified is <code>'miter-join</code>.
</li><li> A end-cap-specifier, which is a symbol specifying how each end of the
shape is terminated.
The options are <code>'square-cap</code>, <code>'round-cap</code>, or <code>'butt-cap</code>.
The default is <code>'butt-cap</code>.
(This follows SVG and HTML Canvas.
The default in plain Java AWT is a square cap.)
</li><li> A real number specifies the thickness of the stroke.
</li><li> A <code>java.awt.Stroke</code> object.
This combines join-specifier, end-cap-specifier, thickness, and more
in a single object.  The <code>BasicStroke</code> class can specify dashes,
though that is not yet supported for SVG output; only AWT or image output.
</li></ul>

<p>Let us illustrate with a sample line <code>lin</code>
and a helper macro <code>show-draw</code>, which adds a border around a shape,
then draws the given shape with some options, and finally
re-draws the shape in plain form.
</p><div class="example">
<pre class="example">#|kawa:10|# <kbd>(define lin (line &amp;P[0 0] &amp;P[300 40] &amp;P[200 100] &amp;P[50 70]))</kbd>
#|kawa:11|# <kbd>(define-syntax show-draw</kbd>
#|....:12|# <kbd>  (syntax-rules ()</kbd>
#|....:13|# <kbd>    ((_ options ... shape)</kbd>
#|....:14|# <kbd>     (border 12 'bisque (zbox (draw options ... shape) shape)))))</kbd>
#|....:15|# <kbd>(show-draw 8 'lime lin)</kbd>
<img src="images/show-draw-1.png" alt="images/show-draw-1">
#|....:16|# <kbd>(show-draw 8 'lime 'round-cap 'round-join lin)</kbd>
<img src="images/show-draw-2.png" alt="images/show-draw-2">
#|....:17|# <kbd>(show-draw 8 'lime 'square-cap 'bevel-join lin)</kbd>
<img src="images/show-draw-3.png" alt="images/show-draw-3">
</pre></div>
</dd></dl>
<p>Notice how the different cap and join styles change the drawing.
Also note how the stroke (color lime) extends beyond its bounding box,
into the surrounding border (color bisque).
</p></div>
<div class="subsection" id="Affine-transforms">
<h4 class="subsection">21.1.6 Affine transforms</h4>

<p>A 2D affine transform is a linear mapping from coordinates to
coordinates.  It generalizes translation, scaling, flipping, shearing,
and their composition.  An affine transform maps straight parallel lines
into other straight parallel lines, so it is only a subset of possible
mappings - but a very useful subset.
</p>
<dl class="def">
<dt id="index-affine_002dtransform"><span class="category">Procedure: </span><span><strong>affine-transform</strong> <em>xx xy yx yy x0 y0</em><a href='#index-affine_002dtransform' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-affine_002dtransform-1"><span class="category">Procedure: </span><span><strong>affine-transform</strong> <em>px py p0</em><a href='#index-affine_002dtransform-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a new affine transform.
The result of applying <code>(affine-transform <var>x<sub>x</sub></var> <var>x<sub>y</sub></var> <var>y<sub>x</sub></var> <var>y<sub>y</sub></var> <var>x<sub>0</sub></var> <var>y<sub>0</sub></var>)</code>
to the point <code>&amp;P[<var>x</var> <var>y</var>]</code>
is the transformed point
</p><div class="example">
<pre class="example">&amp;P[(+ (* <var>x</var> <var>x<sub>x</sub></var>) (* <var>y</var> <var>y<sub>x</sub></var>) <var>x<sub>0</sub></var>)
   (+ (* <var>x</var> <var>x<sub>y</sub></var>) (* <var>y</var> <var>y<sub>y</sub></var>) <var>y<sub>0</sub></var>)]
</pre></div>

<p>If using point arguments,
<code>(affine-transform &amp;P[<var>x<sub>x</sub></var> <var>x<sub>y</sub></var>] &amp;P[<var>y<sub>x</sub></var> <var>y<sub>y</sub></var>] &amp;P[<var>x<sub>0</sub></var> <var>y<sub>0</sub></var>])</code>
is equivalent to:
<code>(affine-transform <var>x<sub>x</sub></var> <var>x<sub>y</sub></var> <var>y<sub>x</sub></var> <var>y<sub>y</sub></var> <var>x<sub>0</sub></var> <var>y<sub>0</sub></var>)</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-with_002dtransform"><span class="category">Procedure: </span><span><strong>with-transform</strong> <em>transform picture</em><a href='#index-with_002dtransform' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-with_002dtransform-1"><span class="category">Procedure: </span><span><strong>with-transform</strong> <em>transform shape</em><a href='#index-with_002dtransform-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a transformed picture.
</p>
<p>If the argument is a <var>shape</var>, then the result is also a shape.
</p></dd></dl>

<dl class="def">
<dt id="index-with_002dtransform-2"><span class="category">Procedure: </span><span><strong>with-transform</strong> <em>transform point</em><a href='#index-with_002dtransform-2' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Apply a transform to a single point, yielding a new point.
</p></dd></dl>

<dl class="def">
<dt id="index-with_002dtransform-3"><span class="category">Procedure: </span><span><strong>with-transform</strong> <em>transform1 transform2</em><a href='#index-with_002dtransform-3' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Combine two transforms, yielding the composed transform.
</p></dd></dl>

<dl class="def">
<dt id="index-rotate"><span class="category">Procedure: </span><span><strong>rotate</strong> <em>angle</em><a href='#index-rotate' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-rotate-1"><span class="category">Procedure: </span><span><strong>rotate</strong> <em>angle picture</em><a href='#index-rotate-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The one-argument variant creates a new affine transform that rotates
a picture about the origin by the specified <var>angle</var>.
A positive <var>angle</var> yields a clockwise rotation.
The <var>angle</var> can be either a quantity (with a unit of
either <code>rad</code> radians, <code>deg</code> (degrees), or <code>grad</code> (gradians)),
or it can be a unit-less real number (which is treated as degrees).
</p>
<p>The two-argument variant applies the resulting transform to
the specified picture.  It is equivalent to:
</p><div class="example">
<pre class="example">(with-transform (rotate <var>angle</var>) <var>picture</var>)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-scale"><span class="category">Procedure: </span><span><strong>scale</strong> <em>factor</em><a href='#index-scale' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-scale-1"><span class="category">Procedure: </span><span><strong>scale</strong> <em>factor picture</em><a href='#index-scale-1' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Scales the <var>picture</var> by the given <var>factor</var>.
The <var>factor</var> can be a real number.
The <var>factor</var> can also be a point or a dimension, in which case
the two cordinates are scaled by a different amount.
</p>
<p>The two-argument variant applies the resulting transform to
the specified picture.  It is equivalent to:
</p><div class="example">
<pre class="example">(with-transform (scale <var>factor</var>) <var>picture</var>)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-translate"><span class="category">Procedure: </span><span><strong>translate</strong> <em>offset</em><a href='#index-translate' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-translate-1"><span class="category">Procedure: </span><span><strong>translate</strong> <em>offset picture</em><a href='#index-translate-1' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>The single-argument variant creates a transform
that adds the <var>offset</var> to each point.
The <var>offset</var> can be either a point or a dimension (which
are treated quivalently).
</p>
<p>The two-argument variant applies the resulting transform to
the specified picture.  It is equivalent to:
</p><div class="example">
<pre class="example">(with-transform (translate <var>offset</var>) <var>picture</var>)
</pre></div>
</dd></dl>

</div>
<div class="subsection" id="Combining-pictures">
<h4 class="subsection">21.1.7 Combining pictures</h4>

<dl class="def">
<dt id="index-hbox"><span class="category">Procedure: </span><span><strong>hbox</strong> <em>[spacing] picture ...</em><a href='#index-hbox' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-vbox"><span class="category">Procedure: </span><span><strong>vbox</strong> <em>[spacing] picture ...</em><a href='#index-vbox' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-zbox"><span class="category">Procedure: </span><span><strong>zbox</strong> <em>picture ...</em><a href='#index-zbox' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Make a combined picture from multiple sub-pictures drawn
either &ldquo;next to&rdquo; or &ldquo;on top of&rdquo; each other.
</p>
<p>The case of <code>zbox</code> is simplest: The sub-pictures are drawn
in argument order at the same position (origin).  The &ldquo;<code>z</code>&rdquo; refers to
the idea that the pictures are stacked on top of each other along
the &ldquo;Z-axis&rdquo; (the one perpendicular to the screen).
</p>
<p>The <code>hbox</code> and <code>vbox</code> instead place the sub-pictures
next to each other, in a row or column.
If <var>spacing</var> is specified, if must be a real number.
That much extra spacing is added between each sub-picture.
</p>
<p>More precisely: <code>hbox</code> shifts each sub-picture except the first
so its left-origin control-point
(see discussion at <code>re-center</code>) has the same position
as the right-origin control point of the previous picture
<var>plus</var> the amount of <var>spacing</var>.
Similarly, <code>vbox</code> shifts each sub-picture except the first
so its top-origin control point has the same position
as the bottom-origin point of the previous picture, plus <var>spacing</var>.
</p>
<p>The bounding box of the result is the smallest rectangle that
includes the bounding boxes of the (shifted) sub-pictures.
The origin of the result is that of the first picture.
</p></dd></dl>

<dl class="def">
<dt id="index-border"><span class="category">Procedure: </span><span><strong>border</strong> <em>[size [paint]] picture</em><a href='#index-border' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a picture that combines <var>picture</var>
with a rectangular border (frame) around <var>picture</var>&rsquo;s bounding box.
The <var>size</var> specifies the thickness of the border:
it can be real number, in which it is the thickness on all four sides;
it can be a Dimension, in which case the width is the left and right
thickness, while the height is the top and bottom thickness;
or it can be a Rectangle, in which case it is the new bounding box.
If <var>paint</var> is specified it is used for the border;
otherwise the default paint is used.
The border is painted before (below) the <var>picture</var> painted.
The bounding box of the result is that of the border, while
the origin point is that of the original <var>picture</var>.
</p><div class="example">
<pre class="example">#|kawa:2|# <kbd>(with-paint 'blue (border &amp;D[8 5] (fill 'pink (circle 30))))</kbd>
<img src="images/border-1.png" alt="images/border-1">
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-padding"><span class="category">Procedure: </span><span><strong>padding</strong> <em>width [background] picture</em><a href='#index-padding' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This is similar to <code>border</code>,
but it just adds extra space around <var>picture</var>,
without painting it.  The <var>size</var> is specified the same way.
If <var>background</var> is specified,
it becomes the background paint for the entire padded
rectangle (both <var>picture</var> and the extra padding).
</p><div class="example">
<pre class="example">#|kawa:3|# <kbd>(define circ1 (fill 'teal (circle 25)))</kbd>
#|kawa:4|# <kbd>(zbox (line &amp;P[-30 20] &amp;P[150 20])</kbd>
#|kawa:5|# <kbd>  (hbox circ1 (padding 6 'yellow circ1) (padding 6 circ1)))</kbd>
<img src="images/padding-1.png" alt="images/padding-1">
</pre></div>
<p>This shows a circle drawn three ways:
as-is; with padding and a background color;
with padding and a transparent background.
A line is drawn before (below) the circles to contrast
the yellow vs transparent backgrounds.
</p></dd></dl>

<dl class="def">
<dt id="index-re_002dcenter"><span class="category">Procedure: </span><span><strong>re-center</strong> <em>[xpos] [ypos] picture</em><a href='#index-re_002dcenter' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Translate the <var>picture</var> such that the point specified by <var>xpos</var>
and <var>ypos</var> is the new origin point, adjusting the bounding box to match.
If the <var>picture</var> is a shape, so is the result.
</p>
<p>The <var>xpos</var> can have four possible values, all of which are symbols:
<code>'left</code> (move the origin to the left edge of the bounding box);
<code>'right</code> (move the origin to the left edge of the bounding box);
<code>'center</code> (or <code>'centre</code>) (move the origin to halfway between the left and right edges);
or <code>'origin</code> (don&rsquo;t change the location along the x-axis).
The <var>ypos</var> can likewise have four possible values:
<code>'top</code> (move the origin to the top edge of the bounding box);
<code>'bottom</code> (move the origin to the bottom edge of the bounding box);
<code>'center</code> (or <code>'centre</code>) (move the origin to halfway between the
top and bottom edges);
or <code>'origin</code> (don&rsquo;t change the location along the y-axis).
</p>
<p>A single <code>'center</code> argument
is the same as specifying <code>'center</code> for both axis; this is the default.
A single <code>'origin</code> argument
is the same as specifying <code>'origin</code> for both axis;
this is the same as just <var>picture</var>.
</p>
<p>The 16 control points are shown below, relative to a picture&rsquo;s
bounding box and the X- and Y-axes.
The abbreviations have the obvious values, for example
<code>LC</code> means <code>'left 'center</code>.
</p><div class="example">
<pre class="example">LT    OT  CT      RT
  ┌────┬──────────┐
  │    │          │
  │    │          │
LC│   OC  C       │RC
LO├────O──CO──────┤RO
  │    │          │
  └────┴──────────┘
LB    OB  CB       RB   
</pre></div>
<p>The result of (for example) <code>(re-center 'left 'center <var>P</var>)</code>
is <var>P</var> translated so the origin is at control point <code>LC</code>.
</p>
<div class="example">
<pre class="example">#|kawa:1|# <kbd>(define D (fill 'light-steel-blue (polygon &amp;P[-20 0] &amp;P[0 -20] &amp;P[60 0] &amp;P[0 40])))</kbd>
#|kawa:2|# <kbd>(zbox D (draw 'red (circle 5)))</kbd>
<img src="images/re-center-1.png" alt="images/re-center-1">
</pre></div>
<p>Above we defined <code>D</code> as a vaguely diamond-shaped quadrilateral.
A small red circle is added to show the origin point.
Below we display 5 versions of <code>D</code> in a line (an <code>hbox</code>),
starting with the original <code>D</code> and 4 calls to <code>re-center</code>.
</p><div class="example">
<pre class="example">#|kawa:3|# <kbd>(zbox (hbox D (re-center 'top D) (re-center 'bottom D)</kbd>
#|....:4|# <kbd>              (re-center 'center D) (re-center 'origin D))</kbd>
#|....:5|# <kbd>  (line &amp;P[0 0] &amp;P[300 0]))</kbd>
<img src="images/re-center-2.png" alt="images/re-center-2">
</pre></div>
<p>The line at <var>y=0</var> shows the effects of <code>re-center</code>.
</p></dd></dl>

</div>
<div class="subsection" id="Images">
<h4 class="subsection">21.1.8 Images</h4>

<p>An image is a picture represented as a rectangular grid of color values.
An image file is some encoding (usually compressed) of an image,
and mostly commonly has the extensions <code>png</code>, <code>gif</code>,
or <code>jpg</code>/<code>jpeg</code>.
</p>
<p>A &ldquo;native image&rdquo; is an instance of <code>java.awt.image.BufferedImage</code>,
while a &ldquo;picture image&rdquo; is an instance of <code>gnu.kawa.models.DrawImage</code>.
(Both classes implement the <code>java.awt.image.RenderedImage</code> interface.)
A <code>BufferedImage</code> is automatically converted to a <code>DrawImage</code>
when needed.
</p>
<dl class="def">
<dt id="index-image"><span class="category">Procedure: </span><span><strong>image</strong> <em>bimage</em><a href='#index-image' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-image-1"><span class="category">Procedure: </span><span><strong>image</strong> <em>picture</em><a href='#index-image-1' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-image-2"><span class="category">Procedure: </span><span><strong>image</strong> <em>src: path</em><a href='#index-image-2' class='copiable-anchor'> &para;</a></span></dt>
<dd>
<p>Creates a picture image, using either an existing native image <var>bimage</var>,
or an image file specified by <var>path</var>.
</p>
<p>Writing <code>(image src: <var>path</var>)</code> is roughly the same
as <code>(image (read-image <var>path</var>))</code> except that the former
has the <var>path</var> associated with the resulting picture image.
This can make a difference when the image is used or displayed.
</p>
<p>If the argument is a <var>picture</var>, it is converted to an image
as if by <code>-&gt;image</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-image_002dread"><span class="category">Procedure: </span><span><strong>image-read</strong> <em>path</em><a href='#index-image_002dread' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Read an image file from the specified <var>path</var>,
and returns a native image object (a <code>BufferedImage</code>).
</p><div class="example">
<pre class="example">#|kawa:10|# <kbd>(define img1 (image-read &quot;http://pics.bothner.com/2013/Cats/06t.jpg&quot;))</kbd>
#|kawa:11|# <kbd>img1</kbd>
<img src="images/image-cat-1a.png" alt="images/image-cat-1a">
#|kawa:12|# <kbd>(scale 0.6 (rotate 30 img1))</kbd>
<img src="images/image-cat-1b.png" alt="images/image-cat-1b">
</pre></div>
</dd></dl>

<p>Note that while <code>img1</code> above is a (native) image,
the scaled rotated image is not an image object.
It is a picture - a more complex value that <em>contains</em> an image.
</p>
<dl class="def">
<dt id="index-image_002dwrite"><span class="category">Procedure: </span><span><strong>image-write</strong> <em>picture path</em><a href='#index-image_002dwrite' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>picture</var> is converted to an image
(as if by using <code>-&gt;image</code>) and then it is written
to the specified <var>path</var>.
The format used depends on (the lower-cased string value of) the path:
A JPG file if the name ends with <code>&quot;.jpg&quot;</code> or <code>&quot;.jpeg&quot;</code>;
a GIF file if the name ends with <code>&quot;.gif&quot;</code>;
a PNG file if the name ends with <code>&quot;.png&quot;</code>.
(Otherwise, the defalt is PNG, but that might change.)
</p></dd></dl>

<dl class="def">
<dt id="index-image_002dwidth"><span class="category">Procedure: </span><span><strong>image-width</strong> <em>image</em><a href='#index-image_002dwidth' class='copiable-anchor'> &para;</a></span></dt>
<dt id="index-image_002dheight"><span class="category">Procedure: </span><span><strong>image-height</strong> <em>image</em><a href='#index-image_002dheight' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return the width or height of the given <var>image</var>, in pixels.
</p></dd></dl>

<dl class="def">
<dt id="index-_002d_003eimage"><span class="category">Procedure: </span><span><strong>-&gt;image</strong> <em>picture</em><a href='#index-_002d_003eimage' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Convert <var>picture</var> to an image (a <code>RenderedImage</code>).
If the <var>picture</var> is an image, return as-is.
Otherwise, create an empty image (a <code>BufferedImage</code> whose size is the
<var>picture</var>&rsquo;s bounding box), and &ldquo;paint&rdquo; the <var>picture</var> into it.
</p><div class="example">
<pre class="example">#|kawa:1|# <kbd>(define c (fill (circle 10)))</kbd>
#|kawa:2|# <kbd>(scale 3 (hbox c (-&gt;image c)))</kbd>
<img src="images/image-scaled-1.png" alt="images/image-scaled-1">
</pre></div>
<p>Here we take a circle <code>c</code>, and convert it to an image.
Note how when the image is scaled, the pixel artifacts are very noticable.
Also note how the origin of the image is the top-level corner,
while the origin of the original circle is its center.
</p></dd></dl>

</div>
<div class="subsection" id="Compositing-_002d-Controlling-how-pictures-are-combined">
<h4 class="subsection">21.1.9 Compositing - Controlling how pictures are combined</h4>

<dl class="def">
<dt id="index-with_002dcomposite"><span class="category">Procedure: </span><span><strong>with-composite</strong> <em>[[compose-op] picture] ...</em><a href='#index-with_002dcomposite' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Limited support - SVG and DomTerm output has not been implemented.
</p></dd></dl>

</div>
<div class="subsection" id="Displaying-and-exporting-pictures">
<h4 class="subsection">21.1.10 Displaying and exporting pictures</h4>

<ul class="section-toc">
<li><a href="#Export-to-SVG" accesskey="1">Export to SVG</a></li>
<li><a href="#Display-in-Swing" accesskey="2">Display in Swing</a></li>
<li><a href="#Convert-to-image" accesskey="3">Convert to image</a></li>
</ul>
<div class="subsubsection" id="Export-to-SVG">
<h4 class="subsubsection">21.1.10.1 Export to SVG</h4>

<dl class="def">
<dt id="index-picture_002dwrite_002dsvg"><span class="category">Procedure: </span><span><strong>picture-write-svg</strong> <em>picture path [headers]</em><a href='#index-picture_002dwrite_002dsvg' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Writes the <var>picture</var> to the file specified <var>path</var>,
in SVG (Structered Vector Graphics) format.
If <var>headers</var> is true (which is the default)
first write out the XML and DOCTYPE declarations
that should be in a well-formed standaline SVG file.
Otherwise, just write of the <code>&lt;svg&gt;</code> element.
(Modern browers should be able to display a file
consisting of just the <code>&lt;svg&gt;</code> element,
as long as it has extension <code>.svg</code>, <code>.xml</code>, or <code>.html</code>;
the latter may add some extra padding.)
</p></dd></dl>

<dl class="def">
<dt id="index-picture_002d_003esvg_002dnode"><span class="category">Procedure: </span><span><strong>picture-&gt;svg-node</strong> <em>picture</em><a href='#index-picture_002d_003esvg_002dnode' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a SVG representation of <code>picture</code>,
in the form of an <code>&lt;svg&gt;</code> element,
similar to those discussed in <a href="#Creating-XML-nodes">Creating XML nodes</a>.
If you convert the <code>&lt;svg&gt;</code> element to a string,
you get formatted XML;
if you <code>write</code> the <code>&lt;svg&gt;</code> element
you get an <a href="#XML-literals">XML literal</a> of form <code>&quot;#&lt;svg&gt;...&lt;/svg&gt;&quot;</code>.
If you <code>display</code> the <code>&lt;svg&gt;</code> element
in a DomTerm terminal you get the picture (as a picture).
This works because when you display an element in DomTerm
it gets inserted into the display.
</p></dd></dl>

</div>
<div class="subsubsection" id="Display-in-Swing">
<h4 class="subsubsection">21.1.10.2 Display in Swing</h4>

<p>These procedures require <code>(import (kawa swing))</code> in addition to
<code>(import (kawa pictures))</code>.
</p>
<p>The convenience function <code>show-picture</code> is useful
for displaying a picture in a new (Swing) window.
</p>
<dl class="def">
<dt id="index-show_002dpicture"><span class="category">Procedure: </span><span><strong>show-picture</strong> <em>picture</em><a href='#index-show_002dpicture' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If this is the first call to <code>show-pictures</code>,
displays <var>picture</var> in a new top-level window (using the Swing toolkit).
Sequenent calls to  <code>show-picture</code> will reuse the window.
</p><div class="example">
<pre class="example">#|kawa:1|# <kbd>(import (kawa swing) (kawa pictures))</kbd>
#|kawa:2|# <kbd>(show-picture <var>some-picture</var>)</kbd>
#|kawa:3|# <kbd>(set-frame-size! &amp;D[200 200])</kbd> ; Adjust window size
#|kawa:4|# <kbd>(show-picture <var>some-other-picture</var>)</kbd>
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-picture_002d_003ejpanel"><span class="category">Procedure: </span><span><strong>picture-&gt;jpanel</strong> <em>picture</em><a href='#index-picture_002d_003ejpanel' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Return a <code>JPanel</code> that displays <var>picture</var>.
You can change the displayed picture by:
</p><div class="example">
<pre class="example">(set! <var>panel</var>:picture <var>some-other-picture</var>)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-set_002dframe_002dsize_0021"><span class="category">Procedure: </span><span><strong>set-frame-size!</strong> <em>size [frame]</em><a href='#index-set_002dframe_002dsize_0021' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>If <var>frame</var> is specified, set its size.
Otherwise, remember the size for future <code>show-picture</code> calls;
if there is already a <code>show-picture</code> window, adjust its size.
</p></dd></dl>

</div>
<div class="subsubsection" id="Convert-to-image">
<h4 class="subsubsection">21.1.10.3 Convert to image</h4>

<p>You can convert a picture to an image using the <code>-&gt;image</code> procedure,
or write it to a file using the <code>image-write</code> procedure.
</p>
<hr>
</div>
</div>
</div>
<div class="section" id="Building-JavaFX-applications">
<div class="header">
<p>
Next: <a href="#Building-for-Android" accesskey="n" rel="next">Building for Android</a>, Previous: <a href="#Composable-pictures" accesskey="p" rel="prev">Composable pictures</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Building-JavaFX-applications-1"></span><h3 class="section">21.2 Building JavaFX applications</h3>

<span id="index-JavaFX"></span>
<p>Kawa makes it easy to build &ldquo;rich client&rdquo; (i.e. GUI) applications using
<a href="http://www.oracle.com/technetwork/java/javafx/overview/index.html">JavaFX</a>.
For example the following program will print up a window with a button;
clicking on the button will print a message on the console output about the
event.
</p><div class="example">
<pre class="example">(require 'javafx-defs)
(javafx-application)

(javafx-scene
 title: &quot;Hello Button&quot;
 width: 600 height: 450
 (Button
  text: &quot;Click Me&quot;
  layout-x: 25
  layout-y: 40
  on-action: (lambda (e) (format #t &quot;Event: ~s~%~!&quot; e))))
</pre></div>

<p>JavaFX support is builtin to the pre-built <code>kawa-2.93.jar</code>.
It is easiest to use JDK 8; see below if you&rsquo;re using JDK 7.
If you build Kawa from source, specify <code>--with-javafx</code> on the
<code>configure</code> command line (assuming you&rsquo;re using JDK 8).
</p>
<p>Assume the above file is <code>HelloButton1.scm</code>, you can
run it like this:
</p><div class="example">
<pre class="example">$ kawa HelloButton1.scm
</pre></div>

<p>For more information and examples read this (slightly older)
<a href="http://per.bothner.com/blog/2011/JavaFX-using-Kawa-intro/">introduction</a>,
and
<a href="http://localhost/per/blog/2011/JavaFX-using-Kawa-animation/">this on animation</a>.
</p>
<p>The <code>browse-kawa-manual</code> script in the <code>doc</code> directory (source only)
uses JavaFX WebView to create a window for browsing the Kawa documentation.
</p>
<ul class="section-toc">
<li><a href="#Using-JavaFX-with-JDK-7" accesskey="1">Using JavaFX with JDK 7</a></li>
</ul>
<div class="subsection" id="Using-JavaFX-with-JDK-7">
<h4 class="subsection">21.2.1 Using JavaFX with JDK 7</h4>
<p>JDK 8 ships with JavaFX, and it is in the default <code>CLASSPATH</code>.
JDK 7 update 9 or later does have JavaFX included, but it is a separate
<code>jfxrt.jar</code> which not in the default <code>CLASSPATH</code>.
Thus you have to explicitly add <code>jfxrt.jar</code>.
To run the previous <code>HelloButton1.scm</code> you can do:
</p><div class="example">
<pre class="example">java -cp $JAVA_HOME/lib/jfxrt.jar:$KAWA_HOME/kawa.jar HelloButton1.scm
</pre></div>

<p>If you build Kawa from source, do:
</p><div class="example">
<pre class="example">$ ./configure --with-javafx=$JAVA_HOME --enable-kawa-frontend ...other-args...
</pre></div>
<p>The resulting Kawa binary sets up the path to <code>jfxrt.jar</code> so you just need to do:
</p><div class="example">
<pre class="example">$ kawa HelloButton1.scm
</pre></div>

<hr>
</div>
</div>
<div class="section" id="Building-for-Android">
<div class="header">
<p>
Next: <a href="#Android-view-construction" accesskey="n" rel="next">Android view construction</a>, Previous: <a href="#Building-JavaFX-applications" accesskey="p" rel="prev">Building JavaFX applications</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Building-for-Android-1"></span><h3 class="section">21.3 Building for Android</h3>

<p>Google&rsquo;s phone/tablet operating system
<a href="https://developers.google.com/android/">Android</a>
is based on a custom virtual machine on top of a Linux kernel.
Even though Android isn&rsquo;t strictly (or legally) speaking Java,
you can build Android applications using Kawa.
</p>
<p>Below is &quot;Hello world&quot; written in Kawa Scheme.  A slightly
more interesting example is in <a href="#Android-view-construction">next section</a>.
</p>
<div class="example">
<pre class="example">(require 'android-defs)
(activity hello
  (on-create-view
   (android.widget.TextView (this)
    text: &quot;Hello, Android from Kawa Scheme!&quot;)))
</pre></div>

<p>The following instructions have been tested on GNU/Linux,
specifically Fedora 17.
<a href="http://asieno.com/blog/index.php/post/2012/08/16/Setting-up-the-environment-Android-Kawa">This link</a> may be helpful if you&rsquo;re building on Windows.
</p>
<ul class="section-toc">
<li><a href="#Downloading-and-setting-up-the-Android-SDK" accesskey="1">Downloading and setting up the Android SDK</a></li>
<li><a href="#Building-Kawa-for-Android" accesskey="2">Building Kawa for Android</a></li>
<li><a href="#Creating-the-application" accesskey="3">Creating the application</a></li>
<li><a href="#Running-the-application-on-the-Android-emulator" accesskey="4">Running the application on the Android emulator</a></li>
<li><a href="#Running-the-application-on-your-device" accesskey="5">Running the application on your device</a></li>
<li><a href="#Some-debugging-notes" accesskey="6">Some debugging notes</a></li>
<li><a href="#Other-resources" accesskey="7">Other resources</a></li>
</ul>
<div class="subsection" id="Downloading-and-setting-up-the-Android-SDK">
<h4 class="subsection">21.3.1 Downloading and setting up the Android SDK</h4>

<p>First <a href="http://code.google.com/android/download.html">download the Android SDK</a>. Unzip in a suitable location, which we&rsquo;ll refer to as <code>ANDROID_HOME</code>.
</p>
<div class="example">
<pre class="example">export ANDROID_HOME=/path/to/android-sdk-linux
PATH=$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$PATH
</pre></div>

<p>Next you have to get the appropriate platform SDK:
</p>
<div class="example">
<pre class="example">$ android update sdk
</pre></div>
<p>You need to select an Android &ldquo;platform&rdquo;.
Platform (API) 16 corresponds to Android 4.1.2 (Jelly Bean).
Select that or whatever you prefer, and click <code>Install</code>.
(You can install multiple platforms, but each project
is built for a specific platform.)
</p>
<div class="example">
<pre class="example">ANDROID_PLATFORM=android-16
</pre></div>

</div>
<div class="subsection" id="Building-Kawa-for-Android">
<h4 class="subsection">21.3.2 Building Kawa for Android</h4>

<p>Set <code>JAVA_HOME</code> to where your JDK tree is.
You should use JDK 6; JDK 7 does not work at time of writing.
</p>
<div class="example">
<pre class="example">$ export JAVA_HOME=/opt/jdk1.6
</pre></div>

<p>First <a href="#Getting-Kawa">get the Kawa source code</a>.
</p>
<p>If using Ant (as is recommended on Windows):
</p>
<div class="example">
<pre class="example">$ ant -Denable-android=true
</pre></div>
<p>Alternatively, you can use <code>configure</code> and <code>make</code>:
</p>
<div class="example">
<pre class="example">$ KAWA_DIR=path_to_Kawa_sources
$ cd $KAWA_DIR
$ ./configure --with-android=$ANDROID_HOME/platforms/$ANDROID_PLATFORM/android.jar --disable-xquery --disable-jemacs
$ make
</pre></div>

</div>
<div class="subsection" id="Creating-the-application">
<h4 class="subsection">21.3.3 Creating the application</h4>

<p>Next, we need to create a project or &ldquo;activity&rdquo;.
This tutorial assumes you want to create the project
in the target directory <code>KawaHello</code>,
with the main activity being a class named <code>hello</code> in a
package <code>kawa.android</code>:
</p><div class="example">
<pre class="example">PROJECT_DIR=KawaHello
PROJECT_CLASS=hello
PROJECT_PACKAGE=kawa.android
PROJECT_PACKAGE_PATH=kawa/android
</pre></div>

<p>To create the project use the following command:
</p><div class="example">
<pre class="example">$ android create project --target $ANDROID_PLATFORM --name $PROJECT_DIR --activity $PROJECT_CLASS --path ./$PROJECT_DIR --package $PROJECT_PACKAGE
</pre></div>

<p>Replace the skeleton <code>hello.java</code> by the Scheme code at the
top of this note, placing in a file named <code>hello.scm</code>:
</p><div class="example">
<pre class="example">$ cd $PROJECT_DIR
$ HELLO_APP_DIR=`pwd`
$ cd $HELLO_APP_DIR/src/$PROJECT_PACKAGE_PATH
$ rm $PROJECT_CLASS.java
$ <i>create</i> $PROJECT_CLASS.scm
</pre></div>

<p>We need to copy/link the Kawa jar file so the Android SDK can find it:
</p><div class="example">
<pre class="example">$ cd $HELLO_APP_DIR
$ ln -s $KAWA_DIR/kawa-2.93.jar libs/kawa.jar
</pre></div>

<p>Optionally, you can use kawart-2.93.jar, which is slightly smaller,
but does not support eval, and does not get built by the Ant build:
</p><div class="example">
<pre class="example">$ ln -s $KAWA_DIR/kawart-2.93.jar libs/kawa.jar
</pre></div>

<p>Copy or link <code>custom_rules.xml</code> from the Kawa sources:
</p><div class="example">
<pre class="example">ln -s $KAWA_DIR/gnu/kawa/android/custom_rules.xml .
</pre></div>

<p>Finally to build the application just do:
</p><div class="example">
<pre class="example">$ ant debug
</pre></div>

</div>
<div class="subsection" id="Running-the-application-on-the-Android-emulator">
<h4 class="subsection">21.3.4 Running the application on the Android emulator</h4>

<p>First you need to create an <a href="http://developer.android.com/tools/devices">Android Virtual Device (avd)</a>. Start:
</p><div class="example">
<pre class="example">android
</pre></div>
<p>Then from menu <code>Tools</code> select <code>Manage AVDs...</code>.
In the new window click <code>New....</code>
Pick a <code>Name</code> (we use <code>avd16</code> in the following),
a <code>Target</code> (to match <code>$ANDROID_PLATFORM</code>),
and optionally change the other properties, before clicking <code>Create AVD</code>.
</p>
<p>Now you can start up the Android emulator:
</p>
<div class="example">
<pre class="example">$ emulator -avd avd16 &amp;
</pre></div>
<p>Wait until Android has finished booting (you will see the Android home screen),
click the menu and home buttons. Now install our new application:
</p>
<div class="example">
<pre class="example">adb install bin/KawaHello-debug.apk
</pre></div>

</div>
<div class="subsection" id="Running-the-application-on-your-device">
<h4 class="subsection">21.3.5 Running the application on your device</h4>

<p>If the emulator is running, kill it:
</p><div class="example">
<pre class="example">$ kill %emulator
</pre></div>

<p>On your phone or other Android devude, enable USB debugging.
(This is settable from the <code>Settings</code> application,
under <code>Applications / Development</code>.)
</p>
<p>Connect the phone to your computer with the USB cable.
Verify that the phone is accessible to <code>adb</code>:
</p><div class="example">
<pre class="example">$ adb devices
List of devices attached 
0A3A560F0C015024	device
</pre></div>

<p>If you don&rsquo;t see a device listed, it may be permission problem. You can figure out which device corresponds to the phone by doing:
</p>
<div class="example">
<pre class="example">$ ls -l /dev/bus/usb/*
/dev/bus/usb/001:
total 0
...
crw-rw-rw- 1 root wheel 189, 5 2010-10-18 16:52 006
...
</pre></div>

<p>The timestamp corresponds to when you connected the phone.
Make the USB connection readable:
</p><div class="example">
<pre class="example">$ sudo chmod a+w /dev/bus/usb/001/006
</pre></div>

<p>Obviously if you spend time developing for an Androd phone you&rsquo;ll want to automate this process;
<a href="https://sites.google.com/site/siteofhx/Home/android/drivers/udc">this link</a>
or <a href="https://groups.google.com/forum/?fromgroups=#!topic/android-developers/nTfhhPktGfM">this link</a> may be helpful.
</p>
<p>Anyway, once <code>adb</code> can talk to the phone, you install in the same way as before:
</p><div class="example">
<pre class="example">adb install bin/KawaHello-debug.apk
</pre></div>

</div>
<div class="subsection" id="Some-debugging-notes">
<h4 class="subsection">21.3.6 Some debugging notes</h4>

<p>You will find a copy of the SDK documentation in <code>$ANDROID_HOME/docs/index.html</code>.
</p>
<p>If the emulator complains that your application has stopped unexpectedly, do:
</p><div class="example">
<pre class="example">$ adb logcat
</pre></div>

<p>This shows log messages, stack traces, output from the <code>Log.i</code> logging method, and other useful information.
(You can alternatively start <code>ddms</code> (Dalvik Debug Monitor Service), click on the <code>kawa.android line</code> in the top-left sub-window to select it, then from the <code>Device</code> menu select <code>Run logcat....</code>).
</p>
<p>To uninstall your application, do:
</p><div class="example">
<pre class="example">$ adb uninstall kawa.android
</pre></div>

</div>
<div class="subsection" id="Other-resources">
<h4 class="subsection">21.3.7 Other resources</h4>

<p>(A more interesting <a href="http://androidscheme.blogspot.com/2010/10/text-to-speech-app.html">text-to-speech</a> example app is on Santosh Rajan&rsquo;s <a href="http://androidscheme.blogspot.com/">Android-Scheme blog</a>.)
</p>
<p><a href="https://github.com/ecraven/SchemeAndroidOGL">https://github.com/ecraven/SchemeAndroidOGL</a>
</p>
<hr>
</div>
</div>
<div class="section" id="Android-view-construction">
<div class="header">
<p>
Next: <a href="#System-inquiry" accesskey="n" rel="next">System inquiry</a>, Previous: <a href="#Building-for-Android" accesskey="p" rel="prev">Building for Android</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Android-view-construction-1"></span><h3 class="section">21.4 Android view construction</h3>

<p>An Android user interface is constructed from <code>View</code> objects.
The following is an example that illustrates some features of
Kawa to help write views hierarchies,
The example is self-contained, and can be built and run
as described in <a href="#Building-for-Android">Building for Android</a>.
</p>
<div class="example">
<pre class="example">(require 'android-defs)
(activity hello
  (on-create-view 
   (define counter ::integer 0)
   (define counter-view
     (TextView text: &quot;Not clicked yet.&quot;))
   (LinearLayout orientation: LinearLayout:VERTICAL
    (TextView text: &quot;Hello, Android from Kawa Scheme!&quot;)
    (Button
     text: &quot;Click here!&quot;
     on-click-listener: (lambda (e)
                          (set! counter (+ counter 1))
                          (counter-view:setText
                           (format &quot;Clicked ~d times.&quot; counter))))
    counter-view)))
</pre></div>

<p>The first <code>import</code> form imports various useful definitions
from the Kawa Android library.  Using these is not required for
writing a Kawa application, but makes it more convenient.
</p>
<p>The names <code>LinearLayout</code>, <code>TextView</code>, and <code>Button</code>
are just aliases for standard Android <code>View</code> sub-classes.
A few are prefined by <code>(require 'android-defs)</code>, or you
can define them yourself using <code>define-alias</code>.
</p>
<p>An Android application consists of one or more <em>activities</em>,
each of which is an instance of the <code>android.app.Activity</code> class.
You can use the <code>activity</code> macro to define your <code>Activity</code> class.
The first macro argument (in this case <code>hello</code>) is the class name,
and the others are members of the class, in the syntax of
a <a href="#meta_002dfield_002dor_002dmethod_002ddecl"><var>field-or-method-decl</var></a>.  The sub-form <code>on-create-view</code>
is an abbreviation for declaring an <code>onCreate</code> method
(which is called when the <code>Activity</code> starts up
followed by a <code>setContentView</code>:
The body of the <code>on-create-view</code> is evaluated.
The result should be a <code>View</code> expression,
which is passed to <code>setContentView</code>.
</p>
<dl class="def">
<dt id="index-current_002dactivity"><span class="category">Procedure: </span><span><strong>current-activity</strong> <em>[new-value]</em><a href='#index-current_002dactivity' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>With no arguments, returns the current <code>Activity</code>.
If a <var>new-value</var> argument is given, sets the current activity.
It is set automatically by the <code>on-create</code> and <code>on-create-view</code>
methods of the <code>activity</code> macro.
</p>
<p>Since <code>current-activity</code> is a <a href="#Parameter-objects">parameter object</a>,
you can
locally change the value using <a href="#parameterize_002dsyntax"><code>parameterize</code></a>.
</p></dd></dl>

<ul class="section-toc">
<li><a href="#View-object-allocation" accesskey="1">View object allocation</a></li>
<li><a href="#Event-handlers" accesskey="2">Event handlers</a></li>
</ul>
<div class="subsection" id="View-object-allocation">
<h4 class="subsection">21.4.1 View object allocation</h4>

<p>To create an instance of a <code>View</code> class you &ldquo;call&rdquo; the
class as if it were a function,
as described in <a href="#Allocating-objects">Allocating objects</a>.
For example:
</p><div class="example">
<pre class="example">(TextView (this) text: &quot;Hello, Android from Kawa Scheme!&quot;)
</pre></div>

<p>If you <code>(require 'android-defs)</code> that defines
some special handling for <code>View</code> classes.
You can leave out the <code>(this)</code> argument,
which refers to the enclosing <code>Activity</code>:
</p><div class="example">
<pre class="example">(TextView text: &quot;Hello, Android from Kawa Scheme!&quot;)
</pre></div>

</div>
<div class="subsection" id="Event-handlers">
<h4 class="subsection">21.4.2 Event handlers</h4>

<p>You can register event listeners on Android <code>View</code> objects
using methods typically named <code>setOn<var>EVENT</var>Listener</code>.
For example <code>setOnClickListener</code>.  When allocating
an object you can leave out the <code>set</code>, and you can optionally
use Scheme-style names: <code>on-click-listener</code>.  The argument
is an object of a special nested listener class,
for example <code>View$OnClickListener</code>.  These are
single-method classes, so you can use a lambda expression
and <a href="#SAM_002dconversion">SAM-conversion</a> will automatically create the needed
listener class.
</p>
<hr>
</div>
</div>
<div class="section" id="System-inquiry">
<div class="header">
<p>
Next: <a href="#Processes" accesskey="n" rel="next">Processes</a>, Previous: <a href="#Android-view-construction" accesskey="p" rel="prev">Android view construction</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="System-inquiry-1"></span><h3 class="section">21.5 System inquiry</h3>

<dl class="def">
<dt id="index-home_002ddirectory"><span class="category">Variable: </span><span><strong>home-directory</strong><a href='#index-home_002ddirectory' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>A string containing the home directory of the user.
</p></dd></dl>

<dl class="def">
<dt id="index-command_002dline"><span class="category">Procedure: </span><span><strong>command-line</strong><a href='#index-command_002dline' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a nonempty list of immutable strings. The first element is
an implementation-specific name for the running top-level
program.
The remaining elements are the command-line arguments,
as passed to the <code>main</code> method (except for those
flags processed by Kawa itself).
</p>
<p>The first element will depend on how the Kawa module was invoked.
Kawa uses the following rules to determine the command name:
</p>
<ol>
<li> If the property <code>kawa.command.name</code> is set, that is used.
This variable can be set on the <code>kawa</code> command line,
for example from a script:
<div class="example">
<pre class="example">kawa -Dkawa.command.name=&quot;$0&quot; foo &quot;$@&quot;
</pre></div>
<p>This variable is also set implicitly by the meta-arg option.  FIXME.
</p></li><li> If we&rsquo;re reading a source file that starts with the Unix command-file prefix
&lsquo;<samp>#!/</samp>&rsquo; then we use the name of the source file.
The assumption is that such a file is an executable script.
</li><li> If the Java property <code>kawa.command.line</code> is set,
then we use that (after stripping off text that duplicates
the remaining arguments).
The <code>kawa</code> program sets this property to the
command line used to invoke it
(specifically the contents of the entire <code>argv</code> array),
before invoking the <code>java</code> program.
</li><li> If the Java property <code>sun.java.command</code> is set,
then we use that (after stripping off text that duplicates
the remaining arguments), and then prepending the string <code>&quot;java &quot;</code>.
The OpenJDK <code>java</code> program sets this property.
</li><li> If all else fails, the command name is <code>&quot;kawa&quot;</code>.
</li></ol>
</dd></dl>

<dl class="def">
<dt id="index-command_002dline_002darguments"><span class="category">Variable: </span><span><strong>command-line-arguments</strong><a href='#index-command_002dline_002darguments' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Any command-line arguments (following flags processed by Kawa itself)
are assigned to the global variable &lsquo;<samp>command-line-arguments</samp>&rsquo;,
which is a vector of strings.
</p></dd></dl>

<dl class="def">
<dt id="index-process_002dcommand_002dline_002dassignments"><span class="category">Procedure: </span><span><strong>process-command-line-assignments</strong><a href='#index-process_002dcommand_002dline_002dassignments' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Process any initial command-line options that set variables.
These have the form <code><var>name</var>=<var>value</var></code>.
Any such command-line options (at the start of the command-line)
are processed and removed from the command-line.
</p><div class="example">
<pre class="example">$ java kawa.repl -- abc=123 def
#|kawa:1|# (write (command-line))
(&quot;java kawa.repl --&quot; &quot;abc=123&quot; &quot;def&quot;)
#|kawa:2|# (process-command-line-assignments)
#|kawa:3|# (write (command-line))
(&quot;java kawa.repl -- abc=123&quot; &quot;def&quot;)
#|kawa:4|# abc
123
</pre></div>
<p>This function is mostly useful for Kawa applications
compiled with the <code>--main</code> option.
(It is used to set XQuery <code>external</code> variables.)
</p></dd></dl>

<dl class="def">
<dt id="index-get_002denvironment_002dvariable"><span class="category">Procedure: </span><span><strong>get-environment-variable</strong> <em>name</em><a href='#index-get_002denvironment_002dvariable' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Many operating systems provide each running process with
an environment conisting of environment variables.
(This environment is not to be confused with the
Scheme environments that can be passed to <code>eval</code>.)
Both the name and value of an environment variable are
strings. The procedure <code>get-environment-variable</code>
returns the value of the environment variable <var>name</var>,
or <code>#f</code> if the environment variable is not found.
(This uses the <code>java.lang.System:getenv</code> method.)
It is an error to mutate the resulting string.
</p><div class="example">
<pre class="example">(get-environment-variable &quot;PATH&quot;)
    &rArr; &quot;/usr/local/bin:/usr/bin:/bin&quot;
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-get_002denvironment_002dvariables"><span class="category">Procedure: </span><span><strong>get-environment-variables</strong><a href='#index-get_002denvironment_002dvariables' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the names and values of all the environment variables as an alist,
where the car of each entry is the name of an environment variable,
and the cdr is its value, both as strings.
It is an error to mutate any of the strings or the alist itself.
</p><div class="example">
<pre class="example">(get-environment-variables)
  &rArr; ((&quot;USER&quot; . &quot;root&quot;) (&quot;HOME&quot; . &quot;/&quot;))
</pre></div>
</dd></dl>

<hr>
</div>
<div class="section" id="Processes">
<div class="header">
<p>
Next: <a href="#Time_002drelated-functions" accesskey="n" rel="next">Time-related functions</a>, Previous: <a href="#System-inquiry" accesskey="p" rel="prev">System inquiry</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Processes-1"></span><h3 class="section">21.6 Processes</h3>

<p>A <em>process</em> is a native (operating-system-level) application or
program that runs separately from the current virtual machine.
</p>
<p>Many programming languages have facilities to allow access to system
processes (commands).  (For example Java has <code>java.lang.Process</code>
and <code>java.lang.ProcessBuilder</code>.)
These facilities let you send data to the standard input, extract the
resulting output, look at the return code, and sometimes even pipe
commands together.   However, this is rarely as easy as it is using
the old Bourne shell; for example command substitution is awkward.
Kawa&rsquo;s solution is based on these two ideas:
</p><ul>
<li> A &ldquo;process expression&rdquo; (typically a function call) evaluates to a
<code>LProcess</code> value, which provides access to a Unix-style
(or Windows) process.
</li><li> In a context requiring a string (or a bytevector), an <code>LProcess</code> is
automatically converted to a string (or bytevector)
comprising the standard output from the process.
</li></ul>

<ul class="section-toc">
<li><a href="#Creating-a-process" accesskey="1">Creating a process</a></li>
<li><a href="#Process-literals" accesskey="2">Process literals</a></li>
<li><a href="#Process-values-and-process-output" accesskey="3">Process values and process output</a></li>
<li><a href="#Substitution-and-tokenization" accesskey="4">Substitution and tokenization</a></li>
<li><a href="#Input_002foutput-redirection" accesskey="5">Input/output redirection</a></li>
<li><a href="#Pipe_002dlines" accesskey="6">Pipe-lines</a></li>
<li><a href="#Setting-the-process-environment" accesskey="7">Setting the process environment</a></li>
<li><a href="#Waiting-for-process-exit" accesskey="8">Waiting for process exit</a></li>
<li><a href="#Exiting-the-current-process-1" accesskey="9">Exiting the current process</a></li>
<li><a href="#Deprecated-functions">Deprecated functions</a></li>
</ul>
<div class="subsection" id="Creating-a-process">
<h4 class="subsection">21.6.1 Creating a process</h4>

<p>The most flexible way to start a process is with either the
<code>run-process</code> procedure or
the <code>&amp;`{<var>command</var>}</code> syntax
for <a href="#process-literals">process literals</a>.
</p>
<dl class="def">
<dt id="index-run_002dprocess"><span class="category">Procedure: </span><span><strong>run-process</strong> <em><a href="#meta_002dprocess_002dkeyword_002dargument"><var>process-keyword-argument</var></a><sup>*</sup> <var>command</var></em><a href='#index-run_002dprocess' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a process object, specifically a <code>gnu.kawa.functions.LProcess</code>
object.
A <var>process-keyword-argument</var> can be used to set various options,
as discussed below.
</p>
<p>The <var>command</var> is the process command-line (name and arguments).
It can be an array of strings, in which case those are used as the
command arguments directly:
</p><div class="example">
<pre class="example">(run-process [&quot;ls&quot; &quot;-l&quot;])
</pre></div>
<p>The <var>command</var> can also be a single string, which is split (tokenized)
into command arguments separated by whitespace.
Quotation groups words together just like traditional shells:
</p><div class="example">
<pre class="example">(run-process &quot;cmd a\&quot;b 'c\&quot;d k'l m\&quot;n'o&quot;)
   &rArr; (run-process [&quot;cmd&quot;   &quot;ab 'cd&quot;   &quot;k'l m\&quot;no&quot;])
</pre></div>

<p>The syntax shorthand <code>&amp;`{<var>command</var>}</code>
or <code>&amp;sh{<var>command</var>}</code> (discussed below)
is usually more convenient.
</p></dd></dl>

<div class="display">
<pre class="display"><span id="index-process_002dkeyword_002dargument"></span><span id="meta_002dprocess_002dkeyword_002dargument"></span><var>process-keyword-argument</var> <tt>::=</tt>
    <a href="#meta_002dprocess_002dredirect_002dargument"><var>process-redirect-argument</var></a>
  | <a href="#meta_002dprocess_002denvironment_002dargument"><var>process-environment-argument</var></a>
  | <a href="#meta_002dprocess_002dmisc_002dargument"><var>process-misc-argument</var></a>
</pre></div>

<p>We discuss <a href="#meta_002dprocess_002dredirect_002dargument"><var>process-redirect-argument</var></a> and
<a href="#meta_002dprocess_002denvironment_002dargument"><var>process-environment-argument</var></a> later.
<span id="meta_002dprocess_002dmisc_002dargument"></span>The <var>process-misc-argument</var> options are just the following:
</p><dl compact="compact">
<dt><span><code><b>shell:</b></code> <var>shell</var></span></dt>
<dd><p>Currently, <var>shell</var> must be one of <code>#f</code> (which is ignored)
or <code>#t</code>.  The latter means to use an external shell to tokenize
the <var>command</var>.
I.e. the following are equivalent:
</p><div class="example">
<pre class="example">(run-process shell: #t &quot;<var>command</var>&quot;)
(run-process [&quot;/bin/sh&quot; &quot;-c&quot; &quot;<var>command</var>&quot;])
</pre></div>
</dd>
<dt><span><code><b>directory:</b></code> <var>dir</var></span></dt>
<dd><p>Change the working directory of the new process to <var>dir</var>.
</p></dd>
</dl>

<span id="process-literals"></span></div>
<div class="subsection" id="Process-literals">
<h4 class="subsection">21.6.2 Process literals</h4>

<p>A simple <em>process literal</em> is a kind of
<a href="#Named-quasi_002dliterals">named literal</a> that uses the backtick character
(<code>`</code>) as the <a href="#meta_002dcname"><var>cname</var></a>.
For example:
</p><div class="example">
<pre class="example">&amp;`{date --utc}
</pre></div>
<p>This is equivalent to:
</p><div class="example">
<pre class="example">(run-process &quot;date --utc&quot;)
</pre></div>

<p>In general the following are
roughly equivalent (using <a href="#string-quasi_002dliterals">string quasi-literals</a>):
</p><div class="example">
<pre class="example">&amp;`[<var>args</var>...]{<var>command</var>}
(run-process <var>args</var>... &amp;{<var>command</var>})
</pre></div>
<p>The reason for the &ldquo;roughly&rdquo; is if <var>command</var> contains
escaped sub-expressions; in that case <code>&amp;`</code> may process
the resulting values differently from plain string-substitution,
as discussed below.
</p>
<p>If you use <code>&amp;sh</code> instead of <code>&amp;`</code> then a shell is used:
</p><div class="example">
<pre class="example">&amp;sh{rm *.class}
</pre></div>
<p>which is equivalent to:
</p><div class="example">
<pre class="example">&amp;`{/bin/sh -c &quot;rm *.class&quot;}
</pre></div>

<p>In general, the following are equivalent:
</p><div class="example">
<pre class="example">&amp;sh[<var>args</var>...]{<var>command</var>}
&amp;`[shell: #t <var>args</var>...]{<var>command</var>}
</pre></div>

</div>
<div class="subsection" id="Process-values-and-process-output">
<h4 class="subsection">21.6.3 Process values and process output</h4>

<p>The value returned from a call to <code>run-process</code> or a process literal
is an instance of <code>gnu.kawa.functions.LProcess</code>.
This class extends <code>java.lang.Process</code>, so you can treat it as
any other <code>Process</code> object.
</p><div class="example">
<pre class="example">#|kawa:1|# (define p1 &amp;`{date --utc})
#|kawa:2|# (p1:toString)
gnu.kawa.functions.LProcess@377dca04
#|kawa:3|# (write p1)
gnu.kawa.functions.LProcess@377dca04
</pre></div>

<p>What makes an <code>LProcess</code> interesting is that it is also
a <a href="#Blobs">blob</a>, which is automatically
converted to a string (or bytevector) in a context that requires it.
The contents of the blob comes from the standard output of the process.
The blob is evaluated <a href="#Lazy-evaluation">lazily</a>,
so data it is only collected when requested.
</p>
<div class="example">
<pre class="example">#|kawa:4|# (define s1 ::string p1)
#|kawa:5|# (write s1)
&quot;Wed Jan  1 01:18:21 UTC 2014\n&quot;
#|kawa:6|# (define b1 ::bytevector p1)
(write b1)
#u8(87 101 100 32 74 97 110 ... 52 10)
</pre></div>

<p>The <code>display</code> procedure prints it in &ldquo;human&rdquo; form, as a string:
</p><div class="example">
<pre class="example">#|kawa:7|# (display p1)
Wed Jan  1 01:18:21 UTC 2014
</pre></div>
<p>This is also the default REPL formatting:
</p><div class="example">
<pre class="example">#|kawa:8|# &amp;`{date --utc}
Wed Jan  1 01:18:22 UTC 2014
</pre></div>

<p>When you type a command to a shell, its output goes to the console,
Similarly, in a REPL the output from the process
is copied to the console output - which can sometimes by optimized
by letting the process inherit its standard output from the Kawa process.
</p>
</div>
<div class="subsection" id="Substitution-and-tokenization">
<h4 class="subsection">21.6.4 Substitution and tokenization</h4>

<p>To substitute the variable or the result of an expression
in the command line use the usual syntax for quasi literals:
</p><div class="example">
<pre class="example">(define filename (make-temporary-file))
&amp;sh{run-experiment &gt;&amp;[filename]}
</pre></div>

<p>Since a process is convertible a string, we need no special
syntax for command substitution:
</p><div class="example">
<pre class="example">`{echo The directory is: &amp;[&amp;`{pwd}]}
</pre></div>
<p>or equivalently:
</p><div class="example">
<pre class="example">`{echo The directory is: &amp;`{pwd}}
</pre></div>

<span id="substitution_002dtokenization"></span><p>Things get more interesting when considering the interaction between
substitution and tokenization. This is not simple string
interpolation. For example, if an interpolated value contains a quote
character, we want to treat it as a literal quote, rather than a token
delimiter. This matches the behavior of traditional shells. There are
multiple cases, depending on whether the interpolation result is a
string or a vector/list, and depending on whether the interpolation is
inside quotes.
</p>
<ul>
<li> If the value is a string, and we&rsquo;re not inside quotes, then all
non-whitespace characters (including quotes) are literal, but
whitespace still separates tokens:
<div class="example">
<pre class="example">(define v1 &quot;a b'c &quot;)
&amp;`{cmd x y&amp;[v1]z}   &rArr;  (run-process [&quot;cmd&quot; &quot;x&quot; &quot;ya&quot; &quot;b'c&quot; &quot;z&quot;])
</pre></div>
</li><li> If the value is a string, and we are inside single quotes,
all characters (including whitespace) are literal.
<div class="example">
<pre class="example">&amp;`{cmd 'x y&amp;[v1]z'}   &rArr;  (run-process [&quot;cmd&quot; &quot;x ya b'c z&quot;])
</pre></div>
<p>Double quotes work the same except that newline is an argument
separator. This is useful when you have one filename per line, and the
filenames may contain spaces, as in the output from <code>find</code>:
</p><div class="example">
<pre class="example">&amp;`{ls -l &quot;&amp;`{find . -name '*.pdf'}&quot;}
</pre></div>
<p>This solves a problem that is quite painful with traditional shells.
</p></li><li> If the value is a vector or list (of strings), and we&rsquo;re not inside
quotes, then each element of the array becomes its own argument, as-is:
<div class="example">
<pre class="example">(define v2 [&quot;a b&quot; &quot;c\&quot;d&quot;])
&amp;`{cmd &amp;[v2]}  &rArr;  (run-process [&quot;cmd&quot; &quot;a b&quot; &quot;c\&quot;d&quot;])
</pre></div>
<p>However, if the enclosed expression is adjacent to non-space non-quote
characters, those are prepended to the first element, or appended to
the last element, respectively.
</p><div class="example">
<pre class="example">&amp;`{cmd x&amp;[v2]y}   &rArr;  (run-process [&quot;cmd&quot; &quot;xa b&quot; &quot;c\&quot;dy&quot;])
&amp;`{cmd x&amp;[[]]y}   &rArr;  (run-process [&quot;cmd&quot; &quot;xy&quot;])
</pre></div>
<p>This behavior is similar to how shells handle <code>&quot;$@&quot;</code>
(or <code>&quot;${name[@]}&quot;</code> for general arrays), though in Kawa you would
leave off the quotes.
</p>
<p>Note the equivalence:
</p><div class="example">
<pre class="example">&amp;`{&amp;[array]}   &rArr;  (run-process array)
</pre></div>
</li><li> If the value is a vector or list (of strings), and we <em>are</em>
inside quotes, it is equivalent to interpolating a single string
resulting from concatenating the elements separated by a space:
<div class="example">
<pre class="example">&amp;`{cmd &quot;&amp;[v2]&quot;}
 &rArr;  (run-process [&quot;cmd&quot; &quot;a b c\&quot;d&quot;])
</pre></div>
<p>This behavior is similar to how shells handle <code>&quot;$*&quot;</code> (or
<code>&quot;${name[*]}&quot;</code> for general arrays).
</p></li><li> If the value is the result of a call to <code>unescaped-data</code> then it
is parsed as if it were literal. For example a quote in the unescaped
data may match a quote in the literal:
<div class="example">
<pre class="example">(define vu (unescaped-data &quot;b ' c d '&quot;))
&amp;`{cmd 'a &amp;[vu]z'}   &rArr;  (run-process [&quot;cmd&quot; &quot;a b &quot; &quot;c&quot; &quot;d&quot; &quot;z&quot;])
</pre></div>
</li><li> If we&rsquo;re using a shell to tokenize the command, then we add quotes or
backslashes as needed so that the shell will tokenize as described
above:
<div class="example">
<pre class="example">(define authors [&quot;O'Conner&quot; &quot;de Beauvoir&quot;])
&amp;sh{list-books &amp;[authors]}
</pre></div>
<p>The command passed to the shell is:
</p><div class="example">
<pre class="example">list-books 'O'\''Conner' 'de Beauvoir
</pre></div>
<p>Having quoting be handled by the <code>$construct$:sh</code>
implementation automatically eliminates common code injection problems.
</p></li></ul>

<p>Smart tokenization only happens when using the quasi-literal forms such
as <code>&amp;`{command}</code>.
You can of course use string templates with <code>run-process</code>:
</p><div class="example">
<pre class="example">(run-process &amp;{echo The directory is: &amp;`{pwd}})
</pre></div>
<p>However, in that case there is no smart tokenization: The template is
evaluated to a string, and then the resulting string is tokenized,
with no knowledge of where expressions were substituted.
</p>
</div>
<div class="subsection" id="Input_002foutput-redirection">
<h4 class="subsection">21.6.5 Input/output redirection</h4>

<p>You can use various keyword arguments to specify standard input, output,
and error streams. For example to lower-case the text in <code>in.txt</code>,
writing the result to <code>out.txt</code>, you can do:
</p><div class="example">
<pre class="example">&amp;`[in-from: &quot;in.txt&quot; out-to: &quot;out.txt&quot;]{tr A-Z a-z}
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">(run-process in-from: &quot;in.txt&quot; out-to: &quot;out.txt&quot; &quot;tr A-Z a-z&quot;)
</pre></div>

<span id="meta_002dprocess_002dredirect_002dargument"></span><p>A <var>process-redirect-argument</var> can be one of the following:
</p>
<dl compact="compact">
<dt><span><code><b>in:</b></code> <var>value</var></span></dt>
<dd><p>The <var>value</var> is evaluated, converted to a string (as if
using <code>display</code>), and copied to the input file of the process.
The following are equivalent:
</p><div class="example">
<pre class="example">&amp;`[in: &quot;text\n&quot;]{command}
&amp;`[in: &amp;`{echo &quot;text&quot;}]{command}
</pre></div>
<p>You can pipe the output from <code>command1</code> to the input
of <code>command2</code> as follows:
</p><div class="example">
<pre class="example">&amp;`[in: &amp;`{command1}]{command2}
</pre></div>
</dd>
<dt><span><code><b>in-from:</b></code> <var>path</var></span></dt>
<dd><p>The process reads its input from the specified <var>path</var>, which
can be any value coercible to a <code>filepath</code>.
</p></dd>
<dt><span><code><b>out-to:</b></code> <var>path</var></span></dt>
<dd><p>The process writes its output to the specified <var>path</var>. 
</p></dd>
<dt><span><code><b>err-to:</b></code> <var>path</var></span></dt>
<dd><p>Similarly for the error stream. 
</p></dd>
<dt><span><code><b>out-append-to:</b></code> <var>path</var></span></dt>
<dt><span><code><b>err-append-to:</b></code> <var>path</var></span></dt>
<dd><p>Similar to <code>out-to</code> and <code>err-to</code>, but append to the file
    specified by <var>path</var>, instead of replacing it.
</p></dd>
<dt><span><code><b>in-from: &rsquo;pipe</b></code></span></dt>
<dt><span><code><b>out-to: &rsquo;pipe</b></code></span></dt>
<dt><span><code><b>err-to: &rsquo;pipe</b></code></span></dt>
<dd><p>Does not set up redirection. Instead, the specified stream is available
using the methods <code>getOutputStream</code>, <code>getInputStream</code>,
or <code>getErrorStream</code>, respectively, on the resulting <code>Process</code> object,
just like Java&rsquo;s <code>ProcessBuilder.Redirect.PIPE</code>.
</p></dd>
<dt><span><code><b>in-from: &rsquo;inherit</b></code></span></dt>
<dt><span><code><b>out-to: &rsquo;inherit</b></code></span></dt>
<dt><span><code><b>err-to: &rsquo;inherit</b></code></span></dt>
<dd><p>Inherits the standard input, output, or error stream from the
current JVM process. 
</p></dd>
<dt><span><code><b>out-to:</b></code> <var>port</var></span></dt>
<dt><span><code><b>err-to:</b></code> <var>port</var></span></dt>
<dd><p>Redirects the standard output or error of the process to
the specified <var>port</var>.
</p></dd>
<dt><span><code><b>out-to: &rsquo;current</b></code></span></dt>
<dt><span><code><b>err-to: &rsquo;current</b></code></span></dt>
<dd><p>Same as <code>out-to: (current-output-port)</code>,
or <code>err-to: (current-error-port)</code>, respectively. 
</p></dd>
<dt><span><code><b>in-from:</b></code> <var>port</var></span></dt>
<dt><span><code><b>in-from: &rsquo;current</b></code></span></dt>
<dd><p>Re-directs standard input to read from the <var>port</var>
(or <code>(current-input-port)</code>). It is unspecified how much is read from
the <var>port</var>. (The implementation is to use a thread that reads from the
port, and sends it to the process, so it might read to the end of the port,
even if the process doesn&rsquo;t read it all.) 
</p></dd>
<dt><span><code><b>err-to: &rsquo;out</b></code></span></dt>
<dd><p>Redirect the standard error of the process to be merged with the
standard output. 
</p></dd>
</dl>

<p>The default for the error stream (if neither <code>err-to</code> or
<code>err-append-to</code> is specified) is equivalent to <code>err-to: 'current</code>.
</p>
<p><em>Note:</em> Writing to a port is implemented by copying the output or error
stream of the process. This is done in a thread, which means we don&rsquo;t have
any guarantees when the copying is finished. (In the future we might
change <code>process-exit-wait</code> (discussed later) wait for not only the
process to finish, but also for these helper threads to finish.)
</p>
<p>A <a href="https://en.wikipedia.org/wiki/Here_document">here document</a> is
a form a literal string, typically multi-line, and commonly used in
shells for the standard input of a process.  You can use string literals or
<a href="#string-quasi_002dliterals">string quasi-literals</a> for this.
For example, this passes the string <code>&quot;line1\nline2\nline3\n&quot;</code> to
the standard input of <code>command</code>:
</p><div class="example">
<pre class="example">(run-process [in: &amp;{
    &amp;|line1
    &amp;|line2
    &amp;|line3
    }] &quot;command&quot;)
</pre></div>

<p>Note the use of <code>&amp;|</code> to mark the end of ignored indentation.
</p>
</div>
<div class="subsection" id="Pipe_002dlines">
<h4 class="subsection">21.6.6 Pipe-lines</h4>

<p>Piping the output of one process as the input of another
is in princple easy - just use the <code>in:</code>
process argument.  However, writing a multi-stage pipe-line quickly gets ugly:
</p><div class="example">
<pre class="example">&amp;`[in: &amp;`[in: &quot;My text\n&quot;]{tr a-z A-Z}]{wc}
</pre></div>
<p>The convenience macro <code>pipe-process</code> makes this much nicer:
</p><div class="example">
<pre class="example">(pipe-process
  &quot;My text\n&quot;
  &amp;`{tr a-z A-Z}
  &amp;`{wc})
</pre></div>

<dl class="def">
<dt id="index-pipe_002dprocess"><span class="category">Syntax: </span><span><strong>pipe-process</strong> <em>input process<sup>*</sup></em><a href='#index-pipe_002dprocess' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>All of the <var>process</var> expressions must be <code>run-process</code> forms,
or equivalent <code>&amp;`{command}</code> forms.
The result of evaluating <var>input</var> becomes the input to the first
<var>process</var>; the output from the first <var>process</var> becomes
the input to the second <var>process</var>, and so on.  The result of
whole <code>pipe-process</code> expression is that of the last <var>process</var>.
</p>
<p>Copying the output of one process to the input of the next is
optimized: it uses a copying loop in a separate thread. Thus you can
safely pipe long-running processes that produce huge output. This
isn&rsquo;t quite as efficient as using an operating system pipe, but is
portable and works pretty well.
</p></dd></dl>

</div>
<div class="subsection" id="Setting-the-process-environment">
<h4 class="subsection">21.6.7 Setting the process environment</h4>

<span id="meta_002dprocess_002denvironment_002dargument"></span><p>By default the new process inherits the system environment of the current
(JVM) process as returned by <code>System.getenv()</code>, but you can override it.
A <var>process-environment-argument</var> can be one of the following:
</p>
<dl compact="compact">
<dt><span><code><b>env-</b></code><var>name</var><code><b>:</b></code> <var>value</var></span></dt>
<dd><p>In the process environment, set the <code>&quot;<var>name</var>&quot;</code> to the
specified <var>value</var>. For example:
</p><div class="example">
<pre class="example">&amp;`[env-CLASSPATH: &quot;.:classes&quot;]{java MyClass}
</pre></div>
</dd>
<dt><span><var>NAME</var><code><b>:</b></code> <var>value</var></span></dt>
<dd><p>Same as using the <code>env-<var>NAME</var></code> option above, but only if the
<code><var>NAME</var></code> is uppercase (i.e. if uppercasing <code><var>NAME</var></code> yields
the same string). For example the previous example could be written:
</p><div class="example">
<pre class="example">&amp;`[CLASSPATH: &quot;.:classes&quot;]{java MyClass}
</pre></div>
</dd>
<dt><span><code><b>environment:</b></code> <var>env</var></span></dt>
<dd><p>The <var>env</var> is evaluated and must yield a <code>HashMap</code>.
This map is used as the system environment of the process. 
</p></dd>
</dl>

</div>
<div class="subsection" id="Waiting-for-process-exit">
<h4 class="subsection">21.6.8 Waiting for process exit</h4>

<p>When a process finishes, it returns an integer exit code.
The code is traditionally 0 on successful completion,
while a non-zero code indicates some kind of failure or error.
</p>
<dl class="def">
<dt id="index-process_002dexit_002dwait"><span class="category">Procedure: </span><span><strong>process-exit-wait</strong> <em>process</em><a href='#index-process_002dexit_002dwait' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The <var>process</var> expression must evaluate to a process
(any <code>java.lang.Process</code> object).
This procedure waits for the process to finish, and then returns the
exit code as an <code>int</code>.
</p><div class="example">
<pre class="example">(process-exit-wait (run-process &quot;echo foo&quot;)) &rArr; 0
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-process_002dexit_002dok_003f"><span class="category">Procedure: </span><span><strong>process-exit-ok?</strong> <em>process</em><a href='#index-process_002dexit_002dok_003f' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Calls <code>process-exit-wait</code>, and then returns <code>#false</code>
if the process exited it 0, and returns <code>#true</code> otherwise.
</p>
<p>This is useful for emulating the way traditional shell do
logic control flow operations based on the exit code.
For example in <code>sh</code> you might write:
</p><div class="example">
<pre class="example">if grep Version Makefile &gt;/dev/null
then echo found Version
else echo no Version
fi
</pre></div>

<p>The equivalent in Kawa:
</p>
<div class="example">
<pre class="example">(if (process-exit-ok? &amp;`{grep Version Makefile})
  &amp;`{echo found}
  &amp;`{echo not found})
</pre></div>

<p>Strictly speaking these are not quite the same, since the Kawa
version silently throws away the output from <code>grep</code>
(because no-one has asked for it). To match the output from the <code>sh</code>,
you can use <code>out-to: 'inherit</code>:
</p><div class="example">
<pre class="example">(if (process-exit-ok? &amp;`[out-to: 'inherit]{grep Version Makefile})
  &amp;`{echo found}
  &amp;`{echo not found})
</pre></div>
</dd></dl>

<span id="Exiting-the-current-process"></span></div>
<div class="subsection" id="Exiting-the-current-process-1">
<h4 class="subsection">21.6.9 Exiting the current process</h4>

<dl class="def">
<dt id="index-exit"><span class="category">Procedure: </span><span><strong>exit</strong> <em>[code]</em><a href='#index-exit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Exits the Kawa interpreter, and ends the Java session.
Returns the value of <var>code</var> to the operating system:
The <var>code</var> must be integer, or the special
values <code>#f</code> (equivalent to -1), or
<code>#t</code> (equivalent to 0).
If <var>code</var> is not specified, zero is returned.
The <var>code</var> is a status code; by convention a non-zero
value indicates a non-standard (error) return.
</p>
<p>Before exiting, finally-handlers (as in <code>try-finally</code>,
or the <var>after</var> procedure of <code>dynamic-wind</code>) are
executed, but only in the current thread, and only if
the current thread was started normally. (Specifically
if we&rsquo;re inside an <code>ExitCalled</code> block with non-zero
nesting - see <code>gnu.kawa.util.ExitCalled</code>.)
Also, JVM shutdown hooks are executed - which includes
flushing buffers of output ports.  (Specifically
<code>Writer</code> objects registered with the <code>WriterManager</code>.)
</p></dd></dl>

<dl class="def">
<dt id="index-emergency_002dexit"><span class="category">Procedure: </span><span><strong>emergency-exit</strong> <em>[code]</em><a href='#index-emergency_002dexit' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Exits the Kawa interpreter, and ends the Java session.
Communicates an exit value in the same manner as <code>exit</code>.
Unlike <code>exit</code>, neither finally-handlers nor
shutdown hooks are executed.
</p></dd></dl>

</div>
<div class="subsection" id="Deprecated-functions">
<h4 class="subsection">21.6.10 Deprecated functions</h4>

<dl class="def">
<dt id="index-make_002dprocess"><span class="category">Procedure: </span><span><strong>make-process</strong> <em>command envp</em><a href='#index-make_002dprocess' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Creates a <code>&lt;java.lang.Process&gt;</code> object, using the specified
<var>command</var> and <var>envp</var>.
The <var>command</var> is converted to an array of Java strings
(that is an object that has type <code>&lt;java.lang.String[]&gt;</code>.
It can be a Scheme vector or list (whose elements should be
Java strings or Scheme strings);  a Java array of Java strings;
or a Scheme string.  In the latter case, the command is converted
using <code>command-parse</code>.
The <var>envp</var> is process environment;  it should be either
a Java array of Java strings, or the special <code>#!null</code> value.
</p>
<p>Except for the representation of <var>envp</var>, this is similar to:
</p><div class="example">
<pre class="example">(run-process environment: <var>envp</var> <var>command</var>)
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-system"><span class="category">Procedure: </span><span><strong>system</strong> <em>command</em><a href='#index-system' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Runs the specified <var>command</var>, and waits for it to finish.
Returns the return code from the command.  The return code is an integer,
where 0 conventionally means successful completion.
The <var>command</var> can be any of the types handled by <code>make-process</code>.
</p>
<p>Equivalent to:
</p><div class="example">
<pre class="example">(process-exit-wait (make-process <var>command</var> #!null))
</pre></div>
</dd></dl>

<dl class="def">
<dt id="index-command_002dparse"><span class="category">Variable: </span><span><strong>command-parse</strong><a href='#index-command_002dparse' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The value of this variable should be a one-argument procedure.
It is used to convert a command from a Scheme string to a Java
array of the constituent &quot;words&quot;.
The default binding, on Unix-like systems, returns a new command to
invoke <code>&quot;/bin/sh&quot; &quot;-c&quot;</code> concatenated with the command string;
on non-Unix-systems, it is bound to <code>tokenize-string-to-string-array</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-tokenize_002dstring_002dto_002dstring_002darray"><span class="category">Procedure: </span><span><strong>tokenize-string-to-string-array</strong> <em>command</em><a href='#index-tokenize_002dstring_002dto_002dstring_002darray' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Uses a <code>java.util.StringTokenizer</code> to parse the <var>command</var> string
into an array of words.  This splits the <var>command</var> using spaces
to delimit words; there is no special processing for quotes or other
special characters.
(This is the same as what <code>java.lang.Runtime.exec(String)</code> does.)
</p></dd></dl>

<hr>
</div>
</div>
<div class="section" id="Time_002drelated-functions">
<div class="header">
<p>
Next: <a href="#Low_002dlevel-functions" accesskey="n" rel="next">Deprecated low-level functions</a>, Previous: <a href="#Processes" accesskey="p" rel="prev">Processes</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Time_002drelated-functions-1"></span><h3 class="section">21.7 Time-related functions</h3>

<dl class="def">
<dt id="index-current_002dsecond"><span class="category">Procedure: </span><span><strong>current-second</strong><a href='#index-current_002dsecond' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an inexact number represent the current time on the
<a href="http://en.wikipedia.org/wiki/International_Atomic_Time">International Atomic Time (TAI)</a> scale.
The value 0.0 represents midnight on January 1, 1070 TAI (equivalent
to 10 seconds before midnight Universal Time), and
the value 1.0 represents on TAI second later.
Neither high acuracy nor high precision are required; in particular
returning Coordinated Universal Time plus a suitable
constant might be the best an implementation cat do.
The Kawa implementation just multiplies by 0.001 the result of calling
the method <code>currentTimeMillis</code> in class <code>java.lang.System</code>.
</p></dd></dl>

<dl class="def">
<dt id="index-current_002djiffy"><span class="category">Procedure: </span><span><strong>current-jiffy</strong><a href='#index-current_002djiffy' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns the number of <em>jiffies</em> as an exact integer that have
elapses since an arbitrary implementation-defined epoch (instant).
A jiffy is an implementation-defined fraction of a second which is
defined by the return value of the <code>jiffies-per-second</code> procedure.
The starting epoch (instant 0) is guaranteed to be constant during
a run of the program, but may vary between runs.
(At the time of writing, Kawa&rsquo;s jiffy is one nano-second.)
</p>
<p><em>Rationale:</em> Jiffies are allowed to be implementation-dependent
so that <code>current-jiffy</code> can execute with minimal overhead.
It should be very likely that a compactly represented integer will
suffice as the return value.  Any particular jiffy size will be
inappropriate some some implementations: a microsecond is too long for
a very fast machine, while a much smaller unit would force many
implementations to return integers which have to allocated for most calls,
rendering <code>current-jiffy</code> less useful for accurate timing measurements.
</p></dd></dl>

<dl class="def">
<dt id="index-jiffies_002dper_002dsecond"><span class="category">Procedure: </span><span><strong>jiffies-per-second</strong><a href='#index-jiffies_002dper_002dsecond' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns an exact integer representing the number of jiffies
per SI second. This value is an implementation-specified
constant.
(At the time of writing, the value in Kawa is 1,000,000,000.)
</p></dd></dl>

<dl class="def">
<dt id="index-sleep"><span class="category">Procedure: </span><span><strong>sleep</strong> <em>time</em><a href='#index-sleep' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Suspends the current thread for the specified time.
The <var>time</var> can be either a pure number (in secords),
or a quantity whose unit is a time unit (such as <code>10s</code>).
</p></dd></dl>

<hr>
</div>
<div class="section" id="Low_002dlevel-functions">
<div class="header">
<p>
Previous: <a href="#Time_002drelated-functions" accesskey="p" rel="prev">Time-related functions</a>, Up: <a href="#Miscellaneous" accesskey="u" rel="up">Miscellaneous topics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Deprecated-low_002dlevel-functions"></span><h3 class="section">21.8 Deprecated low-level functions</h3>

<p>These sections document older and less convenient ways
to call Java methods, access Java fields, and use Java arrays.
</p>
<span id="Low_002dlevel-Method-invocation"></span><ul class="section-toc">
<li><a href="#Low_002dlevel-Method-invocation-1" accesskey="1">Low-level Method invocation</a></li>
<li><a href="#Low_002dlevel-field-operations" accesskey="2">Low-level field operations</a></li>
<li><a href="#Old-low_002dlevel-array-macros-1" accesskey="3">Old low-level array macros</a></li>
</ul>
<div class="subsection" id="Low_002dlevel-Method-invocation-1">
<h4 class="subsection">21.8.1 Low-level Method invocation</h4>
<p>The following lower-level primitives require you to specify
the parameter and return types explicitly.
You should probably use the functions <code>invoke</code> and <code>invoke-static</code>
(see <a href="#Method-operations">Calling Java methods from Scheme</a>) instead.
</p>
<dl class="def">
<dt id="index-primitive_002dconstructor"><span class="category">Syntax: </span><span><strong>primitive-constructor</strong> <em>class (argtype ...)</em><a href='#index-primitive_002dconstructor' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new anonymous procedure, which when called will create
a new object of the specified class, and will then call the
constructor matching the specified argument types.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dvirtual_002dmethod"><span class="category">Syntax: </span><span><strong>primitive-virtual-method</strong> <em>class method rtype (argtype ...)</em><a href='#index-primitive_002dvirtual_002dmethod' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new anonymous procedure, which when called will
invoke the instance method whose name is the string <var>method</var>
in the class whose name is <var>class</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dstatic_002dmethod"><span class="category">Syntax: </span><span><strong>primitive-static-method</strong> <em>class method rtype (argtype ...)</em><a href='#index-primitive_002dstatic_002dmethod' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new anonymous procedure, which when called will
invoke the static method whose name is the string <var>method</var>
in the class whose name is <var>class</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dinterface_002dmethod"><span class="category">Syntax: </span><span><strong>primitive-interface-method</strong> <em>interface method rtype (argtype ...)</em><a href='#index-primitive_002dinterface_002dmethod' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Returns a new anonymous procedure, which when called will
invoke the matching method from the interface whose name is <var>interface</var>.
</p></dd></dl>

<p>The macros return procedure values, just like <code>lambda</code>.
If the macros are used directly as the procedure of a procedure call,
then kawa can inline the correct bytecodes to call the specified methods.
(Note also that neither macro
checks that there really is a method that matches the specification.)
Otherwise, the Java reflection facility is used.
</p>
</div>
<div class="subsection" id="Low_002dlevel-field-operations">
<h4 class="subsection">21.8.2 Low-level field operations</h4>

<p>The following macros evaluate to procedures that can be used to
access or change the fields of objects or static fields.
The compiler can inline each to a single bytecode instruction
(not counting type conversion).
</p>
<p>These macros are deprecated.
The <code>fields</code> and <code>static-field</code> functions
(see <a href="#Field-operations">Accessing object fields</a>) are easier to use, more powerful, and
just as efficient.  However, the high-level functions currently do
not provide access to non-public fields.
</p>
<dl class="def">
<dt id="index-primitive_002dget_002dfield"><span class="category">Syntax: </span><span><strong>primitive-get-field</strong> <em>class fname ftype</em><a href='#index-primitive_002dget_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Use this to access a field named <var>fname</var> having type <var>type</var> in
class <var>class</var>.  Evaluates to a new one-argument procedure,
whose argument is a reference to an object of the specified <var>class</var>.
Calling that procedure returns the value of the specified field.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dset_002dfield"><span class="category">Syntax: </span><span><strong>primitive-set-field</strong> <em>class fname ftype</em><a href='#index-primitive_002dset_002dfield' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Use this to change a field named <var>fname</var> having type <var>type</var> in
class <var>class</var>.  Evaluates to a new two-argument procedure,
whose first argument is a reference to an object of the
specified <var>class</var>, and the second argument is the new value.
Calling that procedure sets the field to the specified value.
(This macro&rsquo;s name does not end in a &lsquo;<samp>!</samp>&rsquo;, because it does not actually
set the field.  Rather, it returns a function for setting the field.)
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dget_002dstatic"><span class="category">Syntax: </span><span><strong>primitive-get-static</strong> <em>class fname ftype</em><a href='#index-primitive_002dget_002dstatic' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Like <code>primitive-get-field</code>, but used to access static fields.
Returns a zero-argument function, which when called returns
the value of the static field.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002dset_002dstatic"><span class="category">Syntax: </span><span><strong>primitive-set-static</strong> <em>class fname ftype</em><a href='#index-primitive_002dset_002dstatic' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Like <code>primitive-set-field</code>, but used to modify static fields.
Returns a one-argument function, which when called sets the
value of the static field to the argument.
</p></dd></dl>

<span id="Low_002dlevel-array-macros"></span></div>
<div class="subsection" id="Old-low_002dlevel-array-macros-1">
<h4 class="subsection">21.8.3 Old low-level array macros</h4>

<p>The following macros evaluate to procedures that can be used to
manipulate primitive Java array objects.
The compiler can inline each to a single bytecode instruction
(not counting type conversion).
</p>
<dl class="def">
<dt id="index-primitive_002darray_002dnew"><span class="category">Syntax: </span><span><strong>primitive-array-new</strong> <em>element-type</em><a href='#index-primitive_002darray_002dnew' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to a one-argument procedure.  Applying the resulting procedure to
an integer count allocates a new Java array of the specified length,
and whose elements have type <var>element-type</var>.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002darray_002dset"><span class="category">Syntax: </span><span><strong>primitive-array-set</strong> <em>element-type</em><a href='#index-primitive_002darray_002dset' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to a three-argument procedure.  The first argument of
the resulting procedure must be an array whose elements have type
<var>element-type</var>;  the second argument is an index;  and the third
argument is a value (coercible to <var>element-type</var>) which replaces
the value specified by the index in the given array.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002darray_002dget"><span class="category">Syntax: </span><span><strong>primitive-array-get</strong> <em>element-type</em><a href='#index-primitive_002darray_002dget' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to a two-argument procedure.  The first argument of
the resulting procedure must be an array whose elements have type
<var>element-type</var>;  the second argument is an index.
Applying the procedure returns the element at the specified index.
</p></dd></dl>

<dl class="def">
<dt id="index-primitive_002darray_002dlength"><span class="category">Syntax: </span><span><strong>primitive-array-length</strong> <em>element-type</em><a href='#index-primitive_002darray_002dlength' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>Evaluates to a one-argument procedure.  The argument of
the resulting procedure must be an array whose elements have type
<var>element-type</var>.
Applying the procedure returns the length of the array.
(Alternatively, you can use <code>(field <var>array</var> 'length)</code>.)
</p></dd></dl>

<hr>
</div>
</div>
</div>
<div class="chapter" id="FAQs">
<div class="header">
<p>
Next: <a href="#Framework" accesskey="n" rel="next">The Kawa language framework</a>, Previous: <a href="#Miscellaneous" accesskey="p" rel="prev">Miscellaneous topics</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Frequently-Asked-Questions"></span><h2 class="chapter">22 Frequently Asked Questions</h2>


<span id="importing_002dclass_002dnames"></span><span id="What-is-the-equivalent-of-Java-import_003f"></span><h4 class="subsubheading">What is the equivalent of Java import?</h4>

<p>To provide a short name for a class instead of the complete fully-qualified
name use either <code>define-alias</code> (or <code>define-private-alias</code>)
or the <code>import</code>-<code>class</code> combination.
For example, to be able to write <code>ArrayList</code> instead
of <code>java.util.ArrayList</code> do either:
</p><div class="example">
<pre class="example">(import (class java.util ArrayList))
</pre></div>
<p>or
</p><div class="example">
<pre class="example">(define-alias ArrayList java.util.ArrayList)
</pre></div>
<p>Using <code>import</code> is recommended:
It handles errors better,
and it allows you to define multiple aliases conveniently:
</p><div class="example">
<pre class="example">(import (class java.util Map HashMap))
</pre></div>

<p>Both forms allow renaming.  For example if you want to refer
to <code>java.lang.StringBuilder</code> as <code>StrBuf</code> do:
</p><div class="example">
<pre class="example">(import (class java.lang (StringBuilder StrBuf)))
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">(define-alias StrBuf java.lang.StringBuilder)
</pre></div>

<p>The name(s) defined by <code>import</code> are by default private.
A name defined using <code>define-alias</code> is by default exported;
to avoid that use <code>define-private-alias</code> instead.
</p>
<p>You can also use <code>define-namespace</code> to introduce an abbreviation or
renaming of a class name, but as a matter of style <code>define-alias</code>
is preferred.
</p>
<p>There is no direct equivalent to Java&rsquo;s <code>import PackageOrTypeName.*</code>
(type-import-on-demand) declaration, but you can alias a package:
</p><div class="example">
<pre class="example">(define-alias jutil java.util)
(define mylist :: jutil:List (jutil:ArrayList))
</pre></div>

<p>To import a static member, giving it a shortened name
(like Java&rsquo;s static-import-on-demand declaration), you can use
<code>define-alias</code>.  For example:
</p><div class="example">
<pre class="example">(define-alias console java.lang.System:console)
</pre></div>

<p>For static fields only (not methods or member classes) you can
use an <code>import</code> form, either:
</p><div class="example">
<pre class="example">(import (only (java lang System) out))
</pre></div>
<p>or:
</p><div class="example">
<pre class="example">(import (only java.lang.System out))
</pre></div>
<p>This works because Kawa can treat any class as a &ldquo;library&rdquo;;
in which case it considers all public static fields as exported bindings.
</p>
<span id="How-do-I-refer-to-a-Java-member-_0028nested_0029-class_003f"></span><h4 class="subsubheading">How do I refer to a Java member (nested) class?</h4>

<p>Consider the Java SE member class <code>javax.swing.text.AbstractDocument.Content</code>.
Using the Java syntax doesn&rsquo;t work in Kawa.
Inside you should use Kawa&rsquo;s colon operator:
</p><div class="example">
<pre class="example">javax.swing.text.AbstractDocument:Content
</pre></div>
<p>Alternatively, you can use the internal JVM class name:
</p><div class="example">
<pre class="example">javax.swing.text.AbstractDocument$Content
</pre></div>

<span id="Why-does-Kawa_0027s-REPL-use-display-rather-than-write_003f"></span><h4 class="subsubheading">Why does Kawa&rsquo;s REPL use display rather than write?</h4>

<p>The read-eval-print-loop of most Scheme implementations prints the
evaluation result using <code>write</code>, while Kawa uses <code>display</code> by default.
</p>
<p>First note that it is easy to override the default with the
<code>--output-format</code> command-line option:
</p><div class="example">
<pre class="example">$kawa --output-format readable-scheme
#|kawa:1|# &quot;abc&quot;
&quot;abc&quot;
</pre></div>

<p>The reason <code>display</code> is the default is because of a vision of the REPL
console as more than just printing out Scheme objects in
textual form for use by a programmer.
Some examples:
</p><ul>
<li> A math program can display equations and graphs as the
output of an expression.
</li><li> An expression can evaluate to a &quot;picture&quot; which would
be <a href="http://per.bothner.com/blog/2007/ReplPane/">displayed inline</a>.
</li><li> An HTML/XML obj can be insert into the output in visual
form if the console understands HTML.  (There is a prototype
for this that works by using the JavaFX WebView as the display.)
</li><li> The plan for &quot;Kawa-shell&quot; functionality is to have expressions
that evaluate to process objects, which would be lazy strings.
This string would be the data from standard output.  Thus the
effect of displaying a process object would be to print out
the standard output - just like a regular shell.  Users would
find it confusing/annoying if shell output used quotes.
</li></ul>

<p>This &quot;repl-as-pad&quot; model doesn&rsquo;t work as well if the repl
uses <code>write</code> rather than <code>display</code>. 
</p>
<hr>
</div>
<div class="chapter" id="Framework">
<div class="header">
<p>
Next: <a href="#License" accesskey="n" rel="next">License</a>, Previous: <a href="#FAQs" accesskey="p" rel="prev">Frequently Asked Questions</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="The-Kawa-language-framework"></span><h2 class="chapter">23 The Kawa language framework</h2>

<p>Kawa is a framework written in Java for implementing
high-level and dynamic languages, compiling them into Java bytecodes.
</p>
<p>The Kawa distributions includes of other programming languages
besides Scheme,
including <a href="../qexo/index.html">XQuery (Qexo)</a>
and <a href="http://JEmacs.sourceforge.net/">Emacs Lisp (JEmacs)</a>.
</p>
<p>For a technical overview of Kawa, see these
<a href="http://www.gnu.org/software/kawa/internals/index.html">http://www.gnu.org/software/kawa/internals/index.html</a>.
Javadoc generated <a href="http://www.gnu.org/software/kawa/api/">documentation of the Kawa classes</a> is also available.
The packages
<a href="http://www.gnu.org/software/kawa/api/gnu/bytecode/package-summary.html"><code>gnu.bytecode</code></a>,
<a href="http://www.gnu.org/software/kawa/api/gnu/math/package-summary.html"><code>gnu.math</code></a>,
<a href="http://www.gnu.org/software/kawa/api/gnu/lists/package-summary.html"><code>gnu.lists</code></a>,
<a href="http://www.gnu.org/software/kawa/api/gnu/xml/package-summary.html"><code>gnu.xml</code></a>,
<a href="http://www.gnu.org/software/kawa/api/gnu/expr/package-summary.html"><code>gnu.expr</code></a>,
<a href="http://www.gnu.org/software/kawa/api/gnu/mapping/package-summary.html"><code>gnu.mapping</code></a>,
and
<a href="http://www.gnu.org/software/kawa/api/gnu/text/package-summary.html"><code>gnu.text</code></a>,
are used by Kawa, and distributed with it, but may be independently useful.
</p>
<p>This <a href="gnu.bytecode/compiling-regexps.html">article</a> explains how to
use <code>gnu.bytecode</code> to compile regular expressions to bytecode.
</p>
<hr>
</div>
<div class="chapter" id="License">
<div class="header">
<p>
Next: <a href="#Overall-Index" accesskey="n" rel="next">Index</a>, Previous: <a href="#Framework" accesskey="p" rel="prev">The Kawa language framework</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="License-1"></span><h2 class="chapter">24 License</h2>


<ul class="section-toc">
<li><a href="#Software_002dLicense" accesskey="1">License for the Kawa software</a></li>
<li><a href="#Manual_002dLicense" accesskey="2">License for the Kawa manual</a></li>
</ul>
<hr>
<div class="section" id="Software_002dLicense">
<div class="header">
<p>
Next: <a href="#Manual_002dLicense" accesskey="n" rel="next">License for the Kawa manual</a>, Up: <a href="#License" accesskey="u" rel="up">License</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="License-for-the-Kawa-software"></span><h3 class="section">24.1 License for the Kawa software</h3>

<p>The license for the Kawa software
(except the optional JEmacs and BRL features - see below) is the
<a href="http://opensource.org/licenses/mit-license.php">X11/MIT license</a>
which is quoted below.
</p>
<div class="example">
<pre class="example">The software (with related files and documentation) in these packages
are copyright (C) 1996-2009  Per Bothner.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</pre></div>

<p>In the past the Kawa license was a &ldquo;modified GNU GPL (General
Public License)&quot;.
If you find any files that contain the old license or otherwise seem
to contradict the new license, please report that as a bug.
</p>
<p>Some of the JEmacs files are based on Emacs and have a GPL license,
which is incompatible with non-Free (proprietary) products.  For that
reason, the <code>gnu.jemacs.*</code> packages are not included any more in
the standard <code>.jar</code>, or by default when building from source, to
avoid surprises.
To build JEmacs you have to specify the <code>configure</code>
flag <code>--enable-jemacs</code> or the <code>ant</code> flag
<code>-Denable-jemacs=true</code>.
</p>
<p>Some code in <code>gnu/brl</code> and <code>gnu/kawa/brl</code> is copyright
Bruce R. Lewis and Eaton Vance Management,
with a modified-GPL license: no restrictions if used
unmodified, but otherwise the GPL applies.
These packages are no longer included by default in Kawa builds,
but have to be selected with the <code>configure</code>
flag <code>--enable-brl</code> or the <code>ant</code> flag <code>-Denable-brl=true</code>.
</p>
<p>Kawa uses some math routines from fdlib&rsquo;s libf77,
which have a AT&amp;T Bell Laboratories and Bellcore copyright.
See the source file <code>gnu/math/DComplex.java</code>.
</p>
<p>The sorting routine in <code>gnu.xquery.util.OrderedTuples</code>
is a re-implementatiomn in Java of code copyrighted by
Simon Tatham.
</p>
<p>Some of the Scheme code in <code>kawa/lib</code> and <code>gnu/kawa/slib</code>
are copyright other parties, and may have slightly different
license wording, but I believe none of then contradicts the
main Kawa license or impose extra restrictions.
Search for the word <code>copyright</code> in these directories.
</p>
<p>Some code has been converted from other languages, with permission.
This includes the <code>rationalize</code> method
in <code>gnu/math/RatNum.java</code>, based on an algorithm of Alan Bawden,
as expressed by Marc Feeley in C-Gambit.
The concepts and algorithm of <code>gnu/text/PrettyWriter.java</code>
are converted from SBCL, which is in the public domain.
</p>
<hr>
</div>
<div class="section" id="Manual_002dLicense">
<div class="header">
<p>
Previous: <a href="#Software_002dLicense" accesskey="p" rel="prev">License for the Kawa software</a>, Up: <a href="#License" accesskey="u" rel="up">License</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="License-for-the-Kawa-manual"></span><h3 class="section">24.2 License for the Kawa manual</h3>

<p>Here is the copyright license for this manual:
</p>
<p>Copyright &copy; 1996, 1997, 1998, 1999, 2005 Per Bothner
</p>
<p>Permission is granted to make and distribute verbatim copies of
this manual provided the copyright notice and this permission notice
are preserved on all copies.
</p>
<p>Permission is granted to copy and distribute modified versions of this
manual under the conditions for verbatim copying, provided that the entire
resulting derived work is distributed under the terms of a permission
notice identical to this one.
</p>
<p>Permission is granted to copy and distribute translations of this manual
into another language, under the above conditions for modified versions,
except that this permission notice may be stated in a translation approved
by the author.
</p>
<p>Parts of this manual are copied from the <a href="http://www.r6rs.org/">R6RS</a>
or <a href="http://www.r7rs.org/">R7RS</a>, which both state:
</p><blockquote>
<p>We intend this report to belong to the entire Scheme community, and so
we grant permission to copy it in whole or in part without fee. In
particular, we encourage implementors of Scheme to use this report as
a starting point for manuals and other documentation, modifying it as
necessary.
</p></blockquote>

<p>Parts of this manual were derived from the SLIB manual,
copyright &copy; 1993-1998 Todd R. Eigenschink and Aubrey Jaffer.
</p>
<p>Parts of this manual were derived from ISO/EIC 10179:1996(E)
(Document Style and Specifical Language) - unknown copyright.
</p>
<p>This manual has quoted from SRFI-6 (Basic String Ports),
which is Copyright (C) William D Clinger (1999). All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-8 (receive: Binding to multiple values),
which is Copyright (C) John David Stone (1999). All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-9 (Defining Record Types)
which is Copyright (C) Richard Kelsey (1999).  All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-11 (Syntax for receiving multiple values),
which is Copyright (C) Lars T. Hansen (1999). All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-25 (Multi-dimensional Array Primitives),
which is Copyright (C) Jussi Piitulainen (2001). All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-26 (Notation for Specializing
Parameters without Currying),
which is Copyright (C) Sebastian Egner (2002). All Rights Reserved.
</p>
<p>This manual has quoted from SRFI-39 (Parameter objects),
which is Copyright (C) Marc Feeley (2002). All Rights Reserved.
</p>
<p>The following notice applies to SRFI-6, SRFI-8, SRFI-9, SRFI-11, SRFI-25,
SRFI-26, and SRFI-39,
which are quoted in this manual, but it does not apply to the manual as a whole:
</p>
<blockquote>
<p>This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it or
assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are included
on all such copies and derivative works. However, this document itself
may not be modified in any way, such as by removing the copyright notice
or references to the Scheme Request For Implementation process or
editors, except as needed for the purpose of developing SRFIs in which
case the procedures for copyrights defined in the SRFI process must be
followed, or as required to translate it into languages other than
English.
</p>
<p>The limited permissions granted above are perpetual and will not be
revoked by the authors or their successors or assigns.
</p>
<p>This document and the information contained herein is provided on an
&quot;AS IS&quot; basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.
</p></blockquote>

<p>This manual has quoted from SRFI-69 (Basic hash tables),
which is Copyright (C) Panu Kalliokoski (2005). All Rights Reserved.
</p>
<p>The following notice applies to SRFI-69,
which is quoted in this manual, but it does not apply to the manual as a whole:
</p>
<blockquote>
<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
Software), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:
</p>
<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.
</p>
<p>THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p></blockquote>

<p>This manual has made use of text and examples from Dorai Sitaram&rsquo;s
<code>pregexp</code> implementation.  But not where the latter talks about
<code>pregexp-xxx</code> functions; the manual also talks about
the <code>regex-xxx</code> functions (which are similar but use a
slightly different regular expression syntax).
The <code>pregexp</code> distribution has the following <code>COPYING</code> file:
</p><blockquote>
<p>Copyright (c) 1999-2005, Dorai Sitaram.
All rights reserved.
</p>
<p>Permission to copy, modify, distribute, and use this work or
a modified copy of this work, for any purpose, is hereby
granted, provided that the copy includes this copyright
notice, and in the case of a modified copy, also includes a
notice of modification.  This work is provided as is, with
no warranty of any kind.
</p></blockquote>

<hr>
</div>
</div>
<div class="appendix" id="Overall-Index">
<div class="header">
<p>
Previous: <a href="#License" accesskey="p" rel="prev">License</a>, Up: <a href="#Top" accesskey="u" rel="up">The Kawa Scheme language</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Overall-Index" title="Index" rel="index">Index</a>]</p>
</div>
<span id="Index"></span><h2 class="appendix">Appendix A Index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Overall-Index_cp_symbol-1"><b>!</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-2"><b>#</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-3"><b>&amp;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-4"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-5"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-6"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-7"><b>/</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-8"><b>~</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Overall-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-W"><b>W</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-X"><b>X</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-Z"><b>Z</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-cp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-1">!</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0021"><code>!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-2">#</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021eof"><code>#!eof</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021fold_002dcase"><code>#!fold-case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021key"><code>#!key</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021no_002dfold_002dcase"><code>#!no-fold-case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021null"><code>#!null</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021optional"><code>#!optional</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021rest"><code>#!rest</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0021void"><code>#!void</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Special-named-constants">Special named constants</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-3">&amp;</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0026D_005b"><code>&amp;D<code><b>[</b></code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0026P_005b"><code>&amp;P<code><b>[</b></code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-4">*</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a"><code>*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a-1"><code>*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aprint_002dbase_002a"><code>*print-base*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aprint_002dmiser_002dwidth_002a"><code>*print-miser-width*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aprint_002dradix_002a"><code>*print-radix*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aprint_002dright_002dmargin_002a"><code>*print-right-margin*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aprint_002dxml_002dindent_002a"><code>*print-xml-indent*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-5">+</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b"><code>+</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b-1"><code>+</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-6">-</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d"><code>-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d-1"><code>-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d-2"><code>-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_002dno_002dwarn_002dwhatever"><code>--no-warn-<var>whatever</var></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_002doutput_002dformat"><code>--output-format</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_002dwarn_002dwhatever"><code>--warn-<var>whatever</var></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_003eimage"><code>-&gt;image</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_003epaint"><code>-&gt;paint</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-7">/</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f"><code>/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f-1"><code>/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f-2"><code>/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f-3"><code>/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_symbol-8">~</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_0024">~$</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_0025">~%</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_0026">~&amp;</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_0028">~(</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_002a">~*</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_003b">~;</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_003f">~?</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ea">~a</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007eb">~b</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ec">~c</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ed">~d</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ee">~e</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ef">~f</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007eg">~g</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007enewline">~<i>newline</i></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007eo">~o</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ep">~p</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007er">~r</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007es">~s</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007et">~t</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007ex">~x</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_005b">~[</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_005e">~^</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_007b">~{</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_007c">~|</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_007e_007e">~~</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-A">A</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-abbrev_002dprefix"><code><i>abbrev-prefix</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-abbreviation"><code><i>abbreviation</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-abs"><code>abs</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-acos"><code>acos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-acos-1"><code>acos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-acosh"><code>acosh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-affine_002dtransform"><code>affine-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-affine_002dtransform-1"><code>affine-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-alist_002d_003ehash_002dtable"><code>alist-&gt;hash-table</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-alternate"><code><i>alternate</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-and"><code>and</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-angle"><code>angle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-annotation"><code><i>annotation</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Annotations">Annotations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-annotation_002delement_002dpair"><code><i>annotation-element-pair</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Annotations">Annotations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-annotation_002delement_002dvalue"><code><i>annotation-element-value</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Annotations">Annotations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-annotation_002dtypename"><code><i>annotation-typename</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Annotations">Annotations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-annotations_002delement_002dvalues"><code><i>annotations-element-values</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Annotations">Annotations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-any_002dbits_002dset_003f"><code>any-bits-set?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-apos_002dattribute_002ddatum"><code><i>apos-attribute-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-apply"><code>apply</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist"><code>arglist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist-1"><code>arglist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002darg_002dcount"><code>arglist-arg-count</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002darg_002dref"><code>arglist-arg-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dkey_002dcount"><code>arglist-key-count</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dkey_002dindex"><code>arglist-key-index</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dkey_002dref"><code>arglist-key-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dkey_002dstart"><code>arglist-key-start</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dkey_002dvalue"><code>arglist-key-value</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist_002dwalk"><code>arglist-walk</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-argvector"><code>argvector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-argvector-1"><code>argvector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arithmetic_002dshift"><code>arithmetic-shift</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array"><code>array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-1"><code>array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002d_003evector"><code>array-&gt;vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dbound"><code><i>array-bound</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dcopy_0021"><code>array-copy!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dend"><code>array-end</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dfill_0021"><code>array-fill!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dflatten"><code>array-flatten</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dindex_002dref"><code>array-index-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dindex_002dshare"><code>array-index-share</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dliteral"><code><i>array-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dliteral_002dheader"><code><i>array-literal-header</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002drank"><code>array-rank</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dref"><code>array-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dref-1"><code>array-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dreshape"><code>array-reshape</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dset_0021"><code>array-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dset_0021-1"><code>array-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dsize"><code>array-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dstart"><code>array-start</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dtransform"><code>array-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_003f"><code>array?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arrayN"><code>array<var>N</var></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arrayN_005betype_005d"><code>array<var>N</var>[<var>etype</var>]</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_005betype_005d"><code>array[<var>etype</var>]</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-as"><code>as</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Type-tests-and-conversions">Type tests and conversions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-as_002dxml"><code>as-xml</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Formatting-XML">Formatting XML</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ash"><code>ash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asin"><code>asin</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asin-1"><code>asin</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asinh"><code>asinh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atan"><code>atan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atan-1"><code>atan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atan-2"><code>atan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atanh"><code>atanh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atmosphere"><code><i>atmosphere</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-attribute_002dname"><code>attribute-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-B">B</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-base_002duri"><code>base-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-binary_002dport_003f"><code>binary-port?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bit_002dcount"><code>bit-count</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bit_002dextract"><code>bit-extract</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bit_002dfield"><code>bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bit_002dset_003f"><code>bit-set?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dand"><code>bitwise-and</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002darithmetic_002dshift"><code>bitwise-arithmetic-shift</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002darithmetic_002dshift_002dleft"><code>bitwise-arithmetic-shift-left</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002darithmetic_002dshift_002dright"><code>bitwise-arithmetic-shift-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dbit_002dcount"><code>bitwise-bit-count</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dbit_002dfield"><code>bitwise-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dbit_002dset_003f"><code>bitwise-bit-set?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dcopy_002dbit"><code>bitwise-copy-bit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dcopy_002dbit_002dfield"><code>bitwise-copy-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dfirst_002dbit_002dset"><code>bitwise-first-bit-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dif"><code>bitwise-if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dior"><code>bitwise-ior</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dlength"><code>bitwise-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dmerge"><code>bitwise-merge</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dnot"><code>bitwise-not</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dreverse_002dbit_002dfield"><code>bitwise-reverse-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002drotate_002dbit_002dfield"><code>bitwise-rotate-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitwise_002dxor"><code>bitwise-xor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-body"><code><i>body</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boolean"><code><i>boolean</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Boolean-values">Boolean values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boolean-1"><code>boolean</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Boolean-values">Boolean values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boolean_003d_003f"><code>boolean=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Boolean-values">Boolean values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boolean_003f"><code>boolean?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Boolean-values">Boolean values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-booleans_002d_003einteger"><code>booleans-&gt;integer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-border"><code>border</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bound_002didentifier_003d_003f"><code>bound-identifier=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bounded_002drange"><code><i>bounded-range</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ranges">Ranges</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-build_002darray"><code>build-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-byte"><code>byte</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector"><code>bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector-1"><code>bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002dappend"><code>bytevector-append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002dcopy"><code>bytevector-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002dcopy_0021"><code>bytevector-copy!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002dlength"><code>bytevector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002du8_002dref"><code>bytevector-u8-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_002du8_002dset_0021"><code>bytevector-u8-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bytevector_003f"><code>bytevector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-C">C</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002dinput_002dfile"><code>call-with-input-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002dinput_002dstring"><code>call-with-input-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002doutput_002dfile"><code>call-with-output-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002doutput_002dstring"><code>call-with-output-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002dport"><code>call-with-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-call_002dwith_002dvalues"><code>call-with-values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-case"><code>case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-case-1"><code>case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-case_002dclause"><code><i>case-clause</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-case_002delse_002dclause"><code><i>case-else-clause</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-case_002dkey"><code><i>case-key</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-catch"><code>catch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ceiling"><code>ceiling</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char"><code>char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002d_003einteger"><code>char-&gt;integer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dalphabetic_003f"><code>char-alphabetic?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dci_003c_003d_003f"><code>char-ci&lt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dci_003c_003f"><code>char-ci&lt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dci_003d_003f"><code>char-ci=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dci_003e_003d_003f"><code>char-ci&gt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dci_003e_003f"><code>char-ci&gt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002ddowncase"><code>char-downcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dfoldcase"><code>char-foldcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dgeneral_002dcategory"><code>char-general-category</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dlower_002dcase_003f"><code>char-lower-case?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dnumeric_003f"><code>char-numeric?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dor_002dentity_002dname"><code><i>char-or-entity-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dready_003f"><code>char-ready?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dref"><code><i>char-ref</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dset"><code>char-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Character-sets">Character sets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dtitle_002dcase_003f"><code>char-title-case?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dtitlecase"><code>char-titlecase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dupcase"><code>char-upcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dupper_002dcase_003f"><code>char-upper-case?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dwhitespace_003f"><code>char-whitespace?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003c_003d_003f"><code>char&lt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003c_003f"><code>char&lt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003d_003f"><code>char=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003e_003d_003f"><code>char&gt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003e_003f"><code>char&gt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_003f"><code>char?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character-2"><code>character</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character"><code>character</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character-1"><code><i>character</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character_002dexcept_002dx"><code><i>character-except-x</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character_002dor_002deof"><code>character-or-eof</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-child_002dvalue"><code><i>child-value</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Allocating-objects">Allocating objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-circle"><code>circle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-class_002dmethods"><code>class-methods</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Method-operations">Method operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-class_002dname"><code><i>class-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-close_002dinput_002dport"><code>close-input-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-close_002doutput_002dport"><code>close-output-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-close_002dport"><code>close-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cname"><code><i>cname</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Named-quasi_002dliterals">Named quasi-literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-coding-specifier">coding specifier</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-colatitude"><code>colatitude</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-command_002dline"><code>command-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-command_002dline_002darguments"><code>command-line-arguments</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-command_002dparse"><code>command-parse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment"><code><i>comment</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment-1"><code>comment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment-2"><code>comment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment_002dcont"><code><i>comment-cont</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment_002dtext"><code><i>comment-text</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dfile"><code>compile-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Archive-compilation">Archive compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-complex"><code>complex</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-complex_002dpart"><code>complex-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compound_002ddatum"><code><i>compound-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond"><code>cond</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond-1"><code>cond</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond_002dclause"><code><i>cond-clause</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond_002dexpand"><code>cond-expand</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond_002dexpand_002dclause"><code><i>cond-expand-clause</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-configure-options">configure options</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Source-distribution">Source distribution</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-conjugate"><code>conjugate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-consequent"><code><i>consequent</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-constant"><code><i>constant</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-constant_002dfold"><code>constant-fold</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Application-and-Arguments-Lists">Application and Arguments Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-constituent"><code><i>constituent</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-constructor_002dvalue"><code><i>constructor-value</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Allocating-objects">Allocating objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002dbit"><code>copy-bit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002dbit_002dfield"><code>copy-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002dfile"><code>copy-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cos"><code>cos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cos-1"><code>cos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cosh"><code>cosh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-create_002ddirectory"><code>create-directory</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cross_002dproduct"><code>cross-product</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dactivity"><code>current-activity</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Android-view-construction">Android view construction</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002derror_002dport"><code>current-error-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dinput_002dport"><code>current-input-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002djiffy"><code>current-jiffy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Time_002drelated-functions">Time-related functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002doutput_002dport"><code>current-output-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dpath"><code>current-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dsecond"><code>current-second</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Time_002drelated-functions">Time-related functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dservlet"><code>current-servlet</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dservlet_002dconfig"><code>current-servlet-config</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-current_002dservlet_002dcontext"><code>current-servlet-context</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cut"><code>cut</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Partial-application">Partial application</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cute"><code>cute</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Partial-application">Partial application</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-D">D</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-datum"><code><i>datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-datum_002d_003esyntax"><code>datum-&gt;syntax</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-datum_002d_003esyntax_002dobject"><code>datum-&gt;syntax-object</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-datum_002dlabel"><code><i>datum-label</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-decimal"><code><i>decimal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-default_002dprompter"><code>default-prompter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define"><code>define</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define-1"><code>define</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define-2"><code>define</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dalias"><code>define-alias</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Locations">Locations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dbase_002dunit"><code>define-base-unit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dclass"><code>define-class</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dconstant"><code>define-constant</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dearly_002dconstant"><code>define-early-constant</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002denum"><code>define-enum</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Enumerations">Enumerations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dlibrary"><code>define-library</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dmacro"><code>define-macro</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dnamespace"><code>define-namespace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dprivate"><code>define-private</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dprivate-1"><code>define-private</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dprivate_002dalias"><code>define-private-alias</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Locations">Locations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dprivate_002dnamespace"><code>define-private-namespace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dprocedure"><code>define-procedure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Procedure-properties">Procedure properties</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002drecord_002dtype"><code>define-record-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Record-types">Record types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dsimple_002dclass"><code>define-simple-class</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dsyntax"><code>define-syntax</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dsyntax_002dcase"><code>define-syntax-case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dunit"><code>define-unit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dvalues"><code>define-values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dvariable"><code>define-variable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Definitions">Definitions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dxml_002dnamespace"><code>define-xml-namespace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defined_002ddatum"><code><i>defined-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defining_002ddatum"><code><i>defining-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defmacro"><code>defmacro</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deg"><code>deg</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delay"><code>delay</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delay_002dforce"><code>delay-force</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delete_002dfile"><code>delete-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delimiter"><code><i>delimiter</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-denominator"><code>denominator</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deprecated_002dreturn_002dspecifier"><code><i>deprecated-return-specifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit"><code><i>digit</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit_002d10"><code><i>digit-10</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit_002d16"><code><i>digit-16</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit_002d2"><code><i>digit-2</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit_002d8"><code><i>digit-8</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-digit_002dvalue"><code>digit-value</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Dimension"><code>Dimension</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disassemble"><code>disassemble</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Debugging">Debugging</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-display"><code>display</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-div"><code>div</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-div_002dand_002dmod"><code>div-and-mod</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-div0"><code>div0</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-div0_002dand_002dmod0"><code>div0-and-mod0</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-domterm_002dload_002dstylesheet"><code>domterm-load-stylesheet</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#REPL-Console">REPL Console</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dot_002dproduct"><code>dot-product</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-double"><code>double</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-draw"><code>draw</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dynamic"><code>dynamic</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dynamic_002dwind"><code>dynamic-wind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-E">E</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-eager"><code>eager</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-element_002dname"><code>element-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ellipsis"><code><i>ellipsis</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-emergency_002dexit"><code>emergency-exit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-enclosed_002dmodifier"><code><i>enclosed-modifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-enclosed_002dpart"><code><i>enclosed-part</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-encoding-specifier">encoding specifier</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-entity_002dref"><code><i>entity-ref</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-environment"><code>environment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-environment_002dbound_003f"><code>environment-bound?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eof_002dobject"><code>eof-object</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eof_002dobject_003f"><code>eof-object?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-equal_002dhash"><code>equal-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error"><code>error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002dobject_002dirritants"><code>error-object-irritants</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002dobject_002dmessage"><code>error-object-message</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002dobject_003f"><code>error-object?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002dresponse"><code>error-response</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-response">HTTP response</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-escape_002dsequence"><code><i>escape-sequence</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dxyx"><code>euler-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dxzx"><code>euler-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dyxy"><code>euler-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dyzy"><code>euler-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dzxz"><code>euler-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-euler_002dzyz"><code>euler-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eval"><code>eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exact-complex-number">exact complex number</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exact_002dinteger_002dsqrt"><code>exact-integer-sqrt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exact_002dinteger_003f"><code>exact-integer?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exactness">exactness</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exit"><code>exit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exp"><code>exp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exp-1"><code>exp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-expand"><code>expand</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-explicit_002dsource_002dname"><code><i>explicit-source-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exponent_002dmarker"><code><i>exponent-marker</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-export"><code>export</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-export_002dspec"><code><i>export-spec</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-expression"><code><i>expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-expt"><code>expt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extended_002ddatum_002dliteral"><code><i>extended-datum-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Named-quasi_002dliterals">Named quasi-literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extended_002dstring_002dliteral"><code><i>extended-string-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dxyx"><code>extrinsic-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dxyz"><code>extrinsic-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dxzx"><code>extrinsic-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dyxy"><code>extrinsic-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dyxz"><code>extrinsic-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dyzx"><code>extrinsic-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dyzy"><code>extrinsic-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dzxy"><code>extrinsic-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dzxy-1"><code>extrinsic-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dzxz"><code>extrinsic-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dzyx"><code>extrinsic-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-extrinsic_002dzyz"><code>extrinsic-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-F">F</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector"><code>f32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector-1"><code>f32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector_002d_003elist"><code>f32vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector_002dlength"><code>f32vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector_002dref"><code>f32vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector_002dset_0021"><code>f32vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f32vector_003f"><code>f32vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector"><code>f64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector-1"><code>f64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector_002d_003elist"><code>f64vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector_002dlength"><code>f64vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector_002dref"><code>f64vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector_002dset_0021"><code>f64vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f64vector_003f"><code>f64vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-feature_002didentifier"><code><i>feature-identifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-feature_002drequirement"><code><i>feature-requirement</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-features"><code>features</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fff_002drec"><code><i>fff-rec</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-field"><code>field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Field-operations">Field operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-field_002ddecl"><code><i>field-decl</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-field_002dname"><code><i>field-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-field_002doption"><code><i>field-option</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-field_002dor_002dmethod_002ddecl"><code><i>field-or-method-decl</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002ddirectory_003f"><code>file-directory?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002derror_003f"><code>file-error?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dexists_003f"><code>file-exists?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dreadable_003f"><code>file-readable?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dwritable_003f"><code>file-writable?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-filepath"><code>filepath</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-filepath_003f"><code>filepath?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fill"><code>fill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fill-1"><code>fill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-finite_003f"><code>finite?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-first_002dset_002dbit"><code>first-set-bit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-float"><code>float</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floor"><code>floor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floor_002dquotient"><code>floor-quotient</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floor_002dremainder"><code>floor-remainder</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floor_002f"><code>floor/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fluid_002dlet"><code>fluid-let</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-flush_002doutput_002dport"><code>flush-output-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-for_002deach"><code>for-each</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mapping-functions">Mapping functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-force"><code>force</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-force-1"><code>force</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Threads">Threads</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-force_002a"><code>force*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-force_002doutput"><code>force-output</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formal_002darguments"><code><i>formal-arguments</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formals"><code><i>formals</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format"><code>format</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format_002darray"><code>format-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format_002darray-1"><code>format-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-free_002didentifier_003d_003f"><code>free-identifier=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-future"><code>future</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Threads">Threads</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-G">G</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-gcd"><code>gcd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-gentemp"><code>gentemp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002denvironment_002dvariable"><code>get-environment-variable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002denvironment_002dvariables"><code>get-environment-variables</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002doutput_002dbytevector"><code>get-output-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002doutput_002dstring"><code>get-output-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002drequest"><code>get-request</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002dresponse"><code>get-response</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Glassfish">Glassfish</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-grad"><code>grad</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-guard"><code><i>guard</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Variables-and-Patterns">Variables and Patterns</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-guard-1"><code>guard</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-H">H</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash"><code>hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dby_002didentity"><code>hash-by-identity</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002d_003ealist"><code>hash-table-&gt;alist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dcopy"><code>hash-table-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002ddelete_0021"><code>hash-table-delete!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dequivalence_002dfunction"><code>hash-table-equivalence-function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dexists_003f"><code>hash-table-exists?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dfold"><code>hash-table-fold</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dhash_002dfunction"><code>hash-table-hash-function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dkeys"><code>hash-table-keys</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dmerge_0021"><code>hash-table-merge!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dref"><code>hash-table-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dref_002fdefault"><code>hash-table-ref/default</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dset_0021"><code>hash-table-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dsize"><code>hash-table-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dupdate_0021"><code>hash-table-update!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dupdate_0021_002fdefault"><code>hash-table-update!/default</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dvalues"><code>hash-table-values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_002dwalk"><code>hash-table-walk</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash_002dtable_003f"><code>hash-table?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dclear_0021"><code>hashtable-clear!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dclear_0021-1"><code>hashtable-clear!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dcontains_003f"><code>hashtable-contains?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dcopy"><code>hashtable-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dcopy-1"><code>hashtable-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002ddelete_0021"><code>hashtable-delete!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dentries"><code>hashtable-entries</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dequivalence_002dfunction"><code>hashtable-equivalence-function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dhash_002dfunction"><code>hashtable-hash-function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dkeys"><code>hashtable-keys</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dmutable_003f"><code>hashtable-mutable?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dref"><code>hashtable-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dset_0021"><code>hashtable-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dsize"><code>hashtable-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_002dupdate_0021"><code>hashtable-update!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hashtable_003f"><code>hashtable?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hbox"><code>hbox</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hex_002ddigit"><code><i>hex-digit</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hex_002dscalar_002dvalue"><code><i>hex-scalar-value</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-home_002ddirectory"><code>home-directory</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-html_003atag"><code>html:<var>tag</var></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-HTML-nodes">Creating HTML nodes</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-I">I</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-identifier"><code><i>identifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-identifier_003f"><code>identifier?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if"><code>if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if-1"><code>if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-imag_002dpart"><code>imag-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image"><code>image</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image-1"><code>image</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image-2"><code>image</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image_002dheight"><code>image-height</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image_002dread"><code>image-read</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image_002dwidth"><code>image-width</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-image_002dwrite"><code>image-write</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-import"><code>import</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-import_002donly_002dname"><code><i>import-only-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-import_002dset"><code><i>import-set</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-include"><code>include</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-include_002dci"><code>include-ci</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-include_002drelative"><code>include-relative</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Syntax-and-conditional-compilation">Syntax and conditional compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-index_002darray"><code>index-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-indexnum"><code><i>indexnum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inexact-complex-number">inexact complex number</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-infinite_003f"><code>infinite?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-initial"><code><i>initial</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-initial_002dignored"><code><i>initial-ignored</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inline_002dhex_002descape"><code><i>inline-hex-escape</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport"><code>input-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_002dcolumn_002dnumber"><code>input-port-column-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_002dline_002dnumber"><code>input-port-line-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_002dopen_003f"><code>input-port-open?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_002dprompter"><code>input-port-prompter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_002dread_002dstate"><code>input-port-read-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dport_003f"><code>input-port?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dprompt1"><code>input-prompt1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dprompt2"><code>input-prompt2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-instance_003f"><code>instance?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Type-tests-and-conversions">Type tests and conversions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-int"><code>int</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integer"><code>integer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integer_002d_003echar"><code>integer-&gt;char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Characters">Characters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integer_002d_003elist"><code>integer-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integer_002dlength"><code>integer-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integer_002dvalued_003f"><code>integer-valued?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-interaction_002denvironment"><code>interaction-environment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-interlexeme_002dspace"><code><i>interlexeme-space</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intraline_002dwhitespace"><code><i>intraline-whitespace</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dxyx"><code>intrinsic-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dxyz"><code>intrinsic-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dxzx"><code>intrinsic-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dxzy"><code>intrinsic-xzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dyxy"><code>intrinsic-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dyxz"><code>intrinsic-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dyzx"><code>intrinsic-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dyzy"><code>intrinsic-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dzxy"><code>intrinsic-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dzxz"><code>intrinsic-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dzyx"><code>intrinsic-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intrinsic_002dzyz"><code>intrinsic-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-invoke"><code>invoke</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Method-operations">Method operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-invoke_002dspecial"><code>invoke-special</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Method-operations">Method operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-invoke_002dstatic"><code>invoke-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Method-operations">Method operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istring">istring</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istring_003f"><code>istring?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-J">J</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-JavaFX">JavaFX</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Building-JavaFX-applications">Building JavaFX applications</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-jiffies_002dper_002dsecond"><code>jiffies-per-second</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Time_002drelated-functions">Time-related functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-jmag_002dpart"><code>jmag-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-K">K</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-kawa_002dabbreviation"><code><i>kawa-abbreviation</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-kawac">kawac</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Compiling-using-Ant">Compiling using Ant</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-key_002darg"><code><i>key-arg</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-keyword-1"><code>keyword</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-keyword"><code><i>keyword</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Keywords">Keywords</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-keyword_002d_003estring"><code>keyword-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Keywords">Keywords</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-keyword_003f"><code>keyword?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Keywords">Keywords</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-kmag_002dpart"><code>kmag-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-L">L</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-lambda_002dexpression"><code><i>lambda-expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lazy"><code>lazy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lcm"><code>lcm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-length"><code>length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Sequences">Sequences</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let"><code>let</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Local-binding-constructs">Local binding constructs</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let_002a"><code>let*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Local-binding-constructs">Local binding constructs</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let_002a_002dvalues"><code>let*-values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let_002dvalues"><code>let-values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-letrec"><code>letrec</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Local-binding-constructs">Local binding constructs</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-letrec_002a"><code>letrec*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Local-binding-constructs">Local binding constructs</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-letter"><code><i>letter</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lexeme"><code><i>lexeme</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lexeme_002ddatum"><code><i>lexeme-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-library_002ddeclaration"><code><i>library-declaration</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-library_002ddefinition"><code><i>library-definition</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-library_002dname"><code><i>library-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-library_002dname_002dparts"><code><i>library-name-parts</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-library_002dreference"><code><i>library-reference</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-line"><code>line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-line_002dending"><code><i>line-ending</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list-1"><code>list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list"><code><i>list</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003ef32vector"><code>list-&gt;f32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003ef64vector"><code>list-&gt;f64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003einteger"><code>list-&gt;integer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003es16vector"><code>list-&gt;s16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003es32vector"><code>list-&gt;s32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003es64vector"><code>list-&gt;s64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003es8vector"><code>list-&gt;s8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003estring"><code>list-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003eu16vector"><code>list-&gt;u16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003eu32vector"><code>list-&gt;u32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003eu64vector"><code>list-&gt;u64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003eu8vector"><code>list-&gt;u8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002d_003evector"><code>list-&gt;vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002dpattern"><code><i>list-pattern</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-literal_002dexpression"><code><i>literal-expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load"><code>load</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002drelative"><code>load-relative</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-location"><code>location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Locations">Locations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-log"><code>log</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-log-1"><code>log</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-log-2"><code>log</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-log2_002dbinary_002dfactors"><code>log2-binary-factors</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logand"><code>logand</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logbit_003f"><code>logbit?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logcount"><code>logcount</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logior"><code>logior</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lognot"><code>lognot</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logop"><code>logop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logtest"><code>logtest</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logxor"><code>logxor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-long"><code>long</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-longitude"><code>longitude</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lpattern"><code><i>lpattern</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Variables-and-Patterns">Variables and Patterns</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-M">M</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-magnitude"><code>magnitude</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make"><code>make</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Allocating-objects">Allocating objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002darray"><code>make-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002darray-1"><code>make-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dattribute"><code>make-attribute</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002daxis_002fangle"><code>make-axis/angle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002daxis_002fangle-1"><code>make-axis/angle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dbytevector"><code>make-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dbytevector-1"><code>make-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002delement"><code>make-element</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deq_002dhashtable"><code>make-eq-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deq_002dhashtable-1"><code>make-eq-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deqv_002dhashtable"><code>make-eqv-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deqv_002dhashtable-1"><code>make-eqv-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dxyx"><code>make-euler-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dxzx"><code>make-euler-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dyxy"><code>make-euler-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dyzy"><code>make-euler-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dzxz"><code>make-euler-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002deuler_002dzyz"><code>make-euler-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dxyx"><code>make-extrinsic-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dxyz"><code>make-extrinsic-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dxzx"><code>make-extrinsic-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dxzy"><code>make-extrinsic-xzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dyxy"><code>make-extrinsic-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dyxz"><code>make-extrinsic-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dyzx"><code>make-extrinsic-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dyzy"><code>make-extrinsic-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dzxy"><code>make-extrinsic-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dzxz"><code>make-extrinsic-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dzyx"><code>make-extrinsic-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dextrinsic_002dzyz"><code>make-extrinsic-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002df32vector"><code>make-f32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002df64vector"><code>make-f64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dhash_002dtable"><code>make-hash-table</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dhashtable"><code>make-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dhashtable-1"><code>make-hashtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dxyx"><code>make-intrinsic-xyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dxyz"><code>make-intrinsic-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dxzx"><code>make-intrinsic-xzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dxzy"><code>make-intrinsic-xzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dyxy"><code>make-intrinsic-yxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dyxz"><code>make-intrinsic-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dyzx"><code>make-intrinsic-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dyzy"><code>make-intrinsic-yzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dzxy"><code>make-intrinsic-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dzxz"><code>make-intrinsic-zxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dzyx"><code>make-intrinsic-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dintrinsic_002dzyz"><code>make-intrinsic-zyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dlist"><code>make-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lists">Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dparameter"><code>make-parameter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Parameter-objects">Parameter objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dpolar"><code>make-polar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dpolar-1"><code>make-polar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dprocedure"><code>make-procedure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Generic-procedures">Generic procedures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dprocess"><code>make-process</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dpromise"><code>make-promise</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dquantity"><code>make-quantity</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002drecord_002dtype"><code>make-record-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002drectangular"><code>make-rectangular</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002drectangular-1"><code>make-rectangular</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002drotation_002dprocedure"><code>make-rotation-procedure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002drpy"><code>make-rpy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002ds16vector"><code>make-s16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002ds32vector"><code>make-s32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002ds64vector"><code>make-s64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002ds8vector"><code>make-s8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dstring"><code>make-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dxyz"><code>make-tait-bryan-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dxzy"><code>make-tait-bryan-xzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dyxz"><code>make-tait-bryan-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dyzx"><code>make-tait-bryan-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dzxy"><code>make-tait-bryan-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtait_002dbryan_002dzyx"><code>make-tait-bryan-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dtemporary_002dfile"><code>make-temporary-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002du16vector"><code>make-u16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002du32vector"><code>make-u32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002du64vector"><code>make-u64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002du8vector"><code>make-u8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dvector"><code>make-vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dvector-1"><code>make-vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dvector_002dquaternion"><code>make-vector-quaternion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-map"><code>map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mapping-functions">Mapping functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-match"><code>match</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-match_002dclause"><code><i>match-clause</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-match_002dkey"><code><i>match-key</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-method_002dbody"><code><i>method-body</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-method_002ddecl"><code><i>method-decl</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-method_002dname"><code><i>method-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-method_002doption"><code><i>method-option</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mnemonic_002descape"><code><i>mnemonic-escape</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mod"><code>mod</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mod0"><code>mod0</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dclass"><code>module-class</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Resources">Resources</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dcompile_002doptions"><code>module-compile-options</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dexport"><code>module-export</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dextends"><code>module-extends</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dimplements"><code>module-implements</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dname"><code>module-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dname-1"><code>module-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dname-2"><code>module-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dstatic"><code>module-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dstatic-1"><code>module-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dstatic-2"><code>module-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002dstatic-3"><code>module-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-module_002duri"><code>module-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Resources">Resources</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-modulo"><code>modulo</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mstring">mstring</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multi_002descape_002dsequence"><code><i>multi-escape-sequence</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-N">N</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dliteral_002dpart"><code><i>named-literal-part</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Named-quasi_002dliterals">Named quasi-literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-namespace"><code>namespace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-namespace_002dprefix"><code>namespace-prefix</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-namespace_002duri"><code>namespace-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nan_003f"><code>nan?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nested_002dcomment"><code><i>nested-comment</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-newline"><code>newline</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nondefining_002ddatum"><code><i>nondefining-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-not"><code>not</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Boolean-values">Boolean values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-null_002denvironment"><code>null-environment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-number"><code><i>number</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-number-1"><code>number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-number_002d_003estring"><code>number-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-input-and-output">Numerical input and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-numerator"><code>numerator</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-O">O</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Object"><code>Object</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-object"><code>object</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Anonymous-classes">Anonymous classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-object_002dfield_002ddecl"><code><i>object-field-decl</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Anonymous-classes">Anonymous classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-object_002dfield_002dor_002dmethod_002ddecl"><code><i>object-field-or-method-decl</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Anonymous-classes">Anonymous classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-object_002dinit"><code><i>object-init</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Anonymous-classes">Anonymous classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-oct_002ddigit"><code><i>oct-digit</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dbinary_002dinput_002dfile"><code>open-binary-input-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dbinary_002doutput_002dfile"><code>open-binary-output-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dinput_002dbytevector"><code>open-input-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dinput_002dfile"><code>open-input-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dinput_002dstring"><code>open-input-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002doutput_002dbytevector"><code>open-output-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002doutput_002dfile"><code>open-output-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002doutput_002dstring"><code>open-output-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operand"><code><i>operand</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operator"><code><i>operator</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-opt_002dreturn_002dtype"><code><i>opt-return-type</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-opt_002dtype_002dspecifier"><code><i>opt-type-specifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Types">Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-option_002dpair"><code><i>option-pair</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Defining-new-classes">Defining new classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-optional_002darg"><code><i>optional-arg</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-optional_002dexponent"><code><i>optional-exponent</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-optional_002dsign"><code><i>optional-sign</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-options">options</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-or"><code>or</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002dport"><code>output-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002dport_002dopen_003f"><code>output-port-open?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002dport_003f"><code>output-port?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-P">P</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-padding"><code>padding</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pair"><code>pair</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-parameter"><code>parameter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-parameterize"><code>parameterize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Parameter-objects">Parameter objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-parse_002dformat"><code>parse-format</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Format">Format</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path"><code>path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path-1"><code>path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dauthority"><code>path-authority</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dbytes"><code>path-bytes</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Reading-and-writing-whole-files">Reading and writing whole files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002ddata"><code>path-data</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Reading-and-writing-whole-files">Reading and writing whole files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002ddirectory"><code>path-directory</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dextension"><code>path-extension</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dfile"><code>path-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dfragment"><code>path-fragment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dhost"><code>path-host</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dlast"><code>path-last</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dparent"><code>path-parent</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dport"><code>path-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dquery"><code>path-query</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002dscheme"><code>path-scheme</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_002duser_002dinfo"><code>path-user-info</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-path_003f"><code>path?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pattern"><code><i>pattern</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Variables-and-Patterns">Variables and Patterns</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pattern_002dliteral"><code><i>pattern-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Variables-and-Patterns">Variables and Patterns</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-peculiar_002didentifier"><code><i>peculiar-identifier</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-peek_002dchar"><code>peek-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-peek_002du8"><code>peek-u8</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-picture_002d_003ejpanel"><code>picture-&gt;jpanel</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-picture_002d_003esvg_002dnode"><code>picture-&gt;svg-node</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-picture_002dwrite_002dsvg"><code>picture-write-svg</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pipe_002dprocess"><code>pipe-process</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Point"><code>Point</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-polygon"><code>polygon</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-port_002dchar_002dencoding"><code>port-char-encoding</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-port_002dcolumn"><code>port-column</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-port_002dline"><code>port-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-port_003f"><code>port?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint"><code>pprint</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint_002dend_002dlogical_002dblock"><code>pprint-end-logical-block</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint_002dident"><code>pprint-ident</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint_002dlogical_002dblock"><code>pprint-logical-block</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint_002dnewline"><code>pprint-newline</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pprint_002dstart_002dlogical_002dblock"><code>pprint-start-logical-block</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pretty_002dprinting">Pretty-printing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002darray_002dget"><code>primitive-array-get</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002darray_002dlength"><code>primitive-array-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002darray_002dnew"><code>primitive-array-new</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002darray_002dset"><code>primitive-array-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dconstructor"><code>primitive-constructor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dget_002dfield"><code>primitive-get-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dget_002dstatic"><code>primitive-get-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dinterface_002dmethod"><code>primitive-interface-method</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dset_002dfield"><code>primitive-set-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dset_002dstatic"><code>primitive-set-static</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dstatic_002dmethod"><code>primitive-static-method</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dthrow"><code>primitive-throw</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primitive_002dvirtual_002dmethod"><code>primitive-virtual-method</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Low_002dlevel-functions">Low-level functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-procedure"><code>procedure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-procedure_002dcall"><code><i>procedure-call</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-procedure_002dproperty"><code>procedure-property</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Procedure-properties">Procedure properties</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dcommand_002dline_002dassignments"><code>process-command-line-assignments</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#System-inquiry">System inquiry</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dexit_002dok_003f"><code>process-exit-ok?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dexit_002dwait"><code>process-exit-wait</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dkeyword_002dargument"><code><i>process-keyword-argument</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-processing_002dinstruction"><code>processing-instruction</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-processing_002dinstruction-1"><code>processing-instruction</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Creating-XML-nodes">Creating XML nodes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-program_002dunit"><code><i>program-unit</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise"><code>promise</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise_002dset_002dalias_0021"><code>promise-set-alias!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise_002dset_002dexception_0021"><code>promise-set-exception!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise_002dset_002dthunk_0021"><code>promise-set-thunk!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise_002dset_002dvalue_0021"><code>promise-set-value!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-promise_005bT_005d"><code>promise[T]</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lazy-evaluation">Lazy evaluation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prompts">prompts</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property_002daccess_002dabbreviation"><code><i>property-access-abbreviation</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Colon-notation">Colon notation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property_002dinitializer"><code><i>property-initializer</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Allocating-objects">Allocating objects</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property_002dname"><code><i>property-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Colon-notation">Colon notation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property_002downer_002dexpression"><code><i>property-owner-expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Colon-notation">Colon notation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-provide"><code>provide</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-Q">Q</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-QName"><code><i>QName</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quantity"><code>quantity</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quantity-1"><code><i>quantity</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quantity_002d_003enumber"><code>quantity-&gt;number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quantity_002d_003eunit"><code>quantity-&gt;unit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quantity_003f"><code>quantity?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quasisyntax"><code>quasisyntax</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quaternion"><code>quaternion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quaternion_002d_003erotation_002dmatrix"><code>quaternion-&gt;rotation-matrix</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quaternion_003f"><code>quaternion?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quot_002dattribute_002ddatum"><code><i>quot-attribute-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quotient"><code>quotient</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-R">R</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-r6rs_002dabbreviation"><code><i>r6rs-abbreviation</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rad"><code>rad</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-raise"><code>raise</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-raise_002dcontinuable"><code>raise-continuable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-range_002dend"><code><i>range-end</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ranges">Ranges</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rational"><code>rational</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rational_002dvalued_003f"><code>rational-valued?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rationalize"><code>rationalize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-re_002dcenter"><code>re-center</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read"><code>read</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dbytevector"><code>read-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dbytevector_0021"><code>read-bytevector!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dchar"><code>read-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002derror_003f"><code>read-error?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dline"><code>read-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dstring"><code>read-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002du8"><code>read-u8</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-real"><code>real</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-real_002dpart"><code>real-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-real_002dvalued_003f"><code>real-valued?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-receive"><code>receive</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002daccessor"><code>record-accessor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dconstructor"><code>record-constructor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dmodifier"><code>record-modifier</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dpredicate"><code>record-predicate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dtype_002ddescriptor"><code>record-type-descriptor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dtype_002dfield_002dnames"><code>record-type-field-names</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_002dtype_002dname"><code>record-type-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-record_003f"><code>record?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Dynamic-records">Dynamic records</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rectangle"><code>rectangle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex"><code>regex</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex-1"><code>regex</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dmatch"><code>regex-match</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dmatch_002dpositions"><code>regex-match-positions</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dquote"><code>regex-quote</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dsplit"><code>regex-split</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dreplace"><code>regex‑replace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-regex_002dreplace_002a"><code>regex‑replace*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Regular-expressions">Regular expressions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remainder"><code>remainder</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rename_002dfile"><code>rename-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rename_002dpair"><code><i>rename-pair</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-report_002dsyntax_002derror"><code>report-syntax-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dbody_002dstring"><code>request-body-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dcontext_002dpath"><code>request-context-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dheader"><code>request-header</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dheader_002dmap"><code>request-header-map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dinput_002dport"><code>request-input-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dinput_002dstream"><code>request-input-stream</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dlocal_002dhost"><code>request-local-host</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dlocal_002dIP_002daddress"><code>request-local-IP-address</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dlocal_002dpath"><code>request-local-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dlocal_002dport"><code>request-local-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dlocal_002dsocket_002daddress"><code>request-local-socket-address</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dmethod"><code>request-method</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dparameter"><code>request-parameter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dparameter_002dmap"><code>request-parameter-map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dparameters"><code>request-parameters</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dpath"><code>request-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dpath_002dinfo"><code>request-path-info</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dpath_002dtranslated"><code>request-path-translated</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dquery_002dstring"><code>request-query-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dremote_002dhost"><code>request-remote-host</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dremote_002dIP_002daddress"><code>request-remote-IP-address</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dremote_002dport"><code>request-remote-port</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dremote_002dsocket_002daddress"><code>request-remote-socket-address</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dscheme"><code>request-scheme</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dscript_002dpath"><code>request-script-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dservlet_002dpath"><code>request-servlet-path</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002dURI"><code>request-URI</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002duri"><code>request-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-request_002durl"><code>request-url</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-requests">HTTP requests</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-require"><code>require</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-require-1"><code>require</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-require-2"><code>require</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Importing">Importing</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-required_002darg"><code><i>required-arg</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-required_002dor_002dguard"><code><i>required-or-guard</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-resolve_002duri"><code>resolve-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-resource_002durl"><code>resource-url</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Resources">Resources</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-response_002dcontent_002dtype"><code>response-content-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-response">HTTP response</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-response_002dheader"><code>response-header</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-response">HTTP response</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-response_002dstatus"><code>response-status</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#HTTP-response">HTTP response</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest_002darg"><code><i>rest-arg</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest_002dkey_002dargs"><code><i>rest-key-args</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-return_002dtype"><code><i>return-type</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reverse_0021"><code>reverse!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lists">Lists</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reverse_002dbit_002dfield"><code>reverse-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reverse_002dlist_002d_003estring"><code>reverse-list-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotate"><code>rotate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotate-1"><code>rotate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotate_002dbit_002dfield"><code>rotate-bit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Logical-Number-Operations">Logical Number Operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotate_002dvector"><code>rotate-vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotation_002dangle"><code>rotation-angle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotation_002daxis"><code>rotation-axis</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotation_002daxis_002fangle"><code>rotation-axis/angle</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotation_002dmatrix_002d_003equaternion"><code>rotation-matrix-&gt;quaternion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotx"><code>rotx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-roty"><code>roty</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rotz"><code>rotz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-round"><code>round</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rpy"><code>rpy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002dprocess"><code>run-process</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-runnable"><code>runnable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Threads">Threads</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-S">S</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector"><code>s16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector-1"><code>s16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector_002d_003elist"><code>s16vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector_002dlength"><code>s16vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector_002dref"><code>s16vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector_002dset_0021"><code>s16vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s16vector_003f"><code>s16vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector"><code>s32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector-1"><code>s32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector_002d_003elist"><code>s32vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector_002dlength"><code>s32vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector_002dref"><code>s32vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector_002dset_0021"><code>s32vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s32vector_003f"><code>s32vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector"><code>s64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector-1"><code>s64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector_002d_003elist"><code>s64vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector_002dlength"><code>s64vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector_002dref"><code>s64vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector_002dset_0021"><code>s64vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s64vector_003f"><code>s64vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector"><code>s8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector-1"><code>s8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector_002d_003elist"><code>s8vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector_002dlength"><code>s8vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector_002dref"><code>s8vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector_002dset_0021"><code>s8vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-s8vector_003f"><code>s8vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scale"><code>scale</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scale-1"><code>scale</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scheme_002dimplementation_002dversion"><code>scheme-implementation-version</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous">Miscellaneous</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scheme_002dreport_002denvironment"><code>scheme-report-environment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Eval-and-Environments">Eval and Environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scheme_002dwindow"><code>scheme-window</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous">Miscellaneous</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002eeval"><code>Scheme.eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Evaluating-Scheme-expressions-from-Java">Evaluating Scheme expressions from Java</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002eeval-1"><code>Scheme.eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Evaluating-Scheme-expressions-from-Java">Evaluating Scheme expressions from Java</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002eeval-2"><code>Scheme.eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Evaluating-Scheme-expressions-from-Java">Evaluating Scheme expressions from Java</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002eregisterEnvironment"><code>Scheme.registerEnvironment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Evaluating-Scheme-expressions-from-Java">Evaluating Scheme expressions from Java</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-servlet_002dcontext_002drealpath"><code>servlet-context-realpath</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dframe_002dsize_0021"><code>set-frame-size!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dinput_002dport_002dline_002dnumber_0021"><code>set-input-port-line-number!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dinput_002dport_002dprompter_0021"><code>set-input-port-prompter!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dport_002dline_0021"><code>set-port-line!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dprocedure_002dproperty_0021"><code>set-procedure-property!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Procedure-properties">Procedure properties</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setter"><code>setter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Locations">Locations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-shape"><code>shape</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-share_002darray"><code>share-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-shebang_002dcomment"><code><i>shebang-comment</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-short"><code>short</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-show_002dpicture"><code>show-picture</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sin"><code>sin</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sin-1"><code>sin</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sinh"><code>sinh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sleep"><code>sleep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Time_002drelated-functions">Time-related functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-slot_002dref"><code>slot-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Field-operations">Field operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-slot_002dset_0021"><code>slot-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Field-operations">Field operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-special_002descape"><code><i>special-escape</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-special_002dinitial"><code><i>special-initial</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-special_002dsubsequent"><code><i>special-subsequent</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sqrt"><code>sqrt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sqrt-1"><code>sqrt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-square"><code>square</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-statement"><code><i>statement</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-statements"><code><i>statements</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bodies">Bodies</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-static_002dfield"><code>static-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Field-operations">Field operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string-3"><code>string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-String"><code>String</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string"><code>string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string-1"><code>string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string-2"><code><i>string</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003ekeyword"><code>string-&gt;keyword</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Keywords">Keywords</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003elist"><code>string-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003enumber"><code>string-&gt;number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-input-and-output">Numerical input and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003esymbol"><code>string-&gt;symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Simple-symbols">Simple symbols</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003eutf16"><code>string-&gt;utf16</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003eutf16be"><code>string-&gt;utf16be</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003eutf16le"><code>string-&gt;utf16le</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003eutf8"><code>string-&gt;utf8</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002d_003evector"><code>string-&gt;vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dany"><code>string-any</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dappend"><code>string-append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dappend_0021"><code>string-append!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcapitalize_0021"><code>string-capitalize!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_002dhash"><code>string-ci-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_002dhash-1"><code>string-ci-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_003c_003d_003f"><code>string-ci&lt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_003c_003f"><code>string-ci&lt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_003d_003f"><code>string-ci=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_003e_003d_003f"><code>string-ci&gt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dci_003e_003f"><code>string-ci&gt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dconcatenate"><code>string-concatenate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dconcatenate_002dreverse"><code>string-concatenate-reverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcontains"><code>string-contains</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcontains_002dright"><code>string-contains-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcopy"><code>string-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcopy_0021"><code>string-copy!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcount"><code>string-count</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor"><code>string-cursor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dend"><code>string-cursor-end</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dfor_002deach"><code>string-cursor-for-each</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dnext"><code>string-cursor-next</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dnext_002dquiet"><code>string-cursor-next-quiet</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dprev"><code>string-cursor-prev</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dref"><code>string-cursor-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_002dstart"><code>string-cursor-start</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_003c_003d_003f"><code>string-cursor&lt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_003c_003f"><code>string-cursor&lt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_003d_003f"><code>string-cursor=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_003e_003d_003f"><code>string-cursor&gt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dcursor_003e_003f"><code>string-cursor&gt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002ddowncase"><code>string-downcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002ddowncase_0021"><code>string-downcase!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002ddrop"><code>string-drop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002ddrop_002dright"><code>string-drop-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002delement"><code><i>string-element</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002devery"><code>string-every</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfill_0021"><code>string-fill!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfilter"><code>string-filter</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfold"><code>string-fold</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfold_002dright"><code>string-fold-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfoldcase"><code>string-foldcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfor_002deach"><code>string-for-each</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfor_002deach-1"><code>string-for-each</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dfor_002deach_002dindex"><code>string-for-each-index</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dhash"><code>string-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dhash-1"><code>string-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dindex"><code>string-index</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dindex_002dright"><code>string-index-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002djoin"><code>string-join</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dlength"><code>string-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dliteral_002dpart"><code><i>string-literal-part</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#String-literals">String literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dmap"><code>string-map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dmap_002dindex"><code>string-map-index</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnormalize_002dnfc"><code>string-normalize-nfc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnormalize_002dnfd"><code>string-normalize-nfd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnormalize_002dnfkc"><code>string-normalize-nfkc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnormalize_002dnfkd"><code>string-normalize-nfkd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnull_003f"><code>string-null?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dpad"><code>string-pad</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dpad_002dright"><code>string-pad-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dprefix_002dlength"><code>string-prefix-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dprefix_003f"><code>string-prefix?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dref"><code>string-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dremove"><code>string-remove</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002drepeat"><code>string-repeat</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreplace"><code>string-replace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreplace_0021"><code>string-replace!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dset_0021"><code>string-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dskip"><code>string-skip</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dskip_002dright"><code>string-skip-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsplit"><code>string-split</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsuffix_002dlength"><code>string-suffix-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsuffix_003f"><code>string-suffix?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtabulate"><code>string-tabulate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtake"><code>string-take</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtake_002dright"><code>string-take-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtitlecase"><code>string-titlecase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtrim"><code>string-trim</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtrim_002dboth"><code>string-trim-both</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtrim_002dright"><code>string-trim-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dunfold"><code>string-unfold</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dunfold_002dright"><code>string-unfold-right</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dupcase"><code>string-upcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dupcase_0021"><code>string-upcase!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Unicode">Unicode</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003c_003d_003f"><code>string&lt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003c_003f"><code>string&lt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003d_003f"><code>string=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003e_003d_003f"><code>string&gt;=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003e_003f"><code>string&gt;?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_003f"><code>string?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subsequent"><code><i>subsequent</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-substring"><code>substring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-substring_002dcursor"><code>substring-cursor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-supplied_002dvar"><code><i>supplied-var</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Extended-formals">Extended formals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol-3"><code>symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol"><code><i>symbol</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol-1"><code>symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol-2"><code>symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002d_003estring"><code>symbol-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Simple-symbols">Simple symbols</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002delement"><code><i>symbol-element</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dhash"><code>symbol-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Hash-tables">Hash tables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dlocal_002dname"><code>symbol-local-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dnamespace"><code>symbol-namespace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dnamespace_002duri"><code>symbol-namespace-uri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dprefix"><code>symbol-prefix</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_002dread_002dcase"><code>symbol-read-case</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_003d_003f"><code>symbol=?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Namespaces">Namespaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol_003f"><code>symbol?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Simple-symbols">Simple symbols</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-synchronized"><code>synchronized</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Threads">Threads</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002d_003edatum"><code>syntax-&gt;datum</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002derror"><code>syntax-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002dobject_002d_003edatum"><code>syntax-object-&gt;datum</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002dpattern"><code><i>syntax-pattern</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002drule"><code><i>syntax-rule</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-syntax_002dtemplate"><code><i>syntax-template</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system"><code>system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002dtmpdir"><code>system-tmpdir</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Files">Files</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-T">T</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dxyz"><code>tait-bryan-xyz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dxzy"><code>tait-bryan-xzy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dyxz"><code>tait-bryan-yxz</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dyzx"><code>tait-bryan-yzx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dzxy"><code>tait-bryan-zxy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tait_002dbryan_002dzyx"><code>tait-bryan-zyx</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tan"><code>tan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tan-1"><code>tan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tanh"><code>tanh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-template_002delement"><code><i>template-element</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-test_002dexpression"><code><i>test-expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-textual_002dport_003f"><code>textual-port?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-this"><code>this</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Objects-Classes-and-Modules">Objects Classes and Modules</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-throw"><code>throw</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tokenize_002dstring_002dto_002dstring_002darray"><code>tokenize-string-to-string-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Processes">Processes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Tomcat">Tomcat</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Servlets">Servlets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tr_002dliteral"><code><i>tr-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-trace"><code>trace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Debugging">Debugging</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-transformer_002dspec"><code><i>transformer-spec</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-translate"><code>translate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-translate-1"><code>translate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-truncate"><code>truncate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-truncate_002dquotient"><code>truncate-quotient</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-truncate_002dremainder"><code>truncate-remainder</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-truncate_002f"><code>truncate/</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arithmetic-operations">Arithmetic operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-try_002dcatch"><code>try-catch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-try_002dfinally"><code>try-finally</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-type"><code><i>type</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Types">Types</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-U">U</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector"><code>u16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector-1"><code>u16vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector_002d_003elist"><code>u16vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector_002dlength"><code>u16vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector_002dref"><code>u16vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector_002dset_0021"><code>u16vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u16vector_003f"><code>u16vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector"><code>u32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector-1"><code>u32vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector_002d_003elist"><code>u32vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector_002dlength"><code>u32vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector_002dref"><code>u32vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector_002dset_0021"><code>u32vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u32vector_003f"><code>u32vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector"><code>u64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector-1"><code>u64vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector_002d_003elist"><code>u64vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector_002dlength"><code>u64vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector_002dref"><code>u64vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector_002dset_0021"><code>u64vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u64vector_003f"><code>u64vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8_002dready_003f"><code>u8-ready?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector"><code>u8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector-1"><code>u8vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector_002d_003elist"><code>u8vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector_002dlength"><code>u8vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector_002dref"><code>u8vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector_002dset_0021"><code>u8vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-u8vector_003f"><code>u8vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ubyte"><code>ubyte</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-uint"><code>uint</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ulong"><code>ulong</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unbounded_002drange"><code><i>unbounded-range</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ranges">Ranges</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unescaped_002ddata"><code>unescaped-data</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Formatting-XML">Formatting XML</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-uniform_002dtag"><code><i>uniform-tag</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-uniform_002dvector"><code><i>uniform-vector</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Uniform-vectors">Uniform vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unit_002dname"><code><i>unit-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unit_002dquaternion"><code>unit-quaternion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unit_002dterm"><code><i>unit-term</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quantities">Quantities</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unit_002dvector"><code>unit-vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unless"><code>unless</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unsyntax"><code>unsyntax</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unsyntax_002dsplicing"><code>unsyntax-splicing</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-untrace"><code>untrace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Debugging">Debugging</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-URI"><code>URI</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-URI_003f"><code>URI?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-URL"><code>URL</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Paths">Paths</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ushort"><code>ushort</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Numerical-types">Numerical types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-utf16_002d_003estring"><code>utf16-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-utf16be_002d_003estring"><code>utf16be-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-utf16le_002d_003estring"><code>utf16le-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-utf8_002d_003estring"><code>utf8-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Bytevectors">Bytevectors</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-V">V</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-values"><code>values</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-values_002dappend"><code>values-append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Multiple-values">Multiple values</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-variable_002dreference"><code><i>variable-reference</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Primitive-expression-syntax">Primitive expression syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vbox"><code>vbox</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vectag"><code><i>vectag</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Arrays">Arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector-3"><code>vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Standard-Types">Standard Types</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector"><code><i>vector</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Datum-syntax">Datum syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector-1"><code>vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector-2"><code>vector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002d_003elist"><code>vector-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002d_003estring"><code>vector-&gt;string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dappend"><code>vector-append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dcopy"><code>vector-copy</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dcopy_0021"><code>vector-copy!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dfill_0021"><code>vector-fill!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dfor_002deach"><code>vector-for-each</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mapping-functions">Mapping functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dlength"><code>vector-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dmap"><code>vector-map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Mapping-functions">Mapping functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dpart"><code>vector-part</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dpattern"><code><i>vector-pattern</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dquaternion_002d_003elist"><code>vector-quaternion-&gt;list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dquaternion_003f"><code>vector-quaternion?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Quaternions">Quaternions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dref"><code>vector-ref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_002dset_0021"><code>vector-set!</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vector_003f"><code>vector?</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Vectors">Vectors</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-W">W</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002das_002derror"><code>warn-as-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dinvoke_002dunknown_002dmethod"><code>warn-invoke-unknown-method</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dundefined_002dvariable"><code><code>warn-undefined-variable</code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dunknown_002dmember"><code>warn-unknown-member</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dunreachable">warn-unreachable</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dunused"><code>warn-unused</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-warn_002dvoid_002dused">warn-void-used</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Options">Options</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-when"><code>when</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Conditionals">Conditionals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-whitespace"><code><i>whitespace</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Lexical-syntax">Lexical syntax</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dcompile_002doptions"><code>with-compile-options</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Module-classes">Module classes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dcomposite"><code>with-composite</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dexception_002dhandler"><code>with-exception-handler</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Exceptions">Exceptions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dinput_002dfrom_002dfile"><code>with-input-from-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002doutput_002dto_002dfile"><code>with-output-to-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dpaint"><code>with-paint</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dsyntax"><code>with-syntax</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Macros">Macros</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dtransform"><code>with-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dtransform-1"><code>with-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dtransform-2"><code>with-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dtransform-3"><code>with-transform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write"><code>write</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002dbytevector"><code>write-bytevector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002dchar"><code>write-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002dshared"><code>write-shared</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002dsimple"><code>write-simple</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002dstring"><code>write-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-write_002du8"><code>write-u8</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Ports">Ports</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-X">X</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dattribute"><code><i>xml-attribute</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dattribute_002dvalue"><code><i>xml-attribute-value</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dCDATA_002dconstructor"><code><i>xml-CDATA-constructor</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dCDATA_002dcontent"><code><i>xml-CDATA-content</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dcharacter_002dreference"><code><i>xml-character-reference</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dcomment_002dconstructor"><code><i>xml-comment-constructor</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dcomment_002dcontent"><code><i>xml-comment-content</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dconstructor"><code><i>xml-constructor</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002delement_002dconstructor"><code><i>xml-element-constructor</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002delement_002ddatum"><code><i>xml-element-datum</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002denclosed_002dexpression"><code><i>xml-enclosed-expression</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dentity_002dname"><code><i>xml-entity-name</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002descaped"><code><i>xml-escaped</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dliteral"><code><i>xml-literal</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dlocal_002dpart"><code><i>xml-local-part</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dname_002dform"><code><i>xml-name-form</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dnamespace_002ddeclaration_002dattribute"><code><i>xml-namespace-declaration-attribute</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dPI_002dconstructor"><code><i>xml-PI-constructor</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dPI_002dcontent"><code><i>xml-PI-content</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dPI_002dtarget"><code><i>xml-PI-target</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xml_002dprefix"><code><i>xml-prefix</i></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#XML-literals">XML literals</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xsubstring"><code>xsubstring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Strings">Strings</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Overall-Index_cp_letter-Z">Z</th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-zbox"><code>zbox</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Composable-pictures">Composable pictures</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Overall-Index_cp_symbol-1"><b>!</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-2"><b>#</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-3"><b>&amp;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-4"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-5"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-6"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-7"><b>/</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_symbol-8"><b>~</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Overall-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-W"><b>W</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-X"><b>X</b></a>
 &nbsp; 
<a class="summary-letter" href="#Overall-Index_cp_letter-Z"><b>Z</b></a>
 &nbsp; 
</td></tr></table>

</div>
</div>


<a href='js_licenses.html' rel='jslicense'><small>JavaScript license information</small></a>
</body>
</html>
